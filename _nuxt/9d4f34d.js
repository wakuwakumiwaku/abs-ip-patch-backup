(window.webpackJsonp=window.webpackJsonp||[]).push([[118,57],{642:function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var n=r(183);var o=r(237),c=r(149);function l(t){return function(t){if(Array.isArray(t))return Object(n.a)(t)}(t)||Object(o.a)(t)||Object(c.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},683:function(t,e,r){"use strict";var n=r(69),o=r(152),c=r(86);t.exports=function(t){for(var e=n(this),r=c(e),l=arguments.length,d=o(l>1?arguments[1]:void 0,r),f=l>2?arguments[2]:void 0,h=void 0===f?r:o(f,r);h>d;)e[d++]=t;return e}},687:function(t,e,r){"use strict";var n=r(9),o=r(683),c=r(124);n({target:"Array",proto:!0},{fill:o}),c("fill")},846:function(t,e,r){"use strict";r.r(e);var n=r(642),o=r(7),c=(r(29),r(17),r(687),r(57),r(15),r(14),r(8),r(352),r(62),r(58),{props:{processing:Boolean,year:Number},data:function(){return{canvas:null,dataUrl:null,yearStats:null}},methods:{initCanvas:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var canvas,r,o,c,l,d,f,h,v,m,w,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.yearStats){e.next=2;break}return e.abrupt("return");case 2:if((canvas=document.createElement("canvas")).width=600,canvas.height=200,r=canvas.getContext("2d"),o=function(t,e,n,o){var c=r.createLinearGradient(t,e,t+n,e+o);c.addColorStop(0,"#44444455"),c.addColorStop(1,"#ffffff11"),r.fillStyle=c,r.strokeStyle="#C0C0C088",r.beginPath(),r.roundRect(t,e,n,o,[20]),r.fill(),r.stroke()},c=function(text,t,e,n,o,c,l){var d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(r.fillStyle=n,r.font="".concat(e," ").concat(t," Source Sans Pro"),r.letterSpacing=o,d)for(var f=r.measureText(text).width;f>d;)console.warn('Text "'.concat(text,'" is greater than max width ').concat(d," (width:").concat(f,")")),text=text.endsWith("...")?text.slice(0,-4):text.slice(0,-3),text+="...",f=r.measureText(text).width,console.log('Checking text "'.concat(text,'" (width:').concat(f,")"));r.fillText(text,c,l)},l=function(t,e,n,o,c){r.fillStyle=e,r.font="".concat(n," Material Symbols Rounded"),r.fillText(t,o,c)},r.fillStyle="#232323",r.fillRect(0,0,canvas.width,canvas.height),(d=t.yearStats.finishedBooksWithCovers).push.apply(d,Object(n.a)(t.yearStats.booksWithCovers)),!d.length){e.next=29;break}f=0,r.globalAlpha=.25,r.save(),r.translate(canvas.width/2,canvas.height/2),r.rotate(-Math.PI/180*25),r.translate(-canvas.width/2,-canvas.height/2),r.translate(-10,-90),h=regeneratorRuntime.mark((function e(n){var o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=regeneratorRuntime.mark((function e(o){var c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=f%d.length,l=d[c],f++,e.next=5,new Promise((function(e){var img=new Image;img.crossOrigin="anonymous",img.addEventListener("load",(function(){var t=img.width;img.width>img.height&&(t=img.height);var c=-(t-img.width)/2,l=-(t-img.height)/2;r.drawImage(img,c,l,t,t,155*n,155*o,155,155),e()})),img.addEventListener("error",(function(){e()})),img.src=t.$store.getters["globals/getLibraryItemCoverSrcById"](l)}));case 5:case"end":return e.stop()}}),e)})),c=0;case 2:if(!(c<3)){e.next=7;break}return e.delegateYield(o(c),"t0",4);case 4:c++,e.next=2;break;case 7:case"end":return e.stop()}}),e)})),v=0;case 23:if(!(v<4)){e.next=28;break}return e.delegateYield(h(v),"t0",25);case 25:v++,e.next=23;break;case 28:r.restore();case 29:r.globalAlpha=1,r.textBaseline="middle",(m=r.createLinearGradient(0,0,canvas.width,canvas.height)).addColorStop(0,"#000000aa"),m.addColorStop(1,"#cd9d49aa"),r.fillStyle=m,r.fillRect(0,0,canvas.width,canvas.height),w="#ffdb70",r.fillStyle=w,r.font="42px absicons",r.fillText("î¤€",15,36),c("audiobookshelf","28px","normal",w,"0px",65,28),c("".concat(t.year," ").concat(t.$strings.StatsYearInReview),"18px","bold","white","1px",65,51),o(15,75,280,110),c(t.yearStats.numBooksFinished,"48px","bold","white","0px",105,120),c(t.$strings.StatsBooksFinished,"20px","normal",w,"0px",105,155,180),(x=new Path2D).addPath(new Path2D("M19 1H5c-1.1 0-1.99.9-1.99 2L3 15.93c0 .69.35 1.3.88 1.66L12 23l8.11-5.41c.53-.36.88-.97.88-1.66L21 3c0-1.1-.9-2-2-2zm-9 15l-5-5 1.41-1.41L10 13.17l7.59-7.59L19 7l-9 9z"),{a:1.5,d:1.5,e:55,f:115}),r.fillStyle="#ffffff",r.fill(x),o(305,75,280,110),c(t.yearStats.numBooksListened,"48px","bold","white","0px",400,120),c(t.$strings.StatsBooksListenedTo,"20px","normal",w,"0px",400,155,180),l("local_library","white","42px",345,130),t.canvas=canvas,t.dataUrl=canvas.toDataURL("png");case 56:case"end":return e.stop()}}),e)})))()},share:function(){var t=this;this.canvas.toBlob((function(e){var r={files:[new File([e],"yearinreviewshort.png",{type:e.type})]};navigator.canShare(r)?navigator.share(r).then((function(){console.log("Share success")})).catch((function(e){console.error("Failed to share",e),"AbortError"!==e.name&&t.$toast.error(t.$strings.ToastFailedToShare+": "+e.message)})):t.$toast.error(t.$strings.ToastErrorCannotShare)}))},refresh:function(){this.init()},init:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$emit("update:processing",!0),e.next=3,t.$axios.$get("/api/me/stats/year/".concat(t.year)).catch((function(e){return console.error("Failed to load stats for year",e),t.$toast.error(t.$strings.ToastFailedToLoadData),null}));case 3:return t.yearStats=e.sent,e.next=6,t.initCanvas();case 6:t.$emit("update:processing",!1);case 7:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.init()}}),l=c,d=r(4),component=Object(d.a)(l,(function(){var t=this,e=t._self._c;return e("div",[t.processing?e("div",{staticClass:"max-w-[600px] h-32 sm:h-[200px] flex items-center justify-center"},[e("widgets-loading-spinner")],1):t.dataUrl?e("img",{attrs:{src:t.dataUrl}}):t._e()])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{WidgetsLoadingSpinner:r(151).default})}}]);