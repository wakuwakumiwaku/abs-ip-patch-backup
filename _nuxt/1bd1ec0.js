(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{1071:function(t,e,r){"use strict";r.r(e);var n=r(16),o=r(7),c=(r(29),r(85),r(22),r(26),r(27),r(44),r(45),r(38),r(150),r(108),r(8),r(28),r(690));function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){Object(n.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var m={components:{draggable:r.n(c).a},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.store,n=t.params,o=t.app,c=t.redirect,t.route,r.getters["user/getUserCanUpdate"]){e.next=3;break}return e.abrupt("return",c("/?error=unauthorized"));case 3:return e.next=5,o.$axios.$get("/api/items/".concat(n.id,"?expanded=1")).catch((function(t){return console.error("Failed",t),!1}));case 5:if(l=e.sent){e.next=9;break}return console.error("Not found...",n.id),e.abrupt("return",c("/"));case 9:if("book"==l.mediaType){e.next=12;break}return console.error("Invalid media type"),e.abrupt("return",c("/"));case 12:if(!l.isFile){e.next=15;break}return console.error("No need to edit library item that is 1 file..."),e.abrupt("return",c("/"));case 15:if(r.state.libraries.currentLibraryId===l.libraryId&&r.state.libraries.filterData){e.next=18;break}return e.next=18,r.dispatch("libraries/fetch",l.libraryId);case 18:return e.abrupt("return",{libraryItem:l,files:l.media.audioFiles?l.media.audioFiles.map((function(t){return d(d({},t),{},{include:!t.exclude})})):[]});case 19:case"end":return e.stop()}}),e)})))()},data:function(){return{drag:!1,dragOptions:{animation:200,group:"description",ghostClass:"ghost"},saving:!1,currentSort:"current"}},computed:{media:function(){return this.libraryItem.media||{}},mediaMetadata:function(){return this.media.metadata||[]},audioFiles:function(){return this.media.audioFiles||[]},numExcluded:function(){var t=0;return this.files.forEach((function(e){e.include||t++})),t},libraryItemId:function(){return this.libraryItem.id},title:function(){return this.mediaMetadata.title||"No Title"},author:function(){return this.mediaMetadata.authorName||"Unknown"},tracks:function(){return this.media.tracks},streamLibraryItem:function(){return this.$store.state.streamLibraryItem}},methods:{draggableUpdate:function(t){this.currentSort=""},sortByCurrent:function(){this.files.sort((function(a,b){return null===a.index?1:a.index-b.index})),this.currentSort="current"},sortByMetadataTrack:function(){this.files.sort((function(a,b){return null===a.trackNumFromMeta?1:a.trackNumFromMeta-b.trackNumFromMeta})),this.currentSort="metadata"},sortByFilenameTrack:function(){this.files.sort((function(a,b){return null===a.trackNumFromFilename?1:a.trackNumFromFilename-b.trackNumFromFilename})),this.currentSort="track-filename"},sortByFilename:function(){this.files.sort((function(a,b){return(a.metadata.filename||"").toLowerCase().localeCompare((b.metadata.filename||"").toLowerCase())})),this.currentSort="filename"},includeToggled:function(audio){var t=0;audio.include&&(t=this.numExcluded);var e=this.files.findIndex((function(t){return t.ino===audio.ino}));if(t>=this.files.length)for(var r=t-this.files.length+1;r--;)this.files.push(void 0);this.files.splice(t,0,this.files.splice(e,1)[0])},saveTracklist:function(){var t=this,e=this.files.map((function(t){return{index:t.index,filename:t.metadata.filename,ino:t.ino,exclude:!t.include}}));this.saving=!0,this.$axios.$patch("/api/items/".concat(this.libraryItem.id,"/tracks"),{orderedFileData:e}).then((function(data){console.log("Finished patching files",data),t.saving=!1,t.$toast.success("Tracks Updated"),t.$router.push("/item/".concat(t.libraryItemId))})).catch((function(e){console.error("Failed",e),t.saving=!1}))}}},f=r(4),component=Object(f.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg-bg page overflow-hidden relative",class:t.streamLibraryItem?"streaming":"",attrs:{id:"page-wrapper"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.saving,expression:"saving"}],staticClass:"absolute z-20 w-full h-full flex items-center justify-center"},[e("ui-loading-indicator")],1),t._v(" "),e("div",{staticClass:"w-full h-full overflow-y-auto p-8"},[e("div",{staticClass:"w-full flex justify-between items-center pb-6 pt-2"},[e("p",{staticClass:"text-lg"},[t._v(t._s(t.$strings.MessageDragFilesIntoTrackOrder))]),t._v(" "),e("ui-btn",{attrs:{color:"bg-success"},on:{click:t.saveTracklist}},[t._v(t._s(t.$strings.ButtonSaveTracklist))])],1),t._v(" "),e("div",{staticClass:"w-full flex items-center text-sm py-4 bg-primary border-l border-r border-t border-gray-600"},[e("div",{staticClass:"text-center px-4 w-12"},[t._v(t._s(t.$strings.LabelNew))]),t._v(" "),e("div",{staticClass:"text-center px-4 w-24 flex items-center cursor-pointer text-white/40 hover:text-white/100",on:{click:t.sortByCurrent,mousedown:function(t){t.preventDefault()}}},[e("span",{staticClass:"text-white"},[t._v(t._s(t.$strings.LabelCurrent))]),t._v(" "),e("span",{staticClass:"material-symbols ml-1",class:"current"===t.currentSort?"text-white/100 text-lg":"text-sm"},[t._v(t._s("current"===t.currentSort?"expand_more":"unfold_more"))])]),t._v(" "),e("div",{staticClass:"text-center px-4 w-32 flex items-center cursor-pointer text-white/40 hover:text-white/100",on:{click:t.sortByFilenameTrack,mousedown:function(t){t.preventDefault()}}},[e("span",{staticClass:"text-white"},[t._v(t._s(t.$strings.LabelTrackFromFilename))]),t._v(" "),e("span",{staticClass:"material-symbols ml-1",class:"track-filename"===t.currentSort?"text-white/100 text-lg":"text-sm"},[t._v(t._s("track-filename"===t.currentSort?"expand_more":"unfold_more"))])]),t._v(" "),e("div",{staticClass:"text-center px-4 w-32 flex items-center cursor-pointer text-white/40 hover:text-white/100",on:{click:t.sortByMetadataTrack,mousedown:function(t){t.preventDefault()}}},[e("span",{staticClass:"text-white"},[t._v(t._s(t.$strings.LabelTrackFromMetadata))]),t._v(" "),e("span",{staticClass:"material-symbols ml-1",class:"metadata"===t.currentSort?"text-white/100 text-lg":"text-sm"},[t._v(t._s("metadata"===t.currentSort?"expand_more":"unfold_more"))])]),t._v(" "),e("div",{staticClass:"w-20 text-center"},[t._v(t._s(t.$strings.LabelDiscFromFilename))]),t._v(" "),e("div",{staticClass:"w-20 text-center"},[t._v(t._s(t.$strings.LabelDiscFromMetadata))]),t._v(" "),e("div",{staticClass:"text-center px-4 grow flex items-center cursor-pointer text-white/40 hover:text-white/100",on:{click:t.sortByFilename,mousedown:function(t){t.preventDefault()}}},[e("span",{staticClass:"text-white"},[t._v(t._s(t.$strings.LabelFilename))]),t._v(" "),e("span",{staticClass:"material-symbols ml-1",class:"filename"===t.currentSort?"text-white/100 text-lg":"text-sm"},[t._v(t._s("filename"===t.currentSort?"expand_more":"unfold_more"))])]),t._v(" "),e("div",{staticClass:"w-20 text-center"},[t._v(t._s(t.$strings.LabelSize))]),t._v(" "),e("div",{staticClass:"w-20 text-center"},[t._v(t._s(t.$strings.LabelDuration))]),t._v(" "),e("div",{staticClass:"w-56"},[t._v(t._s(t.$strings.LabelNotes))]),t._v(" "),e("div",{staticClass:"w-40"},[t._v(t._s(t.$strings.LabelIncludeInTracklist))])]),t._v(" "),e("draggable",t._b({staticClass:"list-group border border-gray-600",attrs:{draggable:".item",tag:"ul"},on:{start:function(e){t.drag=!0},end:function(e){t.drag=!1},update:t.draggableUpdate},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}},"draggable",t.dragOptions,!1),[e("transition-group",{attrs:{type:"transition",name:t.drag?null:"flip-list"}},t._l(t.files,(function(audio,r){return e("li",{key:audio.ino,staticClass:"w-full list-group-item flex items-center relative",class:audio.include?"item":"exclude"},[e("div",{staticClass:"text-center px-4 py-1 w-12 min-w-12"},[t._v("\n            "+t._s(audio.include?r-t.numExcluded+1:-1)+"\n          ")]),t._v(" "),e("div",{staticClass:"text-center px-4 w-24 min-w-24"},[t._v(t._s(audio.index))]),t._v(" "),e("div",{staticClass:"text-center px-2 w-32 min-w-32"},[t._v("\n            "+t._s(audio.trackNumFromFilename)+"\n          ")]),t._v(" "),e("div",{staticClass:"text-center w-32 min-w-32"},[t._v("\n            "+t._s(audio.trackNumFromMeta)+"\n          ")]),t._v(" "),e("div",{staticClass:"truncate px-4 w-20 min-w-20"},[t._v("\n            "+t._s(audio.discNumFromFilename)+"\n          ")]),t._v(" "),e("div",{staticClass:"truncate px-4 w-20 min-w-20"},[t._v("\n            "+t._s(audio.discNumFromMeta)+"\n          ")]),t._v(" "),e("div",{staticClass:"truncate px-4 grow"},[t._v("\n            "+t._s(audio.metadata.filename)+"\n          ")]),t._v(" "),e("div",{staticClass:"font-mono w-20 min-w-20 text-center text-xs"},[t._v("\n            "+t._s(t.$bytesPretty(audio.metadata.size))+"\n          ")]),t._v(" "),e("div",{staticClass:"font-mono w-20 min-w-20 text-center text-xs"},[t._v("\n            "+t._s(t.$secondsToTimestamp(audio.duration))+"\n          ")]),t._v(" "),e("div",{staticClass:"font-sans text-xs font-normal w-56 min-w-[224px]"},[t._v("\n            "+t._s(audio.error)+"\n          ")]),t._v(" "),e("div",{staticClass:"font-sans text-xs font-normal w-40 min-w-[160px] flex items-center justify-center"},[e("ui-toggle-switch",{attrs:{"off-color":"error"},on:{input:function(e){return t.includeToggled(audio)}},model:{value:audio.include,callback:function(e){t.$set(audio,"include",e)},expression:"audio.include"}})],1)])})),0)],1)],1)])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiLoadingIndicator:r(348).default,UiBtn:r(42).default,UiToggleSwitch:r(185).default})}}]);