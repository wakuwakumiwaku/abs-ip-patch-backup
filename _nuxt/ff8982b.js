(window.webpackJsonp=window.webpackJsonp||[]).push([[198,149],{1062:function(e,t,r){"use strict";r.r(t);r(147);var o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"absolute z-0 top-0 left-0 px-6 py-3"},[t("div",{staticClass:"flex items-center"},[t("img",{staticClass:"w-10 min-w-10 h-10",attrs:{src:r(253),alt:"Audiobookshelf Logo"}}),e._v(" "),t("h1",{staticClass:"text-xl ml-4 hidden lg:block hover:underline"},[e._v("audiobookshelf")])])])}],n=r(16),c=r(7);r(29),r(22),r(17),r(41),r(8),r(35),r(52),r(62),r(26),r(44),r(45),r(38),r(63),r(77),r(28),r(58),r(703),r(704),r(350);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m={layout:"blank",data:function(){return{error:null,criticalError:null,processing:!1,username:"",password:null,showInitScreen:!1,isInit:!1,newRoot:{username:"root",password:""},confirmPassword:"",ConfigPath:"",MetadataPath:"",login_local:!0,login_openid:!1,authFormData:null,showNewAuthSystemMessage:!1,showNewAuthSystemAdminMessage:!1}},watch:{user:function(e){if(e)if(this.$store.state.libraries.currentLibraryId){if(this.$route.query.redirect){var t=this.$store.getters["user/getIsAdminOrUp"],r=this.$route.query.redirect;if(t||!r.startsWith("/config/")||"/config/stats"===r)return void this.$router.replace(r)}this.$router.replace("/library/".concat(this.$store.state.libraries.currentLibraryId))}else this.$store.getters["user/getIsRoot"]?this.$router.replace("/config/libraries"):this.$router.replace("/oops?message=No libraries available")}},computed:{user:function(){return this.$store.state.user.user},openidAuthUri:function(){return"".concat("/audiobookshelf","/auth/openid?callback=").concat(location.href.split("?").shift())},openIDButtonText:function(){var e;return(null===(e=this.authFormData)||void 0===e?void 0:e.authOpenIDButtonText)||"Login with OpenId"},loginCustomMessage:function(){var e;return(null===(e=this.authFormData)||void 0===e?void 0:e.authLoginCustomMessage)||null}},methods:{submitServerSetup:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.newRoot.username&&e.newRoot.username.trim()){t.next=3;break}return e.$toast.error(e.$strings.ToastUserRootRequireName),t.abrupt("return");case 3:if(e.newRoot.password===e.confirmPassword){t.next=6;break}return e.$toast.error(e.$strings.ToastUserPasswordMismatch),t.abrupt("return");case 6:if(e.newRoot.password){t.next=9;break}if(confirm("Are you sure you want to create the root user with no password?")){t.next=9;break}return t.abrupt("return");case 9:return e.processing=!0,r={newRoot:d({},e.newRoot)},t.next=13,e.$axios.$post("/init",r).then((function(){return!0})).catch((function(t){console.error("Failed",t.response);var r=t.response&&t.response.data||"Unknown Error";return e.$toast.error(r),!1}));case 13:if(t.sent){t.next=17;break}return e.processing=!1,t.abrupt("return");case 17:location.reload();case 18:case"end":return t.stop()}}),t)})))()},setUser:function(e){var t=e.user,o=e.userDefaultLibraryId,n=e.serverSettings,c=e.Source,l=e.ereaderDevices;this.$store.commit("setServerSettings",n),this.$store.commit("setSource",c),this.$store.commit("libraries/setEReaderDevices",l),this.$setServerLanguageCode(n.language),n.chromecastEnabled&&(console.log("Chromecast enabled import script"),r(911).default(this)),this.$store.commit("libraries/setLastLoad",0),this.$store.commit("libraries/setCurrentLibrary",{id:o}),this.$store.commit("user/setUser",t),t.accessToken&&this.$store.commit("user/setAccessToken",t.accessToken),this.$store.dispatch("user/loadUserSettings")},submitForm:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.error=null,e.showNewAuthSystemMessage=!1,e.showNewAuthSystemAdminMessage=!1,e.processing=!0,r={username:e.username,password:e.password||""},t.next=7,e.$axios.$post("/login",r).catch((function(t){return console.error("Failed",t.response),t.response?e.error=t.response.data:e.error="Unknown Error",!1}));case 7:null!=(o=t.sent)&&o.error?e.error=o.error:o&&e.setUser(o),e.processing=!1;case 10:case"end":return t.stop()}}),t)})))()},checkAuth:function(){var e=this,t=localStorage.getItem("token");return!!t&&(this.processing=!0,this.$store.commit("user/setAccessToken",t),this.$axios.$post("/api/authorize",null,{headers:{Authorization:"Bearer ".concat(t)}}).then((function(t){return t.user.isOldToken?(e.username=t.user.username,e.showNewAuthSystemMessage=!0,e.showNewAuthSystemAdminMessage="admin"===t.user.type||"root"===t.user.type,!1):(e.setUser(t),!0)})).catch((function(e){return console.error("Authorize error",e),!1})).finally((function(){e.processing=!1})))},checkStatus:function(){var e=this;this.processing=!0,this.$axios.$get("/status").then((function(data){e.isInit=data.isInit,e.showInitScreen=!data.isInit,e.$setServerLanguageCode(data.language),e.showInitScreen?(e.ConfigPath=data.ConfigPath||"",e.MetadataPath=data.MetadataPath||""):(e.authFormData=data.authFormData,e.updateLoginVisibility(data.authMethods||[]))})).catch((function(t){console.error("Status check failed",t),e.criticalError="Status check failed"})).finally((function(){e.processing=!1}))},updateLoginVisibility:function(e){var t,r,o,n;if(null!==(t=this.$route.query)&&void 0!==t&&t.error){this.error=this.$route.query.error;var c=new URL(location.href);c.searchParams.delete("error"),window.history.replaceState({path:c.href},"",c.href)}(e.includes("local")||!e.length?this.login_local=!0:this.login_local=!1,e.includes("openid"))?((null!==(r=this.authFormData)&&void 0!==r&&r.authOpenIDAutoLaunch&&"0"!==(null===(o=this.$route.query)||void 0===o?void 0:o.autoLaunch)||"1"==(null===(n=this.$route.query)||void 0===n?void 0:n.autoLaunch))&&(window.location.href=this.openidAuthUri),this.login_openid=!0):this.login_openid=!1}},mounted:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==(r=e.$route.query)&&void 0!==r&&r.accessToken&&localStorage.setItem("token",e.$route.query.accessToken),!localStorage.getItem("token")){t.next=6;break}return t.next=4,e.checkAuth();case 4:if(!t.sent){t.next=6;break}return t.abrupt("return");case 6:e.checkStatus();case 7:case"end":return t.stop()}}),t)})))()}},h=r(4),component=Object(h.a)(m,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"w-full h-screen overflow-y-auto",attrs:{id:"page-wrapper"}},[e._m(0),e._v(" "),t("div",{staticClass:"relative z-10 w-full flex h-full items-center justify-center"},[e.criticalError?t("div",{staticClass:"w-full max-w-md rounded-sm border border-error/25 bg-error/10 p-4"},[t("p",{staticClass:"text-center text-lg font-semibold"},[e._v(e._s(e.$strings.MessageServerCouldNotBeReached))])]):e.showInitScreen?t("div",{staticClass:"w-full max-w-lg px-4 md:px-8 pb-8 pt-4"},[t("p",{staticClass:"text-3xl text-white text-center mb-4"},[e._v("Initial Server Setup")]),e._v(" "),t("div",{staticClass:"w-full h-px bg-white/10 my-4"}),e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitServerSetup.apply(null,arguments)}}},[t("p",{staticClass:"text-lg font-semibold mb-2 pl-1 text-center"},[e._v("Create Root User")]),e._v(" "),t("ui-text-input-with-label",{staticClass:"w-full mb-3 text-sm",attrs:{label:"Username",disabled:e.processing},model:{value:e.newRoot.username,callback:function(t){e.$set(e.newRoot,"username","string"==typeof t?t.trim():t)},expression:"newRoot.username"}}),e._v(" "),t("ui-text-input-with-label",{staticClass:"w-full mb-3 text-sm",attrs:{label:"Password",type:"password",disabled:e.processing},model:{value:e.newRoot.password,callback:function(t){e.$set(e.newRoot,"password",t)},expression:"newRoot.password"}}),e._v(" "),t("ui-text-input-with-label",{staticClass:"w-full mb-3 text-sm",attrs:{label:"Confirm Password",type:"password",disabled:e.processing},model:{value:e.confirmPassword,callback:function(t){e.confirmPassword=t},expression:"confirmPassword"}}),e._v(" "),t("p",{staticClass:"text-lg font-semibold mt-6 mb-2 pl-1 text-center"},[e._v("Directory Paths")]),e._v(" "),t("ui-text-input-with-label",{staticClass:"w-full mb-3 text-sm",attrs:{label:"Config Path",disabled:""},model:{value:e.ConfigPath,callback:function(t){e.ConfigPath=t},expression:"ConfigPath"}}),e._v(" "),t("ui-text-input-with-label",{staticClass:"w-full mb-3 text-sm",attrs:{label:"Metadata Path",disabled:""},model:{value:e.MetadataPath,callback:function(t){e.MetadataPath=t},expression:"MetadataPath"}}),e._v(" "),t("div",{staticClass:"w-full flex justify-end py-3"},[t("ui-btn",{staticClass:"leading-none",attrs:{type:"submit",disabled:e.processing,color:"bg-primary"}},[e._v(e._s(e.processing?"Initializing...":e.$strings.ButtonSubmit))])],1)],1)]):e.isInit?t("div",{staticClass:"w-full max-w-md px-8 pb-8 pt-4 lg:-mt-40"},[t("div",{staticClass:"bg-bg rounded-md shadow-lg border border-white/5 p-4"},[t("p",{staticClass:"text-2xl font-semibold text-center text-white mb-4"},[e._v(e._s(e.$strings.HeaderLogin))]),e._v(" "),t("div",{staticClass:"w-full h-px bg-white/10 my-4"}),e._v(" "),e.loginCustomMessage?t("p",{staticClass:"py-2 default-style mb-2",domProps:{innerHTML:e._s(e.loginCustomMessage)}}):e._e(),e._v(" "),e.error?t("p",{staticClass:"text-error text-center py-2"},[e._v(e._s(e.error))]):e._e(),e._v(" "),e.showNewAuthSystemMessage?t("div",{staticClass:"mb-4"},[t("widgets-alert",{attrs:{type:"warning"}},[t("div",[t("p",[e._v(e._s(e.$strings.MessageAuthenticationSecurityMessage))]),e._v(" "),e.showNewAuthSystemAdminMessage?t("a",{staticClass:"underline",attrs:{href:"https://github.com/advplyr/audiobookshelf/discussions/4460",target:"_blank"}},[e._v(e._s(e.$strings.LabelMoreInfo))]):e._e()])])],1):e._e(),e._v(" "),t("form",{directives:[{name:"show",rawName:"v-show",value:e.login_local,expression:"login_local"}],on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("label",{staticClass:"text-xs text-gray-300 uppercase"},[e._v(e._s(e.$strings.LabelUsername))]),e._v(" "),t("ui-text-input",{staticClass:"mb-3 w-full",attrs:{disabled:e.processing,inputName:"username"},model:{value:e.username,callback:function(t){e.username="string"==typeof t?t.trim():t},expression:"username"}}),e._v(" "),t("label",{staticClass:"text-xs text-gray-300 uppercase"},[e._v(e._s(e.$strings.LabelPassword))]),e._v(" "),t("ui-text-input",{staticClass:"w-full mb-3",attrs:{type:"password",disabled:e.processing,inputName:"password"},model:{value:e.password,callback:function(t){e.password="string"==typeof t?t.trim():t},expression:"password"}}),e._v(" "),t("div",{staticClass:"w-full flex justify-end py-3"},[t("ui-btn",{staticClass:"leading-none",attrs:{type:"submit",disabled:e.processing,color:"bg-primary"}},[e._v(e._s(e.processing?"Checking...":e.$strings.ButtonSubmit))])],1)],1),e._v(" "),e.login_local&&e.login_openid?t("div",{staticClass:"w-full h-px bg-white/10 my-4"}):e._e(),e._v(" "),t("div",{staticClass:"w-full flex py-3"},[e.login_openid?t("a",{staticClass:"w-full abs-btn outline-hidden rounded-md shadow-md relative border border-gray-600 text-center bg-primary text-white px-8 py-2 leading-none",attrs:{href:e.openidAuthUri}},[e._v("\n            "+e._s(e.openIDButtonText)+"\n          ")]):e._e()])])]):e._e()])])}),o,!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:r(121).default,UiBtn:r(42).default,WidgetsAlert:r(657).default,UiTextInput:r(68).default})},657:function(e,t,r){"use strict";r.r(t);var o={props:{type:{type:String,default:"error"}},data:function(){return{}},computed:{icon:function(){return"error"===this.type||"warning"===this.type?"report":"info"},wrapperClass:function(){switch(this.type){case"error":return"bg-error/5 border-error/60 text-error";case"warning":return"bg-warning/5 border-warning/60 text-warning";case"success":return"bg-success/5 border-success/60 text-success";case"info":return"bg-info/5 border-info/60 text-info";default:return"bg-primary/5 border-primary/60 text-primary"}}},methods:{},mounted:function(){}},n=r(4),component=Object(n.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"w-full border rounded-lg flex items-center relative py-4 pl-16",class:e.wrapperClass},[t("div",{staticClass:"absolute top-0 left-4 h-full flex items-center"},[t("span",{staticClass:"material-symbols text-2xl"},[e._v(e._s(e.icon))])]),e._v(" "),e._t("default")],2)}),[],!1,null,null,null);t.default=component.exports},911:function(e,t,r){"use strict";r.r(t);var o=r(7);r(29),r(17),r(26),r(27),r(8),r(40);t.default=function(e){var t=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(r){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.$get("/api/libraries/".concat(e.$store.state.libraries.currentLibraryId,"/items?limit=40&minified=1")).then((function(data){return data.results.filter((function(b){return b.media.coverPath})).map((function(t){var r=e.$store.getters["globals/getLibraryItemCoverSrc"](t);return"".concat(window.location.origin).concat(r)}))})).catch((function(e){return console.error("failed to fetch books",e),null}));case 2:o=t.sent,r.getCurrentSession().sendMessage("urn:x-cast:com.audiobookshelf.cast",{covers:o});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();window.__onGCastApiAvailable=function(r){r&&function(){var r=cast.framework.CastContext.getInstance();r.setOptions({receiverApplicationId:"FD1F76C5",autoJoinPolicy:chrome.cast?chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED:null}),r.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,(function(o){switch(console.log("Session state changed event",o),o.sessionState){case cast.framework.SessionState.SESSION_STARTED:console.log("[chromecast] CAST SESSION STARTED"),e.$store.commit("globals/setCasting",!0),t(r),setTimeout((function(){e.$eventBus.$emit("cast-session-active",!0)}),500);break;case cast.framework.SessionState.SESSION_RESUMED:console.log("[chromecast] CAST SESSION RESUMED"),setTimeout((function(){e.$eventBus.$emit("cast-session-active",!0)}),500);break;case cast.framework.SessionState.SESSION_ENDED:console.log("[chromecast] CAST SESSION DISCONNECTED"),e.$store.commit("globals/setCasting",!1),e.$eventBus.$emit("cast-session-active",!1)}})),e.$store.commit("globals/setChromecastInitialized",!0);var o=new cast.framework.RemotePlayer,n=new cast.framework.RemotePlayerController(o);e.$root.castPlayer=o,e.$root.castPlayerController=n}()};var script=document.createElement("script");script.type="text/javascript",script.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.head.appendChild(script)}}}]);