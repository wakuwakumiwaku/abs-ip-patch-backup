(window.webpackJsonp=window.webpackJsonp||[]).push([[180,59,68,99],{1052:function(t,e,n){"use strict";n.r(e);var o=n(7),r=(n(29),n(14),n(8),n(62),n(58),n(703),n(704),n(350),{asyncData:function(t){var e=t.store,n=t.redirect;e.getters["user/getIsAdminOrUp"]||n("/")},data:function(){return{loading:!1,savingSettings:!1,appriseApiUrl:null,maxNotificationQueue:0,maxFailedAttempts:0,notifications:[],notificationSettings:null,notificationData:null,showEditModal:!1,selectedNotification:null,sendingTest:!1}},computed:{},methods:{updateSettings:function(t){this.notificationSettings=t,this.notifications=t.notifications},editNotification:function(t){this.selectedNotification=t,this.showEditModal=!0},clickCreate:function(){this.selectedNotification=null,this.showEditModal=!0},validateAppriseApiUrl:function(){try{return new URL(this.appriseApiUrl)}catch(t){return console.log("URL error",t),this.$toast.error(t.message),!1}},validateForm:function(){return this.$refs.apiUrlInput&&this.$refs.apiUrlInput.blur(),this.$refs.maxNotificationQueueInput&&this.$refs.maxNotificationQueueInput.blur(),this.$refs.maxFailedAttemptsInput&&this.$refs.maxFailedAttemptsInput.blur(),!!this.validateAppriseApiUrl()&&(isNaN(this.maxNotificationQueue)||this.maxNotificationQueue<=0?(this.$toast.error(this.$strings.ToastNotificationQueueMaximum),!1):!(isNaN(this.maxFailedAttempts)||this.maxFailedAttempts<=0)||(this.$toast.error(this.$strings.ToastNotificationFailedMaximum),!1))},submitForm:function(){var t=this;if(this.validateForm()){var e={appriseApiUrl:this.appriseApiUrl||null,maxNotificationQueue:Number(this.maxNotificationQueue),maxFailedAttempts:Number(this.maxFailedAttempts)};this.savingSettings=!0,this.$axios.$patch("/api/notifications",e).then((function(){t.$toast.success(t.$strings.ToastNotificationSettingsUpdateSuccess)})).catch((function(e){console.error("Failed to update notification settings",e),t.$toast.error(t.$strings.ToastFailedToUpdate)})).finally((function(){t.savingSettings=!1}))}},init:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$axios.$get("/api/notifications").catch((function(e){return console.error("Failed to get notification settings",e),t.$toast.error(t.$strings.ToastFailedToLoadData),null}));case 3:if(n=e.sent,t.loading=!1,n){e.next=7;break}return e.abrupt("return");case 7:t.notificationData=n.data,t.setNotificationSettings(n.settings);case 9:case"end":return e.stop()}}),e)})))()},setNotificationSettings:function(t){this.notificationSettings=t,this.appriseApiUrl=t.appriseApiUrl,this.maxNotificationQueue=t.maxNotificationQueue,this.maxFailedAttempts=t.maxFailedAttempts,this.notifications=t.notifications||[]},notificationsUpdated:function(t){console.log("Notifications updated",t),this.setNotificationSettings(t)}},mounted:function(){this.init(),this.$root.socket.on("notifications_updated",this.notificationsUpdated)},beforeDestroy:function(){this.$root.socket.off("notifications_updated",this.notificationsUpdated)}}),l=n(4),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("div",[e("app-settings-content",{attrs:{"header-text":t.$strings.HeaderAppriseNotificationSettings,description:t.$strings.MessageAppriseDescription}},[e("form",{on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[e("ui-text-input-with-label",{ref:"apiUrlInput",staticClass:"mb-2",attrs:{disabled:t.savingSettings,label:"Apprise API Url"},model:{value:t.appriseApiUrl,callback:function(e){t.appriseApiUrl=e},expression:"appriseApiUrl"}}),t._v(" "),e("div",{staticClass:"flex items-center py-2"},[e("ui-text-input",{ref:"maxNotificationQueueInput",staticClass:"w-10",attrs:{type:"number","no-spinner":"",disabled:t.savingSettings,"padding-x":1,"text-center":""},model:{value:t.maxNotificationQueue,callback:function(e){t.maxNotificationQueue=e},expression:"maxNotificationQueue"}}),t._v(" "),e("ui-tooltip",{attrs:{text:t.$strings.LabelNotificationsMaxQueueSizeHelp,direction:"right"}},[e("p",{staticClass:"pl-2 md:pl-4 text-base md:text-lg"},[t._v(t._s(t.$strings.LabelNotificationsMaxQueueSize)),e("span",{staticClass:"material-symbols icon-text ml-1"},[t._v("info")])])])],1),t._v(" "),e("div",{staticClass:"flex items-center py-2"},[e("ui-text-input",{ref:"maxFailedAttemptsInput",staticClass:"w-10",attrs:{type:"number","no-spinner":"",disabled:t.savingSettings,"padding-x":1,"text-center":""},model:{value:t.maxFailedAttempts,callback:function(e){t.maxFailedAttempts=e},expression:"maxFailedAttempts"}}),t._v(" "),e("ui-tooltip",{attrs:{text:t.$strings.LabelNotificationsMaxFailedAttemptsHelp,direction:"right"}},[e("p",{staticClass:"pl-2 md:pl-4 text-base md:text-lg"},[t._v(t._s(t.$strings.LabelNotificationsMaxFailedAttempts)),e("span",{staticClass:"material-symbols icon-text ml-1"},[t._v("info")])])])],1),t._v(" "),e("div",{staticClass:"flex items-center justify-end pt-4"},[e("ui-btn",{attrs:{loading:t.savingSettings,type:"submit"}},[t._v(t._s(t.$strings.ButtonSave))])],1)],1),t._v(" "),e("div",{staticClass:"w-full h-px bg-white/10 my-6"}),t._v(" "),e("div",{staticClass:"flex items-center justify-between mb-6"},[e("h2",{staticClass:"text-xl font-semibold"},[t._v(t._s(t.$strings.HeaderNotifications))]),t._v(" "),e("ui-btn",{staticClass:"flex items-center",attrs:{small:"",color:"bg-success"},on:{click:t.clickCreate}},[t._v(t._s(t.$strings.ButtonCreate)+" "),e("span",{staticClass:"material-symbols text-lg pl-2"},[t._v("add")])])],1),t._v(" "),t.notifications.length?t._e():e("div",{staticClass:"flex justify-center text-center"},[e("p",{staticClass:"text-lg text-gray-200"},[t._v(t._s(t.$strings.MessageNoNotifications))])]),t._v(" "),t._l(t.notifications,(function(n){return[e("cards-notification-card",{key:n.id,attrs:{notification:n},on:{update:t.updateSettings,edit:t.editNotification}})]}))],2),t._v(" "),e("modals-notification-edit-modal",{attrs:{notification:t.selectedNotification,"notification-data":t.notificationData},on:{update:t.updateSettings},model:{value:t.showEditModal,callback:function(e){t.showEditModal=e},expression:"showEditModal"}})],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiTextInputWithLabel:n(121).default,UiTextInput:n(68).default,UiTooltip:n(76).default,UiBtn:n(42).default,CardsNotificationCard:n(842).default,AppSettingsContent:n(652).default,ModalsNotificationEditModal:n(843).default})},646:function(t,e,n){var content=n(648);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(19).default)("6d988fa2",content,!0,{sourceMap:!1})},647:function(t,e,n){"use strict";n(646)},648:function(t,e,n){var o=n(18)((function(i){return i[1]}));o.push([t.i,"\n#settings-description a {\n  color: rgb(96 165 250);\n}\n#settings-description a:hover {\n  color: rgb(147 197 253);\n  text-decoration-line: underline;\n}\n#settings-description code {\n  font-size: 0.875rem;\n  border-radius: 6px;\n  background-color: rgb(82, 82, 82);\n  color: white;\n  padding: 2px 4px;\n}\n",""]),o.locals={},t.exports=o},652:function(t,e,n){"use strict";n.r(e);n(22),n(43);var o={props:{headerText:String,description:String,note:String},methods:{}},r=(n(647),n(4)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg-bg rounded-md shadow-lg border border-white/5 p-2 sm:p-4 mb-8"},[e("div",{staticClass:"flex items-center mb-2"},[t._t("header-prefix"),t._v(" "),e("h1",{staticClass:"text-xl"},[t._v(t._s(t.headerText))]),t._v(" "),t._t("header-items")],2),t._v(" "),t.description?e("p",{staticClass:"mb-6 text-gray-200",attrs:{id:"settings-description"},domProps:{innerHTML:t._s(t.description)}}):t._e(),t._v(" "),t._t("default")],2)}),[],!1,null,null,null);e.default=component.exports},842:function(t,e,n){"use strict";n.r(e);n(56),n(8),n(40);var o={props:{notification:{type:Object,default:function(){}}},data:function(){return{sendingTest:!1,enabling:!1,deleting:!1,testing:!1}},computed:{eventName:function(){return this.notification?this.notification.eventName:null},lastFiredAt:function(){return this.notification?this.notification.lastFiredAt:null},lastAttemptFailed:function(){return this.notification?this.notification.lastAttemptFailed:null},numConsecutiveFailedAttempts:function(){return this.notification?this.notification.numConsecutiveFailedAttempts:null}},methods:{fireTestEventAndFail:function(){this.fireTestEvent(!0)},fireTestEventAndSucceed:function(){this.fireTestEvent(!1)},fireTestEvent:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.testing=!0,this.$axios.$get("/api/notifications/test?fail=".concat(e?1:0)).then((function(){t.$toast.success(t.$strings.ToastNotificationTestTriggerSuccess)})).catch((function(e){console.error("Failed",e);var n=e.response?e.response.data:null;t.$toast.error("Failed: ".concat(n)||!1)})).finally((function(){t.testing=!1}))},rapidFireTestEvents:function(){var t=this;this.testing=!0;var e=0,n=setInterval((function(){t.fireTestEvent(),++e>25&&(t.testing=!1,clearInterval(n))}),100)},sendTestClick:function(){var t=this,e={message:this.$strings.MessageConfirmNotificationTestTrigger,callback:function(e){e&&t.sendTest()},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",e)},sendTest:function(){var t=this;this.sendingTest=!0,this.$axios.$get("/api/notifications/".concat(this.notification.id,"/test")).then((function(){t.$toast.success(t.$strings.ToastNotificationTestTriggerSuccess)})).catch((function(e){console.error("Failed",e);var n=e.response?e.response.data:null;t.$toast.error("Failed: ".concat(n)||!1)})).finally((function(){t.sendingTest=!1}))},enableNotification:function(){var t=this;this.enabling=!0;var e={id:this.notification.id,enabled:!0};this.$axios.$patch("/api/notifications/".concat(this.notification.id),e).then((function(e){t.$emit("update",e)})).catch((function(e){console.error("Failed to update notification",e),t.$toast.error(t.$strings.ToastFailedToUpdate)})).finally((function(){t.enabling=!1}))},deleteNotificationClick:function(){var t=this,e={message:this.$strings.MessageConfirmDeleteNotification,callback:function(e){e&&t.deleteNotification()},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",e)},deleteNotification:function(){var t=this;this.deleting=!0,this.$axios.$delete("/api/notifications/".concat(this.notification.id)).then((function(e){t.$emit("update",e)})).catch((function(e){console.error("Failed",e),t.$toast.error(t.$strings.ToastNotificationDeleteFailed)})).finally((function(){t.deleting=!1}))},editNotification:function(){this.$emit("edit",this.notification)}},mounted:function(){}},r=o,l=n(4),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"w-full border border-white/10 rounded-xl p-4 my-2",class:t.notification.enabled?"bg-primary/25":"bg-error/5"},[e("div",{staticClass:"flex flex-wrap items-center"},[e("p",{staticClass:"text-base md:text-lg font-semibold pr-4"},[t._v(t._s(t.eventName))]),t._v(" "),e("div",{staticClass:"grow"}),t._v(" "),"onTest"===t.eventName&&t.notification.enabled?e("ui-btn",{staticClass:"mr-2",attrs:{loading:t.testing,small:""},on:{click:function(e){return e.stopPropagation(),t.fireTestEventAndSucceed.apply(null,arguments)}}},[t._v(t._s(this.$strings.ButtonFireOnTest))]):t._e(),t._v(" "),"onTest"===t.eventName&&t.notification.enabled?e("ui-btn",{staticClass:"mr-2",attrs:{loading:t.testing,small:"",color:"bg-red-600"},on:{click:function(e){return e.stopPropagation(),t.fireTestEventAndFail.apply(null,arguments)}}},[t._v(t._s(this.$strings.ButtonFireAndFail))]):t.notification.enabled?e("ui-btn",{staticClass:"mr-2",attrs:{loading:t.sendingTest,small:""},on:{click:function(e){return e.stopPropagation(),t.sendTestClick.apply(null,arguments)}}},[t._v(t._s(this.$strings.ButtonTest))]):e("ui-btn",{staticClass:"mr-2",attrs:{loading:t.enabling,small:"",color:"bg-success"},on:{click:t.enableNotification}},[t._v(t._s(this.$strings.ButtonEnable))]),t._v(" "),e("ui-icon-btn",{staticClass:"mr-2",attrs:{size:7,"icon-font-size":"1.1rem",icon:"edit"},on:{click:t.editNotification}}),t._v(" "),e("ui-icon-btn",{attrs:{"bg-color":"bg-error",size:7,"icon-font-size":"1.2rem",icon:"delete"},on:{click:t.deleteNotificationClick}})],1),t._v(" "),e("div",{staticClass:"pt-4"},[e("p",{staticClass:"text-gray-300 text-xs md:text-sm mb-2"},[t._v(t._s(t.notification.urls.join(", ")))]),t._v(" "),t.lastFiredAt&&t.lastAttemptFailed?e("p",{staticClass:"text-red-300 text-xs"},[t._v("Last attempt failed "+t._s(t.$dateDistanceFromNow(t.lastFiredAt))+" ("+t._s(t.numConsecutiveFailedAttempts)+" attempt"+t._s(1===t.numConsecutiveFailedAttempts?"":"s")+")")]):t.lastFiredAt?e("p",{staticClass:"text-gray-400 text-xs"},[t._v("Last fired "+t._s(t.$dateDistanceFromNow(t.lastFiredAt)))]):t._e()])])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiBtn:n(42).default,UiIconBtn:n(148).default})},843:function(t,e,n){"use strict";n.r(e);n(56);var o=n(642),r=n(16);n(22),n(43),n(26),n(33),n(27),n(15),n(44),n(45),n(38),n(8),n(28);function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={props:{value:Boolean,notification:{type:Object,default:function(){return null}},notificationData:{type:Object,default:function(){}}},data:function(){return{processing:!1,newNotification:{},isNew:!0}},watch:{show:{handler:function(t){t&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},notificationEvents:function(){return this.notificationData&&this.notificationData.events||[]},eventOptions:function(){var t=this;return this.notificationEvents.map((function(e){return{value:e.name,text:e.name,subtext:t.$strings[e.descriptionKey]||e.description}}))},selectedEventData:function(){var t=this;return this.notificationEvents.find((function(e){return e.name===t.newNotification.eventName}))},showLibrarySelectInput:function(){return this.selectedEventData&&this.selectedEventData.requiresLibrary},title:function(){return this.isNew?this.$strings.HeaderNotificationCreate:this.$strings.HeaderNotificationUpdate},availableVariables:function(){return this.selectedEventData&&this.selectedEventData.variables||null}},methods:{eventOptionUpdated:function(){this.selectedEventData&&(this.newNotification.titleTemplate=this.selectedEventData.defaults.title||"",this.newNotification.bodyTemplate=this.selectedEventData.defaults.body||"")},close:function(){this.$refs.modal&&this.$refs.modal.setHide()},submitForm:function(){var t;null===(t=this.$refs.urlsInput)||void 0===t||t.forceBlur(),this.newNotification.urls.length?this.isNew?this.submitCreate():this.submitUpdate():this.$toast.error(this.$strings.ToastAppriseUrlRequired)},submitUpdate:function(){var t=this;this.processing=!0;var e=c({},this.newNotification);console.log("Sending update notification",e),this.$axios.$patch("/api/notifications/".concat(e.id),e).then((function(e){t.$emit("update",e),t.$toast.success(t.$strings.ToastNotificationUpdateSuccess),t.show=!1})).catch((function(e){console.error("Failed to update notification",e),t.$toast.error(t.$strings.ToastFailedToUpdate)})).finally((function(){t.processing=!1}))},submitCreate:function(){var t=this;this.processing=!0;var e=c({},this.newNotification);console.log("Sending create notification",e),this.$axios.$post("/api/notifications",e).then((function(e){t.$emit("update",e),t.show=!1})).catch((function(e){console.error("Failed to create notification",e),t.$toast.error(t.$strings.ToastNotificationCreateFailed)})).finally((function(){t.processing=!1}))},init:function(){this.isNew=!this.notification,this.notification?this.newNotification={id:this.notification.id,libraryId:this.notification.libraryId,eventName:this.notification.eventName,urls:Object(o.a)(this.notification.urls),titleTemplate:this.notification.titleTemplate,bodyTemplate:this.notification.bodyTemplate,enabled:this.notification.enabled,type:this.notification.type}:(this.newNotification={libraryId:null,eventName:"onTest",urls:[],titleTemplate:"",bodyTemplate:"",enabled:!0,type:null},this.eventOptionUpdated())}},mounted:function(){}},d=n(4),component=Object(d.a)(f,(function(){var t=this,e=t._self._c;return e("modals-modal",{ref:"modal",attrs:{name:"notification-edit",width:800,height:"unset",processing:t.processing},scopedSlots:t._u([{key:"outer",fn:function(){return[e("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[e("p",{staticClass:"text-3xl text-white truncate"},[t._v(t._s(t.title))])])]},proxy:!0}]),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v(" "),e("form",{on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[e("div",{staticClass:"w-full text-sm rounded-lg bg-bg shadow-lg border border-black-300"},[e("div",{staticClass:"w-full px-3 py-5 md:p-12"},[e("ui-dropdown",{staticClass:"mb-4",attrs:{label:t.$strings.LabelNotificationEvent,items:t.eventOptions},on:{input:t.eventOptionUpdated},model:{value:t.newNotification.eventName,callback:function(e){t.$set(t.newNotification,"eventName",e)},expression:"newNotification.eventName"}}),t._v(" "),e("ui-multi-select",{ref:"urlsInput",staticClass:"mb-2",attrs:{label:t.$strings.LabelNotificationAppriseURL},model:{value:t.newNotification.urls,callback:function(e){t.$set(t.newNotification,"urls",e)},expression:"newNotification.urls"}}),t._v(" "),e("ui-text-input-with-label",{staticClass:"mb-2",attrs:{label:t.$strings.LabelNotificationTitleTemplate},model:{value:t.newNotification.titleTemplate,callback:function(e){t.$set(t.newNotification,"titleTemplate",e)},expression:"newNotification.titleTemplate"}}),t._v(" "),e("ui-textarea-with-label",{staticClass:"mb-2",attrs:{label:t.$strings.LabelNotificationBodyTemplate,rows:4},model:{value:t.newNotification.bodyTemplate,callback:function(e){t.$set(t.newNotification,"bodyTemplate",e)},expression:"newNotification.bodyTemplate"}}),t._v(" "),t.availableVariables?e("p",{staticClass:"text-sm text-gray-300"},[e("strong",[t._v(t._s(t.$strings.LabelNotificationAvailableVariables)+":")]),t._v(" "+t._s(t.availableVariables.join(", "))+"\n        ")]):t._e(),t._v(" "),e("div",{staticClass:"flex items-center pt-4"},[e("div",{staticClass:"flex items-center"},[e("ui-toggle-switch",{model:{value:t.newNotification.enabled,callback:function(e){t.$set(t.newNotification,"enabled",e)},expression:"newNotification.enabled"}}),t._v(" "),e("p",{staticClass:"text-lg pl-2"},[t._v(t._s(t.$strings.LabelEnable))])],1),t._v(" "),e("div",{staticClass:"grow"}),t._v(" "),e("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[t._v(t._s(t.$strings.ButtonSubmit))])],1)],1)])])])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiDropdown:n(236).default,UiMultiSelect:n(675).default,UiTextInputWithLabel:n(121).default,UiTextareaWithLabel:n(186).default,UiToggleSwitch:n(185).default,UiBtn:n(42).default,ModalsModal:n(39).default})}}]);