(window.webpackJsonp=window.webpackJsonp||[]).push([[169,59,76,77,119],{1045:function(e,t,n){"use strict";n.r(t);n(150),n(8);var r={asyncData:function(e){var t=e.store,n=e.redirect;t.getters["user/getIsAdminOrUp"]||n("/")},data:function(){return{loadingUsers:!1,selectedApiKey:null,showApiKeyModal:!1,showApiKeyCreatedModal:!1,numApiKeys:0,users:[]}},methods:{apiKeyCreated:function(e){this.numApiKeys++,this.selectedApiKey=e,this.showApiKeyCreatedModal=!0,this.$refs.apiKeysTable&&this.$refs.apiKeysTable.addApiKey(e)},apiKeyUpdated:function(e){this.$refs.apiKeysTable&&this.$refs.apiKeysTable.updateApiKey(e)},setShowApiKeyModal:function(e){this.selectedApiKey=e,this.showApiKeyModal=!0},loadUsers:function(){var e=this;this.loadingUsers=!0,this.$axios.$get("/api/users").then((function(t){e.users=t.users.sort((function(a,b){return a.createdAt-b.createdAt}))})).catch((function(e){console.error("Failed",e)})).finally((function(){e.loadingUsers=!1}))}},mounted:function(){this.loadUsers()},beforeDestroy:function(){}},o=n(4),component=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("app-settings-content",{attrs:{"header-text":e.$strings.HeaderApiKeys},scopedSlots:e._u([{key:"header-items",fn:function(){return[e.numApiKeys?t("div",{staticClass:"mx-2 px-1.5 rounded-lg bg-primary/50 text-gray-300/90 text-sm inline-flex items-center justify-center"},[t("span",[e._v(e._s(e.numApiKeys))])]):e._e(),e._v(" "),t("ui-tooltip",{staticClass:"inline-flex ml-2",attrs:{text:e.$strings.LabelClickForMoreInfo}},[t("a",{staticClass:"inline-flex",attrs:{href:"https://www.audiobookshelf.org/guides/api-keys",target:"_blank"}},[t("span",{staticClass:"material-symbols text-xl w-5 text-gray-200"},[e._v("help_outline")])])]),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-primary",disabled:e.loadingUsers||0===e.users.length,small:""},on:{click:function(t){return e.setShowApiKeyModal()}}},[e._v(e._s(e.$strings.ButtonAddApiKey))])]},proxy:!0}])},[e._v(" "),t("tables-api-keys-table",{ref:"apiKeysTable",staticClass:"pt-2",on:{edit:e.setShowApiKeyModal,numApiKeys:function(t){return e.numApiKeys=t}}})],1),e._v(" "),t("modals-api-key-modal",{ref:"apiKeyModal",attrs:{"api-key":e.selectedApiKey,users:e.users},on:{created:e.apiKeyCreated,updated:e.apiKeyUpdated},model:{value:e.showApiKeyModal,callback:function(t){e.showApiKeyModal=t},expression:"showApiKeyModal"}}),e._v(" "),t("modals-api-key-created-modal",{ref:"apiKeyCreatedModal",attrs:{"api-key":e.selectedApiKey},model:{value:e.showApiKeyCreatedModal,callback:function(t){e.showApiKeyCreatedModal=t},expression:"showApiKeyCreatedModal"}})],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTooltip:n(76).default,UiBtn:n(42).default,TablesApiKeysTable:n(835).default,AppSettingsContent:n(652).default,ModalsApiKeyModal:n(836).default,ModalsApiKeyCreatedModal:n(837).default})},646:function(e,t,n){var content=n(648);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(19).default)("6d988fa2",content,!0,{sourceMap:!1})},647:function(e,t,n){"use strict";n(646)},648:function(e,t,n){var r=n(18)((function(i){return i[1]}));r.push([e.i,"\n#settings-description a {\n  color: rgb(96 165 250);\n}\n#settings-description a:hover {\n  color: rgb(147 197 253);\n  text-decoration-line: underline;\n}\n#settings-description code {\n  font-size: 0.875rem;\n  border-radius: 6px;\n  background-color: rgb(82, 82, 82);\n  color: white;\n  padding: 2px 4px;\n}\n",""]),r.locals={},e.exports=r},652:function(e,t,n){"use strict";n.r(t);n(22),n(43);var r={props:{headerText:String,description:String,note:String},methods:{}},o=(n(647),n(4)),component=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg-bg rounded-md shadow-lg border border-white/5 p-2 sm:p-4 mb-8"},[t("div",{staticClass:"flex items-center mb-2"},[e._t("header-prefix"),e._v(" "),t("h1",{staticClass:"text-xl"},[e._v(e._s(e.headerText))]),e._v(" "),e._t("header-items")],2),e._v(" "),e.description?t("p",{staticClass:"mb-6 text-gray-200",attrs:{id:"settings-description"},domProps:{innerHTML:e._s(e.description)}}):e._e(),e._v(" "),e._t("default")],2)}),[],!1,null,null,null);t.default=component.exports},711:function(e,t,n){var content=n(756);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(19).default)("0d166219",content,!0,{sourceMap:!1})},755:function(e,t,n){"use strict";n(711)},756:function(e,t,n){var r=n(18)((function(i){return i[1]}));r.push([e.i,"\n#api-keys {\n  table-layout: fixed;\n  border-collapse: collapse;\n  border: 1px solid #474747;\n  width: 100%;\n}\n#api-keys td,\n#api-keys th {\n  /* border: 1px solid #2e2e2e; */\n  padding: 8px 8px;\n  text-align: left;\n}\n#api-keys td.py-0 {\n  padding: 0px 8px;\n}\n#api-keys tr:nth-child(even) {\n  background-color: #373838;\n}\n#api-keys tr:nth-child(odd) {\n  background-color: #2f2f2f;\n}\n#api-keys tr:hover {\n  background-color: #444;\n}\n#api-keys th {\n  font-size: 0.8rem;\n  font-weight: 600;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  background-color: #272727;\n}\n",""]),r.locals={},e.exports=r},835:function(e,t,n){"use strict";n.r(t);n(15),n(26),n(27),n(150),n(8);var r={data:function(){return{apiKeys:[],isDeletingApiKey:!1}},computed:{dateFormat:function(){return this.$store.state.serverSettings.dateFormat},timeFormat:function(){return this.$store.state.serverSettings.timeFormat}},methods:{getExpiresAtText:function(e){return new Date(e.expiresAt).getTime()<Date.now()?this.$strings.LabelExpired:this.$formatJsDatetime(new Date(e.expiresAt),this.dateFormat,this.timeFormat)},deleteApiKeyClick:function(e){var t=this;if(!this.isDeletingApiKey){var n={message:this.$getString("MessageConfirmDeleteApiKey",[e.name]),callback:function(n){n&&t.deleteApiKey(e)},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",n)}},deleteApiKey:function(e){var t=this;this.isDeletingApiKey=!0,this.$axios.$delete("/api/api-keys/".concat(e.id)).then((function(data){data.error?t.$toast.error(data.error):(t.removeApiKey(e.id),t.$emit("numApiKeys",t.apiKeys.length))})).catch((function(e){console.error("Failed to delete apiKey",e),t.$toast.error(t.$strings.ToastFailedToDelete)})).finally((function(){t.isDeletingApiKey=!1}))},editApiKey:function(e){this.$emit("edit",e)},addApiKey:function(e){this.apiKeys.push(e)},removeApiKey:function(e){this.apiKeys=this.apiKeys.filter((function(a){return a.id!==e}))},updateApiKey:function(e){this.apiKeys=this.apiKeys.map((function(a){return a.id===e.id?e:a}))},loadApiKeys:function(){var e=this;this.$axios.$get("/api/api-keys").then((function(t){e.apiKeys=t.apiKeys.sort((function(a,b){return a.createdAt-b.createdAt})),e.$emit("numApiKeys",e.apiKeys.length)})).catch((function(e){console.error("Failed to load apiKeys",e)}))}},mounted:function(){this.loadApiKeys()}},o=(n(755),n(4)),component=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"text-center"},[e.apiKeys.length>0?t("table",{attrs:{id:"api-keys"}},[t("tr",[t("th",[e._v(e._s(e.$strings.LabelName))]),e._v(" "),t("th",{staticClass:"w-44"},[e._v(e._s(e.$strings.LabelApiKeyUser))]),e._v(" "),t("th",{staticClass:"w-32"},[e._v(e._s(e.$strings.LabelExpiresAt))]),e._v(" "),t("th",{staticClass:"w-32"},[e._v(e._s(e.$strings.LabelCreatedAt))]),e._v(" "),t("th",{staticClass:"w-32"})]),e._v(" "),e._l(e.apiKeys,(function(n){return t("tr",{key:n.id,class:n.isActive?"":"bg-error/10!"},[t("td",[t("div",{staticClass:"flex items-center"},[t("p",{staticClass:"pl-2 truncate"},[e._v(e._s(n.name))])])]),e._v(" "),t("td",{staticClass:"text-xs"},[n.user?t("nuxt-link",{staticClass:"text-xs hover:underline",attrs:{to:"/config/users/".concat(n.user.id)}},[e._v("\n            "+e._s(n.user.username)+"\n          ")]):t("p",{staticClass:"text-xs"},[e._v("Error")])],1),e._v(" "),t("td",{staticClass:"text-xs"},[n.expiresAt?t("p",{staticClass:"text-xs",attrs:{title:n.expiresAt}},[e._v(e._s(e.getExpiresAtText(n)))]):t("p",{staticClass:"text-xs"},[e._v(e._s(e.$strings.LabelExpiresNever))])]),e._v(" "),t("td",{staticClass:"text-xs font-mono"},[t("ui-tooltip",{attrs:{direction:"top",text:e.$formatJsDatetime(new Date(n.createdAt),e.dateFormat,e.timeFormat)}},[e._v("\n            "+e._s(e.$formatJsDate(new Date(n.createdAt),e.dateFormat))+"\n          ")])],1),e._v(" "),t("td",{staticClass:"py-0"},[t("div",{staticClass:"w-full flex justify-left"},[t("div",{staticClass:"h-8 w-8 flex items-center justify-center text-white/50 hover:text-white/100 cursor-pointer",on:{click:function(t){return t.stopPropagation(),e.editApiKey(n)}}},[t("button",{staticClass:"material-symbols text-base",attrs:{type:"button","aria-label":e.$strings.ButtonEdit}},[e._v("edit")])]),e._v(" "),t("div",{staticClass:"h-8 w-8 flex items-center justify-center text-white/50 hover:text-error cursor-pointer",on:{click:function(t){return t.stopPropagation(),e.deleteApiKeyClick(n)}}},[t("button",{staticClass:"material-symbols text-base",attrs:{type:"button","aria-label":e.$strings.ButtonDelete}},[e._v("delete")])])])])])}))],2):t("p",{staticClass:"text-base text-gray-300 py-4"},[e._v(e._s(e.$strings.LabelNoApiKeys))])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTooltip:n(76).default})},836:function(e,t,n){"use strict";n.r(t);n(15),n(147);var r=n(16);n(22),n(17),n(26),n(27),n(44),n(45),n(38),n(8),n(28);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var l={props:{value:Boolean,apiKey:{type:Object,default:function(){return null}},users:{type:Array,default:function(){return[]}}},data:function(){return{processing:!1,newApiKey:{},isNew:!0}},watch:{show:{handler:function(e){e&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},title:function(){return this.isNew?this.$strings.HeaderNewApiKey:this.$strings.HeaderUpdateApiKey},userItems:function(){var e=this;return this.users.filter((function(u){return"root"!==u.type||e.$store.getters["user/getIsRoot"]})).map((function(u){return{text:u.username,value:u.id,subtext:u.type}}))},isExpired:function(){return!(!this.apiKey||!this.apiKey.expiresAt)&&new Date(this.apiKey.expiresAt).getTime()<Date.now()}},methods:{submitForm:function(){this.newApiKey.name?this.newApiKey.userId?this.isNew?this.submitCreateApiKey():this.submitUpdateApiKey():this.$toast.error(this.$strings.ToastNewApiKeyUserError):this.$toast.error(this.$strings.ToastNameRequired)},submitUpdateApiKey:function(){var e=this;if(this.newApiKey.isActive===this.apiKey.isActive&&this.newApiKey.userId===this.apiKey.userId)return this.$toast.info(this.$strings.ToastNoUpdatesNecessary),void(this.show=!1);var t={isActive:this.newApiKey.isActive,userId:this.newApiKey.userId};this.processing=!0,this.$axios.$patch("/api/api-keys/".concat(this.apiKey.id),t).then((function(data){e.processing=!1,data.error?e.$toast.error("".concat(e.$strings.ToastFailedToUpdate,": ").concat(data.error)):(e.show=!1,e.$emit("updated",data.apiKey))})).catch((function(t){e.processing=!1,console.error("Failed to update apiKey",t);var n=t.response&&t.response.data||"";e.$toast.error(n||e.$strings.ToastFailedToUpdate)}))},submitCreateApiKey:function(){var e=this,t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.newApiKey);this.newApiKey.expiresIn?t.expiresIn=parseInt(this.newApiKey.expiresIn):delete t.expiresIn,this.processing=!0,this.$axios.$post("/api/api-keys",t).then((function(data){e.processing=!1,data.error?e.$toast.error(e.$strings.ToastFailedToCreate+": "+data.error):(e.show=!1,e.$emit("created",data.apiKey))})).catch((function(t){e.processing=!1,console.error("Failed to create apiKey",t);var n=t.response&&t.response.data||"";e.$toast.error(n||e.$strings.ToastFailedToCreate)}))},init:function(){this.isNew=!this.apiKey,this.apiKey?this.newApiKey={name:this.apiKey.name,isActive:this.apiKey.isActive,userId:this.apiKey.userId}:this.newApiKey={name:null,expiresIn:null,isActive:!0,userId:null}}},mounted:function(){}},c=l,d=n(4),component=Object(d.a)(c,(function(){var e=this,t=e._self._c;return t("modals-modal",{ref:"modal",attrs:{name:"api-key",width:800,height:"unset",processing:e.processing},scopedSlots:e._u([{key:"outer",fn:function(){return[t("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[t("p",{staticClass:"text-3xl text-white truncate"},[e._v(e._s(e.title))])])]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"px-4 w-full text-sm py-6 rounded-lg bg-bg shadow-lg border border-black-300 overflow-y-auto overflow-x-hidden",staticStyle:{"min-height":"400px","max-height":"80vh"}},[t("div",{staticClass:"w-full p-8"},[t("div",{staticClass:"flex py-2"},[t("div",{staticClass:"w-1/2 px-2"},[t("ui-text-input-with-label",{attrs:{readonly:!e.isNew,label:e.$strings.LabelName},model:{value:e.newApiKey.name,callback:function(t){e.$set(e.newApiKey,"name","string"==typeof t?t.trim():t)},expression:"newApiKey.name"}})],1),e._v(" "),e.isNew?t("div",{staticClass:"w-1/2 px-2"},[t("ui-text-input-with-label",{attrs:{label:e.$strings.LabelExpiresInSeconds,type:"number",min:0},model:{value:e.newApiKey.expiresIn,callback:function(t){e.$set(e.newApiKey,"expiresIn","string"==typeof t?t.trim():t)},expression:"newApiKey.expiresIn"}})],1):e._e()]),e._v(" "),t("div",{staticClass:"flex items-center pt-4 pb-2 gap-2"},[t("div",{staticClass:"flex items-center px-2"},[t("p",{staticClass:"px-3 font-semibold",attrs:{id:"user-enabled-toggle"}},[e._v(e._s(e.$strings.LabelEnable))]),e._v(" "),t("ui-toggle-switch",{attrs:{disabled:e.isExpired&&!e.apiKey.isActive,labeledBy:"user-enabled-toggle"},model:{value:e.newApiKey.isActive,callback:function(t){e.$set(e.newApiKey,"isActive",t)},expression:"newApiKey.isActive"}})],1),e._v(" "),e.isExpired?t("div",{staticClass:"px-2"},[t("p",{staticClass:"text-sm text-error"},[e._v(e._s(e.$strings.LabelExpired))])]):e._e()]),e._v(" "),t("div",{staticClass:"w-full border-t border-b border-black-200 py-4 px-3 mt-4"},[t("p",{staticClass:"text-lg mb-2 font-semibold"},[e._v(e._s(e.$strings.LabelApiKeyUser))]),e._v(" "),t("p",{staticClass:"text-sm mb-2 text-gray-400"},[e._v(e._s(e.$strings.LabelApiKeyUserDescription))]),e._v(" "),t("ui-select-input",{attrs:{disabled:e.isExpired&&!e.apiKey.isActive,items:e.userItems,placeholder:e.$strings.LabelSelectUser,label:e.$strings.LabelApiKeyUser,"label-hidden":""},model:{value:e.newApiKey.userId,callback:function(t){e.$set(e.newApiKey,"userId",t)},expression:"newApiKey.userId"}})],1),e._v(" "),t("div",{staticClass:"flex pt-4 px-2"},[t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[e._v(e._s(e.$strings.ButtonSubmit))])],1)])])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:n(121).default,UiToggleSwitch:n(185).default,UiSelectInput:n(364).default,UiBtn:n(42).default,ModalsModal:n(39).default})},837:function(e,t,n){"use strict";n.r(t);n(15);var r={props:{value:Boolean,apiKey:{type:Object,default:function(){return null}}},data:function(){return{}},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},title:function(){return this.$strings.HeaderNewApiKey},apiKeyName:function(){var e;return(null===(e=this.apiKey)||void 0===e?void 0:e.name)||""},apiKeyKey:function(){var e;return(null===(e=this.apiKey)||void 0===e?void 0:e.apiKey)||""}},methods:{},mounted:function(){}},o=n(4),component=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("modals-modal",{ref:"modal",attrs:{name:"api-key-created",width:800,height:"unset",persistent:""},scopedSlots:e._u([{key:"outer",fn:function(){return[t("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[t("p",{staticClass:"text-3xl text-white truncate"},[e._v(e._s(e.title))])])]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"px-4 w-full text-sm py-6 rounded-lg bg-bg shadow-lg border border-black-300 overflow-y-auto overflow-x-hidden",staticStyle:{"min-height":"200px","max-height":"80vh"}},[t("div",{staticClass:"w-full p-8"},[t("p",{staticClass:"text-lg text-white mb-4"},[e._v(e._s(e.$getString("LabelApiKeyCreated",[e.apiKeyName])))]),e._v(" "),t("p",{staticClass:"text-lg text-white mb-4"},[e._v(e._s(e.$strings.LabelApiKeyCreatedDescription))]),e._v(" "),t("ui-text-input",{attrs:{label:"API Key",value:e.apiKeyKey,readonly:"","show-copy":""}}),e._v(" "),t("div",{staticClass:"flex justify-end mt-4"},[t("ui-btn",{attrs:{color:"bg-primary"},on:{click:function(t){e.show=!1}}},[e._v(e._s(e.$strings.ButtonClose))])],1)],1)])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInput:n(68).default,UiBtn:n(42).default,ModalsModal:n(39).default})}}]);