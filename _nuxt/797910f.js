(window.webpackJsonp=window.webpackJsonp||[]).push([[164,149,154],{1072:function(t,e,n){"use strict";n.r(e);var r=n(7),o=(n(17),n(26),n(33),n(38),n(8),n(59),n(62),n(58),n(350),n(29),{asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,o,l,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.store,r=t.params,o=t.app,l=t.redirect,c=t.route,n.state.user.user){e.next=3;break}return e.abrupt("return",l("/login?redirect=".concat(c.path)));case 3:if(n.getters["user/getIsAdminOrUp"]){e.next=5;break}return e.abrupt("return",l("/?error=unauthorized"));case 5:return e.next=7,o.$axios.$get("/api/items/".concat(r.id,"?expanded=1")).catch((function(t){return console.error("Failed",t),!1}));case 7:if(d=e.sent){e.next=11;break}return console.error("Not found...",r.id),e.abrupt("return",l("/?error=not found"));case 11:if("book"===d.mediaType){e.next=14;break}return console.error("Invalid media type"),e.abrupt("return",l("/?error=invalid media type"));case 14:if(d.media.audioFiles.length){e.next=17;break}return console.error("No audio files"),e.abrupt("return",l("/?error=no audio files"));case 17:if(n.state.libraries.currentLibraryId===d.libraryId&&n.state.libraries.filterData){e.next=20;break}return e.next=20,n.dispatch("libraries/fetch",d.libraryId);case 20:return e.abrupt("return",{libraryItem:d});case 21:case"end":return e.stop()}}),e)})))()},data:function(){return{processing:!1,metadataObject:null,selectedTool:"embed",isCancelingEncode:!1,shouldBackupAudioFiles:!0,encodingOptions:{bitrate:"128k",channels:"2",codec:"aac"}}},watch:{task:{handler:function(t){t&&this.taskUpdated(t)}}},computed:{audioFilesEncoding:function(){return this.$store.getters["tasks/getAudioFilesEncoding"](this.libraryItemId)||{}},audioFilesFinished:function(){return this.$store.getters["tasks/getAudioFilesFinished"](this.libraryItemId)||{}},progress:function(){return this.$store.getters["tasks/getTaskProgress"](this.libraryItemId)||"0%"},isEmbedTool:function(){return"embed"===this.selectedTool},isM4BTool:function(){return"m4b"===this.selectedTool},libraryItemId:function(){return this.libraryItem.id},libraryItemRelPath:function(){return this.libraryItem.relPath},media:function(){return this.libraryItem.media||{}},mediaMetadata:function(){return this.media.metadata||{}},audioFiles:function(){return(this.media.audioFiles||[]).filter((function(t){return!t.exclude}))},streamLibraryItem:function(){return this.$store.state.streamLibraryItem},metadataChapters:function(){return this.media.chapters||[]},availableTools:function(){return[{value:"embed",text:this.$strings.LabelToolsEmbedMetadata},{value:"m4b",text:this.$strings.LabelToolsM4bEncoder}]},taskFailed:function(){return this.isTaskFinished&&this.task.isFailed},taskError:function(){return this.taskFailed?this.task.error||"Unknown Error":null},isTaskFinished:function(){return this.task&&this.task.isFinished},tasks:function(){return this.$store.getters["tasks/getTasksByLibraryItemId"](this.libraryItemId)},embedTask:function(){return this.tasks.find((function(t){return"embed-metadata"===t.action}))},encodeTask:function(){return this.tasks.find((function(t){return"encode-m4b"===t.action}))},task:function(){return this.isEmbedTool?this.embedTask:this.isM4BTool?this.encodeTask:null},taskRunning:function(){return this.task&&!this.task.isFinished},queuedEmbedLIds:function(){return this.$store.state.tasks.queuedEmbedLIds||[]},isMetadataEmbedQueued:function(){var t=this;return this.queuedEmbedLIds.some((function(e){return e===t.libraryItemId}))},encodeTaskHasEncodingOptions:function(){var t;return this.isM4BTool&&!(null===(t=this.encodeTask)||void 0===t||!t.data.encodeOptions)&&Object.keys(this.encodeTask.data.encodeOptions).length>0}},methods:{toggleBackupAudioFiles:function(t){localStorage.setItem("embedMetadataShouldBackup",t?1:0)},bitrateChanged:function(t){localStorage.setItem("embedMetadataBitrate",t)},channelsChanged:function(t){localStorage.setItem("embedMetadataChannels",t)},codecChanged:function(t){localStorage.setItem("embedMetadataCodec",t)},cancelEncodeClick:function(){var t=this;this.isCancelingEncode=!0,this.$axios.$delete("/api/tools/item/".concat(this.libraryItemId,"/encode-m4b")).then((function(){t.$toast.success(t.$strings.ToastEncodeCancelSucces)})).catch((function(e){console.error("Failed to cancel encode",e),t.$toast.error(t.$strings.ToastEncodeCancelFailed)})).finally((function(){t.isCancelingEncode=!1}))},encodeM4bClick:function(){var t=this;this.$refs.bitrateInput&&this.$refs.bitrateInput.blur(),this.$refs.channelsInput&&this.$refs.channelsInput.blur(),this.$refs.codecInput&&this.$refs.codecInput.blur();var e=this.$refs.encoderOptionsCard.getEncodingOptions();this.encodingOptions=e;var n=new URLSearchParams(e);this.processing=!0,this.$axios.$post("/api/tools/item/".concat(this.libraryItemId,"/encode-m4b?").concat(n.toString())).then((function(){console.log("Ab m4b merge started")})).catch((function(e){var n=e.response&&e.response.data||"Unknown Error";t.$toast.error(n),t.processing=!1}))},embedClick:function(){var t=this,e={message:this.$getString("MessageConfirmEmbedMetadataInAudioFiles",[this.audioFiles.length]),callback:function(e){e&&t.updateAudioFileMetadata()},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",e)},updateAudioFileMetadata:function(){var t=this;this.processing=!0,this.$axios.$post("/api/tools/item/".concat(this.libraryItemId,"/embed-metadata?backup=").concat(this.shouldBackupAudioFiles?1:0)).then((function(){console.log("Audio metadata encode started")})).catch((function(e){console.error("Audio metadata encode failed",e),t.processing=!1}))},selectedToolUpdated:function(){var t=window.location.protocol+"//"+window.location.host+window.location.pathname+"?tool=".concat(this.selectedTool);window.history.replaceState({path:t},"",t)},init:function(){this.fetchMetadataEmbedObject(),"m4b"===this.$route.query.tool&&(this.availableTools.some((function(t){return"m4b"===t.value}))?this.selectedTool="m4b":this.selectedToolUpdated()),this.task&&this.taskUpdated(this.task);var t=localStorage.getItem("embedMetadataShouldBackup");this.shouldBackupAudioFiles=0!=t,this.encodeTaskHasEncodingOptions&&(this.encodeTask.data.encodeOptions.bitrate&&(this.encodingOptions.bitrate=this.encodeTask.data.encodeOptions.bitrate),this.encodeTask.data.encodeOptions.channels&&(this.encodingOptions.channels=this.encodeTask.data.encodeOptions.channels),this.encodeTask.data.encodeOptions.codec&&(this.encodingOptions.codec=this.encodeTask.data.encodeOptions.codec))},fetchMetadataEmbedObject:function(){var t=this;this.$axios.$get("/api/items/".concat(this.libraryItemId,"/metadata-object")).then((function(e){t.metadataObject=e})).catch((function(t){console.error("Failed to fetch metadata object",t)}))},taskUpdated:function(t){this.processing=!t.isFinished},editItem:function(){this.$store.commit("showEditModal",this.libraryItem)},libraryItemUpdated:function(t){t.id===this.libraryItem.id&&(this.libraryItem=t,this.fetchMetadataEmbedObject())}},mounted:function(){this.init(),this.$eventBus.$on("".concat(this.libraryItem.id,"_updated"),this.libraryItemUpdated)},beforeDestroy:function(){this.$eventBus.$off("".concat(this.libraryItem.id,"_updated"),this.libraryItemUpdated)}}),l=n(4),component=Object(l.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg-bg page p-8 overflow-auto relative",class:t.streamLibraryItem?"streaming":"",attrs:{id:"page-wrapper"}},[e("div",{staticClass:"flex items-center justify-center mb-6"},[e("div",{staticClass:"w-full max-w-2xl"},[e("div",{staticClass:"flex items-center mb-4"},[e("nuxt-link",{staticClass:"hover:underline",attrs:{to:"/item/".concat(t.libraryItem.id)}},[e("h1",{staticClass:"text-lg lg:text-xl"},[t._v(t._s(t.mediaMetadata.title))])]),t._v(" "),e("button",{staticClass:"w-7 h-7 flex items-center justify-center mx-4 hover:scale-110 duration-100 transform text-gray-200 hover:text-white",on:{click:t.editItem}},[e("span",{staticClass:"material-symbols text-base"},[t._v("edit")])])],1)]),t._v(" "),e("div",{staticClass:"w-full max-w-2xl"},[e("div",{staticClass:"flex justify-end"},[e("ui-dropdown",{staticClass:"max-w-sm",attrs:{items:t.availableTools,disabled:t.processing},on:{input:t.selectedToolUpdated},model:{value:t.selectedTool,callback:function(e){t.selectedTool=e},expression:"selectedTool"}})],1)])]),t._v(" "),e("div",{staticClass:"flex justify-center mb-2"},[e("div",{staticClass:"w-full max-w-2xl"},[e("p",{staticClass:"text-lg"},[t._v(t._s(t.$strings.HeaderMetadataToEmbed))])]),t._v(" "),e("div",{staticClass:"w-full max-w-2xl"})]),t._v(" "),e("div",{staticClass:"flex justify-center flex-wrap lg:flex-nowrap gap-4"},[e("div",{staticClass:"w-full max-w-2xl border border-white/10 bg-bg"},[e("div",{staticClass:"flex py-2 px-4"},[e("div",{staticClass:"w-28 min-w-28 text-xs font-semibold uppercase text-gray-200"},[t._v(t._s(t.$strings.LabelMetaTag))]),t._v(" "),e("div",{staticClass:"grow text-xs font-semibold uppercase text-gray-200"},[t._v(t._s(t.$strings.LabelValue))])]),t._v(" "),e("div",{staticClass:"w-full max-h-72 overflow-auto"},[t._l(t.metadataObject,(function(n,r,o){return[e("div",{key:r,staticClass:"flex py-1 px-4 text-sm",class:o%2==0?"bg-primary/25":""},[e("div",{staticClass:"w-28 min-w-28 font-semibold"},[t._v(t._s(r))]),t._v(" "),e("div",{staticClass:"grow"},[t._v("\n              "+t._s(n)+"\n            ")])])]}))],2)]),t._v(" "),e("div",{staticClass:"w-full max-w-2xl border border-white/10 bg-bg"},[e("div",{staticClass:"flex py-2 px-4 bg-primary/25"},[e("div",{staticClass:"grow text-xs font-semibold uppercase text-gray-200"},[t._v(t._s(t.$strings.LabelChapterTitle))]),t._v(" "),e("div",{staticClass:"w-16 min-w-16 text-xs font-semibold uppercase text-gray-200"},[t._v(t._s(t.$strings.LabelStart))]),t._v(" "),e("div",{staticClass:"w-16 min-w-16 text-xs font-semibold uppercase text-gray-200"},[t._v(t._s(t.$strings.LabelEnd))])]),t._v(" "),e("div",{staticClass:"w-full max-h-72 overflow-auto"},[t.metadataChapters.length?t._e():e("p",{staticClass:"py-5 text-center text-gray-200"},[t._v(t._s(t.$strings.MessageNoChapters))]),t._v(" "),t._l(t.metadataChapters,(function(n,r){return[e("div",{key:r,staticClass:"flex py-1 px-4 text-sm",class:r%2==1?"bg-primary/25":""},[e("div",{staticClass:"grow font-semibold"},[t._v(t._s(n.title))]),t._v(" "),e("div",{staticClass:"w-16 min-w-16"},[t._v("\n              "+t._s(t.$secondsToTimestamp(n.start))+"\n            ")]),t._v(" "),e("div",{staticClass:"w-16 min-w-16"},[t._v("\n              "+t._s(t.$secondsToTimestamp(n.end))+"\n            ")])])]}))],2)])]),t._v(" "),e("div",{staticClass:"w-full h-px bg-white/10 my-8"}),t._v(" "),e("div",{staticClass:"w-full max-w-4xl mx-auto"},[t.isMetadataEmbedQueued?e("widgets-alert",{staticClass:"mb-4",attrs:{type:"warning"}},[e("p",{staticClass:"text-lg"},[t._v(t._s(t.$getString("MessageEmbedQueue",[t.queuedEmbedLIds.length])))])]):t.isEmbedTool?e("div",{staticClass:"w-full flex justify-end items-center mb-4"},[t.isTaskFinished?t._e():e("ui-checkbox",{attrs:{disabled:t.processing,label:t.$strings.LabelBackupAudioFiles,medium:"","checkbox-bg":"bg","label-class":"pl-2 text-base md:text-lg"},on:{input:t.toggleBackupAudioFiles},model:{value:t.shouldBackupAudioFiles,callback:function(e){t.shouldBackupAudioFiles=e},expression:"shouldBackupAudioFiles"}}),t._v(" "),e("div",{staticClass:"grow"}),t._v(" "),t.isTaskFinished?t.taskFailed?e("p",{staticClass:"text-error text-lg font-semibold"},[t._v(t._s(t.$strings.MessageEmbedFailed)+" "+t._s(t.taskError))]):e("p",{staticClass:"text-success text-lg font-semibold"},[t._v(t._s(t.$strings.MessageEmbedFinished))]):e("ui-btn",{attrs:{color:"bg-primary",loading:t.processing,progress:t.progress},on:{click:function(e){return e.stopPropagation(),t.embedClick.apply(null,arguments)}}},[t._v(t._s(t.$strings.ButtonStartMetadataEmbed))])],1):e("div",{staticClass:"w-full flex items-center mb-4"},[e("div",{staticClass:"grow"}),t._v(" "),!t.isTaskFinished&&t.processing?e("ui-btn",{staticClass:"mr-2",attrs:{color:"bg-error",loading:t.isCancelingEncode},on:{click:function(e){return e.stopPropagation(),t.cancelEncodeClick.apply(null,arguments)}}},[t._v(t._s(t.$strings.ButtonCancelEncode))]):t._e(),t._v(" "),t.isTaskFinished?t.taskFailed?e("p",{staticClass:"text-error text-lg font-semibold"},[t._v(t._s(t.$strings.MessageM4BFailed)+" "+t._s(t.taskError))]):e("p",{staticClass:"text-success text-lg font-semibold"},[t._v(t._s(t.$strings.MessageM4BFinished))]):e("ui-btn",{attrs:{color:"bg-primary",loading:t.processing,progress:t.progress},on:{click:function(e){return e.stopPropagation(),t.encodeM4bClick.apply(null,arguments)}}},[t._v(t._s(t.$strings.ButtonStartM4BEncode))])],1),t._v(" "),t.encodeTaskHasEncodingOptions?e("div",{staticClass:"mb-4 pb-4 border-b border-white/10"},[e("div",{staticClass:"flex flex-wrap -mx-2"},[e("ui-text-input-with-label",{ref:"bitrateInput",staticClass:"m-2 max-w-40",attrs:{readonly:"",label:t.$strings.LabelAudioBitrate},on:{input:t.bitrateChanged},model:{value:t.encodingOptions.bitrate,callback:function(e){t.$set(t.encodingOptions,"bitrate",e)},expression:"encodingOptions.bitrate"}}),t._v(" "),e("ui-text-input-with-label",{ref:"channelsInput",staticClass:"m-2 max-w-40",attrs:{readonly:"",label:t.$strings.LabelAudioChannels},on:{input:t.channelsChanged},model:{value:t.encodingOptions.channels,callback:function(e){t.$set(t.encodingOptions,"channels",e)},expression:"encodingOptions.channels"}}),t._v(" "),e("ui-text-input-with-label",{ref:"codecInput",staticClass:"m-2 max-w-40",attrs:{readonly:"",label:t.$strings.LabelAudioCodec},on:{input:t.codecChanged},model:{value:t.encodingOptions.codec,callback:function(e){t.$set(t.encodingOptions,"codec",e)},expression:"encodingOptions.codec"}})],1)]):t.isM4BTool?e("div",{staticClass:"mb-4"},[e("widgets-encoder-options-card",{ref:"encoderOptionsCard",attrs:{"audio-tracks":t.audioFiles,disabled:t.processing||t.isTaskFinished}})],1):t._e(),t._v(" "),e("div",{staticClass:"mb-4"},[t.isEmbedTool?e("div",{staticClass:"flex items-start mb-2"},[e("span",{staticClass:"material-symbols text-base text-warning pt-1"},[t._v("star")]),t._v(" "),e("p",{staticClass:"text-gray-200 ml-2"},[t._v(t._s(t.$strings.LabelEncodingInfoEmbedded))])]):e("div",{staticClass:"flex items-start mb-2"},[e("span",{staticClass:"material-symbols text-base text-warning pt-1"},[t._v("star")]),t._v(" "),e("p",{staticClass:"text-gray-200 ml-2"},[t._v("\n          "+t._s(t.$strings.LabelEncodingFinishedM4B)+" "),e("span",{staticClass:"rounded-md bg-neutral-600 text-sm text-white py-0.5 px-1 font-mono"},[t._v(".../"+t._s(t.libraryItemRelPath)+"/")]),t._v(".\n        ")])]),t._v(" "),t.shouldBackupAudioFiles||t.isM4BTool?e("div",{staticClass:"flex items-start mb-2"},[e("span",{staticClass:"material-symbols text-base text-warning pt-1"},[t._v("star")]),t._v(" "),e("p",{staticClass:"text-gray-200 ml-2"},[t._v("\n          "+t._s(t.$strings.LabelEncodingBackupLocation)+" "),e("span",{staticClass:"rounded-md bg-neutral-600 text-sm text-white py-0.5 px-1 font-mono"},[t._v("/metadata/cache/items/"+t._s(t.libraryItemId)+"/")]),t._v(". "+t._s(t.$strings.LabelEncodingClearItemCache)+"\n        ")])]):t._e(),t._v(" "),t.isEmbedTool&&t.audioFiles.length>1?e("div",{staticClass:"flex items-start mb-2"},[e("span",{staticClass:"material-symbols text-base text-warning pt-1"},[t._v("star")]),t._v(" "),e("p",{staticClass:"text-gray-200 ml-2"},[t._v(t._s(t.$strings.LabelEncodingChaptersNotEmbedded))])]):t._e(),t._v(" "),t.isM4BTool?e("div",{staticClass:"flex items-start mb-2"},[e("span",{staticClass:"material-symbols text-base text-warning pt-1"},[t._v("star")]),t._v(" "),e("p",{staticClass:"text-gray-200 ml-2"},[t._v(t._s(t.$strings.LabelEncodingTimeWarning))])]):t._e(),t._v(" "),t.isM4BTool?e("div",{staticClass:"flex items-start mb-2"},[e("span",{staticClass:"material-symbols text-base text-warning pt-1"},[t._v("star")]),t._v(" "),e("p",{staticClass:"text-gray-200 ml-2"},[t._v(t._s(t.$strings.LabelEncodingWatcherDisabled))])]):t._e(),t._v(" "),e("div",{staticClass:"flex items-start mb-2"},[e("span",{staticClass:"material-symbols text-base text-warning pt-1"},[t._v("star")]),t._v(" "),e("p",{staticClass:"text-gray-200 ml-2"},[t._v(t._s(t.$strings.LabelEncodingStartedNavigation))])])])],1),t._v(" "),e("div",{staticClass:"w-full max-w-4xl mx-auto"},[e("p",{staticClass:"mb-2 font-semibold"},[t._v(t._s(t.$strings.HeaderAudioTracks))]),t._v(" "),e("div",{staticClass:"w-full mx-auto border border-white/10 bg-bg"},[e("div",{staticClass:"flex py-2 px-4 bg-primary/25"},[e("div",{staticClass:"w-10 text-xs font-semibold text-gray-200"},[t._v("#")]),t._v(" "),e("div",{staticClass:"grow text-xs font-semibold uppercase text-gray-200"},[t._v(t._s(t.$strings.LabelFilename))]),t._v(" "),e("div",{staticClass:"w-20 text-xs font-semibold uppercase text-gray-200 hidden lg:block"},[t._v(t._s(t.$strings.LabelChannels))]),t._v(" "),e("div",{staticClass:"w-16 text-xs font-semibold uppercase text-gray-200 hidden md:block"},[t._v(t._s(t.$strings.LabelCodec))]),t._v(" "),e("div",{staticClass:"w-16 text-xs font-semibold uppercase text-gray-200 hidden md:block"},[t._v(t._s(t.$strings.LabelBitrate))]),t._v(" "),e("div",{staticClass:"w-16 text-xs font-semibold uppercase text-gray-200"},[t._v(t._s(t.$strings.LabelSize))]),t._v(" "),e("div",{staticClass:"w-24"})]),t._v(" "),t._l(t.audioFiles,(function(n){return[e("div",{key:n.index,staticClass:"flex py-2 px-4 text-xs sm:text-sm",class:n.index%2==0?"bg-primary/25":""},[e("div",{staticClass:"w-10 min-w-10"},[t._v(t._s(n.index))]),t._v(" "),e("div",{staticClass:"grow"},[t._v("\n            "+t._s(n.metadata.filename)+"\n          ")]),t._v(" "),e("div",{staticClass:"w-20 min-w-20 text-gray-200 hidden lg:block"},[t._v(t._s(n.channels||"unknown")+" ("+t._s(n.channelLayout||"unknown")+")")]),t._v(" "),e("div",{staticClass:"w-16 min-w-16 text-gray-200 hidden md:block"},[t._v("\n            "+t._s(n.codec||"unknown")+"\n          ")]),t._v(" "),e("div",{staticClass:"w-16 min-w-16 text-gray-200 hidden md:block"},[t._v("\n            "+t._s(t.$bytesPretty(n.bitRate||0,0))+"\n          ")]),t._v(" "),e("div",{staticClass:"w-16 min-w-16 text-gray-200"},[t._v("\n            "+t._s(t.$bytesPretty(n.metadata.size))+"\n          ")]),t._v(" "),e("div",{staticClass:"w-24 min-w-24"},[e("div",{staticClass:"flex justify-center"},[t.audioFilesFinished[n.ino]?e("span",{staticClass:"material-symbols text-xl text-success leading-none"},[t._v("check_circle")]):t.audioFilesEncoding[n.ino]?e("div",[e("span",{staticClass:"font-mono text-success leading-none"},[t._v(t._s(t.audioFilesEncoding[n.ino]))])]):t._e()])])])]}))],2)])])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiDropdown:n(236).default,WidgetsAlert:n(657).default,UiCheckbox:n(184).default,UiBtn:n(42).default,UiTextInputWithLabel:n(121).default,WidgetsEncoderOptionsCard:n(872).default})},657:function(t,e,n){"use strict";n.r(e);var r={props:{type:{type:String,default:"error"}},data:function(){return{}},computed:{icon:function(){return"error"===this.type||"warning"===this.type?"report":"info"},wrapperClass:function(){switch(this.type){case"error":return"bg-error/5 border-error/60 text-error";case"warning":return"bg-warning/5 border-warning/60 text-warning";case"success":return"bg-success/5 border-success/60 text-success";case"info":return"bg-info/5 border-info/60 text-info";default:return"bg-primary/5 border-primary/60 text-primary"}}},methods:{},mounted:function(){}},o=n(4),component=Object(o.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"w-full border rounded-lg flex items-center relative py-4 pl-16",class:t.wrapperClass},[e("div",{staticClass:"absolute top-0 left-4 h-full flex items-center"},[e("span",{staticClass:"material-symbols text-2xl"},[t._v(t._s(t.icon))])]),t._v(" "),t._t("default")],2)}),[],!1,null,null,null);e.default=component.exports},872:function(t,e,n){"use strict";n.r(e);n(22),n(43),n(84),n(33),n(83),n(57),n(15),n(14),n(8),n(35),n(59),n(62),n(58);function r(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,a){if(t){if("string"==typeof t)return o(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,l=function(){};return{s:l,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,c=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw c}}}}function o(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=Array(a);e<a;e++)n[e]=t[e];return n}var l={props:{audioTracks:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1}},data:function(){return{showAdvancedView:!1,selectedCodec:"aac",selectedBitrate:"128k",selectedChannels:2,customCodec:"aac",customBitrate:"128k",customChannels:2,currentCodec:"",currentBitrate:"",currentChannels:"",currentChanelLayout:"",isCodecsDifferent:!1}},computed:{codecItems:function(){return[{text:"Copy",value:"copy"},{text:"AAC",value:"aac"},{text:"OPUS",value:"opus"}]},bitrateItems:function(){return[{text:"32k",value:"32k"},{text:"64k",value:"64k"},{text:"128k",value:"128k"},{text:"192k",value:"192k"}]},channelsItems:function(){return[{text:"1 (mono)",value:1},{text:"2 (stereo)",value:2}]}},methods:{customBitrateChanged:function(t){localStorage.setItem("embedMetadataBitrate",t)},customChannelsChanged:function(t){localStorage.setItem("embedMetadataChannels",t)},customCodecChanged:function(t){localStorage.setItem("embedMetadataCodec",t)},getEncodingOptions:function(){return this.showAdvancedView?{codec:this.customCodec||this.selectedCodec||"aac",bitrate:this.customBitrate||this.selectedBitrate||"128k",channels:this.customChannels||this.selectedChannels||2}:{codec:this.selectedCodec||"aac",bitrate:this.selectedBitrate||"128k",channels:this.selectedChannels||2}},setPreset:function(){var t=this;if("aac"!==this.currentCodec||this.isCodecsDifferent?this.selectedCodec="aac":this.selectedCodec="copy",this.currentBitrate){var e=[32,64,128,192].find((function(e){return e>=t.currentBitrate}))||192;this.selectedBitrate=e+"k"}else this.selectedBitrate="128k";!this.currentChannels||isNaN(this.currentChannels)?this.selectedChannels=2:this.selectedChannels=Math.max(Math.min(Number(this.currentChannels),2),1)},setCurrentValues:function(){if(0!==this.audioTracks.length){this.currentChannels=this.audioTracks[0].channels,this.currentChanelLayout=this.audioTracks[0].channelLayout,this.currentCodec=this.audioTracks[0].codec;var t,e=0,n=r(this.audioTracks);try{for(n.s();!(t=n.n()).done;){var track=t.value;e+=isNaN(track.bitRate)?0:track.bitRate,track.channels>this.currentChannels&&(this.currentChannels=track.channels),track.codec!==this.currentCodec&&(console.warn("Audio track codec is different from the first track",track.codec),this.isCodecsDifferent=!0)}}catch(t){n.e(t)}finally{n.f()}this.currentBitrate=Math.round(e/this.audioTracks.length/1e3)}},init:function(){this.customBitrate=localStorage.getItem("embedMetadataBitrate")||"128k",this.customChannels=localStorage.getItem("embedMetadataChannels")||2,this.customCodec=localStorage.getItem("embedMetadataCodec")||"aac",this.setCurrentValues(),this.setPreset()}},mounted:function(){this.init()}},c=n(4),component=Object(c.a)(l,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"w-full py-2"},[e("div",{staticClass:"flex -mb-px"},[e("button",{staticClass:"w-1/2 h-8 rounded-tl-md relative border border-black-200 flex items-center justify-center disabled:cursor-not-allowed",class:t.showAdvancedView?"text-gray-400 hover:text-gray-300 bg-primary/70 hover:bg-primary/60":"text-white bg-bg hover:bg-bg/60 border-b-bg",attrs:{type:"button",disabled:t.disabled},on:{click:function(e){t.showAdvancedView=!1}}},[e("p",{staticClass:"text-sm"},[t._v(t._s(t.$strings.HeaderPresets))])]),t._v(" "),e("button",{staticClass:"w-1/2 h-8 rounded-tr-md relative border border-black-200 flex items-center justify-center -ml-px disabled:cursor-not-allowed",class:t.showAdvancedView?"text-white bg-bg hover:bg-bg/60 border-b-bg":"text-gray-400 hover:text-gray-300 bg-primary/70 hover:bg-primary/60",attrs:{type:"button",disabled:t.disabled},on:{click:function(e){t.showAdvancedView=!0}}},[e("p",{staticClass:"text-sm"},[t._v(t._s(t.$strings.HeaderAdvanced))])])]),t._v(" "),e("div",{staticClass:"p-4 md:p-8 border border-black-200 rounded-b-md mr-px bg-bg"},[t.showAdvancedView?[e("div",[e("div",{staticClass:"flex flex-wrap gap-4 sm:gap-8 justify-start sm:justify-center mb-4"},[e("div",{staticClass:"w-40"},[e("ui-text-input-with-label",{attrs:{label:t.$strings.LabelAudioCodec,disabled:t.disabled},on:{input:t.customCodecChanged},model:{value:t.customCodec,callback:function(e){t.customCodec=e},expression:"customCodec"}})],1),t._v(" "),e("div",{staticClass:"w-40"},[e("ui-text-input-with-label",{attrs:{label:t.$strings.LabelAudioBitrate,disabled:t.disabled},on:{input:t.customBitrateChanged},model:{value:t.customBitrate,callback:function(e){t.customBitrate=e},expression:"customBitrate"}})],1),t._v(" "),e("div",{staticClass:"w-40"},[e("ui-text-input-with-label",{attrs:{label:t.$strings.LabelAudioChannels,type:"number",disabled:t.disabled},on:{input:t.customChannelsChanged},model:{value:t.customChannels,callback:function(e){t.customChannels=e},expression:"customChannels"}})],1)]),t._v(" "),e("p",{staticClass:"text-xs sm:text-sm text-warning sm:text-center"},[t._v(t._s(t.$strings.LabelEncodingWarningAdvancedSettings))])])]:[e("div",{staticClass:"flex flex-wrap gap-4 sm:gap-8 justify-start sm:justify-center"},[e("div",{staticClass:"flex flex-col items-start gap-2"},[e("p",{staticClass:"text-sm w-40"},[t._v(t._s(t.$strings.LabelCodec))]),t._v(" "),e("ui-toggle-btns",{attrs:{items:t.codecItems,disabled:t.disabled},model:{value:t.selectedCodec,callback:function(e){t.selectedCodec=e},expression:"selectedCodec"}}),t._v(" "),e("p",{staticClass:"text-xs text-gray-300"},[t._v("\n            "+t._s(t.$strings.LabelCurrently)+" "),e("span",{staticClass:"text-white"},[t._v(t._s(t.currentCodec))]),t._v(" "),t.isCodecsDifferent?e("span",{staticClass:"text-warning"},[t._v("(mixed)")]):t._e()])],1),t._v(" "),e("div",{staticClass:"flex flex-col items-start gap-2"},[e("p",{staticClass:"text-sm w-40"},[t._v(t._s(t.$strings.LabelBitrate))]),t._v(" "),e("ui-toggle-btns",{attrs:{items:t.bitrateItems,disabled:t.disabled},model:{value:t.selectedBitrate,callback:function(e){t.selectedBitrate=e},expression:"selectedBitrate"}}),t._v(" "),e("p",{staticClass:"text-xs text-gray-300"},[t._v("\n            "+t._s(t.$strings.LabelCurrently)+" "),e("span",{staticClass:"text-white"},[t._v(t._s(t.currentBitrate)+" KB/s")])])],1),t._v(" "),e("div",{staticClass:"flex flex-col items-start gap-2"},[e("p",{staticClass:"text-sm w-40"},[t._v(t._s(t.$strings.LabelChannels))]),t._v(" "),e("ui-toggle-btns",{attrs:{items:t.channelsItems,disabled:t.disabled},model:{value:t.selectedChannels,callback:function(e){t.selectedChannels=e},expression:"selectedChannels"}}),t._v(" "),e("p",{staticClass:"text-xs text-gray-300"},[t._v("\n            "+t._s(t.$strings.LabelCurrently)+" "),e("span",{staticClass:"text-white"},[t._v(t._s(t.currentChannels)+" ("+t._s(t.currentChanelLayout)+")")])])],1)])]],2)])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiToggleBtns:n(365).default,UiTextInputWithLabel:n(121).default})}}]);