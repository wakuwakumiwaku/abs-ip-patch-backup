(window.webpackJsonp=window.webpackJsonp||[]).push([[116,57],{642:function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));var n=r(183);var o=r(237),l=r(149);function c(t){return function(t){if(Array.isArray(t))return Object(n.a)(t)}(t)||Object(o.a)(t)||Object(l.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},683:function(t,e,r){"use strict";var n=r(69),o=r(152),l=r(86);t.exports=function(t){for(var e=n(this),r=l(e),c=arguments.length,d=o(c>1?arguments[1]:void 0,r),h=c>2?arguments[2]:void 0,f=void 0===h?r:o(h,r);f>d;)e[d++]=t;return e}},687:function(t,e,r){"use strict";var n=r(9),o=r(683),l=r(124);n({target:"Array",proto:!0},{fill:o}),l("fill")},845:function(t,e,r){"use strict";r.r(e);var n=r(642),o=r(7),l=(r(29),r(17),r(687),r(41),r(57),r(15),r(14),r(8),r(351),r(352),r(52),r(62),r(58),{props:{variant:{type:Number,default:0},year:Number,processing:Boolean},data:function(){return{canvas:null,dataUrl:null,yearStats:null}},watch:{variant:function(){this.init()}},methods:{initCanvas:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var canvas,r,o,l,c,d,h,f,x,m,w,S,y,v,$,L,k,T,C,R,i,A,P,B;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.yearStats){e.next=2;break}return e.abrupt("return");case 2:if((canvas=document.createElement("canvas")).width=800,canvas.height=800,r=canvas.getContext("2d"),o=function(t,e,n,o){var l=r.createLinearGradient(t,e,t+n,e+o);l.addColorStop(0,"#44444455"),l.addColorStop(1,"#ffffff11"),r.fillStyle=l,r.strokeStyle="#C0C0C088",r.beginPath(),r.roundRect(t,e,n,o,[20]),r.fill(),r.stroke()},l=function(text,t,e,n,o,l,c){var d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(r.fillStyle=n,r.font="".concat(e," ").concat(t," Source Sans Pro"),r.letterSpacing=o,d)for(var h=r.measureText(text).width;h>d;)console.warn('Text "'.concat(text,'" is greater than max width ').concat(d," (width:").concat(h,")")),text=text.endsWith("...")?text.slice(0,-4):text.slice(0,-3),text+="...",h=r.measureText(text).width,console.log('Checking text "'.concat(text,'" (width:').concat(h,")"));r.fillText(text,l,c)},c=function(t,e,n,o,l){r.fillStyle=e,r.font="".concat(n," Material Symbols Rounded"),r.fillText(t,o,l)},r.fillStyle="#232323",r.fillRect(0,0,canvas.width,canvas.height),(d=t.yearStats.finishedBooksWithCovers).push.apply(d,Object(n.a)(t.yearStats.booksWithCovers)),h={},!d.length){e.next=30;break}f=0,r.globalAlpha=.25,r.save(),r.translate(canvas.width/2,canvas.height/2),r.rotate(-Math.PI/180*25),r.translate(-canvas.width/2,-canvas.height/2),r.translate(-130,-120),x=regeneratorRuntime.mark((function e(n){var o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=regeneratorRuntime.mark((function e(o){var l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=f%d.length,c=d[l],f++,e.next=5,new Promise((function(e){var img=new Image;img.crossOrigin="anonymous",img.addEventListener("load",(function(){var l=img.width;img.width>img.height&&(l=img.height);var d=-(l-img.width)/2,f=-(l-img.height)/2;r.drawImage(img,d,f,l,l,215*n,215*o,215,215),e(),t.yearStats.finishedBooksWithCovers.includes(c)&&!h[c]&&(h[c]={img:img,sx:d,sy:f,sw:l})})),img.addEventListener("error",(function(){e()})),img.src=t.$store.getters["globals/getLibraryItemCoverSrcById"](c)}));case 5:case"end":return e.stop()}}),e)})),l=0;case 2:if(!(l<5)){e.next=7;break}return e.delegateYield(o(l),"t0",4);case 4:l++,e.next=2;break;case 7:case"end":return e.stop()}}),e)})),m=0;case 24:if(!(m<5)){e.next=29;break}return e.delegateYield(x(m),"t0",26);case 26:m++,e.next=24;break;case 29:r.restore();case 30:if(w=210,r.globalAlpha=1,r.textBaseline="middle",(S=r.createLinearGradient(0,0,canvas.width,canvas.height)).addColorStop(0,"#000000aa"),S.addColorStop(1,"#cd9d49aa"),r.fillStyle=S,r.fillRect(0,0,canvas.width,canvas.height),y="#ffdb70",r.fillStyle=y,r.font="42px absicons",r.fillText("î¤€",15,36),l("audiobookshelf","28px","normal",y,"0px",65,28),l("".concat(t.year," ").concat(t.$strings.StatsYearInReview),"18px","bold","white","1px",65,51),o(50,100,340,160),l(t.yearStats.numBooksFinished,"64px","bold","white","0px",160,165),l(t.$strings.StatsBooksFinished,"28px","normal",y,"0px",160,210,w),(v=new Path2D).addPath(new Path2D("M19 1H5c-1.1 0-1.99.9-1.99 2L3 15.93c0 .69.35 1.3.88 1.66L12 23l8.11-5.41c.53-.36.88-.97.88-1.66L21 3c0-1.1-.9-2-2-2zm-9 15l-5-5 1.41-1.41L10 13.17l7.59-7.59L19 7l-9 9z"),{a:2,d:2,e:100,f:160}),r.fillStyle="#ffffff",r.fill(v),o(410,100,340,160),l(t.$elapsedPrettyExtended(t.yearStats.totalListeningTime,!0,!1),"40px","bold","white","0px",500,165),l(t.$strings.StatsSpentListening,"28px","normal",y,"0px",500,205,w),c("watch_later","white","52px",440,180),o(50,280,340,160),l(t.yearStats.totalListeningSessions,"64px","bold","white","0px",160,345),l(t.$strings.StatsSessions,"28px","normal",y,"1px",160,390,w),c("headphones","white","52px",95,360),o(410,280,340,160),l(t.yearStats.numBooksListened,"64px","bold","white","0px",500,345),l(t.$strings.StatsBooksListenedTo,"28px","normal",y,"0px",500,390,w),c("local_library","white","52px",440,360),t.variant){if(1===t.variant){if((h=Object.values(h)).length>0)for(r.textAlign="center",l(t.$strings.StatsBooksFinishedThisYear,"28px","normal",y,"0px",canvas.width/2,530),i=0;i<Math.min(5,h.length);i++)A=h[i],r.drawImage(A.img,A.sx,A.sy,A.sw,A.sw,40+145*i,570,140,140)}else if(2===t.variant){if(t.yearStats.topAuthors.length)for(l(t.$strings.StatsTopAuthors,"24px","normal",y,"1px",70,524),P=0;P<t.yearStats.topAuthors.length;P++)l(t.yearStats.topAuthors[P].name,"36px","bolder","white","0px",70,584+60*P,330);if(t.yearStats.topGenres.length)for(l(t.$strings.StatsTopGenres,"24px","normal",y,"1px",430,524),B=0;B<t.yearStats.topGenres.length;B++)l(t.yearStats.topGenres[B].genre,"36px","bolder","white","0px",430,584+60*B,330)}}else(L=t.yearStats.mostListenedNarrator)&&(l(t.$strings.StatsTopNarrator,"24px","normal",y,"1px",70,520,330),l(L.name,"36px","bolder","white","0px",70,564,330),l(t.$elapsedPrettyExtended(L.time,!0,!1),"24px","lighter","white","1px",70,599)),(k=t.yearStats.topGenres[0])&&(l(t.$strings.StatsTopGenre,"24px","normal",y,"1px",430,520,330),l(k.genre,"36px","bolder","white","0px",430,564,330),l(t.$elapsedPrettyExtended(k.time,!0,!1),"24px","lighter","white","1px",430,599)),(T=t.yearStats.topAuthors[0])&&(l(t.$strings.StatsTopAuthor,"24px","normal",y,"1px",70,670,330),l(T.name,"36px","bolder","white","0px",70,714,330),l(t.$elapsedPrettyExtended(T.time,!0,!1),"24px","lighter","white","1px",70,749)),null!==($=t.yearStats.mostListenedMonth)&&void 0!==$&&$.time&&(C=new Date(t.year,t.yearStats.mostListenedMonth.month,1),R=t.$formatJsDate(C,"LLLL"),l(t.$strings.StatsTopMonth,"24px","normal",y,"1px",430,670,330),l(R,"36px","bolder","white","0px",430,714,330),l(t.$elapsedPrettyExtended(t.yearStats.mostListenedMonth.time,!0,!1),"24px","lighter","white","1px",430,749));t.canvas=canvas,t.dataUrl=canvas.toDataURL("png");case 66:case"end":return e.stop()}}),e)})))()},refresh:function(){this.init()},share:function(){var t=this;this.canvas.toBlob((function(e){var r={files:[new File([e],"yearinreview.png",{type:e.type})]};navigator.canShare(r)?navigator.share(r).then((function(){console.log("Share success")})).catch((function(e){console.error("Failed to share",e),"AbortError"!==e.name&&t.$toast.error(t.$strings.ToastFailedToShare+": "+e.message)})):t.$toast.error(t.$strings.ToastErrorCannotShare)}))},init:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$emit("update:processing",!0),e.next=3,t.$axios.$get("/api/me/stats/year/".concat(t.year)).catch((function(e){return console.error("Failed to load stats for year",e),t.$toast.error(t.$strings.ToastFailedToLoadData),null}));case 3:return t.yearStats=e.sent,e.next=6,t.initCanvas();case 6:t.$emit("update:processing",!1);case 7:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.init()}}),c=l,d=r(4),component=Object(d.a)(c,(function(){var t=this,e=t._self._c;return e("div",[t.processing?e("div",{staticClass:"max-w-[800px] h-80 md:h-[800px] mx-auto flex items-center justify-center",attrs:{role:"img","aria-label":t.$strings.MessageLoading}},[e("widgets-loading-spinner")],1):t.dataUrl?e("img",{staticClass:"mx-auto",attrs:{src:t.dataUrl,"aria-label":t.$getString("LabelPersonalYearReview",[t.variant+1])}}):t._e()])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{WidgetsLoadingSpinner:r(151).default})}}]);