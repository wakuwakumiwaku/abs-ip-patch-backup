(window.webpackJsonp=window.webpackJsonp||[]).push([[172,57,59,81,143],{1048:function(e,t,n){"use strict";n.r(t);n(15),n(22),n(44),n(45),n(38),n(28);var r=n(7),l=n(16);n(29),n(26),n(33),n(56),n(27),n(150),n(14),n(8);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={asyncData:function(e){var t=e.store,n=e.redirect;t.getters["user/getIsAdminOrUp"]||n("/")},data:function(){return{users:[],loading:!1,savingSettings:!1,sendingTest:!1,deletingDeviceName:null,settings:null,newSettings:{host:null,port:465,secure:!0,rejectUnauthorized:!0,user:null,pass:null,testAddress:null,fromAddress:null},newEReaderDevice:{name:"",email:""},selectedEReaderDevice:null,showEReaderDeviceModal:!1}},computed:{hasUpdates:function(){if(!this.settings)return!0;for(var e in this.newSettings)if("ereaderDevices"!==e&&this.newSettings[e]!==this.settings[e])return!0;return!1},existingEReaderDevices:function(){var e;return(null===(e=this.settings)||void 0===e?void 0:e.ereaderDevices)||[]}},methods:{resetChanges:function(){this.newSettings=c({},this.settings)},loadUsers:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.users.length){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$axios.$get("/api/users").then((function(e){return e.users.sort((function(a,b){return a.createdAt-b.createdAt}))})).catch((function(t){return console.error("Failed",t),e.$toast.error(e.$strings.ToastFailedToLoadData),[]}));case 4:e.users=t.sent;case 5:case"end":return t.stop()}}),t)})))()},getAccessibleBy:function(e){var t=this,n=e.availabilityOption;return"userOrUp"===n?"Users (excluding Guests)":"guestOrUp"===n?"Users (including Guests)":"specificUsers"===n?e.users.map((function(e){var n;return null===(n=t.users.find((function(u){return u.id===e})))||void 0===n?void 0:n.username})).join(", "):"Admins Only"},editDeviceClick:function(e){this.selectedEReaderDevice=e,this.showEReaderDeviceModal=!0},deleteDeviceClick:function(e){var t=this,n={message:this.$getString("MessageConfirmDeleteDevice",[e.name]),callback:function(n){n&&t.deleteDevice(e)},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",n)},deleteDevice:function(e){var t=this,n={ereaderDevices:this.existingEReaderDevices.filter((function(t){return t.name!==e.name}))};this.deletingDeviceName=e.name,this.$axios.$post("/api/emails/ereader-devices",n).then((function(data){t.ereaderDevicesUpdated(data.ereaderDevices)})).catch((function(e){console.error("Failed to delete device",e),t.$toast.error(t.$strings.ToastRemoveFailed)})).finally((function(){t.deletingDeviceName=null}))},ereaderDevicesUpdated:function(e){this.settings.ereaderDevices=e,this.newSettings.ereaderDevices=e.map((function(e){return c({},e)})),e.some((function(e){return"specificUsers"===e.availabilityOption}))&&this.loadUsers()},addNewDeviceClick:function(){this.selectedEReaderDevice=null,this.showEReaderDeviceModal=!0},sendTestClick:function(){var e=this;this.sendingTest=!0,this.$axios.$post("/api/emails/test").then((function(){e.$toast.success(e.$strings.ToastDeviceTestEmailSuccess)})).catch((function(t){console.error("Failed to send test email",t);var n=t.response.data||e.$strings.ToastDeviceTestEmailFailed;e.$toast.error(n)})).finally((function(){e.sendingTest=!1}))},validateForm:function(){for(var e=0,t=[this.$refs.hostInput,this.$refs.portInput,this.$refs.userInput,this.$refs.passInput,this.$refs.fromInput];e<t.length;e++){var n=t[e];null!=n&&n.blur&&n.blur()}return this.newSettings.port&&(this.newSettings.port=Number(this.newSettings.port)),!0},submitForm:function(){var e=this;if(this.validateForm()){var t={host:this.newSettings.host,port:this.newSettings.port,secure:this.newSettings.secure,rejectUnauthorized:this.newSettings.rejectUnauthorized,user:this.newSettings.user,pass:this.newSettings.pass,testAddress:this.newSettings.testAddress,fromAddress:this.newSettings.fromAddress};this.savingSettings=!0,this.$axios.$patch("/api/emails/settings",t).then((function(data){e.settings=data.settings,e.newSettings=c({},data.settings),e.$toast.success(e.$strings.ToastEmailSettingsUpdateSuccess)})).catch((function(t){console.error("Failed to update email settings",t),e.$toast.error(e.$strings.ToastFailedToUpdate)})).finally((function(){e.savingSettings=!1}))}},init:function(){var e=this;this.loading=!0,this.$axios.$get("/api/emails/settings").then(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(data){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!data.settings.ereaderDevices.some((function(e){return"specificUsers"===e.availabilityOption}))){t.next=3;break}return t.next=3,e.loadUsers();case 3:e.settings=data.settings,e.newSettings=c({},e.settings);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){console.error("Failed to get email settings",t),e.$toast.error(e.$strings.ToastFailedToLoadData)})).finally((function(){e.loading=!1}))}},mounted:function(){this.init()},beforeDestroy:function(){}},v=d,f=n(4),component=Object(f.a)(v,(function(){var e=this,t=e._self._c;return t("div",[t("app-settings-content",{attrs:{"header-text":e.$strings.HeaderEmailSettings,description:""},scopedSlots:e._u([{key:"header-items",fn:function(){return[t("ui-tooltip",{staticClass:"inline-flex ml-2",attrs:{text:e.$strings.LabelClickForMoreInfo}},[t("a",{staticClass:"inline-flex",attrs:{href:"https://www.audiobookshelf.org/guides/send_to_ereader",target:"_blank"}},[t("span",{staticClass:"material-symbols text-xl w-5 text-gray-200"},[e._v("help_outline")])])])]},proxy:!0}])},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"flex items-center -mx-1 mb-2"},[t("div",{staticClass:"w-full md:w-3/4 px-1"},[t("ui-text-input-with-label",{ref:"hostInput",attrs:{disabled:e.savingSettings,label:e.$strings.LabelHost},model:{value:e.newSettings.host,callback:function(t){e.$set(e.newSettings,"host",t)},expression:"newSettings.host"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/4 px-1"},[t("ui-text-input-with-label",{ref:"portInput",attrs:{type:"number",disabled:e.savingSettings,label:e.$strings.LabelPort},model:{value:e.newSettings.port,callback:function(t){e.$set(e.newSettings,"port",t)},expression:"newSettings.port"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center mb-2 py-3"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("div",{staticClass:"flex items-center"},[t("ui-toggle-switch",{attrs:{labeledBy:"email-settings-secure",disabled:e.savingSettings},model:{value:e.newSettings.secure,callback:function(t){e.$set(e.newSettings,"secure",t)},expression:"newSettings.secure"}}),e._v(" "),t("ui-tooltip",{attrs:{text:e.$strings.LabelEmailSettingsSecureHelp}},[t("div",{staticClass:"pl-4 flex items-center"},[t("span",{attrs:{id:"email-settings-secure"}},[e._v(e._s(e.$strings.LabelEmailSettingsSecure))]),e._v(" "),t("span",{staticClass:"material-symbols text-lg pl-1"},[e._v("info")])])])],1)]),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("div",{staticClass:"flex items-center"},[t("ui-toggle-switch",{attrs:{labeledBy:"email-settings-reject-unauthorized",disabled:e.savingSettings},model:{value:e.newSettings.rejectUnauthorized,callback:function(t){e.$set(e.newSettings,"rejectUnauthorized",t)},expression:"newSettings.rejectUnauthorized"}}),e._v(" "),t("ui-tooltip",{attrs:{text:e.$strings.LabelEmailSettingsRejectUnauthorizedHelp}},[t("div",{staticClass:"pl-4 flex items-center"},[t("span",{attrs:{id:"email-settings-reject-unauthorized"}},[e._v(e._s(e.$strings.LabelEmailSettingsRejectUnauthorized))]),e._v(" "),t("span",{staticClass:"material-symbols text-lg pl-1"},[e._v("info")])])])],1)])]),e._v(" "),t("div",{staticClass:"flex items-center -mx-1 mb-2"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"userInput",attrs:{disabled:e.savingSettings,label:e.$strings.LabelUsername},model:{value:e.newSettings.user,callback:function(t){e.$set(e.newSettings,"user",t)},expression:"newSettings.user"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"passInput",attrs:{type:"password",disabled:e.savingSettings,label:e.$strings.LabelPassword},model:{value:e.newSettings.pass,callback:function(t){e.$set(e.newSettings,"pass",t)},expression:"newSettings.pass"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center -mx-1 mb-2"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"fromInput",attrs:{disabled:e.savingSettings,label:e.$strings.LabelEmailSettingsFromAddress},model:{value:e.newSettings.fromAddress,callback:function(t){e.$set(e.newSettings,"fromAddress",t)},expression:"newSettings.fromAddress"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"testInput",attrs:{disabled:e.savingSettings,label:e.$strings.LabelEmailSettingsTestAddress},model:{value:e.newSettings.testAddress,callback:function(t){e.$set(e.newSettings,"testAddress",t)},expression:"newSettings.testAddress"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center justify-between pt-4"},[e.hasUpdates?t("ui-btn",{attrs:{disabled:e.savingSettings,type:"button"},on:{click:e.resetChanges}},[e._v(e._s(e.$strings.ButtonReset))]):t("ui-btn",{attrs:{loading:e.sendingTest,disabled:e.savingSettings||!e.newSettings.host,type:"button"},on:{click:e.sendTestClick}},[e._v(e._s(e.$strings.ButtonTest))]),e._v(" "),t("ui-btn",{attrs:{loading:e.savingSettings,disabled:!e.hasUpdates,type:"submit"}},[e._v(e._s(e.$strings.ButtonSave))])],1)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"absolute top-0 left-0 w-full h-full bg-black/25 flex items-center justify-center"},[t("ui-loading-indicator")],1)]),e._v(" "),t("app-settings-content",{attrs:{"header-text":e.$strings.HeaderEreaderDevices,description:e.$strings.MessageEreaderDevices},scopedSlots:e._u([{key:"header-items",fn:function(){return[t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-primary",small:""},on:{click:e.addNewDeviceClick}},[e._v(e._s(e.$strings.ButtonAddDevice))])]},proxy:!0}])},[e._v(" "),e.existingEReaderDevices.length?t("table",{staticClass:"tracksTable mt-4"},[t("tr",[t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelName))]),e._v(" "),t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelEmail))]),e._v(" "),t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelAccessibleBy))]),e._v(" "),t("th",{staticClass:"w-40"})]),e._v(" "),e._l(e.existingEReaderDevices,(function(n){return t("tr",{key:n.name},[t("td",[t("p",{staticClass:"text-sm md:text-base text-gray-100"},[e._v(e._s(n.name))])]),e._v(" "),t("td",{staticClass:"text-left"},[t("p",{staticClass:"text-sm md:text-base text-gray-100"},[e._v(e._s(n.email))])]),e._v(" "),t("td",{staticClass:"text-left"},[t("p",{staticClass:"text-sm md:text-base text-gray-100"},[e._v(e._s(e.getAccessibleBy(n)))])]),e._v(" "),t("td",{staticClass:"w-40"},[t("div",{staticClass:"flex justify-end items-center h-10"},[t("ui-icon-btn",{staticClass:"mx-1",attrs:{icon:"edit",borderless:"",size:8,"icon-font-size":"1.1rem",disabled:e.deletingDeviceName===n.name},on:{click:function(t){return e.editDeviceClick(n)}}}),e._v(" "),t("ui-icon-btn",{attrs:{icon:"delete",borderless:"",size:8,"icon-font-size":"1.1rem",disabled:e.deletingDeviceName===n.name},on:{click:function(t){return e.deleteDeviceClick(n)}}})],1)])])}))],2):e.loading?e._e():t("div",{staticClass:"text-center py-4"},[t("p",{staticClass:"text-lg text-gray-100"},[e._v(e._s(e.$strings.MessageNoDevices))])])]),e._v(" "),t("modals-emails-e-reader-device-modal",{attrs:{users:e.users,"existing-devices":e.existingEReaderDevices,"ereader-device":e.selectedEReaderDevice,loadUsers:e.loadUsers},on:{update:e.ereaderDevicesUpdated},model:{value:e.showEReaderDeviceModal,callback:function(t){e.showEReaderDeviceModal=t},expression:"showEReaderDeviceModal"}})],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTooltip:n(76).default,UiTextInputWithLabel:n(121).default,UiToggleSwitch:n(185).default,UiBtn:n(42).default,UiLoadingIndicator:n(348).default,AppSettingsContent:n(652).default,UiIconBtn:n(148).default,ModalsEmailsEReaderDeviceModal:n(839).default})},642:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(183);var l=n(237),o=n(149);function c(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(l.a)(e)||Object(o.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},646:function(e,t,n){var content=n(648);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(19).default)("6d988fa2",content,!0,{sourceMap:!1})},647:function(e,t,n){"use strict";n(646)},648:function(e,t,n){var r=n(18)((function(i){return i[1]}));r.push([e.i,"\n#settings-description a {\n  color: rgb(96 165 250);\n}\n#settings-description a:hover {\n  color: rgb(147 197 253);\n  text-decoration-line: underline;\n}\n#settings-description code {\n  font-size: 0.875rem;\n  border-radius: 6px;\n  background-color: rgb(82, 82, 82);\n  color: white;\n  padding: 2px 4px;\n}\n",""]),r.locals={},e.exports=r},652:function(e,t,n){"use strict";n.r(t);n(22),n(43);var r={props:{headerText:String,description:String,note:String},methods:{}},l=(n(647),n(4)),component=Object(l.a)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg-bg rounded-md shadow-lg border border-white/5 p-2 sm:p-4 mb-8"},[t("div",{staticClass:"flex items-center mb-2"},[e._t("header-prefix"),e._v(" "),t("h1",{staticClass:"text-xl"},[e._v(e._s(e.headerText))]),e._v(" "),e._t("header-items")],2),e._v(" "),e.description?t("p",{staticClass:"mb-6 text-gray-200",attrs:{id:"settings-description"},domProps:{innerHTML:e._s(e.description)}}):e._e(),e._v(" "),e._t("default")],2)}),[],!1,null,null,null);t.default=component.exports},676:function(e,t,n){"use strict";n.r(t);n(41),n(52),n(17),n(26),n(33),n(27),n(8);var r={props:{value:{type:Array,default:function(){return[]}},items:{type:Array,default:function(){return[]}},label:String},data:function(){return{showMenu:!1,menu:null,clickOutsideObj:{handler:this.closeMenu,events:["mousedown"],isActive:!0}}},computed:{selected:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},selectedItems:function(){var e=this;return(this.value||[]).map((function(t){return e.items.find((function(i){return i.value===t}))||{text:t,value:t}}))}},methods:{recalcMenuPos:function(){if(this.menu&&this.$refs.inputWrapper){var e=this.$refs.inputWrapper.getBoundingClientRect();this.menu.style.top=e.y+e.height-4+"px",this.menu.style.left=e.x+"px",this.menu.style.width=e.width+"px"}},unmountMountMenu:function(){if(this.$refs.menu&&this.$refs.inputWrapper){this.menu=this.$refs.menu;var e=this.$refs.inputWrapper.getBoundingClientRect();this.menu.remove(),document.body.appendChild(this.menu),this.menu.style.top=e.y+e.height-4+"px",this.menu.style.left=e.x+"px",this.menu.style.width=e.width+"px"}},clickedOption:function(e,t){var n=this;e&&(e.stopPropagation(),e.preventDefault());var r=null;r=this.selected.includes(t.value)?this.selected.filter((function(s){return s!==t.value})):this.selected.concat([t.value]),this.$emit("input",r),this.$nextTick((function(){n.recalcMenuPos()}))},closeMenu:function(){this.showMenu=!1,this.removeListener()},clickWrapper:function(){this.showMenu=!this.showMenu,this.showMenu?this.setListener():this.removeListener()},removeItem:function(e){var t=this,n=this.selected.filter((function(i){return i!==e}));this.$emit("input",n),this.$nextTick((function(){t.recalcMenuPos()}))},scroll:function(){this.recalcMenuPos()},setListener:function(){document.addEventListener("scroll",this.scroll,!0)},removeListener:function(){document.removeEventListener("scroll",this.scroll,!0)}},mounted:function(){},beforeDestroy:function(){this.menu&&this.menu.remove()}},l=n(4),component=Object(l.a)(r,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.clickOutsideObj,expression:"clickOutsideObj"}],staticClass:"w-full"},[t("p",{staticClass:"px-1 text-sm font-semibold"},[e._v(e._s(e.label))]),e._v(" "),t("div",{ref:"wrapper",staticClass:"relative"},[t("div",{ref:"inputWrapper",staticClass:"flex-wrap relative w-full shadow-xs flex items-center bg-primary border border-gray-600 rounded-md px-2 py-1 cursor-pointer",staticStyle:{"min-height":"40px"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.clickWrapper.apply(null,arguments)},mouseup:function(e){e.stopPropagation(),e.preventDefault()},mousedown:function(e){e.preventDefault()}}},e._l(e.selectedItems,(function(n){return t("div",{key:n.value,staticClass:"rounded-full px-2 py-1 ma-0.5 text-xs bg-bg flex flex-nowrap whitespace-nowrap items-center relative"},[t("div",{staticClass:"w-full h-full rounded-full absolute top-0 left-0 opacity-0 hover:opacity-100 px-1 bg-bg/75 flex items-center justify-end cursor-pointer"},[t("span",{staticClass:"material-symbols text-white hover:text-error",staticStyle:{"font-size":"1.1rem"},on:{click:function(t){return t.stopPropagation(),e.removeItem(n.value)}}},[e._v("close")])]),e._v("\n        "+e._s(n.text)+"\n      ")])})),0),e._v(" "),t("transition",{attrs:{name:"menu"}},[t("ul",{directives:[{name:"show",rawName:"v-show",value:e.showMenu,expression:"showMenu"}],ref:"menu",staticClass:"absolute z-60 -mt-px w-full bg-primary border border-black-200 shadow-lg max-h-56 rounded-md py-1 text-base ring-1 ring-black/5 overflow-auto focus:outline-hidden sm:text-sm",attrs:{role:"listbox","aria-labelledby":"listbox-label"}},[e._l(e.items,(function(n){return[t("li",{key:n.value,staticClass:"text-gray-50 select-none relative py-2 pr-9 cursor-pointer hover:bg-black-400",attrs:{role:"option"},on:{click:function(t){return e.clickedOption(t,n)},mouseup:function(e){e.stopPropagation(),e.preventDefault()},mousedown:function(e){e.preventDefault()}}},[t("p",{staticClass:"font-normal ml-3 block truncate"},[e._v(e._s(n.text))]),e._v(" "),e.selected.includes(n.value)?t("div",{staticClass:"text-yellow-400 absolute inset-y-0 right-0 my-auto w-5 h-5 mr-3 overflow-hidden"},[t("span",{staticClass:"material-symbols text-xl"},[e._v("check")])]):e._e()])]})),e._v(" "),e.items.length?e._e():t("li",{staticClass:"text-gray-50 select-none relative py-2 pr-9",attrs:{role:"option"}},[t("div",{staticClass:"flex items-center justify-center"},[t("span",{staticClass:"font-normal"},[e._v(e._s(e.$strings.MessageNoItems))])])])],2)])],1)])}),[],!1,null,null,null);t.default=component.exports},839:function(e,t,n){"use strict";n.r(t);n(15);var r=n(16),l=n(642),o=n(7);n(29),n(22),n(17),n(26),n(27),n(44),n(45),n(38),n(8),n(147),n(28);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v={props:{value:Boolean,existingDevices:{type:Array,default:function(){return[]}},ereaderDevice:{type:Object,default:function(){return null}},users:{type:Array,default:function(){return[]}},loadUsers:Function},data:function(){return{processing:!1,newDevice:{name:"",email:"",availabilityOption:"adminAndUp",users:[]}}},watch:{show:{handler:function(e){e&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},title:function(){return this.ereaderDevice?"Update Device":"Create Device"},userAvailabilityOptions:function(){return[{text:this.$strings.LabelAdminUsersOnly,value:"adminOrUp"},{text:this.$strings.LabelAllUsersExcludingGuests,value:"userOrUp"},{text:this.$strings.LabelAllUsersIncludingGuests,value:"guestOrUp"},{text:this.$strings.LabelSelectUsers,value:"specificUsers"}]},userOptions:function(){return this.users.map((function(u){return{text:u.username,value:u.id}}))}},methods:{availabilityOptionChanged:function(option){"specificUsers"!==option||this.users.length||this.callLoadUsers()},callLoadUsers:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.processing=!0,t.next=3,e.loadUsers();case 3:e.processing=!1;case 4:case"end":return t.stop()}}),t)})))()},submitForm:function(){var e,t,n=this;if(this.$refs.ereaderNameInput.blur(),this.$refs.ereaderEmailInput.blur(),null!==(e=this.newDevice.name)&&void 0!==e&&e.trim()&&null!==(t=this.newDevice.email)&&void 0!==t&&t.trim())if("specificUsers"!==this.newDevice.availabilityOption||this.newDevice.users.length)if("specificUsers"!==this.newDevice.availabilityOption&&(this.newDevice.users=[]),this.newDevice.name=this.newDevice.name.trim(),this.newDevice.email=this.newDevice.email.trim(),this.ereaderDevice){if(this.ereaderDevice.name!==this.newDevice.name&&this.existingDevices.some((function(e){return e.name===n.newDevice.name})))return void this.$toast.error(this.$strings.ToastDeviceNameAlreadyExists);this.submitUpdate()}else{if(this.existingDevices.some((function(e){return e.name===n.newDevice.name})))return void this.$toast.error(this.$strings.ToastDeviceNameAlreadyExists);this.submitCreate()}else this.$toast.error(this.$strings.ToastSelectAtLeastOneUser);else this.$toast.error(this.$strings.ToastNameEmailRequired)},submitUpdate:function(){var e=this;this.processing=!0;var t=this.existingDevices.filter((function(t){return t.name!==e.ereaderDevice.name})),n={ereaderDevices:[].concat(Object(l.a)(t),[d({},this.newDevice)])};this.$axios.$post("/api/emails/ereader-devices",n).then((function(data){e.$emit("update",data.ereaderDevices),e.show=!1})).catch((function(t){console.error("Failed to update device",t),e.$toast.error(e.$strings.ToastFailedToUpdate)})).finally((function(){e.processing=!1}))},submitCreate:function(){var e=this;this.processing=!0;var t={ereaderDevices:[].concat(Object(l.a)(this.existingDevices),[d({},this.newDevice)])};this.$axios.$post("/api/emails/ereader-devices",t).then((function(data){e.$emit("update",data.ereaderDevices||[]),e.show=!1})).catch((function(t){console.error("Failed to add device",t),e.$toast.error(e.$strings.ToastDeviceAddFailed)})).finally((function(){e.processing=!1}))},init:function(){this.ereaderDevice?(this.newDevice.name=this.ereaderDevice.name,this.newDevice.email=this.ereaderDevice.email,this.newDevice.availabilityOption=this.ereaderDevice.availabilityOption||"adminOrUp",this.newDevice.users=this.ereaderDevice.users||[]):(this.newDevice.name="",this.newDevice.email="",this.newDevice.availabilityOption="adminOrUp",this.newDevice.users=[])}},mounted:function(){}},f=n(4),component=Object(f.a)(v,(function(){var e=this,t=e._self._c;return t("modals-modal",{ref:"modal",attrs:{name:"ereader-device-edit",width:800,height:"unset",processing:e.processing},scopedSlots:e._u([{key:"outer",fn:function(){return[t("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[t("p",{staticClass:"text-3xl text-white truncate"},[e._v(e._s(e.title))])])]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"w-full text-sm rounded-lg bg-bg shadow-lg border border-black-300"},[t("div",{staticClass:"w-full px-3 py-5 md:p-12"},[t("div",{staticClass:"flex items-center -mx-1 mb-4"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"ereaderNameInput",attrs:{disabled:e.processing,label:e.$strings.LabelName},model:{value:e.newDevice.name,callback:function(t){e.$set(e.newDevice,"name",t)},expression:"newDevice.name"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"ereaderEmailInput",attrs:{disabled:e.processing,label:e.$strings.LabelEmail},model:{value:e.newDevice.email,callback:function(t){e.$set(e.newDevice,"email",t)},expression:"newDevice.email"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center -mx-1 mb-4"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-dropdown",{attrs:{label:e.$strings.LabelDeviceIsAvailableTo,items:e.userAvailabilityOptions},on:{input:e.availabilityOptionChanged},model:{value:e.newDevice.availabilityOption,callback:function(t){e.$set(e.newDevice,"availabilityOption",t)},expression:"newDevice.availabilityOption"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},["specificUsers"===e.newDevice.availabilityOption?t("ui-multi-select-dropdown",{attrs:{label:e.$strings.HeaderUsers,items:e.userOptions},model:{value:e.newDevice.users,callback:function(t){e.$set(e.newDevice,"users",t)},expression:"newDevice.users"}}):e._e()],1)]),e._v(" "),t("div",{staticClass:"flex items-center pt-4"},[t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[e._v(e._s(e.$strings.ButtonSubmit))])],1)])])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:n(121).default,UiDropdown:n(236).default,UiMultiSelectDropdown:n(676).default,UiBtn:n(42).default,ModalsModal:n(39).default})}}]);