(window.webpackJsonp=window.webpackJsonp||[]).push([[81,57,143],{642:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(183);var l=n(237),o=n(149);function c(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(l.a)(e)||Object(o.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},676:function(e,t,n){"use strict";n.r(t);n(41),n(52),n(17),n(26),n(33),n(27),n(8);var r={props:{value:{type:Array,default:function(){return[]}},items:{type:Array,default:function(){return[]}},label:String},data:function(){return{showMenu:!1,menu:null,clickOutsideObj:{handler:this.closeMenu,events:["mousedown"],isActive:!0}}},computed:{selected:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},selectedItems:function(){var e=this;return(this.value||[]).map((function(t){return e.items.find((function(i){return i.value===t}))||{text:t,value:t}}))}},methods:{recalcMenuPos:function(){if(this.menu&&this.$refs.inputWrapper){var e=this.$refs.inputWrapper.getBoundingClientRect();this.menu.style.top=e.y+e.height-4+"px",this.menu.style.left=e.x+"px",this.menu.style.width=e.width+"px"}},unmountMountMenu:function(){if(this.$refs.menu&&this.$refs.inputWrapper){this.menu=this.$refs.menu;var e=this.$refs.inputWrapper.getBoundingClientRect();this.menu.remove(),document.body.appendChild(this.menu),this.menu.style.top=e.y+e.height-4+"px",this.menu.style.left=e.x+"px",this.menu.style.width=e.width+"px"}},clickedOption:function(e,t){var n=this;e&&(e.stopPropagation(),e.preventDefault());var r=null;r=this.selected.includes(t.value)?this.selected.filter((function(s){return s!==t.value})):this.selected.concat([t.value]),this.$emit("input",r),this.$nextTick((function(){n.recalcMenuPos()}))},closeMenu:function(){this.showMenu=!1,this.removeListener()},clickWrapper:function(){this.showMenu=!this.showMenu,this.showMenu?this.setListener():this.removeListener()},removeItem:function(e){var t=this,n=this.selected.filter((function(i){return i!==e}));this.$emit("input",n),this.$nextTick((function(){t.recalcMenuPos()}))},scroll:function(){this.recalcMenuPos()},setListener:function(){document.addEventListener("scroll",this.scroll,!0)},removeListener:function(){document.removeEventListener("scroll",this.scroll,!0)}},mounted:function(){},beforeDestroy:function(){this.menu&&this.menu.remove()}},l=n(4),component=Object(l.a)(r,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.clickOutsideObj,expression:"clickOutsideObj"}],staticClass:"w-full"},[t("p",{staticClass:"px-1 text-sm font-semibold"},[e._v(e._s(e.label))]),e._v(" "),t("div",{ref:"wrapper",staticClass:"relative"},[t("div",{ref:"inputWrapper",staticClass:"flex-wrap relative w-full shadow-xs flex items-center bg-primary border border-gray-600 rounded-md px-2 py-1 cursor-pointer",staticStyle:{"min-height":"40px"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.clickWrapper.apply(null,arguments)},mouseup:function(e){e.stopPropagation(),e.preventDefault()},mousedown:function(e){e.preventDefault()}}},e._l(e.selectedItems,(function(n){return t("div",{key:n.value,staticClass:"rounded-full px-2 py-1 ma-0.5 text-xs bg-bg flex flex-nowrap whitespace-nowrap items-center relative"},[t("div",{staticClass:"w-full h-full rounded-full absolute top-0 left-0 opacity-0 hover:opacity-100 px-1 bg-bg/75 flex items-center justify-end cursor-pointer"},[t("span",{staticClass:"material-symbols text-white hover:text-error",staticStyle:{"font-size":"1.1rem"},on:{click:function(t){return t.stopPropagation(),e.removeItem(n.value)}}},[e._v("close")])]),e._v("\n        "+e._s(n.text)+"\n      ")])})),0),e._v(" "),t("transition",{attrs:{name:"menu"}},[t("ul",{directives:[{name:"show",rawName:"v-show",value:e.showMenu,expression:"showMenu"}],ref:"menu",staticClass:"absolute z-60 -mt-px w-full bg-primary border border-black-200 shadow-lg max-h-56 rounded-md py-1 text-base ring-1 ring-black/5 overflow-auto focus:outline-hidden sm:text-sm",attrs:{role:"listbox","aria-labelledby":"listbox-label"}},[e._l(e.items,(function(n){return[t("li",{key:n.value,staticClass:"text-gray-50 select-none relative py-2 pr-9 cursor-pointer hover:bg-black-400",attrs:{role:"option"},on:{click:function(t){return e.clickedOption(t,n)},mouseup:function(e){e.stopPropagation(),e.preventDefault()},mousedown:function(e){e.preventDefault()}}},[t("p",{staticClass:"font-normal ml-3 block truncate"},[e._v(e._s(n.text))]),e._v(" "),e.selected.includes(n.value)?t("div",{staticClass:"text-yellow-400 absolute inset-y-0 right-0 my-auto w-5 h-5 mr-3 overflow-hidden"},[t("span",{staticClass:"material-symbols text-xl"},[e._v("check")])]):e._e()])]})),e._v(" "),e.items.length?e._e():t("li",{staticClass:"text-gray-50 select-none relative py-2 pr-9",attrs:{role:"option"}},[t("div",{staticClass:"flex items-center justify-center"},[t("span",{staticClass:"font-normal"},[e._v(e._s(e.$strings.MessageNoItems))])])])],2)])],1)])}),[],!1,null,null,null);t.default=component.exports},839:function(e,t,n){"use strict";n.r(t);n(15);var r=n(16),l=n(642),o=n(7);n(29),n(22),n(17),n(26),n(27),n(44),n(45),n(38),n(8),n(147),n(28);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v={props:{value:Boolean,existingDevices:{type:Array,default:function(){return[]}},ereaderDevice:{type:Object,default:function(){return null}},users:{type:Array,default:function(){return[]}},loadUsers:Function},data:function(){return{processing:!1,newDevice:{name:"",email:"",availabilityOption:"adminAndUp",users:[]}}},watch:{show:{handler:function(e){e&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},title:function(){return this.ereaderDevice?"Update Device":"Create Device"},userAvailabilityOptions:function(){return[{text:this.$strings.LabelAdminUsersOnly,value:"adminOrUp"},{text:this.$strings.LabelAllUsersExcludingGuests,value:"userOrUp"},{text:this.$strings.LabelAllUsersIncludingGuests,value:"guestOrUp"},{text:this.$strings.LabelSelectUsers,value:"specificUsers"}]},userOptions:function(){return this.users.map((function(u){return{text:u.username,value:u.id}}))}},methods:{availabilityOptionChanged:function(option){"specificUsers"!==option||this.users.length||this.callLoadUsers()},callLoadUsers:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.processing=!0,t.next=3,e.loadUsers();case 3:e.processing=!1;case 4:case"end":return t.stop()}}),t)})))()},submitForm:function(){var e,t,n=this;if(this.$refs.ereaderNameInput.blur(),this.$refs.ereaderEmailInput.blur(),null!==(e=this.newDevice.name)&&void 0!==e&&e.trim()&&null!==(t=this.newDevice.email)&&void 0!==t&&t.trim())if("specificUsers"!==this.newDevice.availabilityOption||this.newDevice.users.length)if("specificUsers"!==this.newDevice.availabilityOption&&(this.newDevice.users=[]),this.newDevice.name=this.newDevice.name.trim(),this.newDevice.email=this.newDevice.email.trim(),this.ereaderDevice){if(this.ereaderDevice.name!==this.newDevice.name&&this.existingDevices.some((function(e){return e.name===n.newDevice.name})))return void this.$toast.error(this.$strings.ToastDeviceNameAlreadyExists);this.submitUpdate()}else{if(this.existingDevices.some((function(e){return e.name===n.newDevice.name})))return void this.$toast.error(this.$strings.ToastDeviceNameAlreadyExists);this.submitCreate()}else this.$toast.error(this.$strings.ToastSelectAtLeastOneUser);else this.$toast.error(this.$strings.ToastNameEmailRequired)},submitUpdate:function(){var e=this;this.processing=!0;var t=this.existingDevices.filter((function(t){return t.name!==e.ereaderDevice.name})),n={ereaderDevices:[].concat(Object(l.a)(t),[d({},this.newDevice)])};this.$axios.$post("/api/emails/ereader-devices",n).then((function(data){e.$emit("update",data.ereaderDevices),e.show=!1})).catch((function(t){console.error("Failed to update device",t),e.$toast.error(e.$strings.ToastFailedToUpdate)})).finally((function(){e.processing=!1}))},submitCreate:function(){var e=this;this.processing=!0;var t={ereaderDevices:[].concat(Object(l.a)(this.existingDevices),[d({},this.newDevice)])};this.$axios.$post("/api/emails/ereader-devices",t).then((function(data){e.$emit("update",data.ereaderDevices||[]),e.show=!1})).catch((function(t){console.error("Failed to add device",t),e.$toast.error(e.$strings.ToastDeviceAddFailed)})).finally((function(){e.processing=!1}))},init:function(){this.ereaderDevice?(this.newDevice.name=this.ereaderDevice.name,this.newDevice.email=this.ereaderDevice.email,this.newDevice.availabilityOption=this.ereaderDevice.availabilityOption||"adminOrUp",this.newDevice.users=this.ereaderDevice.users||[]):(this.newDevice.name="",this.newDevice.email="",this.newDevice.availabilityOption="adminOrUp",this.newDevice.users=[])}},mounted:function(){}},m=n(4),component=Object(m.a)(v,(function(){var e=this,t=e._self._c;return t("modals-modal",{ref:"modal",attrs:{name:"ereader-device-edit",width:800,height:"unset",processing:e.processing},scopedSlots:e._u([{key:"outer",fn:function(){return[t("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[t("p",{staticClass:"text-3xl text-white truncate"},[e._v(e._s(e.title))])])]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"w-full text-sm rounded-lg bg-bg shadow-lg border border-black-300"},[t("div",{staticClass:"w-full px-3 py-5 md:p-12"},[t("div",{staticClass:"flex items-center -mx-1 mb-4"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"ereaderNameInput",attrs:{disabled:e.processing,label:e.$strings.LabelName},model:{value:e.newDevice.name,callback:function(t){e.$set(e.newDevice,"name",t)},expression:"newDevice.name"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"ereaderEmailInput",attrs:{disabled:e.processing,label:e.$strings.LabelEmail},model:{value:e.newDevice.email,callback:function(t){e.$set(e.newDevice,"email",t)},expression:"newDevice.email"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center -mx-1 mb-4"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-dropdown",{attrs:{label:e.$strings.LabelDeviceIsAvailableTo,items:e.userAvailabilityOptions},on:{input:e.availabilityOptionChanged},model:{value:e.newDevice.availabilityOption,callback:function(t){e.$set(e.newDevice,"availabilityOption",t)},expression:"newDevice.availabilityOption"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},["specificUsers"===e.newDevice.availabilityOption?t("ui-multi-select-dropdown",{attrs:{label:e.$strings.HeaderUsers,items:e.userOptions},model:{value:e.newDevice.users,callback:function(t){e.$set(e.newDevice,"users",t)},expression:"newDevice.users"}}):e._e()],1)]),e._v(" "),t("div",{staticClass:"flex items-center pt-4"},[t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[e._v(e._s(e.$strings.ButtonSubmit))])],1)])])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:n(121).default,UiDropdown:n(236).default,UiMultiSelectDropdown:n(676).default,UiBtn:n(42).default,ModalsModal:n(39).default})}}]);