(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{843:function(t,e,n){"use strict";n.r(e);n(56);var o=n(642),l=n(16);n(22),n(43),n(26),n(33),n(27),n(15),n(44),n(45),n(38),n(8),n(28);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={props:{value:Boolean,notification:{type:Object,default:function(){return null}},notificationData:{type:Object,default:function(){}}},data:function(){return{processing:!1,newNotification:{},isNew:!0}},watch:{show:{handler:function(t){t&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},notificationEvents:function(){return this.notificationData&&this.notificationData.events||[]},eventOptions:function(){var t=this;return this.notificationEvents.map((function(e){return{value:e.name,text:e.name,subtext:t.$strings[e.descriptionKey]||e.description}}))},selectedEventData:function(){var t=this;return this.notificationEvents.find((function(e){return e.name===t.newNotification.eventName}))},showLibrarySelectInput:function(){return this.selectedEventData&&this.selectedEventData.requiresLibrary},title:function(){return this.isNew?this.$strings.HeaderNotificationCreate:this.$strings.HeaderNotificationUpdate},availableVariables:function(){return this.selectedEventData&&this.selectedEventData.variables||null}},methods:{eventOptionUpdated:function(){this.selectedEventData&&(this.newNotification.titleTemplate=this.selectedEventData.defaults.title||"",this.newNotification.bodyTemplate=this.selectedEventData.defaults.body||"")},close:function(){this.$refs.modal&&this.$refs.modal.setHide()},submitForm:function(){var t;null===(t=this.$refs.urlsInput)||void 0===t||t.forceBlur(),this.newNotification.urls.length?this.isNew?this.submitCreate():this.submitUpdate():this.$toast.error(this.$strings.ToastAppriseUrlRequired)},submitUpdate:function(){var t=this;this.processing=!0;var e=r({},this.newNotification);console.log("Sending update notification",e),this.$axios.$patch("/api/notifications/".concat(e.id),e).then((function(e){t.$emit("update",e),t.$toast.success(t.$strings.ToastNotificationUpdateSuccess),t.show=!1})).catch((function(e){console.error("Failed to update notification",e),t.$toast.error(t.$strings.ToastFailedToUpdate)})).finally((function(){t.processing=!1}))},submitCreate:function(){var t=this;this.processing=!0;var e=r({},this.newNotification);console.log("Sending create notification",e),this.$axios.$post("/api/notifications",e).then((function(e){t.$emit("update",e),t.show=!1})).catch((function(e){console.error("Failed to create notification",e),t.$toast.error(t.$strings.ToastNotificationCreateFailed)})).finally((function(){t.processing=!1}))},init:function(){this.isNew=!this.notification,this.notification?this.newNotification={id:this.notification.id,libraryId:this.notification.libraryId,eventName:this.notification.eventName,urls:Object(o.a)(this.notification.urls),titleTemplate:this.notification.titleTemplate,bodyTemplate:this.notification.bodyTemplate,enabled:this.notification.enabled,type:this.notification.type}:(this.newNotification={libraryId:null,eventName:"onTest",urls:[],titleTemplate:"",bodyTemplate:"",enabled:!0,type:null},this.eventOptionUpdated())}},mounted:function(){}},d=n(4),component=Object(d.a)(f,(function(){var t=this,e=t._self._c;return e("modals-modal",{ref:"modal",attrs:{name:"notification-edit",width:800,height:"unset",processing:t.processing},scopedSlots:t._u([{key:"outer",fn:function(){return[e("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[e("p",{staticClass:"text-3xl text-white truncate"},[t._v(t._s(t.title))])])]},proxy:!0}]),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v(" "),e("form",{on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[e("div",{staticClass:"w-full text-sm rounded-lg bg-bg shadow-lg border border-black-300"},[e("div",{staticClass:"w-full px-3 py-5 md:p-12"},[e("ui-dropdown",{staticClass:"mb-4",attrs:{label:t.$strings.LabelNotificationEvent,items:t.eventOptions},on:{input:t.eventOptionUpdated},model:{value:t.newNotification.eventName,callback:function(e){t.$set(t.newNotification,"eventName",e)},expression:"newNotification.eventName"}}),t._v(" "),e("ui-multi-select",{ref:"urlsInput",staticClass:"mb-2",attrs:{label:t.$strings.LabelNotificationAppriseURL},model:{value:t.newNotification.urls,callback:function(e){t.$set(t.newNotification,"urls",e)},expression:"newNotification.urls"}}),t._v(" "),e("ui-text-input-with-label",{staticClass:"mb-2",attrs:{label:t.$strings.LabelNotificationTitleTemplate},model:{value:t.newNotification.titleTemplate,callback:function(e){t.$set(t.newNotification,"titleTemplate",e)},expression:"newNotification.titleTemplate"}}),t._v(" "),e("ui-textarea-with-label",{staticClass:"mb-2",attrs:{label:t.$strings.LabelNotificationBodyTemplate,rows:4},model:{value:t.newNotification.bodyTemplate,callback:function(e){t.$set(t.newNotification,"bodyTemplate",e)},expression:"newNotification.bodyTemplate"}}),t._v(" "),t.availableVariables?e("p",{staticClass:"text-sm text-gray-300"},[e("strong",[t._v(t._s(t.$strings.LabelNotificationAvailableVariables)+":")]),t._v(" "+t._s(t.availableVariables.join(", "))+"\n        ")]):t._e(),t._v(" "),e("div",{staticClass:"flex items-center pt-4"},[e("div",{staticClass:"flex items-center"},[e("ui-toggle-switch",{model:{value:t.newNotification.enabled,callback:function(e){t.$set(t.newNotification,"enabled",e)},expression:"newNotification.enabled"}}),t._v(" "),e("p",{staticClass:"text-lg pl-2"},[t._v(t._s(t.$strings.LabelEnable))])],1),t._v(" "),e("div",{staticClass:"grow"}),t._v(" "),e("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[t._v(t._s(t.$strings.ButtonSubmit))])],1)],1)])])])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiDropdown:n(236).default,UiMultiSelect:n(675).default,UiTextInputWithLabel:n(121).default,UiTextareaWithLabel:n(186).default,UiToggleSwitch:n(185).default,UiBtn:n(42).default,ModalsModal:n(39).default})}}]);