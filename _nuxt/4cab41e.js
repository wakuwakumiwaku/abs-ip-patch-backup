(window.webpackJsonp=window.webpackJsonp||[]).push([[82,57],{642:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(183);var o=r(237),c=r(149);function l(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||Object(o.a)(e)||Object(c.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},832:function(e,t,r){"use strict";r.r(t);r(15);var n=r(16),o=r(642);r(22),r(17),r(26),r(41),r(44),r(45),r(38),r(8),r(52),r(147),r(28);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={props:{value:Boolean,existingDevices:{type:Array,default:function(){return[]}},ereaderDevice:{type:Object,default:function(){return null}}},data:function(){return{processing:!1,newDevice:{name:"",email:"",availabilityOption:"adminAndUp",users:[]}}},watch:{show:{handler:function(e){e&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},user:function(){return this.$store.state.user.user},title:function(){return this.ereaderDevice?"Update Device":"Create Device"}},methods:{submitForm:function(){var e,t,r=this;if(this.$refs.ereaderNameInput.blur(),this.$refs.ereaderEmailInput.blur(),null!==(e=this.newDevice.name)&&void 0!==e&&e.trim()&&null!==(t=this.newDevice.email)&&void 0!==t&&t.trim())if(this.newDevice.name=this.newDevice.name.trim(),this.newDevice.email=this.newDevice.email.trim(),this.ereaderDevice){if(this.ereaderDevice.name!==this.newDevice.name&&this.existingDevices.some((function(e){return e.name===r.newDevice.name})))return void this.$toast.error(this.$strings.ToastDeviceNameAlreadyExists);this.submitUpdate()}else{if(this.existingDevices.some((function(e){return e.name===r.newDevice.name})))return void this.$toast.error(this.$strings.ToastDeviceNameAlreadyExists);this.submitCreate()}else this.$toast.error(this.$strings.ToastNameEmailRequired)},submitUpdate:function(){var e=this;this.processing=!0;var t=this.existingDevices.filter((function(t){return t.name!==e.ereaderDevice.name})),r={ereaderDevices:[].concat(Object(o.a)(t),[l({},this.newDevice)])};this.$axios.$post("/api/me/ereader-devices",r).then((function(data){e.$emit("update",data.ereaderDevices),e.show=!1})).catch((function(t){var r;console.error("Failed to update device",t),null!==(r=t.response)&&void 0!==r&&null!==(r=r.data)&&void 0!==r&&r.toLowerCase().includes("duplicate")?e.$toast.error(e.$strings.ToastDeviceNameAlreadyExists):e.$toast.error(e.$strings.ToastDeviceAddFailed)})).finally((function(){e.processing=!1}))},submitCreate:function(){var e=this;this.processing=!0;var t={ereaderDevices:[].concat(Object(o.a)(this.existingDevices),[l({},this.newDevice)])};this.$axios.$post("/api/me/ereader-devices",t).then((function(data){e.$emit("update",data.ereaderDevices||[]),e.show=!1})).catch((function(t){var r;console.error("Failed to add device",t),null!==(r=t.response)&&void 0!==r&&null!==(r=r.data)&&void 0!==r&&r.toLowerCase().includes("duplicate")?e.$toast.error(e.$strings.ToastDeviceNameAlreadyExists):e.$toast.error(e.$strings.ToastDeviceAddFailed)})).finally((function(){e.processing=!1}))},init:function(){this.ereaderDevice?(this.newDevice.name=this.ereaderDevice.name,this.newDevice.email=this.ereaderDevice.email,this.newDevice.availabilityOption=this.ereaderDevice.availabilityOption||"specificUsers",this.newDevice.users=this.ereaderDevice.users||[this.user.id]):(this.newDevice.name="",this.newDevice.email="",this.newDevice.availabilityOption="specificUsers",this.newDevice.users=[this.user.id])}},mounted:function(){}},v=r(4),component=Object(v.a)(d,(function(){var e=this,t=e._self._c;return t("modals-modal",{ref:"modal",attrs:{name:"ereader-device-edit",width:800,height:"unset",processing:e.processing},scopedSlots:e._u([{key:"outer",fn:function(){return[t("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[t("p",{staticClass:"text-3xl text-white truncate"},[e._v(e._s(e.title))])])]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"w-full text-sm rounded-lg bg-bg shadow-lg border border-black-300"},[t("div",{staticClass:"w-full px-3 py-5 md:p-12"},[t("div",{staticClass:"flex items-center -mx-1 mb-4"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"ereaderNameInput",attrs:{disabled:e.processing,label:e.$strings.LabelName},model:{value:e.newDevice.name,callback:function(t){e.$set(e.newDevice,"name",t)},expression:"newDevice.name"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"ereaderEmailInput",attrs:{disabled:e.processing,label:e.$strings.LabelEmail},model:{value:e.newDevice.email,callback:function(t){e.$set(e.newDevice,"email",t)},expression:"newDevice.email"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center pt-4"},[t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[e._v(e._s(e.$strings.ButtonSubmit))])],1)])])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:r(121).default,UiBtn:r(42).default,ModalsModal:r(39).default})}}]);