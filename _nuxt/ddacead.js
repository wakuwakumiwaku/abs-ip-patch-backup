(window.webpackJsonp=window.webpackJsonp||[]).push([[200,132,133],{1069:function(t,e,r){"use strict";r.r(e);r(22),r(43);var n=r(16),o=r(7);r(26),r(33),r(56),r(27),r(15),r(44),r(45),r(38),r(8),r(28),r(29);function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){Object(n.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var d={asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,o,l,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.store,n=t.params,o=t.app,l=t.redirect,c=t.route,r.state.user.user){e.next=3;break}return e.abrupt("return",l("/login?redirect=".concat(c.path)));case 3:return e.next=5,o.$axios.$get("/api/playlists/".concat(n.id)).catch((function(t){return console.error("Failed",t),!1}));case 5:if(d=e.sent){e.next=8;break}return e.abrupt("return",l("/"));case 8:if(d.libraryId===r.state.libraries.currentLibraryId){e.next=11;break}return e.next=11,r.dispatch("libraries/fetch",d.libraryId);case 11:return r.commit("libraries/addUpdateUserPlaylist",d),e.abrupt("return",{playlistId:d.id});case 13:case"end":return e.stop()}}),e)})))()},data:function(){return{processingRemove:!1}},computed:{streamLibraryItem:function(){return this.$store.state.streamLibraryItem},playlistItems:function(){return this.playlist.items||[]},playlistName:function(){return this.playlist.name||""},description:function(){return this.playlist.description||""},playlist:function(){return this.$store.getters["libraries/getPlaylist"](this.playlistId)||{}},playableItems:function(){return this.playlistItems.filter((function(t){var e=t.libraryItem;return!e.isMissing&&!e.isInvalid&&(t.episode?t.episode.audioFile:e.media.tracks.length)}))},streaming:function(){var t=this;return!!this.playableItems.find((function(i){return t.$store.getters.getIsMediaStreaming(i.libraryItemId,i.episodeId)}))},showPlayButton:function(){return this.playableItems.length},userCanUpdate:function(){return this.$store.getters["user/getUserCanUpdate"]},userCanDelete:function(){return this.$store.getters["user/getUserCanDelete"]}},methods:{editClick:function(){this.$store.commit("globals/setEditPlaylist",this.playlist)},removeClick:function(){var t=this,e={message:this.$getString("MessageConfirmRemovePlaylist",[this.playlistName]),callback:function(e){e&&t.removePlaylist()},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",e)},removePlaylist:function(){var t=this;this.processingRemove=!0,this.$axios.$delete("/api/playlists/".concat(this.playlist.id)).then((function(){t.$toast.success(t.$strings.ToastPlaylistRemoveSuccess)})).catch((function(e){console.error("Failed to remove playlist",e),t.$toast.error(t.$strings.ToastRemoveFailed)})).finally((function(){t.processingRemove=!1}))},clickPlay:function(){var t=this,e=[],r=this.playableItems.map((function(e){return c(c({},e),{},{progress:t.$store.getters["user/getUserMediaProgress"](e.libraryItemId,e.episodeId)})})),n=r.some((function(i){return!i.progress||!i.progress.isFinished}));n||console.warn("All items in playlist are finished - starting at first item");for(var i=0;i<r.length;i++){var o=r[i];if(!n||!o.progress||!o.progress.isFinished){var l=o.libraryItem;o.episode?e.push({libraryItemId:l.id,libraryId:l.libraryId,episodeId:o.episode.id,title:o.episode.title,subtitle:l.media.metadata.title,caption:"",duration:o.episode.duration||null,coverPath:l.media.coverPath||null}):e.push({libraryItemId:l.id,libraryId:l.libraryId,episodeId:null,title:l.media.metadata.title,subtitle:l.media.metadata.authors.map((function(t){return t.name})).join(", "),caption:"",duration:l.media.duration||null,coverPath:l.media.coverPath||null})}}e.length>=0&&this.$eventBus.$emit("play-item",{libraryItemId:e[0].libraryItemId,episodeId:e[0].episodeId,queueItems:e})}},mounted:function(){},beforeDestroy:function(){}},m=r(4),component=Object(m.a)(d,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg-bg page overflow-hidden",class:t.streamLibraryItem?"streaming":"",attrs:{id:"page-wrapper"}},[e("div",{staticClass:"w-full h-full overflow-y-auto px-2 py-6 md:p-8"},[e("div",{staticClass:"flex flex-col sm:flex-row max-w-6xl mx-auto"},[e("div",{staticClass:"w-full flex justify-center md:block sm:w-32 md:w-52",staticStyle:{"min-width":"200px"}},[e("div",{staticClass:"relative",staticStyle:{height:"fit-content"}},[e("covers-playlist-cover",{attrs:{items:t.playlistItems,width:200,height:200}})],1)]),t._v(" "),e("div",{staticClass:"grow px-2 py-6 md:py-0 md:px-10"},[e("div",{staticClass:"flex items-end flex-row flex-wrap md:flex-nowrap"},[e("h1",{staticClass:"text-2xl md:text-3xl font-sans w-full md:w-fit mb-4 md:mb-0"},[t._v("\n            "+t._s(t.playlistName)+"\n          ")]),t._v(" "),e("div",{staticClass:"grow"}),t._v(" "),t.showPlayButton?e("ui-btn",{staticClass:"flex items-center h-9 mr-2",attrs:{disabled:t.streaming,color:"bg-success","padding-x":4,small:""},on:{click:t.clickPlay}},[e("span",{directives:[{name:"show",rawName:"v-show",value:!t.streaming,expression:"!streaming"}],staticClass:"material-symbols fill text-2xl -ml-2 pr-1 text-white"},[t._v("play_arrow")]),t._v("\n            "+t._s(t.streaming?t.$strings.ButtonPlaying:t.$strings.ButtonPlayAll)+"\n          ")]):t._e(),t._v(" "),e("ui-icon-btn",{staticClass:"mx-0.5",attrs:{icon:"edit"},on:{click:t.editClick}}),t._v(" "),e("ui-icon-btn",{staticClass:"mx-0.5",attrs:{icon:"delete"},on:{click:t.removeClick}})],1),t._v(" "),e("div",{staticClass:"my-8 max-w-2xl"},[e("p",{staticClass:"text-base text-gray-100"},[t._v(t._s(t.description))])]),t._v(" "),e("tables-playlist-items-table",{attrs:{items:t.playlistItems,"playlist-id":t.playlistId}})],1)])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.processingRemove,expression:"processingRemove"}],staticClass:"absolute top-0 left-0 w-full h-full z-10 bg-black/40 flex items-center justify-center"},[e("ui-loading-indicator")],1)])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{CoversPlaylistCover:r(243).default,UiBtn:r(42).default,UiIconBtn:r(148).default,TablesPlaylistItemsTable:r(870).default,UiLoadingIndicator:r(348).default})},721:function(t,e,r){var content=r(776);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(19).default)("5cb622e1",content,!0,{sourceMap:!1})},751:function(t,e,r){"use strict";r.r(e);r(15),r(17),r(56),r(27),r(14),r(8);var n={props:{playlistId:String,item:{type:Object,default:function(){}},isDragging:Boolean,bookCoverAspectRatio:Number},data:function(){return{isProcessingReadUpdate:!1,processingRemove:!1,isHovering:!1}},watch:{isDragging:{handler:function(t){t&&(this.isHovering=!1)}}},computed:{translateDistance:function(){return this.userCanUpdate?"-translate-x-24":"-translate-x-12"},libraryItem:function(){return this.item.libraryItem||{}},episode:function(){return this.item.episode},episodeId:function(){return this.episode?this.episode.id:null},media:function(){return this.libraryItem.media||{}},mediaMetadata:function(){return this.media.metadata||{}},tracks:function(){return this.episode?[]:this.media.tracks||[]},itemTitle:function(){return this.episode?this.episode.title:this.mediaMetadata.title||""},bookAuthors:function(){return this.episode?[]:this.mediaMetadata.authors||[]},itemDuration:function(){return this.episode?this.$elapsedPretty(this.episode.duration):this.$elapsedPretty(this.media.duration)},isMissing:function(){return this.libraryItem.isMissing},isInvalid:function(){return this.libraryItem.isInvalid},isStreaming:function(){return this.$store.getters.getIsMediaStreaming(this.libraryItem.id,this.episodeId)},showPlayBtn:function(){return!this.isMissing&&!this.isInvalid&&!this.isStreaming&&(this.tracks.length||this.episode)},itemProgress:function(){return this.$store.getters["user/getUserMediaProgress"](this.libraryItem.id,this.episodeId)},userIsFinished:function(){return!!this.itemProgress&&!!this.itemProgress.isFinished},coverSize:function(){return this.$store.state.globals.isMobile?30:50},coverWidth:function(){return 1===this.bookCoverAspectRatio?1.6*this.coverSize:this.coverSize},userCanUpdate:function(){return this.$store.getters["user/getUserCanUpdate"]},userCanDelete:function(){return this.$store.getters["user/getUserCanDelete"]}},methods:{mouseover:function(){this.isDragging||(this.isHovering=!0)},mouseleave:function(){this.isHovering=!1},playClick:function(){var t=null;t=this.episode?{libraryItemId:this.libraryItem.id,libraryId:this.libraryItem.libraryId,episodeId:this.episodeId,title:this.itemTitle,subtitle:this.mediaMetadata.title,caption:"",duration:this.media.duration||null,coverPath:this.media.coverPath||null}:{libraryItemId:this.libraryItem.id,libraryId:this.libraryItem.libraryId,episodeId:null,title:this.itemTitle,subtitle:this.bookAuthors.map((function(t){return t.name})).join(", "),caption:"",duration:this.media.duration||null,coverPath:this.media.coverPath||null},this.$eventBus.$emit("play-item",{libraryItemId:this.libraryItem.id,episodeId:this.episodeId,queueItems:[t]})},clickEdit:function(){this.$emit("edit",this.item)},toggleFinished:function(){var t=this,e={isFinished:!this.userIsFinished};this.isProcessingReadUpdate=!0;var r="/api/me/progress/".concat(this.libraryItem.id);this.episodeId&&(r+="/".concat(this.episodeId)),this.$axios.$patch(r,e).then((function(){t.isProcessingReadUpdate=!1})).catch((function(r){console.error("Failed",r),t.isProcessingReadUpdate=!1,t.$toast.error(e.isFinished?t.$strings.ToastItemMarkedAsFinishedFailed:t.$strings.ToastItemMarkedAsNotFinishedFailed)}))},removeClick:function(){var t=this;this.processingRemove=!0;var e="/api/playlists/".concat(this.playlistId,"/item/").concat(this.libraryItem.id);this.episodeId&&(e+="/".concat(this.episodeId)),this.$axios.$delete(e).then((function(e){e.items.length?console.log("Item removed from playlist",e):(console.log("All items removed so playlist was removed",e),t.$toast.success(t.$strings.ToastPlaylistRemoveSuccess))})).catch((function(e){console.error("Failed to remove item from playlist",e),t.$toast.error(t.$strings.ToastFailedToUpdate)})).finally((function(){t.processingRemove=!1}))}},mounted:function(){}},o=r(4),component=Object(o.a)(n,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"w-full px-1 md:px-2 py-2 overflow-hidden relative",class:t.isHovering?"bg-white/5":"",on:{mouseover:t.mouseover,mouseleave:t.mouseleave}},[t.item?e("div",{staticClass:"flex h-16 md:h-20"},[t._m(0),t._v(" "),e("div",{staticClass:"h-full relative flex items-center",style:{width:t.coverWidth+"px",minWidth:t.coverWidth+"px",maxWidth:t.coverWidth+"px"}},[e("covers-book-cover",{attrs:{"library-item":t.libraryItem,width:t.coverWidth,"book-cover-aspect-ratio":t.bookCoverAspectRatio}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isHovering&&t.showPlayBtn,expression:"isHovering && showPlayBtn"}],staticClass:"absolute top-0 left-0 bg-black/50 flex items-center justify-center h-full w-full z-10"},[e("div",{staticClass:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/40 cursor-pointer",on:{click:t.playClick}},[e("span",{staticClass:"material-symbols fill text-2xl"},[t._v("play_arrow")])])])],1),t._v(" "),e("div",{staticClass:"grow overflow-hidden max-w-48 md:max-w-md h-full flex items-center px-2 md:px-3"},[e("div",[e("div",{staticClass:"truncate max-w-48 md:max-w-md"},[e("nuxt-link",{staticClass:"truncate hover:underline text-sm md:text-base",attrs:{to:"/item/".concat(t.libraryItem.id)}},[t._v(t._s(t.itemTitle))])],1),t._v(" "),e("div",{staticClass:"truncate max-w-48 md:max-w-md text-xs md:text-sm text-gray-300"},[t._l(t.bookAuthors,(function(r,n){return[e("nuxt-link",{key:r.id,staticClass:"truncate hover:underline",attrs:{to:"/author/".concat(r.id)}},[t._v(t._s(r.name))]),n<t.bookAuthors.length-1?e("span",{key:r.id+"-comma"},[t._v(",Â ")]):t._e()]})),t._v(" "),t.episode?e("nuxt-link",{staticClass:"truncate hover:underline",attrs:{to:"/item/".concat(t.libraryItem.id)}},[t._v(t._s(t.mediaMetadata.title))]):t._e()],2),t._v(" "),e("p",{staticClass:"text-xs md:text-sm text-gray-400"},[t._v(t._s(t.itemDuration))])])])]):t._e(),t._v(" "),e("div",{staticClass:"w-40 absolute top-0 -right-24 h-full transform transition-transform",class:t.isHovering?t.translateDistance:"translate-x-0"},[e("div",{staticClass:"flex h-full items-center"},[e("ui-tooltip",{attrs:{text:t.userIsFinished?t.$strings.MessageMarkAsNotFinished:t.$strings.MessageMarkAsFinished,direction:"top"}},[e("ui-read-icon-btn",{staticClass:"mx-1 mt-0.5",attrs:{disabled:t.isProcessingReadUpdate,"is-read":t.userIsFinished,borderless:""},on:{click:t.toggleFinished}})],1),t._v(" "),t.userCanUpdate?e("div",{staticClass:"mx-1",class:t.isHovering?"":"ml-6"},[e("ui-icon-btn",{attrs:{icon:"edit",borderless:""},on:{click:t.clickEdit}})],1):t._e(),t._v(" "),e("div",{staticClass:"mx-1",class:t.isHovering?"":"ml-6"},[e("ui-icon-btn",{attrs:{icon:"close",borderless:""},on:{click:t.removeClick}})],1)],1)])])}),[function(){var t=this._self._c;return t("div",{staticClass:"w-10 min-w-10 md:w-16 md:max-w-16 h-full"},[t("div",{staticClass:"flex h-full items-center justify-center"},[t("span",{staticClass:"material-symbols drag-handle text-lg md:text-xl"},[this._v("menu")])])])}],!1,null,null,null);e.default=component.exports;installComponents(component,{CoversBookCover:r(107).default,UiReadIconBtn:r(353).default,UiTooltip:r(76).default,UiIconBtn:r(148).default})},775:function(t,e,r){"use strict";r(721)},776:function(t,e,r){var n=r(18)((function(i){return i[1]}));n.push([t.i,"\n.playlist-item-item {\n  transition: all 0.4s ease;\n}\n.playlist-item-enter-from,\n.playlist-item-leave-to {\n  opacity: 0;\n  transform: translateX(30px);\n}\n.playlist-item-leave-active {\n  position: absolute;\n}\n",""]),n.locals={},t.exports=n},870:function(t,e,r){"use strict";r.r(e);var n=r(16),o=(r(22),r(26),r(27),r(8),r(44),r(45),r(38),r(28),r(690));function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var c={components:{draggable:r.n(o).a},props:{playlistId:String,items:{type:Array,default:function(){return[]}}},data:function(){return{drag:!1,dragOptions:{animation:200,group:"description",ghostClass:"ghost"},itemsCopy:[]}},watch:{items:{handler:function(t){this.init()}}},computed:{bookCoverAspectRatio:function(){return this.$store.getters["libraries/getBookCoverAspectRatio"]},totalDuration:function(){var t=0;return this.items.forEach((function(e){e.episode?t+=e.episode.duration:t+=e.libraryItem.media.duration})),t},totalDurationPretty:function(){return this.$elapsedPrettyExtended(this.totalDuration)}},methods:{editItem:function(t){if(t.episode){var e=this.items.map((function(t){return t.episodeId}));this.$store.commit("setEpisodeTableEpisodeIds",e),this.$store.commit("setSelectedLibraryItem",t.libraryItem),this.$store.commit("globals/setSelectedEpisode",t.episode),this.$store.commit("globals/setShowEditPodcastEpisodeModal",!0)}else{var r=this.items.map((function(i){return i.libraryItemId}));this.$store.commit("setBookshelfBookIds",r),this.$store.commit("showEditModal",t.libraryItem)}},draggableUpdate:function(){var t=this,e={items:this.itemsCopy.map((function(i){return{libraryItemId:i.libraryItemId,episodeId:i.episodeId}}))};this.$axios.$patch("/api/playlists/".concat(this.playlistId),e).then((function(t){console.log("Playlist updated",t)})).catch((function(e){console.error("Failed to update playlist",e),t.$toast.error(t.$strings.ToastFailedToUpdate)}))},init:function(){this.itemsCopy=this.items.map((function(i){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){Object(n.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},i)}))}},mounted:function(){this.init()}},d=c,m=(r(775),r(4)),component=Object(m.a)(d,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"w-full bg-primary/40"},[e("div",{staticClass:"w-full h-14 flex items-center px-4 md:px-6 py-2 bg-primary"},[e("p",{staticClass:"pr-4"},[t._v(t._s(t.$strings.HeaderPlaylistItems))]),t._v(" "),e("div",{staticClass:"w-6 h-6 md:w-7 md:h-7 bg-white/10 rounded-full flex items-center justify-center"},[e("span",{staticClass:"text-xs md:text-sm font-mono leading-none"},[t._v(t._s(t.items.length))])]),t._v(" "),e("div",{staticClass:"grow"}),t._v(" "),t.totalDuration?e("p",{staticClass:"text-sm text-gray-200"},[t._v(t._s(t.totalDurationPretty))]):t._e()]),t._v(" "),e("draggable",t._b({staticClass:"list-group",attrs:{handle:".drag-handle",draggable:".item",tag:"div"},on:{start:function(e){t.drag=!0},end:function(e){t.drag=!1},update:t.draggableUpdate},model:{value:t.itemsCopy,callback:function(e){t.itemsCopy=e},expression:"itemsCopy"}},"draggable",t.dragOptions,!1),[e("transition-group",{attrs:{type:"transition",name:t.drag?null:"playlist-item"}},[t._l(t.itemsCopy,(function(r,n){return[e("tables-playlist-item-table-row",{key:n,staticClass:"item",class:t.drag?"":"playlist-item-item",attrs:{"is-dragging":t.drag,item:r,"playlist-id":t.playlistId,"book-cover-aspect-ratio":t.bookCoverAspectRatio},on:{edit:t.editItem}})]}))],2)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{TablesPlaylistItemTableRow:r(751).default})}}]);