(window.webpackJsonp=window.webpackJsonp||[]).push([[10,57,60,64,65,66,152],{642:function(t,e,o){"use strict";o.d(e,"a",(function(){return c}));var r=o(183);var n=o(237),l=o(149);function c(t){return function(t){if(Array.isArray(t))return Object(r.a)(t)}(t)||Object(n.a)(t)||Object(l.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},748:function(t,e,o){"use strict";o.r(e);o(85);var r={data:function(){return{selectedSizeIndex:3,availableSizes:[60,80,100,120,140,160,180,200,220]}},watch:{selectedSize:{immediate:!0,handler:function(){this.setSelectedIndex()}}},computed:{selectedSize:function(){return this.$store.getters["user/getUserSetting"]("bookshelfCoverSize")},bookCoverWidth:function(){return this.availableSizes[this.selectedSizeIndex]}},methods:{increaseSize:function(){this.selectedSizeIndex=Math.min(this.availableSizes.length-1,this.selectedSizeIndex+1),this.$store.dispatch("user/updateUserSettings",{bookshelfCoverSize:this.bookCoverWidth})},decreaseSize:function(){this.selectedSizeIndex=Math.max(0,this.selectedSizeIndex-1),this.$store.dispatch("user/updateUserSettings",{bookshelfCoverSize:this.bookCoverWidth})},setSelectedIndex:function(){var t=this,e=this.availableSizes.findIndex((function(s){return s===t.selectedSize}));isNaN(e)||(this.selectedSizeIndex=e)}},mounted:function(){}},n=o(4),component=Object(n.a)(r,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"rounded-full py-1 bg-primary px-2 border border-black-100 text-center flex items-center box-shadow-md",attrs:{"aria-hidden":"true"},on:{mousedown:function(t){t.preventDefault()},mouseup:function(t){t.preventDefault()}}},[e("span",{staticClass:"material-symbols",class:0===t.selectedSizeIndex?"text-gray-400":"hover:text-yellow-300 cursor-pointer",staticStyle:{"font-size":"0.9rem"},attrs:{"aria-label":"Decrease Cover Size",role:"button"},on:{mousedown:function(t){t.preventDefault()},click:t.decreaseSize}},[t._v("")]),t._v(" "),e("p",{staticClass:"px-2 font-mono",staticStyle:{"font-size":"1rem"}},[t._v(t._s(t.bookCoverWidth))]),t._v(" "),e("span",{staticClass:"material-symbols",class:t.selectedSizeIndex===t.availableSizes.length-1?"text-gray-400":"hover:text-yellow-300 cursor-pointer",staticStyle:{"font-size":"0.9rem"},attrs:{"aria-label":"Increase Cover Size",role:"button"},on:{mousedown:function(t){t.preventDefault()},click:t.increaseSize}},[t._v("")])])])}),[],!1,null,null,null);e.default=component.exports},749:function(t,e,o){"use strict";o.r(e);var r=o(642),n=(o(17),o(26),o(27),o(15),o(14),o(8),o(28),{props:{index:Number,width:Number,height:{type:Number,default:192},bookshelfView:{type:Number,default:0},seriesMount:{type:Object,default:function(){return null}},sortingIgnorePrefix:Boolean,orderBy:String},data:function(){return{series:null,isSelectionMode:!1,selected:!1,isHovering:!1,imageReady:!1}},computed:{bookCoverAspectRatio:function(){return this.store.getters["libraries/getBookCoverAspectRatio"]},cardWidth:function(){return this.width||this.coverHeight/this.bookCoverAspectRatio*2},coverHeight:function(){return this.height*this.sizeMultiplier},dateFormat:function(){return this.store.getters.getServerSetting("dateFormat")},labelFontSize:function(){return this.width<160?.75:.9},sizeMultiplier:function(){return this.store.getters["user/getSizeMultiplier"]},seriesId:function(){var t;return(null===(t=this.series)||void 0===t?void 0:t.id)||""},title:function(){var t;return(null===(t=this.series)||void 0===t?void 0:t.name)||""},nameIgnorePrefix:function(){var t;return(null===(t=this.series)||void 0===t?void 0:t.nameIgnorePrefix)||""},displayTitle:function(){return this.sortingIgnorePrefix?this.nameIgnorePrefix||this.title||" ":this.title||" "},displaySortLine:function(){switch(this.orderBy){case"addedAt":return this.$getString("LabelAddedDate",[this.$formatDate(this.addedAt,this.dateFormat)]);case"totalDuration":return"".concat(this.$strings.LabelDuration," ").concat(this.$elapsedPrettyExtended(this.totalDuration,!1));case"lastBookUpdated":var t=Math.max.apply(Math,Object(r.a)(this.books.map((function(t){return t.updatedAt}))).concat([0]));return"".concat(this.$strings.LabelLastBookUpdated," ").concat(this.$formatDate(t,this.dateFormat));case"lastBookAdded":var e=Math.max.apply(Math,Object(r.a)(this.books.map((function(t){return t.addedAt}))).concat([0]));return"".concat(this.$strings.LabelLastBookAdded," ").concat(this.$formatDate(e,this.dateFormat));default:return null}},books:function(){var t;return(null===(t=this.series)||void 0===t?void 0:t.books)||[]},addedAt:function(){var t;return(null===(t=this.series)||void 0===t?void 0:t.addedAt)||0},totalDuration:function(){var t;return(null===(t=this.series)||void 0===t?void 0:t.totalDuration)||0},seriesBookProgress:function(){var t=this;return this.books.map((function(e){return t.store.getters["user/getUserMediaProgress"](e.id)})).filter((function(p){return!!p}))},seriesBooksFinished:function(){return this.seriesBookProgress.filter((function(p){return p.isFinished}))},hasSeriesBookInProgress:function(){return this.seriesBookProgress.some((function(p){return!p.isFinished&&p.progress>0}))},seriesPercentInProgress:function(){if(!this.books.length)return 0;var t=0;return this.seriesBookProgress.forEach((function(progress){t+=progress.isFinished?1:progress.progress||0})),t/=this.books.length,Math.min(1,Math.max(0,t))},isSeriesFinished:function(){return this.books.length===this.seriesBooksFinished.length},store:function(){return this.$store||this.$nuxt.$store},currentLibraryId:function(){return this.store.state.libraries.currentLibraryId},seriesBooksRoute:function(){return"/library/".concat(this.currentLibraryId,"/series/").concat(this.seriesId)},hasValidCovers:function(){return!!this.books.map((function(t){return t.media.coverPath})).length},isAlternativeBookshelfView:function(){var t=this.$constants||this.$nuxt.$constants;return this.bookshelfView==t.BookshelfView.DETAIL},rssFeed:function(){var t;return null===(t=this.series)||void 0===t?void 0:t.rssFeed}},methods:{setEntity:function(t){this.series=t},setSelectionMode:function(t){this.isSelectionMode=t},mouseover:function(){this.isHovering=!0},mouseleave:function(){this.isHovering=!1},clickCard:function(){this.series&&(this.$router||this.$nuxt.$router).push("/library/".concat(this.currentLibraryId,"/series/").concat(this.seriesId))},imageLoaded:function(){this.imageReady=!0},destroy:function(){this.$destroy(),this.$el&&this.$el.parentNode?this.$el.parentNode.removeChild(this.$el):this.$el&&this.$el.remove&&this.$el.remove()}},mounted:function(){this.seriesMount&&this.setEntity(this.seriesMount)},beforeDestroy:function(){}}),l=o(4),component=Object(l.a)(n,(function(){var t=this,e=t._self._c;return e("div",{ref:"card",staticClass:"absolute rounded-xs z-30 cursor-pointer",style:{width:t.cardWidth+"px"},attrs:{"cy-id":"card",id:"series-card-".concat(t.index),tabindex:"0"},on:{mousedown:function(t){t.preventDefault()},mouseup:function(t){t.preventDefault()},mousemove:function(t){t.preventDefault()},mouseover:t.mouseover,mouseleave:t.mouseleave,click:t.clickCard}},[e("div",{staticClass:"relative",style:{height:t.coverHeight+"px"},attrs:{"cy-id":"covers-area"}},[e("div",{staticClass:"absolute top-0 left-0 w-full box-shadow-book shadow-height"}),t._v(" "),e("div",{staticClass:"w-full h-full bg-primary relative rounded-sm overflow-hidden z-0"},[t.series?e("covers-group-cover",{ref:"cover",attrs:{id:t.seriesId,name:t.displayTitle,"book-items":t.books,width:t.cardWidth,height:t.coverHeight,"book-cover-aspect-ratio":t.bookCoverAspectRatio}}):t._e()],1),t._v(" "),e("div",{staticClass:"absolute rounded-lg bg-black/90 box-shadow-md z-20",staticStyle:{"background-color":"#cd9d49dd"},style:{top:"0.375em",right:"0.375em",padding:"0.1em 0.25em"},attrs:{"cy-id":"seriesLengthMarker"}},[e("p",{style:{fontSize:"0.8em"},attrs:{role:"status","aria-label":t.$strings.LabelNumberOfBooks}},[t._v(t._s(t.books.length))])]),t._v(" "),t.seriesPercentInProgress>0?e("div",{staticClass:"absolute bottom-0 left-0 h-1e shadow-xs max-w-full z-10 rounded-b w-full box-shadow-progressbar",class:t.isSeriesFinished?"bg-success":"bg-yellow-400",style:{width:100*t.seriesPercentInProgress+"%"},attrs:{"cy-id":"seriesProgressBar"}}):t._e(),t._v(" "),t.hasValidCovers?e("div",{staticClass:"bg-black/60 absolute top-0 left-0 w-full h-full flex items-center justify-center text-center transition-opacity",class:t.isHovering?"":"opacity-0",style:{padding:"1em"},attrs:{"cy-id":"hoveringDisplayTitle","aria-hidden":"true"}},[e("p",{style:{fontSize:"1.2em"}},[t._v(t._s(t.displayTitle))])]):t._e(),t._v(" "),!t.isHovering&&t.rssFeed?e("span",{staticClass:"absolute z-10 material-symbols text-success",style:{top:"0.5em",left:"0.5em",fontSize:"1.5em"},attrs:{"cy-id":"rssFeedMarker"}},[t._v("rss_feed")]):t._e()]),t._v(" "),t.isAlternativeBookshelfView?e("div",{staticClass:"relative z-30 left-0 right-0 mx-auto py-1e rounded-md text-center",attrs:{"cy-id":"detailBottomText"}},[e("p",{staticClass:"truncate",style:{fontSize:t.labelFontSize+"em"},attrs:{"cy-id":"detailBottomDisplayTitle"}},[t._v(t._s(t.displayTitle))]),t._v(" "),t.displaySortLine?e("p",{staticClass:"truncate text-gray-400",style:{fontSize:"0.8em"},attrs:{"cy-id":"detailBottomSortLine"}},[t._v(t._s(t.displaySortLine))]):t._e()]):e("div",{staticClass:"categoryPlacard absolute z-10 left-0 right-0 mx-auto -bottom-6e h-6e rounded-md text-center",style:{width:Math.min(200,t.cardWidth)+"px"},attrs:{"cy-id":"standardBottomText"}},[e("div",{staticClass:"w-full h-full shinyBlack flex items-center justify-center rounded-xs border",style:{padding:"0em 0.5em"}},[e("p",{staticClass:"truncate",style:{fontSize:t.labelFontSize+"em"},attrs:{"cy-id":"standardBottomDisplayTitle"}},[t._v(t._s(t.displayTitle))])])])])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{CoversGroupCover:o(359).default})},750:function(t,e,o){"use strict";o.r(e);o(15);var r=o(7),n=(o(29),o(14),o(77),{props:{authorMount:{type:Object,default:function(){}},width:Number,height:{type:Number,default:192},nameBelow:{type:Boolean,default:!1}},data:function(){return{searching:!1,isHovering:!1,author:null}},computed:{cardWidth:function(){return this.width||.8*this.cardHeight},cardHeight:function(){return this.height*this.sizeMultiplier},coverHeight:function(){return this.cardHeight},_author:function(){return this.author||{}},authorId:function(){var t;return(null===(t=this._author)||void 0===t?void 0:t.id)||""},name:function(){var t;return(null===(t=this._author)||void 0===t?void 0:t.name)||""},asin:function(){var t;return(null===(t=this._author)||void 0===t?void 0:t.asin)||""},numBooks:function(){var t;return(null===(t=this._author)||void 0===t?void 0:t.numBooks)||0},store:function(){return this.$store||this.$nuxt.$store},userCanUpdate:function(){return this.store.getters["user/getUserCanUpdate"]},currentLibraryId:function(){return this.store.state.libraries.currentLibraryId},libraryProvider:function(){return this.store.getters["libraries/getLibraryProvider"](this.currentLibraryId)||"google"},sizeMultiplier:function(){return this.store.getters["user/getSizeMultiplier"]}},methods:{mouseover:function(){this.isHovering=!0},mouseleave:function(){this.isHovering=!1},searchAuthor:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.searching=!0,o={},t.asin?o.asin=t.asin:o.q=t.name,o.region="us",t.libraryProvider.startsWith("audible.")&&(o.region=t.libraryProvider.split(".").pop()||"us"),e.next=7,t.$axios.$post("/api/authors/".concat(t.authorId,"/match"),o).catch((function(t){return console.error("Failed",t),null}));case 7:(r=e.sent)?r.updated?r.author.imagePath?t.$toast.success(t.$strings.ToastAuthorUpdateSuccess):t.$toast.success(t.$strings.ToastAuthorUpdateSuccessNoImageFound):t.$toast.info(t.$strings.ToastNoUpdatesNecessary):t.$toast.error(t.$getString("ToastAuthorNotFound",[t.name])),t.searching=!1;case 10:case"end":return e.stop()}}),e)})))()},setSearching:function(t){this.searching=t},setEntity:function(t){this.removeListeners(),this.author=t,this.addListeners()},addListeners:function(){this.author&&this.$eventBus.$on("searching-author-".concat(this.authorId),this.setSearching)},removeListeners:function(){this.author&&this.$eventBus.$off("searching-author-".concat(this.authorId),this.setSearching)},destroy:function(){this.$destroy(),this.$el&&this.$el.parentNode?this.$el.parentNode.removeChild(this.$el):this.$el&&this.$el.remove&&this.$el.remove()},setSelectionMode:function(t){}},mounted:function(){this.authorMount&&this.setEntity(this.authorMount)},beforeDestroy:function(){this.removeListeners()}}),l=o(4),component=Object(l.a)(n,(function(){var t,e=this,o=e._self._c;return o("div",{staticClass:"pb-3e",style:{minWidth:e.cardWidth+"px",maxWidth:e.cardWidth+"px"}},[o("nuxt-link",{attrs:{to:"/author/".concat(null===(t=e.author)||void 0===t?void 0:t.id)}},[o("div",{attrs:{"cy-id":"card"},on:{mouseover:e.mouseover,mouseleave:e.mouseleave}},[o("div",{staticClass:"bg-primary box-shadow-book rounded-md relative overflow-hidden",style:{height:e.cardHeight+"px"},attrs:{"cy-id":"imageArea"}},[o("covers-author-image",{attrs:{author:e.author}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.searching&&!e.nameBelow,expression:"!searching && !nameBelow"}],staticClass:"absolute bottom-0 left-0 w-full py-1e bg-black/60 px-2e",attrs:{"cy-id":"textInline"}},[o("p",{staticClass:"text-center font-semibold truncate",style:{fontSize:"0.75em"}},[e._v(e._s(e.name))]),e._v(" "),o("p",{staticClass:"text-center text-gray-200",style:{fontSize:"0.65em"}},[e._v(e._s(e.numBooks)+" "+e._s(e.$strings.LabelBooks))])]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.searching&&e.isHovering&&e.userCanUpdate,expression:"!searching && isHovering && userCanUpdate"}],staticClass:"absolute top-0 left-0 p-2e cursor-pointer hover:text-white text-gray-200 transform hover:scale-125 duration-150",attrs:{"cy-id":"match"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.searchAuthor.apply(null,arguments)}}},[o("ui-tooltip",{attrs:{text:e.$strings.ButtonQuickMatch,direction:"bottom"}},[o("span",{staticClass:"material-symbols",style:{fontSize:"1.125em"}},[e._v("search")])])],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.isHovering&&!e.searching&&e.userCanUpdate,expression:"isHovering && !searching && userCanUpdate"}],staticClass:"absolute top-0 right-0 p-2e cursor-pointer hover:text-white text-gray-200 transform hover:scale-125 duration-150",attrs:{"cy-id":"edit"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.$emit("edit",e.author)}}},[o("ui-tooltip",{attrs:{text:e.$strings.LabelEdit,direction:"bottom"}},[o("span",{staticClass:"material-symbols",style:{fontSize:"1.125em"}},[e._v("edit")])])],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.searching,expression:"searching"}],staticClass:"absolute top-0 left-0 z-10 w-full h-full bg-black/50 flex items-center justify-center",attrs:{"cy-id":"spinner"}},[o("widgets-loading-spinner",{attrs:{size:""}})],1)],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.nameBelow,expression:"nameBelow"}],staticClass:"w-full py-1e px-2e",attrs:{"cy-id":"nameBelow"}},[o("p",{staticClass:"text-center font-semibold truncate text-gray-200",style:{fontSize:"0.75em"}},[e._v(e._s(e.name))])])])])],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{CoversAuthorImage:o(241).default,UiTooltip:o(76).default,WidgetsLoadingSpinner:o(151).default})},807:function(t,e,o){var content=o(923);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(19).default)("a5c8061a",content,!0,{sourceMap:!1})},831:function(t,e,o){"use strict";o.r(e);var r=o(16),n=o(7),l=(o(29),o(22),o(17),o(26),o(85),o(41),o(27),o(57),o(14),o(44),o(45),o(38),o(8),o(35),o(59),o(52),o(62),o(122),o(77),o(28),o(58),o(40),o(350),o(43),o(84),o(83),o(15),o(5)),c=o(866),h=o(749),d=o(878),f=o(879),m=o(750);function v(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,a){if(t){if("string"==typeof t)return y(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?y(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==o.return||o.return()}finally{if(u)throw l}}}}function y(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,o=Array(a);e<a;e++)o[e]=t[e];return o}function k(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}function S(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?k(Object(o),!0).forEach((function(e){Object(r.a)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):k(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var w={props:{page:String,seriesId:String},mixins:[{data:function(){return{cardsHelpers:{mountEntityCard:this.mountEntityCard,setCardSize:this.setCardSize}}},methods:{getComponentClass:function(){return"series"===this.entityName?l.a.extend(h.default):"collections"===this.entityName?l.a.extend(d.default):"playlists"===this.entityName?l.a.extend(f.default):"authors"===this.entityName?l.a.extend(m.default):l.a.extend(c.default)},getComponentName:function(){return"series"===this.entityName?"cards-lazy-series-card":"collections"===this.entityName?"cards-lazy-collection-card":"playlists"===this.entityName?"cards-lazy-playlist-card":"authors"===this.entityName?"cards-author-card":"cards-lazy-book-card"},setCardSize:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.cardWidth=0,t.cardHeight=0,o=t.getComponentClass(),r={index:-1,bookshelfView:t.bookshelfView,sortingIgnorePrefix:!!t.sortingIgnorePrefix},"items"===t.entityName?(r.filterBy=t.filterBy,r.orderBy=t.orderBy):"series"===t.entityName&&(r.orderBy=t.seriesSortBy),(n=new o({propsData:r,parent:t})).$mount(),t.resizeObserver=new ResizeObserver((function(e){var o,r=v(e);try{for(r.s();!(o=r.n()).done;){var l=o.value;t.cardWidth=l.borderBoxSize[0].inlineSize,t.cardHeight=l.borderBoxSize[0].blockSize}}catch(t){r.e(t)}finally{r.f()}t.coverHeight=n.coverHeight,t.resizeObserver.disconnect(),t.$refs.bookshelf.removeChild(n.$el)})),n.$el.style.visibility="hidden",n.$el.style.position="absolute",t.$refs.bookshelf.appendChild(n.$el),t.resizeObserver.observe(n.$el),performance.now(),e.next=15,new Promise((function(e){var o=t.$watch("cardWidth",(function(t){t&&(o(),e())}))}));case 15:performance.now();case 16:case"end":return e.stop()}}),e)})))()},mountEntityCard:function(t){var e=Math.floor(t/this.entitiesPerShelf),o=document.getElementById("shelf-".concat(e));if(o){if(this.entityIndexesMounted.push(t),this.entityComponentRefs[t]){var r=this.entityComponentRefs[t];return o.appendChild(r.$el),this.isSelectionMode?(r.setSelectionMode(!0),this.selectedMediaItems.some((function(i){return i.id===r.libraryItemId}))||this.isSelectAll?r.selected=!0:r.selected=!1):r.setSelectionMode(!1),void(r.isHovering=!1)}var n=this.getComponentClass(),l={index:t,bookshelfView:this.bookshelfView,sortingIgnorePrefix:!!this.sortingIgnorePrefix};"items"===this.entityName?(l.filterBy=this.filterBy,l.orderBy=this.orderBy):"series"===this.entityName&&(l.orderBy=this.seriesSortBy);var c=this,h=new n({propsData:l,parent:this,created:function(){this.$on("edit",(function(t,e){c.editEntity&&c.editEntity(t,e)})),this.$on("select",(function(t){var e=t.entity,o=t.shiftKey;c.selectEntity&&c.selectEntity(e,o)}))}});this.entityComponentRefs[t]=h,h.$mount(),h.$el.style.transform=this.entityTransform(t%this.entitiesPerShelf+1),h.$el.classList.add("absolute","top-0","left-0","z-10"),o.appendChild(h.$el),this.entities[t]&&h.setEntity(this.entities[t]),this.isSelectionMode&&(h.setSelectionMode(!0),(h.libraryItemId&&this.selectedMediaItems.some((function(i){return i.id===h.libraryItemId}))||this.isSelectAll)&&(h.selected=!0))}else console.error("invalid shelf",e,"book index",t)}}}],data:function(){return{routeFullPath:null,initialized:!1,bookshelfHeight:0,bookshelfWidth:0,shelvesPerPage:0,entitiesPerShelf:8,currentPage:0,totalEntities:0,entities:[],pagesLoaded:{},entityIndexesMounted:[],entityComponentRefs:{},currentBookWidth:0,isFetchingEntities:!1,scrollTimeout:null,booksPerFetch:0,totalShelves:0,bookshelfMarginLeft:0,isSelectionMode:!1,currentSFQueryString:null,pendingReset:!1,keywordFilter:null,currScrollTop:0,resizeTimeout:null,mountWindowWidth:0,lastItemIndexSelected:-1,tempIsScanning:!1,cardWidth:0,cardHeight:0,coverHeight:0,resizeObserver:null,lastScrollTop:0,lastTimestamp:0,postScrollTimeout:null,currFirstEntityIndex:-1,currLastEntityIndex:-1}},watch:{"$route.query.filter":function(){this.$route.query.filter&&this.$route.query.filter!==this.filterBy?this.$store.dispatch("user/updateUserSettings",{filterBy:this.$route.query.filter}):!this.$route.query.filter&&this.filterBy&&this.$store.dispatch("user/updateUserSettings",{filterBy:"all"})}},computed:{userIsAdminOrUp:function(){return this.$store.getters["user/getIsAdminOrUp"]},libraryMediaType:function(){return this.$store.getters["libraries/getCurrentLibraryMediaType"]},isPodcast:function(){return"podcast"===this.libraryMediaType},emptyMessage:function(){return"series"===this.page?this.$strings.MessageBookshelfNoSeries:"collections"===this.page?this.$strings.MessageBookshelfNoCollections:"playlists"===this.page?this.$strings.MessageNoUserPlaylists:"authors"===this.page?this.$strings.MessageNoAuthors:this.hasFilter?"Issues"===this.filterName?this.$strings.MessageNoIssues:"Feed-open"===this.filterName?this.$strings.MessageBookshelfNoRSSFeeds:this.$getString("MessageBookshelfNoResultsForFilter",[this.filterName,this.filterValue]):this.$strings.MessageNoResults},emptyMessageHelp:function(){return"collections"===this.page?this.$strings.MessageBookshelfNoCollectionsHelp:"playlists"===this.page?this.$strings.MessageNoUserPlaylistsHelp:""},entityName:function(){return this.page?this.page:"items"},seriesSortBy:function(){return this.$store.getters["user/getUserSetting"]("seriesSortBy")},seriesSortDesc:function(){return this.$store.getters["user/getUserSetting"]("seriesSortDesc")},seriesFilterBy:function(){return this.$store.getters["user/getUserSetting"]("seriesFilterBy")},authorSortBy:function(){return this.$store.getters["user/getUserSetting"]("authorSortBy")},authorSortDesc:function(){return!!this.$store.getters["user/getUserSetting"]("authorSortDesc")},orderBy:function(){return this.$store.getters["user/getUserSetting"]("orderBy")},orderDesc:function(){return this.$store.getters["user/getUserSetting"]("orderDesc")},filterBy:function(){return this.$store.getters["user/getUserSetting"]("filterBy")},collapseSeries:function(){return this.$store.getters["user/getUserSetting"]("collapseSeries")},collapseBookSeries:function(){return this.$store.getters["user/getUserSetting"]("collapseBookSeries")},coverAspectRatio:function(){return this.$store.getters["libraries/getBookCoverAspectRatio"]},sortingIgnorePrefix:function(){return this.$store.getters.getServerSetting("sortingIgnorePrefix")},isCoverSquareAspectRatio:function(){return 1==this.coverAspectRatio},bookshelfView:function(){return this.$store.getters.getBookshelfView},isAlternativeBookshelfView:function(){return this.bookshelfView===this.$constants.BookshelfView.DETAIL},hasFilter:function(){return this.filterBy&&"all"!==this.filterBy},filterName:function(){if(!this.filterBy)return"";var filter=this.filterBy.split(".")[0];return filter=filter.substr(0,1).toUpperCase()+filter.substr(1)},filterValue:function(){return this.filterBy&&this.filterBy.includes(".")?this.$decode(this.filterBy.split(".")[1]):""},currentLibraryId:function(){return this.$store.state.libraries.currentLibraryId},libraryName:function(){return this.$store.getters["libraries/getCurrentLibraryName"]},bookWidth:function(){return this.cardWidth},shelfPadding:function(){return this.bookshelfWidth<640?32*this.sizeMultiplier:64*this.sizeMultiplier},totalPadding:function(){return 2*this.shelfPadding},entityWidth:function(){return this.cardWidth},shelfPaddingHeight:function(){return 16},shelfHeight:function(){var t=this.isAlternativeBookshelfView?0:24;return this.cardHeight+(this.shelfPaddingHeight+t)*this.sizeMultiplier},totalEntityCardWidth:function(){return this.entityWidth+24*this.sizeMultiplier},selectedMediaItems:function(){return this.$store.state.globals.selectedMediaItems||[]},sizeMultiplier:function(){return this.$store.getters["user/getSizeMultiplier"]},streamLibraryItem:function(){return this.$store.state.streamLibraryItem},isScanningLibrary:function(){return!!this.$store.getters["tasks/getRunningLibraryScanTask"](this.currentLibraryId)}},methods:{clearFilter:function(){this.$store.dispatch("user/updateUserSettings",{filterBy:"all"})},editEntity:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"details";if("items"===this.entityName||"series-books"===this.entityName){var o=this.entities.map((function(t){return t.id}));this.$store.commit("setBookshelfBookIds",o),this.$store.commit("showEditModalOnTab",{libraryItem:t,tab:e||"details"})}else"collections"===this.entityName?this.$store.commit("globals/setEditCollection",t):"playlists"===this.entityName?this.$store.commit("globals/setEditPlaylist",t):"authors"===this.entityName&&this.$store.commit("globals/showEditAuthorModal",t)},clearSelectedEntities:function(){this.updateBookSelectionMode(!1),this.isSelectionMode=!1},selectEntity:function(t,e){var o=this;if("items"===this.entityName||"series-books"===this.entityName){var r=this.entities.findIndex((function(e){return e&&e.id===t.id})),n=this.lastItemIndexSelected;if(this.selectedMediaItems.some((function(i){return i.id===t.id}))?this.lastItemIndexSelected=-1:this.lastItemIndexSelected=r,e&&n>=0){var l=r,c=n;r>n&&(l=n,c=r);for(var h=!1,d=function(){var t=o.entities[i];if(t&&!t.collapsedSeries&&!o.selectedMediaItems.some((function(i){return i.id===t.id})))return h=!0,1},i=l;i<=c&&!d();i++);h&&(this.lastItemIndexSelected=r);for(var f=l;f<=c;f++){var m=this.entities[f];if(m.collapsedSeries)console.warn("Ignoring collapsed series");else{var v=this.entityComponentRefs[f];if(m&&v){v.selected=h;var y={id:m.id,mediaType:m.mediaType,hasTracks:"podcast"===m.mediaType||m.media.audioFile||m.media.numTracks||m.media.tracks&&m.media.tracks.length};this.$store.commit("globals/setMediaItemSelected",{item:y,selected:h})}else console.error("Invalid entity index",f)}}}else{var k={id:t.id,mediaType:t.mediaType,hasTracks:"podcast"===t.mediaType||t.media.audioFile||t.media.numTracks||t.media.tracks&&t.media.tracks.length};this.$store.commit("globals/toggleMediaItemSelected",k)}var S=!!this.selectedMediaItems.length;this.isSelectionMode!==S&&(this.isSelectionMode=S,this.updateBookSelectionMode(S))}},updateBookSelectionMode:function(t){for(var e in this.entityComponentRefs)this.entityIndexesMounted.includes(Number(e))&&this.entityComponentRefs[e].setSelectionMode(t);t||(this.lastItemIndexSelected=-1)},fetchEntites:function(){var t=arguments,e=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var r,n,l,c,h,d,i,f;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return n=(r=t.length>0&&void 0!==t[0]?t[0]:0)*e.booksPerFetch,e.isFetchingEntities=!0,e.initialized||(e.currentSFQueryString=e.buildSearchParams()),l="series-books"===e.entityName?"items":e.entityName,c=e.currentSFQueryString?e.currentSFQueryString+"&":"",h="?".concat(c,"limit=").concat(e.booksPerFetch,"&page=").concat(r,"&minified=1&include=rssfeed,numEpisodesIncomplete,share"),o.next=9,e.$axios.$get("/api/libraries/".concat(e.currentLibraryId,"/").concat(l).concat(h)).catch((function(t){return console.error("failed to fetch items",t),null}));case 9:if(d=o.sent,e.isFetchingEntities=!1,!e.pendingReset){o.next=15;break}return e.pendingReset=!1,e.resetEntities(),o.abrupt("return");case 15:if(d){for(e.initialized||(e.initialized=!0,e.totalEntities=d.total,e.totalShelves=Math.ceil(e.totalEntities/e.entitiesPerShelf),e.entities=new Array(e.totalEntities)),i=0;i<d.results.length;i++)f=i+n,e.entities[f]=d.results[i],e.entityComponentRefs[f]&&e.entityComponentRefs[f].setEntity(e.entities[f]);e.$eventBus.$emit("bookshelf-total-entities",e.totalEntities)}case 16:case"end":return o.stop()}}),o)})))()},loadPage:function(t){return this.pagesLoaded[t]||(this.pagesLoaded[t]=this.fetchEntites(t)),this.pagesLoaded[t]},showHideBookPlaceholder:function(t,e){var o=document.getElementById("book-".concat(t,"-placeholder"));o&&(o.style.display=e?"flex":"none")},mountEntities:function(t,e){for(var i=t;i<e;i++)this.entityIndexesMounted.includes(i)||this.cardsHelpers.mountEntityCard(i)},getVisibleIndices:function(t){var e=Math.floor(t/this.shelfHeight),o=Math.min(Math.ceil((t+this.bookshelfHeight)/this.shelfHeight),this.totalShelves-1);return{firstEntityIndex:e*this.entitiesPerShelf,lastEntityIndex:Math.min(o*this.entitiesPerShelf+this.entitiesPerShelf,this.totalEntities)}},postScroll:function(){var t=this,e=this.getVisibleIndices(this.currScrollTop),o=e.firstEntityIndex,r=e.lastEntityIndex;this.entityIndexesMounted=this.entityIndexesMounted.filter((function(e){if(e<o||e>=r){var n=t.entityComponentRefs[e];return n&&n.$el&&n.$el.remove(),!1}return!0}))},handleScroll:function(t){var e=this;this.currScrollTop=t;var o=this.getVisibleIndices(t),r=o.firstEntityIndex,n=o.lastEntityIndex;if(r!==this.currFirstEntityIndex||n!==this.currLastEntityIndex){this.currFirstEntityIndex=r,this.currLastEntityIndex=n,clearTimeout(this.postScrollTimeout);var l=Math.floor(r/this.booksPerFetch),c=Math.floor(n/this.booksPerFetch);Promise.all([this.loadPage(l),this.loadPage(c)]).then((function(){return e.mountEntities(r,n)})).catch((function(t){return console.error("Failed to load page",t)})),this.postScrollTimeout=setTimeout(this.postScroll,500)}},resetEntities:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!e.isFetchingEntities){o.next=3;break}return e.pendingReset=!0,o.abrupt("return");case 3:return e.destroyEntityComponents(),e.pagesLoaded={},e.entities=[],e.totalShelves=0,e.totalEntities=0,e.currentPage=0,e.isSelectionMode=!1,e.initialized=!1,e.initSizeData(),o.next=14,e.loadPage(0);case 14:r=Math.min(e.totalEntities,e.shelvesPerPage*e.entitiesPerShelf),e.mountEntities(0,r),t&&window.bookshelf&&(window.bookshelf.scrollTop=t);case 17:case"end":return o.stop()}}),o)})))()},rebuild:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.initSizeData(),o=Math.min(t.totalEntities,t.booksPerFetch),t.destroyEntityComponents(),e.next=5,t.loadPage(0);case 5:window.bookshelf&&(window.bookshelf.scrollTop=0),t.mountEntities(0,o);case 7:case"end":return e.stop()}}),e)})))()},buildSearchParams:function(){if("search"===this.page||"collections"===this.page)return"";var t=new URLSearchParams;return"series"===this.page?(t.set("sort",this.seriesSortBy),t.set("desc",this.seriesSortDesc?1:0),t.set("filter",this.seriesFilterBy)):"series-books"===this.page?(t.set("filter","series.".concat(this.$encode(this.seriesId))),this.collapseBookSeries&&t.set("collapseseries",1)):"authors"===this.page?(t.set("sort",this.authorSortBy),t.set("desc",this.authorSortDesc?1:0)):(this.filterBy&&"all"!==this.filterBy&&t.set("filter",this.filterBy),this.orderBy&&(t.set("sort",this.orderBy),t.set("desc",this.orderDesc?1:0)),this.collapseSeries&&!this.isPodcast&&t.set("collapseseries",1)),t.toString()},checkUpdateSearchParams:function(){var t=this.buildSearchParams(),e=window.location.search;if(e&&e.startsWith("?")&&(e=e.slice(1)),""===t)return!1;if(t!==this.currentSFQueryString||t!==e){var o=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+t;return window.history.replaceState({path:o},"",o),this.routeFullPath=window.location.pathname+(window.location.search||""),!0}return!1},seriesSortUpdated:function(){this.checkUpdateSearchParams()&&this.resetEntities()},settingsUpdated:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,e.cardsHelpers.setCardSize();case 2:e.checkUpdateSearchParams()?e.resetEntities():t.bookshelfCoverSize!==e.currentBookWidth&&e.rebuild();case 4:case"end":return o.stop()}}),o)})))()},getScrollRate:function(){var t=Date.now(),e=t-this.lastTimestamp,o=this.currScrollTop-this.lastScrollTop,r=Math.abs(o)/(e||1);return this.lastScrollTop=this.currScrollTop,this.lastTimestamp=t,r},scroll:function(t){var e=this;if(t&&t.target){clearTimeout(this.scrollTimeout);var o=t.target.scrollTop;this.getScrollRate()>5?this.scrollTimeout=setTimeout((function(){e.handleScroll(o)}),25):this.handleScroll(o)}},libraryItemAdded:function(t){console.log("libraryItem added",t),this.resetEntities()},libraryItemUpdated:function(t){if(console.log("Item updated",t),"items"===this.entityName||"series-books"===this.entityName){var e=this.entities.findIndex((function(e){return e&&e.id===t.id}));if(e>=0){var o,r;if("items"===this.entityName&&"media.metadata.title"===this.orderBy)if((null===(o=this.entities[e].media.metadata)||void 0===o?void 0:o.title)!=(null===(r=t.media.metadata)||void 0===r?void 0:r.title))return console.log("Title changed. Re-sorting..."),void this.resetEntities(this.currScrollTop);this.entities[e]=t,this.entityComponentRefs[e]&&this.entityComponentRefs[e].setEntity(t)}}},routeToBookshelfIfLastIssueRemoved:function(){var t=this;if(0===this.totalEntities){var e=this.$route.query;null!=e&&e.filter&&"issues"===e.filter&&this.$nextTick((function(){console.log("Last issue removed. Redirecting to library bookshelf"),t.$router.push("/library/".concat(t.currentLibraryId,"/bookshelf")),t.$store.dispatch("libraries/fetch",t.currentLibraryId)}))}},libraryItemRemoved:function(t){"items"!==this.entityName&&"series-books"!==this.entityName||this.entities.findIndex((function(e){return e&&e.id===t.id}))>=0&&(this.entities=this.entities.filter((function(e){return e.id!==t.id})),this.totalEntities--,this.$eventBus.$emit("bookshelf-total-entities",this.totalEntities),this.executeRebuild());this.routeToBookshelfIfLastIssueRemoved()},libraryItemsAdded:function(t){console.log("items added",t),this.resetEntities()},libraryItemsUpdated:function(t){var e=this;t.forEach((function(t){e.libraryItemUpdated(t)}))},collectionAdded:function(t){"collections"===this.entityName&&(console.log("[LazyBookshelf] collectionAdded ".concat(t.id),t),this.resetEntities())},collectionUpdated:function(t){if("collections"===this.entityName){console.log("[LazyBookshelf] collectionUpdated ".concat(t.id),t);var e=this.entities.findIndex((function(e){return e&&e.id===t.id}));e>=0&&(this.entities[e]=t,this.entityComponentRefs[e]&&this.entityComponentRefs[e].setEntity(t))}},collectionRemoved:function(t){"collections"===this.entityName&&(console.log("[LazyBookshelf] collectionRemoved ".concat(t.id),t),this.entities.findIndex((function(e){return e&&e.id===t.id}))>=0&&(this.entities=this.entities.filter((function(e){return e.id!==t.id})),this.totalEntities--,this.$eventBus.$emit("bookshelf-total-entities",this.totalEntities),this.executeRebuild()))},playlistAdded:function(t){"playlists"===this.entityName&&(console.log("[LazyBookshelf] playlistAdded ".concat(t.id),t),this.resetEntities())},playlistUpdated:function(t){if("playlists"===this.entityName){console.log("[LazyBookshelf] playlistUpdated ".concat(t.id),t);var e=this.entities.findIndex((function(e){return e&&e.id===t.id}));e>=0&&(this.entities[e]=t,this.entityComponentRefs[e]&&this.entityComponentRefs[e].setEntity(t))}},playlistRemoved:function(t){"playlists"===this.entityName&&(console.log("[LazyBookshelf] playlistRemoved ".concat(t.id),t),this.entities.findIndex((function(e){return e&&e.id===t.id}))>=0&&(this.entities=this.entities.filter((function(e){return e.id!==t.id})),this.totalEntities--,this.$eventBus.$emit("bookshelf-total-entities",this.totalEntities),this.executeRebuild()))},authorAdded:function(t){"authors"===this.entityName&&(console.log("[LazyBookshelf] authorAdded ".concat(t.id),t),this.resetEntities())},authorUpdated:function(t){if("authors"===this.entityName){console.log("[LazyBookshelf] authorUpdated ".concat(t.id),t);var e=this.entities.findIndex((function(e){return e&&e.id===t.id}));e>=0&&(this.entities[e]=t,this.entityComponentRefs[e]&&this.entityComponentRefs[e].setEntity(t))}},authorRemoved:function(t){"authors"===this.entityName&&(console.log("[LazyBookshelf] authorRemoved ".concat(t.id),t),this.entities.findIndex((function(e){return e&&e.id===t.id}))>=0&&(this.entities=this.entities.filter((function(e){return e.id!==t.id})),this.totalEntities--,this.$eventBus.$emit("bookshelf-total-entities",this.totalEntities),this.executeRebuild()))},shareOpen:function(t){if("items"===this.entityName||"series-books"===this.entityName){var e=this.entities.findIndex((function(e){var o;return(null==e||null===(o=e.media)||void 0===o?void 0:o.id)===t.mediaItemId}));if(e>=0&&this.entityComponentRefs[e]){var o,r,n=S({},this.entityComponentRefs[e].libraryItem);n.mediaItemShare=t,null===(o=(r=this.entityComponentRefs[e]).setEntity)||void 0===o||o.call(r,n)}}},shareClosed:function(t){if("items"===this.entityName||"series-books"===this.entityName){var e=this.entities.findIndex((function(e){var o;return(null==e||null===(o=e.media)||void 0===o?void 0:o.id)===t.mediaItemId}));if(e>=0&&this.entityComponentRefs[e]){var o,r,n=S({},this.entityComponentRefs[e].libraryItem);n.mediaItemShare=null,null===(o=(r=this.entityComponentRefs[e]).setEntity)||void 0===o||o.call(r,n)}}},updatePagesLoaded:function(){var t=Math.ceil(this.totalEntities/this.booksPerFetch);this.pagesLoaded={};for(var e=0;e<t;e++){var o=Math.min(this.totalEntities-e*this.booksPerFetch,this.booksPerFetch);this.pagesLoaded[e]=Promise.resolve();for(var i=0;i<o;i++){var r=e*this.booksPerFetch+i;if(!this.entities[r]){this.pagesLoaded[e]&&delete this.pagesLoaded[e];break}}}},initSizeData:function(t){var e=t||document.getElementById("bookshelf");if(e){var o=this.entitiesPerShelf,r=e.clientHeight,n=e.clientWidth;this.mountWindowWidth=window.innerWidth,this.bookshelfHeight=r,this.bookshelfWidth=n,this.entitiesPerShelf=Math.max(1,Math.floor((this.bookshelfWidth-this.shelfPadding)/this.totalEntityCardWidth)),this.shelvesPerPage=Math.ceil(this.bookshelfHeight/this.shelfHeight)+2,this.bookshelfMarginLeft=(this.bookshelfWidth-this.entitiesPerShelf*this.totalEntityCardWidth)/2;var l=this.entitiesPerShelf*this.shelvesPerPage;return l!==this.booksPerFetch&&(this.booksPerFetch=l,this.totalEntities&&this.updatePagesLoaded()),this.currentBookWidth=this.bookWidth,this.totalEntities&&(this.totalShelves=Math.ceil(this.totalEntities/this.entitiesPerShelf)),o<this.entitiesPerShelf}console.error("Failed to init size data")},init:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var r,n,path,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return e.initSizeData(t),e.checkUpdateSearchParams(),o.next=4,e.loadPage(0);case 4:r=Math.min(e.totalEntities,e.shelvesPerPage*e.entitiesPerShelf),e.mountEntities(0,r),e.$store.state.lastBookshelfScrollData[e.page]&&window.bookshelf&&(n=e.$store.state.lastBookshelfScrollData[e.page],path=n.path,l=n.scrollTop,path===e.routeFullPath&&(window.bookshelf.scrollTop=l));case 7:case"end":return o.stop()}}),o)})))()},executeRebuild:function(){var t=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((function(){t.rebuild()}),200)},windowResize:function(){this.executeRebuild()},initListeners:function(){var t=this;window.addEventListener("resize",this.windowResize),this.$nextTick((function(){var e=document.getElementById("bookshelf");e&&(t.init(e),e.addEventListener("scroll",t.scroll,{passive:!0}))})),this.$eventBus.$on("bookshelf_clear_selection",this.clearSelectedEntities),this.$eventBus.$on("user-settings",this.settingsUpdated),this.$root.socket?(this.$root.socket.on("item_updated",this.libraryItemUpdated),this.$root.socket.on("item_added",this.libraryItemAdded),this.$root.socket.on("item_removed",this.libraryItemRemoved),this.$root.socket.on("items_updated",this.libraryItemsUpdated),this.$root.socket.on("items_added",this.libraryItemsAdded),this.$root.socket.on("collection_added",this.collectionAdded),this.$root.socket.on("collection_updated",this.collectionUpdated),this.$root.socket.on("collection_removed",this.collectionRemoved),this.$root.socket.on("playlist_added",this.playlistAdded),this.$root.socket.on("playlist_updated",this.playlistUpdated),this.$root.socket.on("playlist_removed",this.playlistRemoved),this.$root.socket.on("author_added",this.authorAdded),this.$root.socket.on("author_updated",this.authorUpdated),this.$root.socket.on("author_removed",this.authorRemoved),this.$root.socket.on("share_open",this.shareOpen),this.$root.socket.on("share_closed",this.shareClosed)):console.error("Bookshelf - Socket not initialized")},removeListeners:function(){window.removeEventListener("resize",this.windowResize);var t=document.getElementById("bookshelf");t&&t.removeEventListener("scroll",this.scroll),this.$eventBus.$off("bookshelf_clear_selection",this.clearSelectedEntities),this.$eventBus.$off("user-settings",this.settingsUpdated),this.$root.socket?(this.$root.socket.off("item_updated",this.libraryItemUpdated),this.$root.socket.off("item_added",this.libraryItemAdded),this.$root.socket.off("item_removed",this.libraryItemRemoved),this.$root.socket.off("items_updated",this.libraryItemsUpdated),this.$root.socket.off("items_added",this.libraryItemsAdded),this.$root.socket.off("collection_added",this.collectionAdded),this.$root.socket.off("collection_updated",this.collectionUpdated),this.$root.socket.off("collection_removed",this.collectionRemoved),this.$root.socket.off("playlist_added",this.playlistAdded),this.$root.socket.off("playlist_updated",this.playlistUpdated),this.$root.socket.off("playlist_removed",this.playlistRemoved),this.$root.socket.off("author_added",this.authorAdded),this.$root.socket.off("author_updated",this.authorUpdated),this.$root.socket.off("author_removed",this.authorRemoved),this.$root.socket.off("share_open",this.shareOpen),this.$root.socket.off("share_closed",this.shareClosed)):console.error("Bookshelf - Socket not initialized")},destroyEntityComponents:function(){for(var t in this.entityComponentRefs){var e=this.entityComponentRefs[t];e&&e.destroy&&(e.$el&&e.$el.remove(),e.destroy())}this.entityComponentRefs={},this.entityIndexesMounted=[]},scan:function(){var t=this;this.tempIsScanning=!0,this.$store.dispatch("libraries/requestLibraryScan",{libraryId:this.currentLibraryId}).catch((function(e){console.error("Failed to start scan",e),t.$toast.error(t.$strings.ToastLibraryScanFailedToStart)})).finally((function(){t.tempIsScanning=!1}))},entitiesInShelf:function(t){return t==this.totalShelves&&this.totalEntities%this.entitiesPerShelf||this.entitiesPerShelf},entityTransform:function(t){var e=this.shelfPaddingHeight*this.sizeMultiplier,o=(t-1)*this.totalEntityCardWidth+this.bookshelfMarginLeft;return"translate3d(".concat(o,"px, ").concat(e,"px, 0px)")}},mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.cardsHelpers.setCardSize();case 2:t.initListeners(),t.routeFullPath=window.location.pathname+(window.location.search||"");case 4:case"end":return e.stop()}}),e)})))()},updated:function(){var t=this;this.routeFullPath=window.location.pathname+(window.location.search||""),setTimeout((function(){window.innerWidth>0&&window.innerWidth!==t.mountWindowWidth&&(console.log("Updated window width",window.innerWidth,"from",t.mountWindowWidth),t.executeRebuild())}),50)},beforeDestroy:function(){this.destroyEntityComponents(),this.removeListeners(),window.bookshelf&&this.$store.commit("setLastBookshelfScrollData",{scrollTop:window.bookshelf.scrollTop||0,path:this.routeFullPath,name:this.page})}},x=w,$=(o(922),o(4)),component=Object($.a)(x,(function(){var t=this,e=t._self._c;return e("div",{ref:"bookshelf",staticClass:"w-full overflow-y-auto",style:{fontSize:t.sizeMultiplier+"rem"},attrs:{id:"bookshelf"}},[t._l(t.totalShelves,(function(o){return[e("div",{key:o,staticClass:"w-full px-4e sm:px-8e relative",class:{bookshelfRow:!t.isAlternativeBookshelfView},style:{height:t.shelfHeight+"px"},attrs:{id:"shelf-".concat(o-1)}},[t._l(t.entitiesInShelf(o),(function(o){return[e("div",{key:o,staticClass:"w-full h-full absolute rounded-sm z-5 top-0 left-0 bg-primary box-shadow-book",style:{transform:t.entityTransform(o),width:t.cardWidth+"px",height:t.coverHeight+"px"}})]})),t._v(" "),t.isAlternativeBookshelfView?t._e():e("div",{staticClass:"bookshelfDivider w-full absolute bottom-0 left-0 right-0 z-20 h-6e"})],2)]})),t._v(" "),!t.initialized||t.totalShelves||t.hasFilter||"items"!==t.entityName?!t.totalShelves&&t.initialized?e("div",{staticClass:"w-full py-16"},[e("p",{staticClass:"text-xl text-center"},[t._v(t._s(t.emptyMessage))]),t._v(" "),"collections"===t.entityName||"playlists"===t.entityName?e("div",{staticClass:"flex justify-center mt-4"},[t._v("\n      "+t._s(t.emptyMessageHelp)+"\n      "),e("ui-tooltip",{staticClass:"inline-flex ml-2",attrs:{text:t.$strings.LabelClickForMoreInfo}},[e("a",{staticClass:"inline-flex",attrs:{href:"https://www.audiobookshelf.org/guides/collections",target:"_blank"}},[e("span",{staticClass:"material-symbols text-xl w-5 text-gray-200"},[t._v("help_outline")])])])],1):t._e(),t._v(" "),"items"===t.entityName?e("div",{staticClass:"flex justify-center mt-2"},[t.hasFilter?e("ui-btn",{attrs:{color:"bg-primary"},on:{click:t.clearFilter}},[t._v(t._s(t.$strings.ButtonClearFilter))]):t._e()],1):t._e()]):t._e():e("div",{staticClass:"w-full flex flex-col items-center justify-center py-12"},[e("p",{staticClass:"text-center text-2xl mb-4 py-4"},[t._v(t._s(t.$getString("MessageXLibraryIsEmpty",[t.libraryName])))]),t._v(" "),t.userIsAdminOrUp?e("div",{staticClass:"flex"},[e("ui-btn",{staticClass:"w-52 mr-2",attrs:{to:"/config",color:"bg-primary"}},[t._v(t._s(t.$strings.ButtonConfigureScanner))]),t._v(" "),e("ui-btn",{staticClass:"w-52",attrs:{color:"bg-success",loading:t.isScanningLibrary||t.tempIsScanning},on:{click:t.scan}},[t._v(t._s(t.$strings.ButtonScanLibrary))])],1):t._e()]),t._v(" "),e("widgets-cover-size-widget",{staticClass:"fixed right-4 z-50",style:{bottom:t.streamLibraryItem?"181px":"16px"}})],2)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiBtn:o(42).default,UiTooltip:o(76).default,WidgetsCoverSizeWidget:o(748).default})},878:function(t,e,o){"use strict";o.r(e);o(15),o(14);var r={props:{index:Number,width:Number,height:{type:Number,default:192},bookshelfView:{type:Number,default:0},collectionMount:{type:Object,default:function(){return null}},isTag:Boolean},data:function(){return{collection:null,isSelectionMode:!1,selected:!1,isHovering:!1}},computed:{bookCoverAspectRatio:function(){return this.store.getters["libraries/getBookCoverAspectRatio"]},cardWidth:function(){return this.width||this.coverHeight/this.bookCoverAspectRatio*2},coverHeight:function(){return this.height*this.sizeMultiplier},labelFontSize:function(){return this.width<160?.75:.9},sizeMultiplier:function(){return this.store.getters["user/getSizeMultiplier"]},title:function(){return this.collection?this.collection.name:""},books:function(){return this.collection&&this.collection.books||[]},store:function(){return this.$store||this.$nuxt.$store},currentLibraryId:function(){return this.store.state.libraries.currentLibraryId},isAlternativeBookshelfView:function(){var t=this.$constants||this.$nuxt.$constants;return this.bookshelfView==t.BookshelfView.DETAIL},userCanUpdate:function(){return this.store.getters["user/getUserCanUpdate"]},rssFeed:function(){return this.collection?this.collection.rssFeed:null}},methods:{setEntity:function(t){this.collection=t},setSelectionMode:function(t){this.isSelectionMode=t},mouseover:function(){this.isHovering=!0},mouseleave:function(){this.isHovering=!1},clickCard:function(){this.collection&&(this.$router||this.$nuxt.$router).push("/collection/".concat(this.collection.id))},clickEdit:function(){this.$emit("edit",this.collection)},destroy:function(){this.$destroy(),this.$el&&this.$el.parentNode?this.$el.parentNode.removeChild(this.$el):this.$el&&this.$el.remove&&this.$el.remove()}},mounted:function(){this.collectionMount&&this.setEntity(this.collectionMount)}},n=o(4),component=Object(n.a)(r,(function(){var t=this,e=t._self._c;return e("div",{ref:"card",staticClass:"absolute top-0 left-0 rounded-xs z-30 cursor-pointer",style:{width:t.cardWidth+"px"},attrs:{id:"collection-card-".concat(t.index),role:"button"},on:{mousedown:function(t){t.preventDefault()},mouseup:function(t){t.preventDefault()},mousemove:function(t){t.preventDefault()},mouseover:t.mouseover,mouseleave:t.mouseleave,click:t.clickCard}},[e("div",{staticClass:"relative",style:{height:t.coverHeight+"px"}},[e("div",{staticClass:"absolute top-0 left-0 w-full box-shadow-book shadow-height"}),t._v(" "),e("div",{staticClass:"w-full h-full bg-primary relative rounded-sm overflow-hidden"},[e("covers-collection-cover",{ref:"cover",attrs:{"book-items":t.books,width:t.cardWidth,height:t.coverHeight,"book-cover-aspect-ratio":t.bookCoverAspectRatio}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isHovering&&t.userCanUpdate,expression:"isHovering && userCanUpdate"}],staticClass:"w-full h-full absolute top-0 left-0 z-10 bg-black/40 pointer-events-none"},[e("div",{staticClass:"absolute pointer-events-auto",style:{top:"0.5em",right:"0.5em"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.clickEdit.apply(null,arguments)}}},[e("span",{staticClass:"material-symbols text-white/75 hover:text-white/100",style:{fontSize:"1.25em"}},[t._v("edit")])])]),t._v(" "),!t.isHovering&&t.rssFeed?e("span",{staticClass:"absolute z-10 material-symbols text-success",style:{top:"0.5em",left:"0.5em",fontSize:"1.5em"}},[t._v("rss_feed")]):t._e()]),t._v(" "),t.isAlternativeBookshelfView?e("div",{staticClass:"relative z-30 left-0 right-0 mx-auto h-8e py-1e rounded-md text-center"},[e("p",{staticClass:"truncate",style:{fontSize:t.labelFontSize+"em"}},[t._v(t._s(t.title))])]):e("div",{staticClass:"categoryPlacard absolute z-30 left-0 right-0 mx-auto -bottom-6e h-6e rounded-md text-center",style:{width:Math.min(200,t.cardWidth)+"px"}},[e("div",{staticClass:"w-full h-full shinyBlack flex items-center justify-center rounded-xs border",style:{padding:"0em ".concat(.5,"em")}},[e("p",{staticClass:"truncate",style:{fontSize:t.labelFontSize+"em"}},[t._v(t._s(t.title))])])])])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{CoversCollectionCover:o(242).default})},879:function(t,e,o){"use strict";o.r(e);o(15),o(14);var r={props:{index:Number,width:Number,height:{type:Number,default:192},bookshelfView:{type:Number,default:0},playlistMount:{type:Object,default:function(){return null}}},data:function(){return{playlist:null,isSelectionMode:!1,selected:!1,isHovering:!1}},computed:{bookCoverAspectRatio:function(){return this.store.getters["libraries/getBookCoverAspectRatio"]},cardWidth:function(){return this.width||this.coverHeight},coverHeight:function(){return this.height*this.sizeMultiplier},labelFontSize:function(){return this.width<160?.75:.9},sizeMultiplier:function(){return this.store.getters["user/getSizeMultiplier"]},title:function(){return this.playlist?this.playlist.name:""},items:function(){return this.playlist&&this.playlist.items||[]},store:function(){return this.$store||this.$nuxt.$store},currentLibraryId:function(){return this.store.state.libraries.currentLibraryId},isAlternativeBookshelfView:function(){var t=this.$constants||this.$nuxt.$constants;return this.bookshelfView==t.BookshelfView.DETAIL},userCanUpdate:function(){return this.store.getters["user/getUserCanUpdate"]}},methods:{setEntity:function(t){this.playlist=t},setSelectionMode:function(t){this.isSelectionMode=t},mouseover:function(){this.isHovering=!0},mouseleave:function(){this.isHovering=!1},clickCard:function(){this.playlist&&(this.$router||this.$nuxt.$router).push("/playlist/".concat(this.playlist.id))},clickEdit:function(){this.$emit("edit",this.playlist)},destroy:function(){this.$destroy(),this.$el&&this.$el.parentNode?this.$el.parentNode.removeChild(this.$el):this.$el&&this.$el.remove&&this.$el.remove()}},mounted:function(){this.playlistMount&&this.setEntity(this.playlistMount)}},n=o(4),component=Object(n.a)(r,(function(){var t=this,e=t._self._c;return e("div",{ref:"card",staticClass:"absolute top-0 left-0 rounded-xs z-30 cursor-pointer",style:{width:t.cardWidth+"px",fontSize:t.sizeMultiplier+"rem"},attrs:{id:"playlist-card-".concat(t.index),role:"button"},on:{mousedown:function(t){t.preventDefault()},mouseup:function(t){t.preventDefault()},mousemove:function(t){t.preventDefault()},mouseover:t.mouseover,mouseleave:t.mouseleave,click:t.clickCard}},[e("div",{staticClass:"relative",style:{height:t.coverHeight+"px"}},[e("div",{staticClass:"absolute top-0 left-0 w-full box-shadow-book shadow-height"}),t._v(" "),e("div",{staticClass:"w-full h-full bg-primary relative rounded-sm overflow-hidden"},[e("covers-playlist-cover",{ref:"cover",attrs:{items:t.items,width:t.cardWidth,height:t.coverHeight}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isHovering&&t.userCanUpdate,expression:"isHovering && userCanUpdate"}],staticClass:"w-full h-full absolute top-0 left-0 z-10 bg-black/40 pointer-events-none"},[e("div",{staticClass:"absolute pointer-events-auto",style:{top:"0.5em",right:"0.5em"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.clickEdit.apply(null,arguments)}}},[e("span",{staticClass:"material-symbols text-white/75 hover:text-white/100",style:{fontSize:"1.25em"}},[t._v("edit")])])])]),t._v(" "),t.isAlternativeBookshelfView?e("div",{staticClass:"relative z-30 left-0 right-0 mx-auto h-8e py-1e rounded-md text-center"},[e("p",{staticClass:"truncate",style:{fontSize:t.labelFontSize+"em"}},[t._v(t._s(t.title))])]):e("div",{staticClass:"categoryPlacard absolute z-30 -bottom-6e left-0 right-0 mx-auto h-6e rounded-md text-center",style:{width:Math.min(200,t.width)+"px"}},[e("div",{staticClass:"w-full h-full shinyBlack flex items-center justify-center rounded-xs border",style:{padding:"0em ".concat(.5,"em")}},[e("p",{staticClass:"truncate",style:{fontSize:t.labelFontSize+"em"}},[t._v(t._s(t.title))])])])])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{CoversPlaylistCover:o(243).default})},922:function(t,e,o){"use strict";o(807)},923:function(t,e,o){var r=o(18)((function(i){return i[1]}));r.push([t.i,"\n.bookshelfRow {\n  background-image: var(--bookshelf-texture-img);\n}\n.bookshelfDivider {\n  background: rgb(149, 119, 90);\n  background: var(--bookshelf-divider-bg);\n  box-shadow: 0.125em 0.875em 0.5em #111111aa;\n}\n",""]),r.locals={},t.exports=r}}]);