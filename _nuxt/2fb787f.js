(window.webpackJsonp=window.webpackJsonp||[]).push([[121,108,140],{685:function(t,e,n){"use strict";n.r(e);n(83),n(62);var o={props:{accept:{type:String,default:".png, .jpg, .jpeg, .webp"}},data:function(){return{}},computed:{},methods:{reset:function(){this.$refs.fileInput&&(this.$refs.fileInput.value="")},clickUpload:function(){this.$refs.fileInput&&this.$refs.fileInput.click()},inputChanged:function(t){if(t.target&&t.target.files){var e=Array.from(t.target.files);if(e&&e.length){var n=e[0];this.$emit("change",n)}}}},mounted:function(){}},c=n(4),component=Object(c.a)(o,(function(){var t=this,e=t._self._c;return e("div",[e("input",{ref:"fileInput",staticClass:"hidden",attrs:{type:"file",accept:t.accept},on:{change:t.inputChanged}}),t._v(" "),e("ui-btn",{staticClass:"hidden md:block w-full",attrs:{color:"bg-primary",type:"text"},on:{click:t.clickUpload}},[t._t("default")],2),t._v(" "),e("ui-icon-btn",{staticClass:"block md:hidden",attrs:{icon:"upload"},on:{click:t.clickUpload}})],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiBtn:n(42).default,UiIconBtn:n(148).default})},706:function(t,e,n){"use strict";n.r(e);n(14),n(40);var o={props:{value:Boolean,persistent:{type:Boolean,default:!0},width:{type:[String,Number],default:500},height:{type:[String,Number],default:"unset"}},data:function(){return{el:null,content:null}},watch:{show:function(t){t?this.setShow():this.setHide()}},computed:{show:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},modalHeight:function(){return"string"==typeof this.height?this.height:this.height+"px"},modalWidth:function(){return"string"==typeof this.width?this.width:this.width+"px"}},methods:{setShow:function(){var t=this;document.body.appendChild(this.el),setTimeout((function(){t.content.style.transform="scale(1)"}),10)},setHide:function(){this.content.style.transform="scale(0)",this.el.remove()}},mounted:function(){this.el=this.$refs.wrapper,this.content=this.$refs.content,this.content.style.transform="scale(0)",this.content.style.transition="transform 0.25s cubic-bezier(0.16, 1, 0.3, 1)",this.el.style.opacity=1,this.el.remove()}},c=n(4),component=Object(c.a)(o,(function(){var t=this,e=t._self._c;return e("div",{ref:"wrapper",staticClass:"modal modal-bg w-full h-full fixed top-0 left-0 bg-primary/75 flex items-center justify-center z-40 opacity-0"},[e("div",{staticClass:"absolute top-0 left-0 right-0 w-full h-36 bg-linear-to-t from-transparent via-black-500 to-black-700 opacity-90 pointer-events-none"}),t._v(" "),e("div",{ref:"content",staticClass:"relative text-white",staticStyle:{"min-width":"400px","min-height":"200px"},style:{height:t.modalHeight,width:t.modalWidth}},[t._t("default")],2)])}),[],!1,null,null,null);e.default=component.exports},712:function(t,e,n){var content=n(758);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(19).default)("32b7be47",content,!0,{sourceMap:!1})},757:function(t,e,n){"use strict";n(712)},758:function(t,e,n){var o=n(18)((function(i){return i[1]}));o.push([t.i,"\n#backups {\n  table-layout: fixed;\n  border-collapse: collapse;\n  width: 100%;\n}\n#backups td,\n#backups th {\n  border: 1px solid #2e2e2e;\n  padding: 8px 8px;\n  text-align: left;\n}\n#backups tr.staticrow td {\n  text-align: center;\n}\n#backups tr:nth-child(even):not(.bg-error) {\n  background-color: #3a3a3a;\n}\n#backups tr:not(.staticrow):not(.bg-error):hover {\n  background-color: #444;\n}\n#backups th {\n  font-size: 0.8rem;\n  font-weight: 600;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  background-color: #333;\n}\n",""]),o.locals={},t.exports=o},838:function(t,e,n){"use strict";n.r(e);n(35),n(63),n(17),n(150),n(8);var o={data:function(){return{showConfirmApply:!1,selectedBackup:null,isBackingUp:!1,isApplyingBackup:!1,processing:!1,backups:[]}},computed:{userToken:function(){return this.$store.getters["user/getToken"]},dateFormat:function(){return this.$store.getters.getServerSetting("dateFormat")},timeFormat:function(){return this.$store.getters.getServerSetting("timeFormat")}},methods:{downloadBackup:function(t){this.$downloadFile("".concat("/audiobookshelf","/api/backups/").concat(t.id,"/download?token=").concat(this.userToken))},confirm:function(){var t=this;this.showConfirmApply=!1,this.isApplyingBackup=!0,this.$axios.$get("/api/backups/".concat(this.selectedBackup.id,"/apply")).then((function(){location.replace("/config/backups?backup=1")})).catch((function(e){console.error("Failed to apply backup",e);var n=e.response.data||t.$strings.ToastBackupRestoreFailed;t.$toast.error(n)})).finally((function(){t.isApplyingBackup=!1}))},deleteBackupClick:function(t){var e=this,n={message:this.$getString("MessageConfirmDeleteBackup",[this.$formatDatetime(t.createdAt,this.dateFormat,this.timeFormat)]),callback:function(n){n&&e.deleteBackup(t)},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",n)},deleteBackup:function(t){var e=this;this.processing=!0,this.$axios.$delete("/api/backups/".concat(t.id)).then((function(data){e.setBackups(data.backups||[]),e.$toast.success(e.$strings.ToastBackupDeleteSuccess)})).catch((function(t){console.error(t),e.$toast.error(e.$strings.ToastBackupDeleteFailed)})).finally((function(){e.processing=!1}))},applyBackup:function(t){this.selectedBackup=t,this.showConfirmApply=!0},clickCreateBackup:function(){var t=this;this.isBackingUp=!0,this.$axios.$post("/api/backups").then((function(data){t.isBackingUp=!1,t.$toast.success(t.$strings.ToastBackupCreateSuccess),t.setBackups(data.backups||[])})).catch((function(e){t.isBackingUp=!1,console.error("Failed",e),t.$toast.error(t.$strings.ToastBackupCreateFailed)}))},backupUploaded:function(t){var e=this,form=new FormData;form.set("file",t),this.processing=!0,this.$axios.$post("/api/backups/upload",form).then((function(data){e.setBackups(data.backups||[]),e.$toast.success(e.$strings.ToastBackupUploadSuccess),e.processing=!1})).catch((function(t){console.error(t);var n=t.response&&t.response.data?t.response.data:e.$strings.ToastBackupUploadFailed;e.$toast.error(n),e.processing=!1}))},setBackups:function(t){t.sort((function(a,b){return b.createdAt-a.createdAt})),this.backups=t},loadBackups:function(){var t=this;this.processing=!0,this.$axios.$get("/api/backups").then((function(data){t.$emit("loaded",data),t.setBackups(data.backups||[])})).catch((function(e){console.error("Failed to load backups",e),t.$toast.error(t.$strings.ToastFailedToLoadData)})).finally((function(){t.processing=!1}))}},mounted:function(){this.loadBackups(),this.$route.query.backup&&this.$toast.success(this.$strings.ToastBackupAppliedSuccess)}},c=(n(757),n(4)),component=Object(c.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"text-center mt-4 relative"},[e("div",{staticClass:"flex py-4"},[e("ui-file-input",{ref:"fileInput",staticClass:"mr-2",attrs:{accept:".audiobookshelf"},on:{change:t.backupUploaded}},[t._v(t._s(t.$strings.ButtonUploadBackup))]),t._v(" "),e("div",{staticClass:"grow"}),t._v(" "),e("ui-btn",{attrs:{loading:t.isBackingUp},on:{click:t.clickCreateBackup}},[t._v(t._s(t.$strings.ButtonCreateBackup))])],1),t._v(" "),e("div",{staticClass:"relative"},[e("table",{attrs:{id:"backups"}},[e("tr",[e("th",[t._v(t._s(t.$strings.LabelFile))]),t._v(" "),e("th",{staticClass:"hidden sm:table-cell w-32 md:w-56"},[t._v(t._s(t.$strings.LabelDatetime))]),t._v(" "),e("th",{staticClass:"hidden sm:table-cell w-20 md:w-28"},[t._v(t._s(t.$strings.LabelSize))]),t._v(" "),e("th",{staticClass:"w-36"})]),t._v(" "),t._l(t.backups,(function(n){return e("tr",{key:n.id,class:n.serverVersion?"":"bg-error/10"},[e("td",[e("p",{staticClass:"truncate text-xs sm:text-sm md:text-base"},[t._v("/"+t._s(n.path.replace(/\\/g,"/")))])]),t._v(" "),e("td",{staticClass:"hidden sm:table-cell font-sans text-sm"},[t._v(t._s(t.$formatDatetime(n.createdAt,t.dateFormat,t.timeFormat)))]),t._v(" "),e("td",{staticClass:"hidden sm:table-cell font-mono md:text-sm text-xs"},[t._v(t._s(t.$bytesPretty(n.fileSize)))]),t._v(" "),e("td",[e("div",{staticClass:"w-full flex flex-row items-center justify-center"},[n.serverVersion&&n.key?e("ui-btn",{attrs:{small:"",color:"bg-primary"},on:{click:function(e){return t.applyBackup(n)}}},[t._v(t._s(t.$strings.ButtonRestore))]):e("ui-tooltip",{staticClass:"mx-2 flex items-center",attrs:{text:"This backup was created with an old version of audiobookshelf no longer supported",direction:"bottom"}},[e("span",{staticClass:"material-symbols text-2xl text-error"},[t._v("error_outline")])]),t._v(" "),e("button",{staticClass:"inline-flex material-symbols text-xl mx-1 mt-1 text-white/70 hover:text-white/100",attrs:{"aria-label":"Download backup"},on:{click:function(e){return e.stopPropagation(),t.downloadBackup(n)}}},[t._v("download")]),t._v(" "),e("button",{staticClass:"inline-flex material-symbols text-xl mx-1 text-white/70 hover:text-error",attrs:{"aria-label":"Delete backup"},on:{click:function(e){return e.stopPropagation(),t.deleteBackupClick(n)}}},[t._v("delete")])],1)])])})),t._v(" "),t.backups.length?t._e():e("tr",{staticClass:"staticrow"},[e("td",{staticClass:"text-lg",attrs:{colspan:"4"}},[t._v(t._s(t.$strings.MessageNoBackups))])])],2),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.processing,expression:"processing"}],staticClass:"absolute top-0 left-0 w-full h-full bg-black/25 flex items-center justify-center"},[e("ui-loading-indicator")],1)]),t._v(" "),e("prompt-dialog",{attrs:{width:675},model:{value:t.showConfirmApply,callback:function(e){t.showConfirmApply=e},expression:"showConfirmApply"}},[t.selectedBackup?e("div",{staticClass:"px-4 w-full text-sm py-6 rounded-lg bg-bg shadow-lg border border-black-300"},[e("p",{staticClass:"text-error text-lg font-semibold"},[t._v(t._s(t.$strings.MessageImportantNotice))]),t._v(" "),e("p",{staticClass:"text-base py-1",domProps:{innerHTML:t._s(t.$strings.MessageRestoreBackupWarning)}}),t._v(" "),e("p",{staticClass:"text-lg text-center my-8"},[t._v(t._s(t.$strings.MessageRestoreBackupConfirm)+" "+t._s(t.$formatDatetime(t.selectedBackup.createdAt,t.dateFormat,t.timeFormat))+"?")]),t._v(" "),e("div",{staticClass:"flex px-1 items-center"},[e("ui-btn",{attrs:{color:"bg-primary"},on:{click:function(e){t.showConfirmApply=!1}}},[t._v(t._s(t.$strings.ButtonNevermind))]),t._v(" "),e("div",{staticClass:"grow"}),t._v(" "),e("ui-btn",{attrs:{color:"bg-success"},on:{click:t.confirm}},[t._v(t._s(t.$strings.ButtonRestore))])],1)]):t._e()]),t._v(" "),t.isApplyingBackup?e("div",{staticClass:"absolute inset-0 w-full h-full flex items-center justify-center bg-black/20 rounded-md"},[e("ui-loading-indicator")],1):t._e()],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiFileInput:n(685).default,UiBtn:n(42).default,UiTooltip:n(76).default,UiLoadingIndicator:n(348).default,PromptDialog:n(706).default})}}]);