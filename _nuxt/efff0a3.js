(window.webpackJsonp=window.webpackJsonp||[]).push([[11,57,143],{1034:function(e,t,n){"use strict";n.r(t);n(147);var r=n(642),o=n(16);n(17),n(27),n(22),n(26),n(15),n(44),n(45),n(38),n(8),n(28);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={props:{value:Boolean,account:{type:Object,default:function(){return null}}},data:function(){return{processing:!1,newUser:{},isNew:!0,tags:[],loadingTags:!1,unlinkingFromOpenID:!1}},watch:{show:{handler:function(e){e&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},accountTypes:function(){return[{text:this.$strings.LabelAccountTypeGuest,value:"guest"},{text:this.$strings.LabelAccountTypeUser,value:"user"},{text:this.$strings.LabelAccountTypeAdmin,value:"admin"}]},user:function(){return this.$store.state.user.user},title:function(){return this.isNew?this.$strings.HeaderNewAccount:this.$strings.HeaderUpdateAccount},isEditingRoot:function(){var e;return"root"===(null===(e=this.account)||void 0===e?void 0:e.type)},libraries:function(){return this.$store.state.libraries.libraries},libraryItems:function(){return this.libraries.map((function(e){return{text:e.name,value:e.id}}))},itemTags:function(){return this.tags.map((function(e){return{text:e,value:e}}))},tagsSelectionText:function(){return this.newUser.permissions.selectedTagsNotAccessible?this.$strings.LabelTagsNotAccessibleToUser:this.$strings.LabelTagsAccessibleToUser},hasOpenIDLink:function(){var e;return!(null===(e=this.account)||void 0===e||!e.hasOpenIDLink)}},methods:{close:function(){this.$refs.modal&&this.$refs.modal.setHide()},unlinkOpenID:function(){var e=this,t={message:this.$strings.MessageConfirmUnlinkOpenId,callback:function(t){t&&(e.unlinkingFromOpenID=!0,e.$axios.$patch("/api/users/".concat(e.account.id,"/openid-unlink")).then((function(){e.$toast.success(e.$strings.ToastUnlinkOpenIdSuccess),e.show=!1})).catch((function(t){console.error("Failed to unlink user from OpenID",t),e.$toast.error(e.$strings.ToastUnlinkOpenIdFailed)})).finally((function(){e.unlinkingFromOpenID=!1})))},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",t)},accessAllTagsToggled:function(e){var t;e&&(null!==(t=this.newUser.itemTagsSelected)&&void 0!==t&&t.length&&(this.newUser.itemTagsSelected=[]),this.newUser.permissions.selectedTagsNotAccessible=!1)},fetchAllTags:function(){var e=this;this.loadingTags=!0,this.$axios.$get("/api/tags").then((function(t){e.tags=t.tags,e.loadingTags=!1})).catch((function(t){console.error("Failed to load tags",t),e.loadingTags=!1}))},accessAllLibrariesToggled:function(e){e||this.newUser.librariesAccessible.length?e&&this.newUser.librariesAccessible.length&&(this.newUser.librariesAccessible=[]):this.newUser.librariesAccessible=this.libraries.map((function(e){return e.id}))},submitForm:function(){this.newUser.username?this.newUser.permissions.accessAllLibraries||this.newUser.librariesAccessible.length?this.newUser.permissions.accessAllTags||this.newUser.itemTagsSelected.length?this.isNew?this.submitCreateAccount():this.submitUpdateAccount():this.$toast.error(this.$strings.ToastNewUserTagError):this.$toast.error(this.$strings.ToastNewUserLibraryError):this.$toast.error(this.$strings.ToastNewUserUsernameError)},submitUpdateAccount:function(){var e=this,t=c({},this.newUser);t.password&&"root"!==t.type||delete t.password,("root"!==t.type||t.isActive)&&(this.processing=!0,this.$axios.$patch("/api/users/".concat(this.account.id),t).then((function(data){e.processing=!1,data.error?e.$toast.error("".concat(e.$strings.ToastFailedToUpdate,": ").concat(data.error)):(console.log("Account updated",data.user),data.user.id===e.user.id&&data.user.accessToken!==e.user.accessToken&&(console.log("Current user access token was updated"),e.$store.commit("user/setAccessToken",data.user.accessToken)),e.$toast.success(e.$strings.ToastAccountUpdateSuccess),e.show=!1)})).catch((function(t){e.processing=!1,console.error("Failed to update account",t);var n=t.response&&t.response.data||"";e.$toast.error(n||e.$strings.ToastFailedToUpdate)})))},submitCreateAccount:function(){var e=this;if(this.newUser.password){var t=c({},this.newUser);this.processing=!0,this.$axios.$post("/api/users",t).then((function(data){e.processing=!1,data.error?e.$toast.error(e.$strings.ToastNewUserCreatedFailed+": "+data.error):(e.$toast.success(e.$strings.ToastNewUserCreatedSuccess),e.show=!1)})).catch((function(t){e.processing=!1,console.error("Failed to create account",t);var n=t.response&&t.response.data||"";e.$toast.error(n||"Failed to create account")}))}else this.$toast.error(this.$strings.ToastNewUserPasswordError)},userTypeUpdated:function(e){this.newUser.permissions={download:"guest"!==e,update:"admin"===e,delete:"admin"===e,upload:"admin"===e,accessExplicitContent:"admin"===e,accessAllLibraries:!0,accessAllTags:!0,selectedTagsNotAccessible:!1,createEreader:"admin"===e}},init:function(){this.fetchAllTags(),this.isNew=!this.account,this.account?this.newUser={username:this.account.username,email:this.account.email,password:this.account.password,type:this.account.type,isActive:this.account.isActive,permissions:c({},this.account.permissions),librariesAccessible:Object(r.a)(this.account.librariesAccessible||[]),itemTagsSelected:Object(r.a)(this.account.itemTagsSelected||[])}:this.newUser={username:null,email:null,password:null,type:"user",isActive:!0,permissions:{download:!0,update:!1,delete:!1,upload:!1,accessAllLibraries:!0,accessAllTags:!0,accessExplicitContent:!1,selectedTagsNotAccessible:!1,createEreader:!1},librariesAccessible:[],itemTagsSelected:[]}}},mounted:function(){}},m=n(4),component=Object(m.a)(d,(function(){var e=this,t=e._self._c;return t("modals-modal",{ref:"modal",attrs:{name:"account",width:800,height:"unset",processing:e.processing},scopedSlots:e._u([{key:"outer",fn:function(){return[t("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[t("p",{staticClass:"text-3xl text-white truncate"},[e._v(e._s(e.title))])])]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"px-4 w-full text-sm py-6 rounded-lg bg-bg shadow-lg border border-black-300 overflow-y-auto overflow-x-hidden",staticStyle:{"min-height":"400px","max-height":"80vh"}},[t("div",{staticClass:"w-full p-8"},[t("div",{staticClass:"flex py-2"},[t("div",{staticClass:"w-1/2 px-2"},[t("ui-text-input-with-label",{attrs:{label:e.$strings.LabelUsername},model:{value:e.newUser.username,callback:function(t){e.$set(e.newUser,"username","string"==typeof t?t.trim():t)},expression:"newUser.username"}})],1),e._v(" "),t("div",{staticClass:"w-1/2 px-2"},[e.isEditingRoot?t("ui-text-input-with-label",{attrs:{label:e.$strings.LabelEmail},model:{value:e.newUser.email,callback:function(t){e.$set(e.newUser,"email","string"==typeof t?t.trim():t)},expression:"newUser.email"}}):t("ui-text-input-with-label",{attrs:{label:e.isNew?e.$strings.LabelPassword:e.$strings.LabelChangePassword,type:"password"},model:{value:e.newUser.password,callback:function(t){e.$set(e.newUser,"password",t)},expression:"newUser.password"}})],1)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isEditingRoot,expression:"!isEditingRoot"}],staticClass:"flex py-2"},[t("div",{staticClass:"w-1/2 px-2"},[t("ui-text-input-with-label",{attrs:{label:e.$strings.LabelEmail},model:{value:e.newUser.email,callback:function(t){e.$set(e.newUser,"email","string"==typeof t?t.trim():t)},expression:"newUser.email"}})],1),e._v(" "),t("div",{staticClass:"px-2 w-52"},[t("ui-dropdown",{attrs:{label:e.$strings.LabelAccountType,disabled:e.isEditingRoot,items:e.accountTypes,small:""},on:{input:e.userTypeUpdated},model:{value:e.newUser.type,callback:function(t){e.$set(e.newUser,"type",t)},expression:"newUser.type"}})],1),e._v(" "),t("div",{staticClass:"flex items-center pt-4 px-2"},[t("p",{staticClass:"px-3 font-semibold",class:e.isEditingRoot?"text-gray-300":"",attrs:{id:"user-enabled-toggle"}},[e._v(e._s(e.$strings.LabelEnable))]),e._v(" "),t("ui-toggle-switch",{attrs:{labeledBy:"user-enabled-toggle",disabled:e.isEditingRoot},model:{value:e.newUser.isActive,callback:function(t){e.$set(e.newUser,"isActive",t)},expression:"newUser.isActive"}})],1)]),e._v(" "),!e.isEditingRoot&&e.newUser.permissions?t("div",{staticClass:"w-full border-t border-b border-black-200 py-2 px-3 mt-4"},[t("p",{staticClass:"text-lg mb-2 font-semibold"},[e._v(e._s(e.$strings.HeaderPermissions))]),e._v(" "),t("div",{staticClass:"flex items-center my-2 max-w-md"},[t("div",{staticClass:"w-1/2"},[t("p",{attrs:{id:"download-permissions-toggle"}},[e._v(e._s(e.$strings.LabelPermissionsDownload))])]),e._v(" "),t("div",{staticClass:"w-1/2"},[t("ui-toggle-switch",{attrs:{labeledBy:"download-permissions-toggle"},model:{value:e.newUser.permissions.download,callback:function(t){e.$set(e.newUser.permissions,"download",t)},expression:"newUser.permissions.download"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center my-2 max-w-md"},[t("div",{staticClass:"w-1/2"},[t("p",{attrs:{id:"update-permissions-toggle"}},[e._v(e._s(e.$strings.LabelPermissionsUpdate))])]),e._v(" "),t("div",{staticClass:"w-1/2"},[t("ui-toggle-switch",{attrs:{labeledBy:"update-permissions-toggle"},model:{value:e.newUser.permissions.update,callback:function(t){e.$set(e.newUser.permissions,"update",t)},expression:"newUser.permissions.update"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center my-2 max-w-md"},[t("div",{staticClass:"w-1/2"},[t("p",{attrs:{id:"delete-permissions-toggle"}},[e._v(e._s(e.$strings.LabelPermissionsDelete))])]),e._v(" "),t("div",{staticClass:"w-1/2"},[t("ui-toggle-switch",{attrs:{labeledBy:"delete-permissions-toggle"},model:{value:e.newUser.permissions.delete,callback:function(t){e.$set(e.newUser.permissions,"delete",t)},expression:"newUser.permissions.delete"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center my-2 max-w-md"},[t("div",{staticClass:"w-1/2"},[t("p",{attrs:{id:"upload-permissions-toggle"}},[e._v(e._s(e.$strings.LabelPermissionsUpload))])]),e._v(" "),t("div",{staticClass:"w-1/2"},[t("ui-toggle-switch",{attrs:{labeledBy:"upload-permissions-toggle"},model:{value:e.newUser.permissions.upload,callback:function(t){e.$set(e.newUser.permissions,"upload",t)},expression:"newUser.permissions.upload"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center my-2 max-w-md"},[t("div",{staticClass:"w-1/2"},[t("p",{attrs:{id:"ereader-permissions-toggle"}},[e._v(e._s(e.$strings.LabelPermissionsCreateEreader))])]),e._v(" "),t("div",{staticClass:"w-1/2"},[t("ui-toggle-switch",{attrs:{labeledBy:"ereader-permissions-toggle"},model:{value:e.newUser.permissions.createEreader,callback:function(t){e.$set(e.newUser.permissions,"createEreader",t)},expression:"newUser.permissions.createEreader"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center my-2 max-w-md"},[t("div",{staticClass:"w-1/2"},[t("p",{attrs:{id:"explicit-content-permissions-toggle"}},[e._v(e._s(e.$strings.LabelPermissionsAccessExplicitContent))])]),e._v(" "),t("div",{staticClass:"w-1/2"},[t("ui-toggle-switch",{attrs:{labeledBy:"explicit-content-permissions-toggle"},model:{value:e.newUser.permissions.accessExplicitContent,callback:function(t){e.$set(e.newUser.permissions,"accessExplicitContent",t)},expression:"newUser.permissions.accessExplicitContent"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center my-2 max-w-md"},[t("div",{staticClass:"w-1/2"},[t("p",{attrs:{id:"access-all-libs--permissions-toggle"}},[e._v(e._s(e.$strings.LabelPermissionsAccessAllLibraries))])]),e._v(" "),t("div",{staticClass:"w-1/2"},[t("ui-toggle-switch",{attrs:{labeledBy:"access-all-libs--permissions-toggle"},on:{input:e.accessAllLibrariesToggled},model:{value:e.newUser.permissions.accessAllLibraries,callback:function(t){e.$set(e.newUser.permissions,"accessAllLibraries",t)},expression:"newUser.permissions.accessAllLibraries"}})],1)]),e._v(" "),e.newUser.permissions.accessAllLibraries?e._e():t("div",{staticClass:"my-4"},[t("ui-multi-select-dropdown",{attrs:{items:e.libraryItems,label:e.$strings.LabelLibrariesAccessibleToUser},model:{value:e.newUser.librariesAccessible,callback:function(t){e.$set(e.newUser,"librariesAccessible",t)},expression:"newUser.librariesAccessible"}})],1),e._v(" "),t("div",{staticClass:"flex items-cen~ter my-2 max-w-md"},[t("div",{staticClass:"w-1/2"},[t("p",[e._v(e._s(e.$strings.LabelPermissionsAccessAllTags))])]),e._v(" "),t("div",{staticClass:"w-1/2"},[t("ui-toggle-switch",{on:{input:e.accessAllTagsToggled},model:{value:e.newUser.permissions.accessAllTags,callback:function(t){e.$set(e.newUser.permissions,"accessAllTags",t)},expression:"newUser.permissions.accessAllTags"}})],1)]),e._v(" "),e.newUser.permissions.accessAllTags?e._e():t("div",{staticClass:"my-4"},[t("div",{staticClass:"flex items-center"},[t("ui-multi-select-dropdown",{attrs:{items:e.itemTags,label:e.tagsSelectionText},model:{value:e.newUser.itemTagsSelected,callback:function(t){e.$set(e.newUser,"itemTagsSelected",t)},expression:"newUser.itemTagsSelected"}}),e._v(" "),t("div",{staticClass:"flex items-center pt-4 px-2"},[t("p",{staticClass:"px-3 font-semibold",attrs:{id:"selected-tags-not-accessible--permissions-toggle"}},[e._v(e._s(e.$strings.LabelInvert))]),e._v(" "),t("ui-toggle-switch",{attrs:{labeledBy:"selected-tags-not-accessible--permissions-toggle"},model:{value:e.newUser.permissions.selectedTagsNotAccessible,callback:function(t){e.$set(e.newUser.permissions,"selectedTagsNotAccessible",t)},expression:"newUser.permissions.selectedTagsNotAccessible"}})],1)],1)])]):e._e(),e._v(" "),t("div",{staticClass:"flex pt-4 px-2"},[e.hasOpenIDLink?t("ui-btn",{staticClass:"mr-2",attrs:{small:"",loading:e.unlinkingFromOpenID,color:"bg-primary",type:"button"},on:{click:function(t){return t.stopPropagation(),e.unlinkOpenID.apply(null,arguments)}}},[e._v(e._s(e.$strings.ButtonUnlinkOpenId))]):e._e(),e._v(" "),e.isEditingRoot?t("ui-btn",{staticClass:"flex items-center",attrs:{small:"",to:"/account"}},[e._v(e._s(e.$strings.ButtonChangeRootPassword))]):e._e(),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[e._v(e._s(e.$strings.ButtonSubmit))])],1)])])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:n(121).default,UiDropdown:n(236).default,UiToggleSwitch:n(185).default,UiMultiSelectDropdown:n(676).default,UiBtn:n(42).default,ModalsModal:n(39).default})},642:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(183);var o=n(237),l=n(149);function c(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(o.a)(e)||Object(l.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},676:function(e,t,n){"use strict";n.r(t);n(41),n(52),n(17),n(26),n(33),n(27),n(8);var r={props:{value:{type:Array,default:function(){return[]}},items:{type:Array,default:function(){return[]}},label:String},data:function(){return{showMenu:!1,menu:null,clickOutsideObj:{handler:this.closeMenu,events:["mousedown"],isActive:!0}}},computed:{selected:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},selectedItems:function(){var e=this;return(this.value||[]).map((function(t){return e.items.find((function(i){return i.value===t}))||{text:t,value:t}}))}},methods:{recalcMenuPos:function(){if(this.menu&&this.$refs.inputWrapper){var e=this.$refs.inputWrapper.getBoundingClientRect();this.menu.style.top=e.y+e.height-4+"px",this.menu.style.left=e.x+"px",this.menu.style.width=e.width+"px"}},unmountMountMenu:function(){if(this.$refs.menu&&this.$refs.inputWrapper){this.menu=this.$refs.menu;var e=this.$refs.inputWrapper.getBoundingClientRect();this.menu.remove(),document.body.appendChild(this.menu),this.menu.style.top=e.y+e.height-4+"px",this.menu.style.left=e.x+"px",this.menu.style.width=e.width+"px"}},clickedOption:function(e,t){var n=this;e&&(e.stopPropagation(),e.preventDefault());var r=null;r=this.selected.includes(t.value)?this.selected.filter((function(s){return s!==t.value})):this.selected.concat([t.value]),this.$emit("input",r),this.$nextTick((function(){n.recalcMenuPos()}))},closeMenu:function(){this.showMenu=!1,this.removeListener()},clickWrapper:function(){this.showMenu=!this.showMenu,this.showMenu?this.setListener():this.removeListener()},removeItem:function(e){var t=this,n=this.selected.filter((function(i){return i!==e}));this.$emit("input",n),this.$nextTick((function(){t.recalcMenuPos()}))},scroll:function(){this.recalcMenuPos()},setListener:function(){document.addEventListener("scroll",this.scroll,!0)},removeListener:function(){document.removeEventListener("scroll",this.scroll,!0)}},mounted:function(){},beforeDestroy:function(){this.menu&&this.menu.remove()}},o=n(4),component=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.clickOutsideObj,expression:"clickOutsideObj"}],staticClass:"w-full"},[t("p",{staticClass:"px-1 text-sm font-semibold"},[e._v(e._s(e.label))]),e._v(" "),t("div",{ref:"wrapper",staticClass:"relative"},[t("div",{ref:"inputWrapper",staticClass:"flex-wrap relative w-full shadow-xs flex items-center bg-primary border border-gray-600 rounded-md px-2 py-1 cursor-pointer",staticStyle:{"min-height":"40px"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.clickWrapper.apply(null,arguments)},mouseup:function(e){e.stopPropagation(),e.preventDefault()},mousedown:function(e){e.preventDefault()}}},e._l(e.selectedItems,(function(n){return t("div",{key:n.value,staticClass:"rounded-full px-2 py-1 ma-0.5 text-xs bg-bg flex flex-nowrap whitespace-nowrap items-center relative"},[t("div",{staticClass:"w-full h-full rounded-full absolute top-0 left-0 opacity-0 hover:opacity-100 px-1 bg-bg/75 flex items-center justify-end cursor-pointer"},[t("span",{staticClass:"material-symbols text-white hover:text-error",staticStyle:{"font-size":"1.1rem"},on:{click:function(t){return t.stopPropagation(),e.removeItem(n.value)}}},[e._v("close")])]),e._v("\n        "+e._s(n.text)+"\n      ")])})),0),e._v(" "),t("transition",{attrs:{name:"menu"}},[t("ul",{directives:[{name:"show",rawName:"v-show",value:e.showMenu,expression:"showMenu"}],ref:"menu",staticClass:"absolute z-60 -mt-px w-full bg-primary border border-black-200 shadow-lg max-h-56 rounded-md py-1 text-base ring-1 ring-black/5 overflow-auto focus:outline-hidden sm:text-sm",attrs:{role:"listbox","aria-labelledby":"listbox-label"}},[e._l(e.items,(function(n){return[t("li",{key:n.value,staticClass:"text-gray-50 select-none relative py-2 pr-9 cursor-pointer hover:bg-black-400",attrs:{role:"option"},on:{click:function(t){return e.clickedOption(t,n)},mouseup:function(e){e.stopPropagation(),e.preventDefault()},mousedown:function(e){e.preventDefault()}}},[t("p",{staticClass:"font-normal ml-3 block truncate"},[e._v(e._s(n.text))]),e._v(" "),e.selected.includes(n.value)?t("div",{staticClass:"text-yellow-400 absolute inset-y-0 right-0 my-auto w-5 h-5 mr-3 overflow-hidden"},[t("span",{staticClass:"material-symbols text-xl"},[e._v("check")])]):e._e()])]})),e._v(" "),e.items.length?e._e():t("li",{staticClass:"text-gray-50 select-none relative py-2 pr-9",attrs:{role:"option"}},[t("div",{staticClass:"flex items-center justify-center"},[t("span",{staticClass:"font-normal"},[e._v(e._s(e.$strings.MessageNoItems))])])])],2)])],1)])}),[],!1,null,null,null);t.default=component.exports}}]);