(window.webpackJsonp=window.webpackJsonp||[]).push([[179,59],{1051:function(e,t,r){"use strict";r.r(t);r(35),r(122),r(22),r(44),r(45),r(38),r(28);var n=r(7),o=r(16);r(29),r(26),r(41),r(57),r(14),r(8),r(52),r(147),r(40);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={asyncData:function(e){var t=e.store,r=e.redirect;t.getters["user/getIsAdminOrUp"]||r("/")},data:function(){return{search:null,searchTimeout:null,searchText:null,newServerSettings:{},textColors:["text-yellow-200","text-gray-400","text-info","text-warning","text-error","text-red-800","text-blue-400"],bgColors:["bg-yellow-200/10","bg-gray-400/10","bg-info/10","bg-warning/10","bg-error/10","bg-red-800/10","bg-blue-400/10"],loadedLogs:[]}},watch:{serverSettings:function(e,t){e&&!t&&(this.newServerSettings=c({},this.serverSettings))},logs:function(){this.updateScroll()}},computed:{logLevels:function(){return[{value:1,text:this.$strings.LabelLogLevelDebug},{value:2,text:this.$strings.LabelLogLevelInfo},{value:3,text:this.$strings.LabelLogLevelWarn}]},logLevelItems:function(){return this.logLevels},logs:function(){var e=this;return this.loadedLogs.filter((function(t){return t.level>=e.newServerSettings.logLevel&&(!e.searchText||t.message.toLowerCase().includes(e.searchText))}))},serverSettings:function(){return this.$store.state.serverSettings},streamLibraryItem:function(){return this.$store.state.streamLibraryItem}},methods:{inputUpdate:function(){var e=this;clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((function(){e.search&&e.search.trim()?e.searchText=e.search.toLowerCase().trim():e.searchText=""}),500)},updateScroll:function(){this.$refs.container&&(this.$refs.container.scrollTop=this.$refs.container.scrollHeight-this.$refs.container.clientHeight)},logLevelUpdated:function(e){var t={logLevel:Number(e)};this.updateServerSettings(t),this.$root.socket.emit("set_log_listener",this.newServerSettings.logLevel),this.$nextTick(this.updateScroll)},updateServerSettings:function(e){this.$store.dispatch("updateServerSettings",e).then((function(e){console.log("Updated Server Settings",e)})).catch((function(e){console.error("Failed to update server settings",e)}))},logEvtReceived:function(e){this.loadedLogs.push(e),this.loadedLogs.length>5050&&(this.loadedLogs=this.loadedLogs.slice(-5e3))},loadLoggerData:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.$get("/api/logger-data").catch((function(t){console.error("Failed to load logger data",t),e.$toast.error(e.$strings.ToastFailedToLoadData)}));case 2:r=t.sent,e.loadedLogs=(null==r?void 0:r.currentDailyLogs)||[];case 4:case"end":return t.stop()}}),t)})))()},init:function(){var e=arguments,t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.length>0&&void 0!==e[0]?e[0]:0,t.$root.socket){r.next=6;break}if(!(n>10)){r.next=4;break}return r.abrupt("return",console.error("Failed to setup socket listeners"));case 4:return setTimeout((function(){t.init(++n)}),250),r.abrupt("return");case 6:return r.next=8,t.loadLoggerData();case 8:t.newServerSettings=t.serverSettings?c({},t.serverSettings):{},t.$root.socket.on("log",t.logEvtReceived),t.$root.socket.emit("set_log_listener",t.newServerSettings.logLevel);case 11:case"end":return r.stop()}}),r)})))()}},updated:function(){this.$nextTick(this.updateScroll)},mounted:function(){this.init()},beforeDestroy:function(){this.$root.socket&&(this.$root.socket.emit("remove_log_listener"),this.$root.socket.off("log",this.logEvtReceived))}},f=d,v=(r(901),r(4)),component=Object(v.a)(f,(function(){var e=this,t=e._self._c;return t("div",[t("app-settings-content",{attrs:{"header-text":e.$strings.HeaderLogs,description:e.$strings.MessageLogsDescription},scopedSlots:e._u([{key:"header-items",fn:function(){return[t("ui-tooltip",{staticClass:"inline-flex ml-2",attrs:{text:e.$strings.LabelClickForMoreInfo}},[t("a",{staticClass:"inline-flex",attrs:{href:"https://www.audiobookshelf.org/guides/server_logs",target:"_blank"}},[t("span",{staticClass:"material-symbols text-xl w-5 text-gray-200"},[e._v("help_outline")])])])]},proxy:!0}])},[e._v(" "),t("div",{staticClass:"flex justify-between mb-2 place-items-end"},[t("ui-text-input",{ref:"input",staticClass:"w-full sm:w-40 h-8 text-sm sm:mb-0",attrs:{placeholder:e.$strings.PlaceholderSearch,clearable:""},on:{input:e.inputUpdate},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),t("ui-dropdown",{staticClass:"w-full sm:w-44",attrs:{label:e.$strings.LabelServerLogLevel,items:e.logLevelItems},on:{input:e.logLevelUpdated},model:{value:e.newServerSettings.logLevel,callback:function(t){e.$set(e.newServerSettings,"logLevel",t)},expression:"newServerSettings.logLevel"}})],1),e._v(" "),t("div",{staticClass:"relative"},[t("div",{ref:"container",staticClass:"relative w-full h-full bg-primary border-bg overflow-x-hidden overflow-y-auto text-red shadow-inner rounded-md",staticStyle:{"min-height":"550px"},attrs:{id:"log-container"}},[e._l(e.logs,(function(r,n){return[t("div",{key:n,staticClass:"flex flex-nowrap px-2 py-1 items-start text-sm",class:"".concat(e.bgColors[r.level])},[t("p",{staticClass:"text-gray-400 w-36 font-mono text-xs"},[e._v(e._s(r.timestamp))]),e._v(" "),t("p",{staticClass:"font-semibold w-12 text-right text-sm",class:"".concat(e.textColors[r.level])},[e._v(e._s(r.levelName))]),e._v(" "),t("p",{staticClass:"px-4 logmessage"},[e._v(e._s(r.message))])])]}))],2),e._v(" "),e.logs.length?e._e():t("div",{staticClass:"absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center text-center"},[t("p",{staticClass:"text-xl text-gray-200 mb-2"},[e._v(e._s(e.$strings.MessageNoLogs))])])])])],1)}),[],!1,null,"d743f010",null);t.default=component.exports;installComponents(component,{UiTooltip:r(76).default,UiTextInput:r(68).default,UiDropdown:r(236).default,AppSettingsContent:r(652).default})},646:function(e,t,r){var content=r(648);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("6d988fa2",content,!0,{sourceMap:!1})},647:function(e,t,r){"use strict";r(646)},648:function(e,t,r){var n=r(18)((function(i){return i[1]}));n.push([e.i,"\n#settings-description a {\n  color: rgb(96 165 250);\n}\n#settings-description a:hover {\n  color: rgb(147 197 253);\n  text-decoration-line: underline;\n}\n#settings-description code {\n  font-size: 0.875rem;\n  border-radius: 6px;\n  background-color: rgb(82, 82, 82);\n  color: white;\n  padding: 2px 4px;\n}\n",""]),n.locals={},e.exports=n},652:function(e,t,r){"use strict";r.r(t);r(22),r(43);var n={props:{headerText:String,description:String,note:String},methods:{}},o=(r(647),r(4)),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg-bg rounded-md shadow-lg border border-white/5 p-2 sm:p-4 mb-8"},[t("div",{staticClass:"flex items-center mb-2"},[e._t("header-prefix"),e._v(" "),t("h1",{staticClass:"text-xl"},[e._v(e._s(e.headerText))]),e._v(" "),e._t("header-items")],2),e._v(" "),e.description?t("p",{staticClass:"mb-6 text-gray-200",attrs:{id:"settings-description"},domProps:{innerHTML:e._s(e.description)}}):e._e(),e._v(" "),e._t("default")],2)}),[],!1,null,null,null);t.default=component.exports},797:function(e,t,r){var content=r(902);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("44cd8d0a",content,!0,{sourceMap:!1})},901:function(e,t,r){"use strict";r(797)},902:function(e,t,r){var n=r(18)((function(i){return i[1]}));n.push([e.i,"\n#log-container[data-v-d743f010] {\n  height: calc(100vh - 285px);\n}\n.logmessage[data-v-d743f010] {\n  width: calc(100% - 208px);\n}\n",""]),n.locals={},e.exports=n}}]);