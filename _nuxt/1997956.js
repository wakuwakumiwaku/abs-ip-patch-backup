(window.webpackJsonp=window.webpackJsonp||[]).push([[202,57,63,137,149],{1039:function(e,t,r){"use strict";r.r(t);r(56);var n=r(7),o=(r(29),r(22),r(43),r(84),r(17),r(26),r(33),r(83),r(27),r(57),r(15),r(8),r(351),r(35),r(59),r(62),r(28),r(58),r(40),r(188)),l=r.n(o),c=r(16);r(41),r(44),r(45),r(38),r(52),r(77);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){Object(c.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,a){if(e){if("string"==typeof e)return m(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?m(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,l=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw l}}}}function m(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,r=Array(a);t<a;t++)r[t]=e[t];return r}var v={data:function(){return{uploadHelpers:{getItemsFromDrop:this.getItemsFromDataTransferItems,getItemsFromPicker:this.getItemsFromFilelist}}},methods:{checkFileType:function(e){var t=l.a.extname(e);if(!t)return!1;for(var r in t.startsWith(".")&&(t=t.slice(1)),t=t.toLowerCase(),this.$constants.SupportedFileTypes)if(this.$constants.SupportedFileTypes[r].includes(t))return r;return!1},filterItemFiles:function(e,t){var r=[],n=[],o=[];return e.forEach((function(e){e.filetype?"audio"===e.filetype||"ebook"===e.filetype&&"book"===t?r.push(e):n.push(e):o.push(e)})),{itemFiles:r,otherFiles:n,ignoredFiles:o}},itemFromTreeItems:function(e,t){var r=this.filterItemFiles(e,t),n=r.itemFiles,o=r.otherFiles,l=r.ignoredFiles;return n.length||(l=l.concat(o),o=[]),[{itemFiles:n,otherFiles:o,ignoredFiles:l}]},traverseForItem:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e.items.some((function(e){return e.isDirectory}))){var o=[];return e.items.forEach((function(e){if(e.isDirectory){var l=r.traverseForItem(e,t,++n);o=o.concat(l)}})),o}return this.itemFromTreeItems(e.items,t)},fileTreeToItems:function(e,t){if(e.some((function(e){return e.isDirectory}))){var r=e.filter((function(e){return!e.isDirectory}));return r.length&&(e=e.filter((function(e){return e.isDirectory}))),{items:this.traverseForItem({items:e},t),ignoredFiles:r}}return e.some((function(e){return"audio"!==e.filetype}))||"book"!==t?{items:this.itemFromTreeItems(e,t),ignoredFiles:[]}:{items:e.map((function(e){return{itemFiles:[e],otherFiles:[],ignoredFiles:[]}})),ignoredFiles:[]}},getFilesDropped:function(e){var t=this,r={path:"/",items:[]};function n(e,t,r){return new Promise((function(o){if(e.isFile)e.file((function(e){e.filepath=t.path+e.name,e.filetype=r(e.name),t.items.push(e),o(e)}));else if(e.isDirectory){var l=function(){c.readEntries((function(e){if(e.length>0){var t,c=h(e);try{for(c.s();!(t=c.n()).done;){var m=t.value;f.push(n(m,d,r))}}catch(e){c.e(e)}finally{c.f()}l()}else o(Promise.all(f))}))},c=e.createReader();t.items.push({isDirectory:!0,dirname:e.name,path:t.path+e.name+"/",items:[]});var d=t.items[t.items.length-1],f=[];l()}}))}return new Promise((function(o,l){var c,d=[],f=h(e);try{for(f.s();!(c=f.n()).done;){var m=n(c.value.webkitGetAsEntry(),r,t.checkFileType);d.push(m)}}catch(e){f.e(e)}finally{f.f()}Promise.all(d).then((function(){o(r.items)}))}))},cleanBook:function(e,t){var r=f({index:t,title:"",author:"",series:""},e),n=e.itemFiles[0];if(!n.filepath)return r;var o=l.a.dirname(n.filepath).split("/").filter((function(e){return!!e&&"."!==e}));return o.length?(r.title=o.pop(),o.length>1&&(r.series=o.pop()),o.length&&(r.author=o.pop())):r.title=l.a.basename(n.name,l.a.extname(n.name)),r},cleanPodcast:function(e,t){var r=f({index:t,title:""},e),n=r.itemFiles[0];if(!n.filepath)return r;var o=l.a.dirname(n.filepath).split("/").filter((function(e){return!!e&&"."!==e}));return o.length?r.title=o.length>1?o[1]:o[0]:r.title=l.a.basename(n.name,l.a.extname(n.name)),r},cleanItem:function(e,t,r){return"podcast"===t?this.cleanPodcast(e,r):this.cleanBook(e,r)},getItemsFromDataTransferItems:function(e,t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o,l,c,d,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.getFilesDropped(e);case 2:if((o=n.sent)&&o.length){n.next=5;break}return n.abrupt("return",{error:"No files found "});case 5:if((l=r.fileTreeToItems(o,t)).items.length||l.ignoredFiles.length){n.next=8;break}return n.abrupt("return",{error:"Invalid file drop"});case 8:return c=l.ignoredFiles,d=1,f=l.items.filter((function(e){return e.itemFiles.length||(e.otherFiles.length&&(c=c.concat(e.otherFiles)),e.ignoredFiles.length&&(c=c.concat(e.ignoredFiles))),e.itemFiles.length})).map((function(e){return r.cleanItem(e,t,d++)})),n.abrupt("return",{items:f,ignoredFiles:c});case 12:case"end":return n.stop()}}),n)})))()},getItemsFromFilelist:function(e,t){var r=this,n=[],o=[],c={};e.forEach((function(e){var d=r.checkFileType(e.name);if(d)if(e.filetype=d,e.webkitRelativePath?e.filepath=e.webkitRelativePath:e.filepath=e.name,"audio"===d||"ebook"===d&&"book"===t){var f=e.filepath?l.a.dirname(e.filepath):"";"."===f&&(f=""),c[f]||(c[f]={path:f,ignoredFiles:[],itemFiles:[],otherFiles:[]}),c[f].itemFiles.push(e)}else o.push(e);else n.push(e)})),o.forEach((function(e){var t=l.a.dirname(e.filepath),r=Object.values(c).find((function(b){return t.startsWith(b.path)}));r?r.otherFiles.push(e):n.push(e)}));var d=1;return{items:!c[""]||o.length||"book"!==t||c[""].itemFiles.some((function(e){return"audio"!==e.filetype}))?Object.values(c).map((function(i){return r.cleanItem(i,t,d++)})):c[""].itemFiles.map((function(e){return r.cleanItem({itemFiles:[e],otherFiles:[],ignoredFiles:[]},t,d++)})),ignoredFiles:n}}}};function y(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,a){if(e){if("string"==typeof e)return x(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?x(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,l=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw l}}}}function x(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,r=Array(a);t<a;t++)r[t]=e[t];return r}var F={mixins:[v],data:function(){return{isDragging:!1,error:"",items:[],ignoredFiles:[],selectedLibraryId:null,selectedFolderId:null,processing:!1,uploadFinished:!1,fetchMetadata:{enabled:!1,provider:null}}},watch:{selectedLibrary:function(e){e&&!this.selectedFolderId&&(this.setDefaultFolder(),this.setMetadataProvider())}},computed:{inputAccept:function(){var e=[];return Object.values(this.$constants.SupportedFileTypes).forEach((function(t){e=e.concat(t.map((function(e){return".".concat(e)})))})),e},isIOS:function(){var e=window.navigator.userAgent;return/iPad|iPhone|iPod/.test(e)&&!window.MSStream},streamLibraryItem:function(){return this.$store.state.streamLibraryItem},libraries:function(){return this.$store.state.libraries.libraries},libraryItems:function(){return this.libraries.map((function(e){return{value:e.id,text:e.name}}))},selectedLibrary:function(){var e=this;return this.libraries.find((function(t){return t.id===e.selectedLibraryId}))},selectedLibraryMediaType:function(){return this.selectedLibrary?this.selectedLibrary.mediaType:null},selectedLibraryIsPodcast:function(){return"podcast"===this.selectedLibraryMediaType},providers:function(){return this.selectedLibraryIsPodcast?this.$store.state.scanners.podcastProviders:this.$store.state.scanners.bookProviders},canFetchMetadata:function(){return!this.selectedLibraryIsPodcast&&this.fetchMetadata.enabled},selectedFolder:function(){var e=this;return this.selectedLibrary?this.selectedLibrary.folders.find((function(t){return t.id===e.selectedFolderId})):null},folderItems:function(){return this.selectedLibrary?this.selectedLibrary.folders.map((function(e){return{value:e.id,text:e.fullPath}})):[]},uploadReady:function(){return!this.items.length&&!this.ignoredFiles.length&&!this.uploadFinished}},methods:{libraryChanged:function(){var e=this;!this.selectedLibrary&&this.selectedFolderId?this.selectedFolderId=null:this.selectedFolderId&&(this.selectedLibrary.folders.find((function(t){return t.id===e.selectedFolderId}))||(this.selectedFolderId=null)),this.setDefaultFolder(),this.setMetadataProvider()},setDefaultFolder:function(){!this.selectedFolderId&&this.selectedLibrary&&this.selectedLibrary.folders.length&&(this.selectedFolderId=this.selectedLibrary.folders[0].id)},setMetadataProvider:function(){var e;(e=this.fetchMetadata).provider||(e.provider=this.$store.getters["libraries/getLibraryProvider"](this.selectedLibraryId))},removeItem:function(e){this.items=this.items.filter((function(b){return b.index!==e.index})),this.items.length||this.reset()},reset:function(){this.error="",this.items=[],this.ignoredFiles=[],this.uploadFinished=!1,this.$refs.fileInput&&(this.$refs.fileInput.value=""),this.$refs.fileFolderInput&&(this.$refs.fileFolderInput.value="")},openFilePicker:function(){this.$refs.fileInput&&this.$refs.fileInput.click()},openFolderPicker:function(){this.$refs.fileFolderInput&&this.$refs.fileFolderInput.click()},isDraggingFile:function(e){var dt=e.dataTransfer||{};return dt.types&&dt.types.indexOf("Files")>=0},dragenter:function(e){e.preventDefault(),this.uploadReady&&this.isDraggingFile(e)&&!this.isDragging&&(this.isDragging=!0)},dragleave:function(e){e.preventDefault(),!e.fromElement&&this.isDragging&&(this.isDragging=!1)},dragover:function(e){e.preventDefault()},drop:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.preventDefault(),t.isDragging=!1,n=e.dataTransfer.items||[],r.next=5,t.uploadHelpers.getItemsFromDrop(n,t.selectedLibraryMediaType);case 5:o=r.sent,t.onItemsSelected(o);case 7:case"end":return r.stop()}}),r)})))()},inputChanged:function(e){if(e.target&&e.target.files){var t=Array.from(e.target.files);if(t&&t.length){var r=this.uploadHelpers.getItemsFromPicker(t,this.selectedLibraryMediaType);this.onItemsSelected(r)}}},onItemsSelected:function(e){this.itemSelectionSuccessful(e)&&setTimeout(this.attemptMetadataFetch,0)},itemSelectionSuccessful:function(e){return console.log("Upload results",e),e.error?(this.error=e.error,this.items=[],this.ignoredFiles=[],!1):(this.error="",this.items=e.items,this.ignoredFiles=e.ignoredFiles,!0)},attemptMetadataFetch:function(){var e=this;if(!this.canFetchMetadata)return!1;this.items.forEach((function(t){var r=e.$refs["itemCard-".concat(t.index)];null!=r&&r.length&&r[0].fetchMetadata(e.fetchMetadata.provider)}))},updateItemCardStatus:function(e,t){var r=this.$refs["itemCard-".concat(e)];r&&r.length&&(r=r[0]),r?r.setUploadStatus(t):console.error("Book card ref not found",e,this.$refs)},updateItemCardProgress:function(e,progress){var t=this.$refs["itemCard-".concat(e)];t&&t.length&&(t=t[0]),t?t.setUploadProgress(progress):console.error("Book card ref not found",e,this.$refs)},uploadItem:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var form,n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(form=new FormData).set("title",e.title),t.selectedLibraryIsPodcast||(form.set("author",e.author||""),form.set("series",e.series||"")),form.set("library",t.selectedLibraryId),form.set("folder",t.selectedFolderId),n=0,e.files.forEach((function(e){form.set("".concat(n++),e)})),o={onUploadProgress:function(r){if(r.lengthComputable){var progress={loaded:r.loaded,total:r.total};t.updateItemCardProgress(e.index,progress)}}},r.abrupt("return",t.$axios.$post("/api/upload",form,o).then((function(){return!0})).catch((function(e){var r;return console.error("Failed to upload item",e),t.$toast.error((null===(r=e.response)||void 0===r?void 0:r.data)||"Oops, something went wrong..."),!1})));case 9:case"end":return r.stop()}}),r)})))()},validateItems:function(){var e,t=[],r=y(this.items);try{for(r.s();!(e=r.n()).done;){var n=e.value,o=this.$refs["itemCard-".concat(n.index)];if(o&&o.length&&(o=o[0]),!o)return console.error("Invalid item index no ref",n.index,this.$refs.itemCard),!1;var data=o.getData();if(!data)return!1;t.push(data)}}catch(e){r.e(e)}finally{r.f()}return t},submit:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,d,f,h,m,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.selectedFolderId&&e.selectedLibraryId){t.next=4;break}return e.$toast.error("Must select library and folder"),document.getElementById("page-wrapper").scroll({top:0,left:0,behavior:"smooth"}),t.abrupt("return");case 4:if(r=e.validateItems()){t.next=8;break}return e.$toast.error("Some invalid items"),t.abrupt("return");case 8:e.processing=!0,n=[],o=y(r),t.prev=11,d=regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=c.value,t.next=3,e.$axios.$post("/api/filesystem/pathexists",{directory:r.directory,folderPath:e.selectedFolder.fullPath}).then((function(data){return data.exists&&(data.libraryItemTitle?e.$toast.error(e.$getString("ToastUploaderItemExistsInSubdirectoryError",[data.libraryItemTitle])):e.$toast.error(e.$getString("ToastUploaderFilepathExistsError",[l.a.join(e.selectedFolder.fullPath,r.directory)]))),data.exists})).catch((function(e){return console.error("Failed to check if filepath exists",e),!1}));case 3:t.sent||n.push(r);case 5:case"end":return t.stop()}}),t)})),o.s();case 14:if((c=o.n()).done){t.next=18;break}return t.delegateYield(d(),"t0",16);case 16:t.next=14;break;case 18:t.next=23;break;case 20:t.prev=20,t.t1=t.catch(11),o.e(t.t1);case 23:return t.prev=23,o.f(),t.finish(23);case 26:f=0,h=n;case 27:if(!(f<h.length)){t.next=37;break}return m=h[f],e.updateItemCardStatus(m.index,"uploading"),t.next=32,e.uploadItem(m);case 32:v=t.sent,e.updateItemCardStatus(m.index,v?"success":"failed");case 34:f++,t.next=27;break;case 37:e.processing=!1,e.uploadFinished=!0;case 39:case"end":return t.stop()}}),t,null,[[11,20,23,26]])})))()}},mounted:function(){this.selectedLibraryId=this.$store.state.libraries.currentLibraryId,this.setMetadataProvider(),this.setDefaultFolder(),this.$store.dispatch("scanners/fetchProviders"),window.addEventListener("dragenter",this.dragenter),window.addEventListener("dragleave",this.dragleave),window.addEventListener("dragover",this.dragover),window.addEventListener("drop",this.drop)},beforeDestroy:function(){window.removeEventListener("dragenter",this.dragenter),window.removeEventListener("dragleave",this.dragleave),window.removeEventListener("dragover",this.dragover),window.removeEventListener("drop",this.drop)}},w=r(4),component=Object(w.a)(F,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"page p-1 sm:p-6 overflow-y-auto",class:e.streamLibraryItem?"streaming":"",attrs:{id:"page-wrapper"}},[t("div",{staticClass:"w-full max-w-6xl mx-auto"},[t("div",{staticClass:"flex flex-wrap my-6 md:-mx-2"},[t("div",{staticClass:"w-full md:w-1/5 px-2"},[t("ui-dropdown",{attrs:{items:e.libraryItems,label:e.$strings.LabelLibrary,disabled:!!e.items.length},on:{input:e.libraryChanged},model:{value:e.selectedLibraryId,callback:function(t){e.selectedLibraryId=t},expression:"selectedLibraryId"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-3/5 px-2"},[t("ui-dropdown",{attrs:{items:e.folderItems,disabled:!e.selectedLibraryId||!!e.items.length,label:e.$strings.LabelFolder},model:{value:e.selectedFolderId,callback:function(t){e.selectedFolderId=t},expression:"selectedFolderId"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/5 px-2"},[t("ui-text-input-with-label",{attrs:{value:e.selectedLibraryMediaType,readonly:"",label:e.$strings.LabelMediaType}})],1)]),e._v(" "),e.selectedLibraryIsPodcast?e._e():t("div",{staticClass:"flex items-center mb-6 px-2 md:px-0"},[t("label",{staticClass:"flex cursor-pointer pt-4"},[t("ui-toggle-switch",{staticClass:"inline-flex",model:{value:e.fetchMetadata.enabled,callback:function(t){e.$set(e.fetchMetadata,"enabled",t)},expression:"fetchMetadata.enabled"}}),e._v(" "),t("span",{staticClass:"pl-2 text-base"},[e._v(e._s(e.$strings.LabelAutoFetchMetadata))])],1),e._v(" "),t("ui-tooltip",{staticClass:"inline-flex pt-4",attrs:{text:e.$strings.LabelAutoFetchMetadataHelp}},[t("span",{staticClass:"pl-1 material-symbols icon-text text-sm cursor-pointer"},[e._v("info")])]),e._v(" "),t("div",{staticClass:"grow ml-4"},[t("ui-dropdown",{attrs:{items:e.providers,label:e.$strings.LabelProvider},model:{value:e.fetchMetadata.provider,callback:function(t){e.$set(e.fetchMetadata,"provider",t)},expression:"fetchMetadata.provider"}})],1)],1),e._v(" "),e.error?t("widgets-alert",{attrs:{type:"error"}},[t("p",{staticClass:"text-lg"},[e._v(e._s(e.error))])]):e._e(),e._v(" "),e.items.length||e.ignoredFiles.length?t("div",{staticClass:"w-full flex items-center pb-4 border-b border-white/10"},[t("p",{staticClass:"text-lg lowercase"},[e._v(e._s(1===e.items.length?"1 ".concat(e.$strings.LabelItem):e.$getString("LabelXItems",[e.items.length])))]),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{disabled:e.processing,small:""},on:{click:e.reset}},[e._v(e._s(e.$strings.ButtonReset))])],1):t("div",{staticClass:"w-full mx-auto border border-white/20 px-4 md:px-12 pt-12 pb-4 my-12 relative",class:e.isDragging?"bg-primary/40":"border-dashed"},[t("p",{staticClass:"text-2xl text-center"},[e._v(e._s(e.isDragging?e.$strings.LabelUploaderDropFiles:e.isIOS?e.$strings.LabelUploaderDragAndDropFilesOnly:e.$strings.LabelUploaderDragAndDrop))]),e._v(" "),t("p",{staticClass:"text-center text-sm my-5"},[e._v(e._s(e.$strings.MessageOr))]),e._v(" "),t("div",{staticClass:"w-full max-w-xl mx-auto"},[t("div",{staticClass:"flex"},[t("ui-btn",{staticClass:"w-full mx-1",on:{click:e.openFilePicker}},[e._v(e._s(e.$strings.ButtonChooseFiles))]),e._v(" "),e.isIOS?e._e():t("ui-btn",{staticClass:"w-full mx-1",on:{click:e.openFolderPicker}},[e._v(e._s(e.$strings.ButtonChooseAFolder)+" ")])],1)]),e._v(" "),t("div",{staticClass:"pt-8 text-center"},[t("p",{staticClass:"text-xs text-white/50 font-mono mb-4"},[t("strong",[e._v(e._s(e.$strings.LabelSupportedFileTypes)+": ")]),e._v(e._s(e.inputAccept.join(", "))+"\n        ")]),e._v(" "),t("p",{staticClass:"text-sm text-white/70"},[e.isIOS?e._e():t("span",[e._v(e._s(e.$strings.NoteUploaderFoldersWithMediaFiles))]),e._v(" "),"book"===e.selectedLibraryMediaType?t("span",[e._v(e._s(e.$strings.NoteUploaderOnlyAudioFiles))]):e._e()])])]),e._v(" "),e.items.length||e.uploadReady?e._e():t("widgets-alert",{staticClass:"my-4",attrs:{type:"error"}},[t("p",{staticClass:"text-lg"},[e._v(e._s(e.$strings.MessageNoItemsFound))])]),e._v(" "),e.ignoredFiles.length?t("widgets-alert",{staticClass:"my-4",attrs:{type:"warning"}},[t("div",{staticClass:"w-full pr-12"},[t("p",{staticClass:"text-base mb-1"},[e._v(e._s(e.$strings.NoteUploaderUnsupportedFiles))]),e._v(" "),t("tables-uploaded-files-table",{staticClass:"text-white",attrs:{files:e.ignoredFiles,title:e.$strings.HeaderIgnoredFiles}}),e._v(" "),t("p",{staticClass:"text-xs text-white/50 font-mono pt-1"},[t("strong",[e._v(e._s(e.$strings.LabelSupportedFileTypes)+": ")]),e._v(e._s(e.inputAccept.join(", "))+"\n        ")])],1)]):e._e(),e._v(" "),e._l(e.items,(function(r){return t("cards-item-upload-card",{key:r.index,ref:"itemCard-".concat(r.index),refInFor:!0,attrs:{"media-type":e.selectedLibraryMediaType,item:r,provider:e.fetchMetadata.provider,processing:e.processing},on:{remove:function(t){return e.removeItem(r)}}})})),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.items.length,expression:"items.length"}],staticClass:"flex justify-end pb-8 pt-4"},[e.uploadFinished?t("ui-btn",{on:{click:e.reset}},[e._v(e._s(e.$strings.ButtonReset))]):t("ui-btn",{attrs:{color:"bg-success",loading:e.processing},on:{click:e.submit}},[e._v(e._s(e.$strings.ButtonUpload))])],1)],2),e._v(" "),t("input",{ref:"fileInput",staticClass:"hidden",attrs:{type:"file",multiple:"",accept:e.isIOS?"":e.inputAccept},on:{change:e.inputChanged}}),e._v(" "),e.isIOS?e._e():t("input",{ref:"fileFolderInput",staticClass:"hidden",attrs:{type:"file",webkitdirectory:"",multiple:"",accept:e.inputAccept},on:{change:e.inputChanged}})])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiDropdown:r(236).default,UiTextInputWithLabel:r(121).default,UiToggleSwitch:r(185).default,UiTooltip:r(76).default,WidgetsAlert:r(657).default,UiBtn:r(42).default,TablesUploadedFilesTable:r(727).default,CardsItemUploadCard:r(853).default})},642:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(183);var o=r(237),l=r(149);function c(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||Object(o.a)(e)||Object(l.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},657:function(e,t,r){"use strict";r.r(t);var n={props:{type:{type:String,default:"error"}},data:function(){return{}},computed:{icon:function(){return"error"===this.type||"warning"===this.type?"report":"info"},wrapperClass:function(){switch(this.type){case"error":return"bg-error/5 border-error/60 text-error";case"warning":return"bg-warning/5 border-warning/60 text-warning";case"success":return"bg-success/5 border-success/60 text-success";case"info":return"bg-info/5 border-info/60 text-info";default:return"bg-primary/5 border-primary/60 text-primary"}}},methods:{},mounted:function(){}},o=r(4),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"w-full border rounded-lg flex items-center relative py-4 pl-16",class:e.wrapperClass},[t("div",{staticClass:"absolute top-0 left-4 h-full flex items-center"},[t("span",{staticClass:"material-symbols text-2xl"},[e._v(e._s(e.icon))])]),e._v(" "),e._t("default")],2)}),[],!1,null,null,null);t.default=component.exports},727:function(e,t,r){"use strict";r.r(t);r(15);var n={props:{title:String,files:{type:Array,default:function(){return[]}}},data:function(){return{expand:!1}},computed:{},methods:{clickBar:function(){this.expand=!this.expand}},mounted:function(){}},o=r(4),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"w-full my-4"},[t("div",{staticClass:"w-full bg-primary px-6 py-1 flex items-center cursor-pointer",on:{click:function(t){return t.stopPropagation(),e.clickBar.apply(null,arguments)}}},[t("p",{staticClass:"pr-4"},[e._v(e._s(e.title))]),e._v(" "),t("span",{staticClass:"bg-black-400 rounded-xl py-0.5 px-2 text-sm font-mono"},[e._v(e._s(e.files.length))]),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("div",{staticClass:"cursor-pointer h-9 w-9 rounded-full hover:bg-black-400 flex justify-center items-center duration-500",class:e.expand?"transform rotate-180":""},[t("span",{staticClass:"material-symbols text-3xl"},[e._v("expand_more")])])]),e._v(" "),t("transition",{attrs:{name:"slide"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expand,expression:"expand"}],staticClass:"w-full"},[t("table",{staticClass:"text-sm tracksTable"},[t("tr",[t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelFilename))]),e._v(" "),t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelSize))]),e._v(" "),t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelType))])]),e._v(" "),e._l(e.files,(function(r){return[t("tr",{key:r.path},[t("td",{staticClass:"pl-2"},[e._v("\n              "+e._s(r.name)+"\n            ")]),e._v(" "),t("td",{staticClass:"font-mono"},[e._v("\n              "+e._s(e.$bytesPretty(r.size))+"\n            ")]),e._v(" "),t("td",[e._v("\n              "+e._s(r.filetype)+"\n            ")])])]}))],2)])])],1)}),[],!1,null,null,null);t.default=component.exports},853:function(e,t,r){"use strict";r.r(t);r(147);var n=r(16),o=r(220),l=r(7),c=r(642),d=(r(29),r(22),r(17),r(26),r(56),r(27),r(57),r(44),r(45),r(38),r(8),r(62),r(28),r(58),r(350),r(188)),f=r.n(d);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v={props:{item:{type:Object,default:function(){}},mediaType:String,processing:Boolean,provider:String},data:function(){return{itemData:{title:"",author:"",series:""},error:"",isUploading:!1,uploadFailed:!1,uploadSuccess:!1,isFetchingMetadata:!1,uploadProgress:{loaded:0,total:0}}},computed:{isPodcast:function(){return"podcast"===this.mediaType},directory:function(){var e=this;if(!this.itemData.title)return"";if(this.isPodcast)return this.itemData.title;var t=[this.itemData.author,this.itemData.series,this.itemData.title].filter(Boolean).map((function(t){return e.$sanitizeFilename(t)}));return f.a.join.apply(f.a,Object(c.a)(t))},isNonInteractable:function(){return this.isUploading||this.isFetchingMetadata},nonInteractionLabel:function(){return this.isUploading?this.$strings.MessageUploading:this.isFetchingMetadata?this.$strings.LabelFetchingMetadata:void 0},uploadProgressPercent:function(){return 0===this.uploadProgress.total?0:Math.min(100,Math.round(this.uploadProgress.loaded/this.uploadProgress.total*100))},uploadProgressText:function(){var e=this.$bytesPretty(this.uploadProgress.loaded),t=this.$bytesPretty(this.uploadProgress.total);return"".concat(this.uploadProgressPercent,"% (").concat(e," / ").concat(t,")")}},methods:{setUploadStatus:function(e){this.isUploading="uploading"===e,this.uploadFailed="failed"===e,this.uploadSuccess="success"===e,"uploading"!==e&&(this.uploadProgress={loaded:0,total:0})},setUploadProgress:function(progress){this.isUploading&&progress&&(this.uploadProgress={loaded:progress.loaded||0,total:progress.total||0})},titleUpdated:function(){this.error=""},fetchMetadata:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var r,n,l,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.itemData.title.trim().length){t.next=2;break}return t.abrupt("return");case 2:return e.isFetchingMetadata=!0,e.error="",t.prev=4,r=new URLSearchParams({title:e.itemData.title,author:e.itemData.author,provider:e.provider}),t.next=8,e.$axios.$get("/api/search/books?".concat(r));case 8:n=t.sent,l=Object(o.a)(n),c=l[0],l.slice(1),c?e.itemData=m(m({},e.itemData),{},{title:c.title,author:c.author,series:null===(d=(c.series||[])[0])||void 0===d?void 0:d.series}):e.error=e.$strings.ErrorUploadFetchMetadataNoResults,t.next=19;break;case 15:t.prev=15,t.t0=t.catch(4),console.error("Failed",t.t0),e.error=e.$strings.ErrorUploadFetchMetadataAPI;case 19:return t.prev=19,e.isFetchingMetadata=!1,t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[4,15,19,22]])})))()},getData:function(){if(!this.itemData.title)return this.error=this.$strings.ErrorUploadLacksTitle,null;this.error="";var e=this.item.itemFiles.concat(this.item.otherFiles);return m(m({index:this.item.index,directory:this.directory},this.itemData),{},{files:e})}},mounted:function(){this.item&&(this.itemData.title=this.item.title,this.itemData.author=this.item.author,this.itemData.series=this.item.series)}},y=r(4),component=Object(y.a)(v,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"relative w-full py-4 px-6 border border-white/10 shadow-lg rounded-md my-6"},[t("div",{staticClass:"absolute -top-3 -left-3 w-8 h-8 bg-bg border border-white/10 flex items-center justify-center rounded-full"},[t("p",{staticClass:"text-base text-white/80 font-mono"},[e._v("#"+e._s(e.item.index))])]),e._v(" "),e.processing||e.uploadFailed||e.uploadSuccess?e._e():t("div",{staticClass:"absolute -top-3 -right-3 w-8 h-8 bg-bg border border-white/10 flex items-center justify-center rounded-full hover:bg-error cursor-pointer",on:{click:function(t){return e.$emit("remove")}}},[t("span",{staticClass:"text-base text-white/80 font-mono material-symbols"},[e._v("close")])]),e._v(" "),e.uploadSuccess||e.uploadFailed?e._e():[e.error?t("widgets-alert",{attrs:{type:"error"}},[t("p",{staticClass:"text-base"},[e._v(e._s(e.error))])]):e._e(),e._v(" "),t("div",{staticClass:"flex my-2 -mx-2"},[t("div",{staticClass:"w-1/2 px-2"},[t("ui-text-input-with-label",{attrs:{disabled:e.processing,label:e.$strings.LabelTitle},on:{input:e.titleUpdated},model:{value:e.itemData.title,callback:function(t){e.$set(e.itemData,"title","string"==typeof t?t.trim():t)},expression:"itemData.title"}})],1),e._v(" "),t("div",{staticClass:"w-1/2 px-2"},[e.isPodcast?t("div",{staticClass:"w-full"},[t("p",{staticClass:"px-1 text-sm font-semibold"},[e._v("\n            "+e._s(e.$strings.LabelDirectory)+"\n            "),t("em",{staticClass:"font-normal text-xs pl-2"},[e._v("(auto)")])]),e._v(" "),t("ui-text-input",{staticClass:"w-full font-mono text-xs",attrs:{value:e.directory,disabled:""}})],1):t("div",{staticClass:"flex items-end"},[t("ui-text-input-with-label",{attrs:{disabled:e.processing,label:e.$strings.LabelAuthor},model:{value:e.itemData.author,callback:function(t){e.$set(e.itemData,"author","string"==typeof t?t.trim():t)},expression:"itemData.author"}}),e._v(" "),t("ui-tooltip",{attrs:{direction:"top",text:e.$strings.LabelUploaderItemFetchMetadataHelp}},[t("button",{staticClass:"ml-2 mb-1 w-8 h-8 bg-bg border border-white/10 flex items-center justify-center rounded-full hover:bg-primary cursor-pointer",attrs:{type:"button"},on:{click:e.fetchMetadata}},[t("span",{staticClass:"text-base text-white/80 font-mono material-symbols"},[e._v("sync")])])])],1)])]),e._v(" "),e.isPodcast?e._e():t("div",{staticClass:"flex my-2 -mx-2"},[t("div",{staticClass:"w-1/2 px-2"},[t("ui-text-input-with-label",{attrs:{disabled:e.processing,label:e.$strings.LabelSeries,note:"(optional)",inputClass:"h-10"},model:{value:e.itemData.series,callback:function(t){e.$set(e.itemData,"series","string"==typeof t?t.trim():t)},expression:"itemData.series"}})],1),e._v(" "),t("div",{staticClass:"w-1/2 px-2"},[t("div",{staticClass:"w-full"},[t("label",{staticClass:"px-1 text-sm font-semibold"},[e._v("\n            "+e._s(e.$strings.LabelDirectory)+"\n            "),t("em",{staticClass:"font-normal text-xs pl-2"},[e._v("(auto)")])]),e._v(" "),t("ui-text-input",{staticClass:"w-full font-mono text-xs h-10",attrs:{value:e.directory,disabled:""}})],1)])]),e._v(" "),t("tables-uploaded-files-table",{staticClass:"mt-8",attrs:{files:e.item.itemFiles,title:e.$strings.HeaderItemFiles}}),e._v(" "),e.item.otherFiles.length?t("tables-uploaded-files-table",{attrs:{title:e.$strings.HeaderOtherFiles,files:e.item.otherFiles}}):e._e(),e._v(" "),e.item.ignoredFiles.length?t("tables-uploaded-files-table",{attrs:{title:e.$strings.HeaderIgnoredFiles,files:e.item.ignoredFiles}}):e._e()],e._v(" "),e.uploadSuccess?t("widgets-alert",{attrs:{type:"success"}},[t("p",{staticClass:"text-base"},[e._v('"'+e._s(e.itemData.title)+'" '+e._s(e.$strings.MessageUploaderItemSuccess))])]):e._e(),e._v(" "),e.uploadFailed?t("widgets-alert",{attrs:{type:"error"}},[t("p",{staticClass:"text-base"},[e._v('"'+e._s(e.itemData.title)+'" '+e._s(e.$strings.MessageUploaderItemFailed))])]):e._e(),e._v(" "),e.isNonInteractable?t("div",{staticClass:"absolute top-0 left-0 w-full h-full bg-black/50 flex items-center justify-center z-20"},[t("ui-loading-indicator",[t("div",{staticClass:"mb-4"},[t("span",{staticClass:"text-lg font-medium text-white"},[e._v("\n          "+e._s(e.nonInteractionLabel)+"\n        ")])]),e._v(" "),e.isUploading?t("div",{staticClass:"w-64 mx-auto mb-2"},[t("div",{staticClass:"flex items-center justify-center mb-2"},[t("span",{staticClass:"text-sm font-medium text-white/60 text-center w-full"},[e._v("\n            "+e._s(e.uploadProgressText)+"\n          ")])]),e._v(" "),t("div",{staticClass:"w-full bg-primary/20 rounded-full h-2.5"},[t("div",{staticClass:"bg-green-500 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:e.uploadProgressPercent+"%"}})])]):e._e()])],1):e._e()],2)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{WidgetsAlert:r(657).default,UiTextInputWithLabel:r(121).default,UiTooltip:r(76).default,UiTextInput:r(68).default,TablesUploadedFilesTable:r(727).default,UiLoadingIndicator:r(348).default})}}]);