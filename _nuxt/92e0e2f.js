(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{1015:function(e,t){},1016:function(e,t){},1017:function(e,t){},1018:function(e,t){},1019:function(e,t){},1084:function(e,t,r){"use strict";r.r(t);var o=r(7),n=(r(29),r(17),r(14),{components:{pdf:r(1031).a},props:{libraryItem:{type:Object,default:function(){}},playerOpen:Boolean,keepProgress:Boolean,fileId:String},data:function(){return{windowWidth:0,windowHeight:0,scale:1,rotate:0,loadedRatio:0,page:1,numPages:0,pdfDocInitParams:null,isRefreshing:!1}},computed:{userToken:function(){return this.$store.getters["user/getToken"]},libraryItemId:function(){var e;return null===(e=this.libraryItem)||void 0===e?void 0:e.id},fitToPageWidth:function(){return.6*this.pdfHeight},pdfWidth:function(){return this.fitToPageWidth*this.scale},pdfHeight:function(){return this.windowHeight<400||!this.playerOpen?this.windowHeight-120:this.windowHeight-284},maxScale:function(){return Math.floor(10*this.windowWidth/this.fitToPageWidth)/10},canGoNext:function(){return this.page<this.numPages},canGoPrev:function(){return this.page>1},canScaleUp:function(){return this.scale<this.maxScale},canScaleDown:function(){return this.scale>1},userMediaProgress:function(){if(this.libraryItemId)return this.$store.getters["user/getUserMediaProgress"](this.libraryItemId)},savedPage:function(){var e;return this.keepProgress?null===(e=this.userMediaProgress)||void 0===e||!e.ebookLocation||isNaN(this.userMediaProgress.ebookLocation)?0:Number(this.userMediaProgress.ebookLocation):0},ebookUrl:function(){return this.fileId?"/api/items/".concat(this.libraryItemId,"/ebook/").concat(this.fileId):"/api/items/".concat(this.libraryItemId,"/ebook")}},methods:{zoomIn:function(){this.scale+=.1},zoomOut:function(){this.scale-=.1},updateProgress:function(){if(this.keepProgress)if(this.numPages){var e={ebookLocation:this.page,ebookProgress:Math.max(0,Math.min(1,(Number(this.page)-1)/Number(this.numPages)))};this.$axios.$patch("/api/me/progress/".concat(this.libraryItemId),e,{progress:!1}).catch((function(e){console.error("EpubReader.updateProgress failed:",e)}))}else console.error("Num pages not loaded")},loadedEvt:function(){this.savedPage>0&&this.savedPage<=this.numPages&&(this.page=this.savedPage)},progressEvt:function(progress){this.loadedRatio=progress},numPagesLoaded:function(e){e&&(this.numPages=e)},prev:function(){this.page<=1||(this.page--,this.updateProgress())},next:function(){this.page>=this.numPages||(this.page++,this.updateProgress())},refreshToken:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isRefreshing){t.next=2;break}return t.abrupt("return");case 2:return e.isRefreshing=!0,t.next=5,e.$store.dispatch("user/refreshToken").catch((function(e){return console.error("Failed to refresh token",e),null}));case 5:if(r=t.sent){t.next=9;break}return e.$router.push("/login"),t.abrupt("return");case 9:e.pdfDocInitParams={url:e.ebookUrl,httpHeaders:{Authorization:"Bearer ".concat(r)}},e.isRefreshing=!1;case 11:case"end":return t.stop()}}),t)})))()},error:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e||401!==e.status){r.next=5;break}return console.log("Received 401 error, refreshing token"),r.next=4,t.refreshToken();case 4:return r.abrupt("return");case 5:console.error(e);case 6:case"end":return r.stop()}}),r)})))()},resize:function(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight},init:function(){this.pdfDocInitParams={url:this.ebookUrl,httpHeaders:{Authorization:"Bearer ".concat(this.userToken)}}}},mounted:function(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,window.addEventListener("resize",this.resize),this.init()},beforeDestroy:function(){window.removeEventListener("resize",this.resize)}}),c=r(4),component=Object(c.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"w-full h-full pt-20 relative"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.canGoPrev,expression:"canGoPrev"}],staticClass:"absolute top-0 left-0 h-full w-1/2 hover:opacity-100 opacity-0 z-10 cursor-pointer",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.prev.apply(null,arguments)},mousedown:function(e){e.preventDefault()}}},[e._m(0)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.canGoNext,expression:"canGoNext"}],staticClass:"absolute top-0 right-0 h-full w-1/2 hover:opacity-100 opacity-0 z-10 cursor-pointer",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.next.apply(null,arguments)},mousedown:function(e){e.preventDefault()}}},[e._m(1)]),e._v(" "),t("div",{staticClass:"absolute top-0 right-20 bg-bg text-gray-100 border-b border-l border-r border-gray-400 z-20 rounded-b-md px-2 h-9 hidden md:flex items-center text-center"},[t("p",{staticClass:"font-mono"},[e._v(e._s(e.page)+" / "+e._s(e.numPages))])]),e._v(" "),t("div",{staticClass:"absolute top-0 right-40 bg-bg text-gray-100 border-b border-l border-r border-gray-400 z-20 rounded-b-md px-2 h-9 hidden md:flex items-center text-center"},[t("ui-icon-btn",{staticClass:"mr-px",attrs:{icon:"zoom_out",size:8,disabled:!e.canScaleDown,borderless:""},on:{click:e.zoomOut}}),e._v(" "),t("ui-icon-btn",{staticClass:"ml-px",attrs:{icon:"zoom_in",size:8,disabled:!e.canScaleUp,borderless:""},on:{click:e.zoomIn}})],1),e._v(" "),t("div",{staticClass:"overflow-hidden m-auto",style:{height:e.pdfHeight+"px"}},[t("div",{staticClass:"flex items-center justify-center"},[t("div",{staticClass:"overflow-auto",style:{width:e.pdfWidth+"px",height:e.pdfHeight+"px"}},[e.loadedRatio>0&&e.loadedRatio<1?t("div",{staticStyle:{"background-color":"green",color:"white","text-align":"center"},style:{width:100*e.loadedRatio+"%"}},[e._v(e._s(Math.floor(100*e.loadedRatio))+"%")]):e._e(),e._v(" "),e.pdfDocInitParams?t("pdf",{ref:"pdf",staticClass:"m-auto z-10 border border-black/20 shadow-md",attrs:{src:e.pdfDocInitParams,page:e.page,rotate:e.rotate},on:{progress:e.progressEvt,error:e.error,"num-pages":e.numPagesLoaded,"link-clicked":function(t){e.page=t},loaded:e.loadedEvt}}):e._e()],1)])])])}),[function(){var e=this._self._c;return e("div",{staticClass:"flex items-center justify-center h-full w-1/2"},[e("span",{staticClass:"material-symbols text-5xl text-white/30 cursor-pointer hover:text-white/90"},[this._v("arrow_back_ios")])])},function(){var e=this._self._c;return e("div",{staticClass:"flex items-center justify-center h-full w-1/2 ml-auto"},[e("span",{staticClass:"material-symbols text-5xl text-white/30 cursor-pointer hover:text-white/90"},[this._v("arrow_forward_ios")])])}],!1,null,null,null);t.default=component.exports;installComponents(component,{UiIconBtn:r(148).default})},825:function(e,t){}}]);