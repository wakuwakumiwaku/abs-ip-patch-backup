(window.webpackJsonp=window.webpackJsonp||[]).push([[193,57,159],{1077:function(t,e,r){"use strict";r.r(e);r(22),r(43);var o=r(16),n=r(7);r(17),r(85),r(26),r(27),r(44),r(45),r(38),r(8),r(28),r(29);function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){Object(o.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var c={asyncData:function(t){return Object(n.a)(regeneratorRuntime.mark((function e(){var r,o,n,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params,t.query,o=t.store,t.app,n=t.redirect,l=r.library,e.next=4,o.dispatch("libraries/fetch",l);case 4:if(d=e.sent){e.next=7;break}return e.abrupt("return",n("/oops?message=Library not found"));case 7:if("book"!==d.library.mediaType){e.next=10;break}return e.abrupt("return",n("/library/".concat(l)));case 10:return e.abrupt("return",{libraryId:l});case 11:case"end":return e.stop()}}),e)})))()},data:function(){return{recentEpisodes:[],episodesProcessingMap:{},totalEpisodes:0,currentPage:0,processing:!1,openingItem:!1}},computed:{bookCoverAspectRatio:function(){return this.$store.getters["libraries/getBookCoverAspectRatio"]},libraryItemIdStreaming:function(){return this.$store.getters.getLibraryItemIdStreaming},episodeIdStreaming:function(){return this.$store.state.streamEpisodeId},streamIsPlaying:function(){return this.$store.state.streamIsPlaying},isStreamingFromDifferentLibrary:function(){return this.$store.getters.getIsStreamingFromDifferentLibrary},episodesMapped:function(){var t=this;return this.recentEpisodes.map((function(e){return d(d({},e),{},{progress:t.$store.getters["user/getUserMediaProgress"](e.libraryItemId,e.id)})}))},playerQueueItems:function(){return this.$store.state.playerQueueItems||[]},playerQueueEpisodeIdMap:function(){var t={};return this.playerQueueItems.forEach((function(i){i.episodeId&&(t[i.episodeId]=!0)})),t},dateFormat:function(){return this.$store.getters.getServerSetting("dateFormat")}},methods:{toggleEpisodeFinished:function(t){var e=arguments,r=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var n,l,d,c,m,f,v;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(d=e.length>1&&void 0!==e[1]&&e[1],!r.episodesProcessingMap[t.id]){o.next=4;break}return console.warn("Episode is already processing"),o.abrupt("return");case 4:if(c=!(null===(n=t.progress)||void 0===n||!n.isFinished),m=(null===(l=t.progress)||void 0===l?void 0:l.progress)||0,c||!(m>0)||d){o.next=10;break}return f={message:r.$getString("MessageConfirmMarkItemFinished",[t.title]),callback:function(e){e&&r.toggleEpisodeFinished(t,!0)},type:"yesNo"},r.$store.commit("globals/setConfirmPrompt",f),o.abrupt("return");case 10:v={isFinished:!c},r.$set(r.episodesProcessingMap,t.id,!0),r.$axios.$patch("/api/me/progress/".concat(t.libraryItemId,"/").concat(t.id),v).catch((function(t){console.error("Failed to update progress",t),r.$toast.error(v.isFinished?r.$strings.ToastItemMarkedAsFinishedFailed:r.$strings.ToastItemMarkedAsNotFinishedFailed)})).finally((function(){r.$set(r.episodesProcessingMap,t.id,!1)}));case 13:case"end":return o.stop()}}),o)})))()},clickAddToPlaylist:function(t){var e={id:t.libraryItemId,media:t.podcast};this.$store.commit("globals/setSelectedPlaylistItems",[{libraryItem:e,episode:t}]),this.$store.commit("globals/setShowPlaylistsModal",!0)},clickEpisode:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.openingItem){r.next=2;break}return r.abrupt("return");case 2:return e.openingItem=!0,r.next=5,e.$axios.$get("/api/items/".concat(t.libraryItemId)).catch((function(t){var r=t.response&&t.response.data||"";return e.$toast.error(r||"Failed to get library item"),null}));case 5:if(o=r.sent,e.openingItem=!1,o){r.next=9;break}return r.abrupt("return");case 9:e.$store.commit("setSelectedLibraryItem",o),e.$store.commit("globals/setSelectedEpisode",t),e.$store.commit("globals/setShowViewPodcastEpisodeModal",!0);case 12:case"end":return r.stop()}}),r)})))()},getButtonText:function(t){if(this.episodeIdStreaming===t.id)return this.streamIsPlaying?"Streaming":"Play";if(!t.progress)return this.$elapsedPretty(t.duration);if(t.progress.isFinished)return"Finished";var e=t.progress.duration||t.duration,r=Math.floor(e-t.progress.currentTime);return"".concat(this.$elapsedPretty(r)," left")},playClick:function(t){if(t.id===this.episodeIdStreaming&&this.streamIsPlaying)return this.$eventBus.$emit("pause-item");for(var e=[],r=this.episodesMapped.findIndex((function(e){return e.id===t.id})),o=this.episodesMapped.length-r-1,i=this.episodesMapped.length-1-o;i>=0;i--){var n=this.episodesMapped[i];n.progress&&n.isFinished||e.push({libraryItemId:n.libraryItemId,libraryId:n.libraryId,episodeId:n.id,title:n.title,subtitle:n.podcast.metadata.title,caption:n.publishedAt?this.$getString("LabelPublishedDate",[this.$formatDate(n.publishedAt,this.dateFormat)]):this.$strings.LabelUnknownPublishDate,duration:n.duration||null,coverPath:n.podcast.coverPath||null})}this.$eventBus.$emit("play-item",{libraryItemId:t.libraryItemId,episodeId:t.id,queueItems:e})},loadRecentEpisodes:function(){var t=arguments,e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var o,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=t.length>0&&void 0!==t[0]?t[0]:0,e.processing=!0,r.next=4,e.$axios.$get("/api/libraries/".concat(e.libraryId,"/recent-episodes?limit=50&page=").concat(o)).catch((function(t){return console.error("Failed to get recent episodes",t),e.$toast.error(e.$strings.ToastFailedToLoadData),null}));case 4:n=r.sent,e.processing=!1,e.recentEpisodes=n.episodes||[],e.totalEpisodes=n.total,e.currentPage=o;case 9:case"end":return r.stop()}}),r)})))()},queueBtnClick:function(t){if(this.playerQueueEpisodeIdMap[t.id])this.$store.commit("removeItemFromQueue",{libraryItemId:t.libraryItemId,episodeId:t.id});else{var e={libraryItemId:t.libraryItemId,libraryId:t.libraryId,episodeId:t.id,title:t.title,subtitle:t.podcast.metadata.title,caption:t.publishedAt?this.$getString("LabelPublishedDate",[this.$formatDate(t.publishedAt,this.dateFormat)]):this.$strings.LabelUnknownPublishDate,duration:t.duration||null,coverPath:t.podcast.coverPath||null};this.$store.commit("addItemToQueue",e)}}},mounted:function(){this.loadRecentEpisodes()}},m=c,f=r(4),component=Object(f.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"page",class:t.libraryItemIdStreaming?"streaming":""},[e("app-book-shelf-toolbar",{attrs:{page:"recent-episodes"}}),t._v(" "),e("div",{staticClass:"w-full overflow-y-auto px-2 py-6 sm:px-4 md:p-12 relative",attrs:{id:"bookshelf"}},[e("div",{staticClass:"w-full max-w-3xl mx-auto py-4"},[e("p",{staticClass:"text-xl mb-2 font-semibold px-4 md:px-0"},[t._v(t._s(t.$strings.HeaderLatestEpisodes))]),t._v(" "),t.recentEpisodes.length||t.processing?t._e():e("p",{staticClass:"text-center text-xl"},[t._v(t._s(t.$strings.MessageNoEpisodes))]),t._v(" "),t._l(t.episodesMapped,(function(r,o){var n,l,d;return[e("div",{key:r.id,staticClass:"flex py-5 cursor-pointer relative",on:{click:function(e){return e.stopPropagation(),t.clickEpisode(r)}}},[e("covers-preview-cover",{staticClass:"hidden md:block",attrs:{src:t.$store.getters["globals/getLibraryItemCoverSrcById"](r.libraryItemId,r.updatedAt),width:96,"book-cover-aspect-ratio":t.bookCoverAspectRatio,"show-resolution":!1}}),t._v(" "),e("div",{staticClass:"grow pl-4 max-w-2xl"},[e("div",{staticClass:"flex md:hidden mb-2"},[e("covers-preview-cover",{staticClass:"md:hidden",attrs:{src:t.$store.getters["globals/getLibraryItemCoverSrcById"](r.libraryItemId,r.updatedAt),width:48,"book-cover-aspect-ratio":t.bookCoverAspectRatio,"show-resolution":!1}}),t._v(" "),e("div",{staticClass:"grow px-2"},[e("div",{staticClass:"flex items-center"},[e("div",{staticClass:"flex",on:{click:function(t){t.stopPropagation()}}},[e("nuxt-link",{staticClass:"text-sm text-gray-200 hover:underline",attrs:{to:"/item/".concat(r.libraryItemId)}},[t._v(t._s(r.podcast.metadata.title))])],1),t._v(" "),r.podcast.metadata.explicit?e("widgets-explicit-indicator"):t._e()],1),t._v(" "),e("p",{staticClass:"text-xs text-gray-300 mb-1"},[t._v(t._s(t.$dateDistanceFromNow(r.publishedAt)))])])],1),t._v(" "),e("div",{staticClass:"hidden md:block"},[e("div",{staticClass:"flex items-center"},[e("div",{staticClass:"flex",on:{click:function(t){t.stopPropagation()}}},[e("nuxt-link",{staticClass:"text-sm text-gray-200 hover:underline",attrs:{to:"/item/".concat(r.libraryItemId)}},[t._v(t._s(r.podcast.metadata.title))])],1),t._v(" "),r.podcast.metadata.explicit?e("widgets-explicit-indicator"):t._e()],1),t._v(" "),e("p",{staticClass:"text-xs text-gray-300 mb-1"},[t._v(t._s(t.$dateDistanceFromNow(r.publishedAt)))])]),t._v(" "),e("div",{staticClass:"flex items-center font-semibold text-gray-200"},[r.season||r.episode?e("div",[t._v("#")]):t._e(),t._v(" "),r.season?e("div",[t._v(t._s(r.season)+"x")]):t._e(),t._v(" "),r.episode?e("div",[t._v(t._s(r.episode))]):t._e()]),t._v(" "),e("div",{staticClass:"flex items-center mb-2",attrs:{dir:"auto"}},[e("div",{staticClass:"font-semibold text-sm md:text-base"},[t._v(t._s(r.title))]),t._v(" "),e("widgets-podcast-type-indicator",{attrs:{type:r.episodeType}})],1),t._v(" "),e("p",{staticClass:"text-sm text-gray-200 mb-4 line-clamp-4",attrs:{dir:"auto"},domProps:{innerHTML:t._s(r.subtitle||r.description)}}),t._v(" "),e("div",{staticClass:"flex items-center"},[e("button",{staticClass:"h-8 px-4 border border-white/20 hover:bg-white/10 rounded-full flex items-center justify-center cursor-pointer focus:outline-hidden",class:null!==(n=r.progress)&&void 0!==n&&n.isFinished?"text-white/40":"",on:{click:function(e){return e.stopPropagation(),t.playClick(r)}}},[t.episodeIdStreaming===r.id?e("span",{staticClass:"material-symbols text-2xl",class:t.streamIsPlaying?"":"text-success"},[t._v(t._s(t.streamIsPlaying?"pause":"play_arrow"))]):e("span",{staticClass:"material-symbols fill text-2xl text-success"},[t._v("play_arrow")]),t._v(" "),e("p",{staticClass:"pl-2 pr-1 text-sm font-semibold"},[t._v(t._s(t.getButtonText(r)))])]),t._v(" "),t.libraryItemIdStreaming&&!t.isStreamingFromDifferentLibrary?e("ui-tooltip",{class:t.playerQueueEpisodeIdMap[r.id]?"text-success":"",attrs:{text:t.playerQueueEpisodeIdMap[r.id]?t.$strings.MessageRemoveFromPlayerQueue:t.$strings.MessageAddToPlayerQueue,direction:"top"}},[e("ui-icon-btn",{attrs:{icon:t.playerQueueEpisodeIdMap[r.id]?"playlist_add_check":"playlist_play",borderless:""},on:{click:function(e){return t.queueBtnClick(r)}}})],1):t._e(),t._v(" "),e("ui-tooltip",{attrs:{text:null!==(l=r.progress)&&void 0!==l&&l.isFinished?t.$strings.MessageMarkAsNotFinished:t.$strings.MessageMarkAsFinished,direction:"top"}},[e("ui-read-icon-btn",{staticClass:"mx-1 mt-0.5",attrs:{disabled:t.episodesProcessingMap[r.id],"is-read":!(null===(d=r.progress)||void 0===d||!d.isFinished),borderless:""},on:{click:function(e){return t.toggleEpisodeFinished(r)}}})],1),t._v(" "),e("ui-tooltip",{attrs:{text:t.$strings.LabelYourPlaylists,direction:"top"}},[e("ui-icon-btn",{attrs:{icon:"playlist_add",borderless:""},on:{click:function(e){return t.clickAddToPlaylist(r)}}})],1)],1)]),t._v(" "),r.progress?e("div",{staticClass:"absolute bottom-0 left-0 h-0.5 pointer-events-none bg-warning",style:{width:100*r.progress.progress+"%"}}):t._e()],1),t._v(" "),o!==t.recentEpisodes.length?e("div",{key:o,staticClass:"w-full h-px bg-white/10"}):t._e()]}))],2)])],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{AppBookShelfToolbar:r(689).default,CoversPreviewCover:r(356).default,WidgetsExplicitIndicator:r(354).default,WidgetsPodcastTypeIndicator:r(677).default,UiIconBtn:r(148).default,UiTooltip:r(76).default,UiReadIconBtn:r(353).default})},642:function(t,e,r){"use strict";r.d(e,"a",(function(){return d}));var o=r(183);var n=r(237),l=r(149);function d(t){return function(t){if(Array.isArray(t))return Object(o.a)(t)}(t)||Object(n.a)(t)||Object(l.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},677:function(t,e,r){"use strict";r.r(e);var o={props:{type:{type:String,default:"full"}},data:function(){return{}},computed:{},methods:{},mounted:function(){}},n=r(4),component=Object(n.a)(o,(function(){var t=this,e=t._self._c;return e("div",["bonus"==t.type?[e("ui-tooltip",{attrs:{text:"Bonus",direction:"top"}},[e("span",{staticClass:"material-symbols ml-1",staticStyle:{"font-size":"0.8rem"}},[t._v("local_play")])])]:t._e(),t._v(" "),"trailer"==t.type?[e("ui-tooltip",{attrs:{text:"Trailer",direction:"top"}},[e("span",{staticClass:"material-symbols ml-1",staticStyle:{"font-size":"0.8rem"}},[t._v("local_movies")])])]:t._e()],2)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UiTooltip:r(76).default})}}]);