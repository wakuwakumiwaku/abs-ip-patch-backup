(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{683:function(t,e,r){"use strict";var n=r(69),o=r(152),l=r(86);t.exports=function(t){for(var e=n(this),r=l(e),d=arguments.length,c=o(d>1?arguments[1]:void 0,r),h=d>2?arguments[2]:void 0,f=void 0===h?r:o(h,r);f>c;)e[c++]=t;return e}},687:function(t,e,r){"use strict";var n=r(9),o=r(683),l=r(124);n({target:"Array",proto:!0},{fill:o}),l("fill")},847:function(t,e,r){"use strict";r.r(e);var n=r(7),o=(r(29),r(17),r(687),r(57),r(15),r(14),r(8),r(351),r(352),r(62),r(58),{props:{variant:{type:Number,default:0},processing:Boolean,year:Number},data:function(){return{canvas:null,dataUrl:null,yearStats:null}},watch:{variant:function(){this.init()}},methods:{initCanvas:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var canvas,r,n,o,l,d,c,h,f,x,i,S,w,m,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.yearStats){e.next=2;break}return e.abrupt("return");case 2:if((canvas=document.createElement("canvas")).width=800,canvas.height=800,r=canvas.getContext("2d"),n=function(t,e,n,o){var l=r.createLinearGradient(t,e,t+n,e+o);l.addColorStop(0,"#44444455"),l.addColorStop(1,"#ffffff11"),r.fillStyle=l,r.strokeStyle="#C0C0C088",r.beginPath(),r.roundRect(t,e,n,o,[20]),r.fill(),r.stroke()},o=function(text,t,e,n,o,l,d){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(r.fillStyle=n,r.font="".concat(e," ").concat(t," Source Sans Pro"),r.letterSpacing=o,c)for(var h=r.measureText(text).width;h>c;)console.warn('Text "'.concat(text,'" is greater than max width ').concat(c," (width:").concat(h,")")),text=text.endsWith("...")?text.slice(0,-4):text.slice(0,-3),text+="...",h=r.measureText(text).width,console.log('Checking text "'.concat(text,'" (width:').concat(h,")"));r.fillText(text,l,d)},r.fillStyle="#232323",r.fillRect(0,0,canvas.width,canvas.height),l={},!t.yearStats.booksAddedWithCovers.length){e.next=27;break}d=0,r.globalAlpha=.25,r.save(),r.translate(canvas.width/2,canvas.height/2),r.rotate(-Math.PI/180*25),r.translate(-canvas.width/2,-canvas.height/2),r.translate(-130,-120),c=regeneratorRuntime.mark((function e(n){var o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=regeneratorRuntime.mark((function e(o){var c,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=d%t.yearStats.booksAddedWithCovers.length,h=t.yearStats.booksAddedWithCovers[c],d++,e.next=5,new Promise((function(e){var img=new Image;img.crossOrigin="anonymous",img.addEventListener("load",(function(){var t=img.width;img.width>img.height&&(t=img.height);var d=-(t-img.width)/2,c=-(t-img.height)/2;r.drawImage(img,d,c,t,t,215*n,215*o,215,215),l[h]||(l[h]={img:img,sx:d,sy:c,sw:t}),e()})),img.addEventListener("error",(function(){e()})),img.src=t.$store.getters["globals/getLibraryItemCoverSrcById"](h)}));case 5:case"end":return e.stop()}}),e)})),c=0;case 2:if(!(c<5)){e.next=7;break}return e.delegateYield(o(c),"t0",4);case 4:c++,e.next=2;break;case 7:case"end":return e.stop()}}),e)})),h=0;case 21:if(!(h<5)){e.next=26;break}return e.delegateYield(c(h),"t0",23);case 23:h++,e.next=21;break;case 26:r.restore();case 27:if(r.globalAlpha=1,r.textBaseline="middle",(f=r.createLinearGradient(0,0,canvas.width,canvas.height)).addColorStop(0,"#000000aa"),f.addColorStop(1,"#cd9d49aa"),r.fillStyle=f,r.fillRect(0,0,canvas.width,canvas.height),x="#ffdb70",r.fillStyle=x,r.font="42px absicons",r.fillText("î¤€",15,36),o("audiobookshelf","28px","normal",x,"0px",65,28),o("".concat(t.year," ").concat(t.$strings.StatsYearInReview),"18px","bold","white","1px",65,51),n(40,100,230,100),r.textAlign="center",o(t.yearStats.numBooksAdded,"48px","bold","white","0px",155,140),o(t.$strings.StatsBooksAdded,"18px","normal",x,"0px",155,170,200),n(285,100,230,100),o(t.yearStats.numAuthorsAdded,"48px","bold","white","0px",400,140),o(t.$strings.StatsAuthorsAdded,"18px","normal",x,"0px",400,170,200),n(530,100,230,100),o(t.yearStats.numListeningSessions,"48px","bold","white","0px",645,140),o(t.$strings.StatsSessions,"18px","normal",x,"1px",645,170,200),t.yearStats.totalBooksAddedSize&&(o(t.$strings.StatsCollectionGrewTo,"24px","normal",x,"0px",canvas.width/2,260),o(t.$bytesPretty(t.yearStats.totalBooksSize),"36px","bolder","white","0px",canvas.width/2,300),o("+"+t.$bytesPretty(t.yearStats.totalBooksAddedSize),"20px","lighter","white","0px",canvas.width/2,330)),t.yearStats.totalBooksAddedDuration&&(o(t.$strings.StatsTotalDuration,"24px","normal",x,"0px",canvas.width/2,400),o(t.$elapsedPrettyExtended(t.yearStats.totalBooksDuration,!0,!1),"36px","bolder","white","0px",canvas.width/2,440),o("+"+t.$elapsedPrettyExtended(t.yearStats.totalBooksAddedDuration,!0,!1),"20px","lighter","white","0px",canvas.width/2,470)),t.variant){if(1===t.variant){if(r.textAlign="left",t.yearStats.topAuthors.length)for(o(t.$strings.StatsTopAuthors,"24px","normal",x,"1px",70,549,330),w=0;w<t.yearStats.topAuthors.length;w++)o(t.yearStats.topAuthors[w].name,"36px","bolder","white","0px",70,609+60*w,330);if(t.yearStats.topNarrators.length)for(o(t.$strings.StatsTopNarrators,"24px","normal",x,"1px",430,549),m=0;m<t.yearStats.topNarrators.length;m++)o(t.yearStats.topNarrators[m].name,"36px","bolder","white","0px",430,609+60*m,330)}else if(2===t.variant){if(r.textAlign="left",t.yearStats.topAuthors.length)for(o(t.$strings.StatsTopAuthors,"24px","normal",x,"1px",70,549,330),v=0;v<t.yearStats.topAuthors.length;v++)o(t.yearStats.topAuthors[v].name,"36px","bolder","white","0px",70,609+60*v,330);if(t.yearStats.topGenres.length)for(o(t.$strings.StatsTopGenres,"24px","normal",x,"1px",430,549),y=0;y<t.yearStats.topGenres.length;y++)o(t.yearStats.topGenres[y].genre,"36px","bolder","white","0px",430,609+60*y,330)}}else if((l=Object.values(l)).length>0)for(o(t.$strings.StatsBooksAdditional,"24px","normal",x,"0px",canvas.width/2,540),i=0;i<Math.min(5,l.length);i++)S=l[i],r.drawImage(S.img,S.sx,S.sy,S.sw,S.sw,40+145*i,580,140,140);t.canvas=canvas,t.dataUrl=canvas.toDataURL("png");case 56:case"end":return e.stop()}}),e)})))()},share:function(){var t=this;this.canvas.toBlob((function(e){var r={files:[new File([e],"yearinreviewserver.png",{type:e.type})]};navigator.canShare(r)?navigator.share(r).then((function(){console.log("Share success")})).catch((function(e){console.error("Failed to share",e),"AbortError"!==e.name&&t.$toast.error(t.$strings.ToastFailedToShare+": "+e.message)})):t.$toast.error(t.$strings.ToastErrorCannotShare)}))},refresh:function(){this.init()},init:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$emit("update:processing",!0),e.next=3,t.$axios.$get("/api/stats/year/".concat(t.year)).catch((function(e){return console.error("Failed to load stats for year",e),t.$toast.error(t.$strings.ToastFailedToLoadData),null}));case 3:return t.yearStats=e.sent,e.next=6,t.initCanvas();case 6:t.$emit("update:processing",!1);case 7:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.init()}}),l=o,d=r(4),component=Object(d.a)(l,(function(){var t=this,e=t._self._c;return e("div",[t.processing?e("div",{staticClass:"max-w-[800px] h-80 md:h-[800px] mx-auto flex items-center justify-center",attrs:{role:"img","aria-label":t.$strings.MessageLoading}},[e("widgets-loading-spinner")],1):t.dataUrl?e("img",{staticClass:"mx-auto",attrs:{src:t.dataUrl,"aria-label":t.$getString("LabelServerYearReview",[t.variant+1])}}):t._e()])}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{WidgetsLoadingSpinner:r(151).default})}}]);