/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[201],{1040:function(e,t,r){"use strict";r.r(t);var n=r(7),o=(r(17),r(33),r(41),r(27),r(8),r(351),r(52),r(28),r(40),r(29),r(143));function l(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function c(e){return"#"+e.map(l).join("")}function d(e){return e?(t=e,Array.isArray(t[0])?e:[e]):[];var t}function h(data,e,t){for(var i=0;i<t.length;i++)if(f(data,e,t[i]))return!0;return!1}function f(data,e,t){switch(t.length){case 3:if(function(data,e,t){if(255!==data[e+3])return!0;if(data[e]===t[0]&&data[e+1]===t[1]&&data[e+2]===t[2])return!0;return!1}(data,e,t))return!0;break;case 4:if(function(data,e,t){if(data[e+3]&&t[3])return data[e]===t[0]&&data[e+1]===t[1]&&data[e+2]===t[2]&&data[e+3]===t[3];return data[e+3]===t[3]}(data,e,t))return!0;break;case 5:if(function(data,e,t){var r=t[0],n=t[1],o=t[2],l=t[3],c=t[4],d=data[e+3],h=m(d,l,c);if(!l)return h;if(!d&&h)return!0;if(m(data[e],r,c)&&m(data[e+1],n,c)&&m(data[e+2],o,c)&&h)return!0;return!1}(data,e,t))return!0;break;default:return!1}}function m(e,t,r){return e>=t-r&&e<=t+r}function v(e,t,r){for(var n={},o=r.dominantDivider||24,l=r.ignoredColor,c=r.step,d=[0,0,0,0,0],i=0;i<t;i+=c){var f=e[i],m=e[i+1],v=e[i+2],y=e[i+3];if(!l||!h(e,i,l)){var w=Math.round(f/o)+","+Math.round(m/o)+","+Math.round(v/o);n[w]?n[w]=[n[w][0]+f*y,n[w][1]+m*y,n[w][2]+v*y,n[w][3]+y,n[w][4]+1]:n[w]=[f*y,m*y,v*y,y,1],d[4]<n[w][4]&&(d=n[w])}}var S=d[0],k=d[1],P=d[2],C=d[3],A=d[4];return C?[Math.round(S/C),Math.round(k/C),Math.round(P/C),Math.round(C/A)]:r.defaultColor}function y(e,t,r){for(var n=0,o=0,l=0,c=0,d=0,f=r.ignoredColor,m=r.step,i=0;i<t;i+=m){var v=e[i+3],y=e[i]*v,w=e[i+1]*v,S=e[i+2]*v;f&&h(e,i,f)||(n+=y,o+=w,l+=S,c+=v,d++)}return c?[Math.round(n/c),Math.round(o/c),Math.round(l/c),Math.round(c/d)]:r.defaultColor}function w(e,t,r){for(var n=0,o=0,l=0,c=0,d=0,f=r.ignoredColor,m=r.step,i=0;i<t;i+=m){var v=e[i],y=e[i+1],w=e[i+2],S=e[i+3];f&&h(e,i,f)||(n+=v*v*S,o+=y*y*S,l+=w*w*S,c+=S,d++)}return c?[Math.round(Math.sqrt(n/c)),Math.round(Math.sqrt(o/c)),Math.round(Math.sqrt(l/c)),Math.round(c/d)]:r.defaultColor}function S(e){return k(e,"defaultColor",[0,0,0,0])}function k(e,t,r){return void 0===e[t]?r:e[t]}function P(e){if(A(e)){var t=e.naturalWidth,r=e.naturalHeight;return e.naturalWidth||-1===e.src.search(/\.svg(\?|$)/i)||(t=r=100),{width:t,height:r}}return function(e){return"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement}(e)?{width:e.videoWidth,height:e.videoHeight}:{width:e.width,height:e.height}}function C(e){return function(e){return"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement}(e)?"canvas":function(e){return x&&e instanceof OffscreenCanvas}(e)?"offscreencanvas":function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}(e)?"imagebitmap":e.src}function A(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement}var x="undefined"!=typeof OffscreenCanvas;var M="undefined"==typeof window;function I(e){return Error("FastAverageColor: "+e)}function T(e,t){t||console.error(e)}var L=function(){function e(){this.canvas=null,this.ctx=null}return e.prototype.getColorAsync=function(e,t){if(!e)return Promise.reject(I("call .getColorAsync() without resource"));if("string"==typeof e){if("undefined"==typeof Image)return Promise.reject(I("resource as string is not supported in this environment"));var img=new Image;return img.crossOrigin=t&&t.crossOrigin||"",img.src=e,this.bindImageEvents(img,t)}if(A(e)&&!e.complete)return this.bindImageEvents(e,t);var r=this.getColor(e,t);return r.error?Promise.reject(r.error):Promise.resolve(r)},e.prototype.getColor=function(e,t){var r=S(t=t||{});if(!e)return T(l=I("call .getColor() without resource"),t.silent),this.prepareResult(r,l);var n=function(e,t){var r,n=k(t,"left",0),o=k(t,"top",0),l=k(t,"width",e.width),c=k(t,"height",e.height),d=l,h=c;return"precision"===t.mode||(l>c?(r=l/c,d=100,h=Math.round(d/r)):(r=c/l,h=100,d=Math.round(h/r)),(d>l||h>c||d<10||h<10)&&(d=l,h=c)),{srcLeft:n,srcTop:o,srcWidth:l,srcHeight:c,destWidth:d,destHeight:h}}(P(e),t);if(!(n.srcWidth&&n.srcHeight&&n.destWidth&&n.destHeight))return T(l=I('incorrect sizes for resource "'.concat(C(e),'"')),t.silent),this.prepareResult(r,l);if(!this.canvas&&(this.canvas=M?x?new OffscreenCanvas(1,1):null:document.createElement("canvas"),!this.canvas))return T(l=I("OffscreenCanvas is not supported in this browser"),t.silent),this.prepareResult(r,l);if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx)return T(l=I("Canvas Context 2D is not supported in this browser"),t.silent),this.prepareResult(r);this.ctx.imageSmoothingEnabled=!1}this.canvas.width=n.destWidth,this.canvas.height=n.destHeight;try{this.ctx.clearRect(0,0,n.destWidth,n.destHeight),this.ctx.drawImage(e,n.srcLeft,n.srcTop,n.srcWidth,n.srcHeight,0,0,n.destWidth,n.destHeight);var o=this.ctx.getImageData(0,0,n.destWidth,n.destHeight).data;return this.prepareResult(this.getColorFromArray4(o,t))}catch(n){var l;return T(l=I("security error (CORS) for resource ".concat(C(e),".\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image")),t.silent),!t.silent&&console.error(n),this.prepareResult(r,l)}},e.prototype.getColorFromArray4=function(e,t){t=t||{};var r=e.length,n=S(t);if(r<4)return n;var o,l=r-r%4,c=4*(t.step||1);switch(t.algorithm||"sqrt"){case"simple":o=y;break;case"sqrt":o=w;break;case"dominant":o=v;break;default:throw I("".concat(t.algorithm," is unknown algorithm"))}return o(e,l,{defaultColor:n,ignoredColor:d(t.ignoredColor),step:c,dominantDivider:t.dominantDivider})},e.prototype.prepareResult=function(e,t){var r,n=e.slice(0,3),o=[e[0],e[1],e[2],e[3]/255],l=(299*(r=e)[0]+587*r[1]+114*r[2])/1e3<128;return{value:[e[0],e[1],e[2],e[3]],rgb:"rgb("+n.join(",")+")",rgba:"rgba("+o.join(",")+")",hex:c(n),hexa:c(e),isDark:l,isLight:!l,error:t}},e.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},e.prototype.bindImageEvents=function(e,t){var r=this;return new Promise((function(n,o){var l=function(){h();var l=r.getColor(e,t);l.error?o(l.error):n(l)},c=function(){h(),o(I('Error loading image "'.concat(e.src,'"')))},d=function(){h(),o(I('Image "'.concat(e.src,'" loading aborted')))},h=function(){e.removeEventListener("load",l),e.removeEventListener("error",c),e.removeEventListener("abort",d)};e.addEventListener("load",l),e.addEventListener("error",c),e.addEventListener("abort",d)}))},e}(),H={layout:"blank",asyncData:function(e){return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,l,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.params,n=e.error,o=e.app,l=e.query,c="/public/share/".concat(r.slug),l.t&&!isNaN(l.t)&&(c+="?t=".concat(l.t)),t.next=5,o.$axios.$get(c,{timeout:1e4}).catch((function(e){return console.error("Failed",e),null}));case 5:if(d=t.sent){t.next=8;break}return t.abrupt("return",n({statusCode:404,message:"Media item not found or expired"}));case 8:return t.abrupt("return",{mediaItemShare:d});case 9:case"end":return t.stop()}}),t)})))()},data:function(){return{localAudioPlayer:new o.a,playerState:null,playInterval:null,hasLoaded:!1,totalDuration:0,windowWidth:0,windowHeight:0,listeningTimeSinceSync:0,coverRgb:null,coverBgIsLight:!1,currentTime:0}},computed:{playbackSession:function(){return this.mediaItemShare.playbackSession},coverUrl:function(){return this.playbackSession.coverPath?"".concat(this.$config.routerBasePath,"/public/share/").concat(this.mediaItemShare.slug,"/cover"):this.$store.getters["globals/getPlaceholderCoverSrc"]},downloadUrl:function(){return"".concat("/audiobookshelf","/public/share/").concat(this.mediaItemShare.slug,"/download")},audioTracks:function(){return(this.playbackSession.audioTracks||[]).map((function(track){return track.relativeContentUrl=track.contentUrl,track}))},isPlaying:function(){return"PLAYING"===this.playerState},isPaused:function(){return!this.isPlaying},chapters:function(){return this.playbackSession.chapters||[]},currentChapter:function(){var e=this;return this.chapters.find((function(t){return t.start<=e.currentTime&&e.currentTime<t.end}))},coverAspectRatio:function(){var e=this.playbackSession.coverAspectRatio;return e===this.$constants.BookCoverAspectRatio.STANDARD?1.6:1},isMobileLandscape:function(){return this.windowWidth>this.windowHeight&&this.windowHeight<450},coverWidth:function(){var e=Math.min(450,this.windowWidth-32),t=Math.min(450,this.windowHeight-250);return e*this.coverAspectRatio>t?t/this.coverAspectRatio:e},coverHeight:function(){return this.coverWidth*this.coverAspectRatio}},methods:{mediaSessionPlay:function(){console.log("Media session play"),this.play()},mediaSessionPause:function(){console.log("Media session pause"),this.pause()},mediaSessionStop:function(){console.log("Media session stop"),this.pause()},mediaSessionSeekBackward:function(){console.log("Media session seek backward"),this.jumpBackward()},mediaSessionSeekForward:function(){console.log("Media session seek forward"),this.jumpForward()},mediaSessionSeekTo:function(e){console.log("Media session seek to",e),null===e.seekTime||isNaN(e.seekTime)||this.seek(e.seekTime)},mediaSessionPreviousTrack:function(){this.$refs.audioPlayer&&this.$refs.audioPlayer.prevChapter()},mediaSessionNextTrack:function(){this.$refs.audioPlayer&&this.$refs.audioPlayer.nextChapter()},updateMediaSessionPlaybackState:function(){"mediaSession"in navigator&&(navigator.mediaSession.playbackState=this.isPlaying?"playing":"paused")},setMediaSession:function(){if("mediaSession"in navigator){var e=[];this.chapters.length>0&&this.chapters.forEach((function(t){e.push({title:t.title,startTime:t.start})})),navigator.mediaSession.metadata=new MediaMetadata({title:this.mediaItemShare.playbackSession.displayTitle||"No title",artist:this.mediaItemShare.playbackSession.displayAuthor||"Unknown",artwork:[{src:this.coverUrl}],chapterInfo:e}),console.log("Set media session metadata",navigator.mediaSession.metadata),navigator.mediaSession.setActionHandler("play",this.mediaSessionPlay),navigator.mediaSession.setActionHandler("pause",this.mediaSessionPause),navigator.mediaSession.setActionHandler("stop",this.mediaSessionStop),navigator.mediaSession.setActionHandler("seekbackward",this.mediaSessionSeekBackward),navigator.mediaSession.setActionHandler("seekforward",this.mediaSessionSeekForward),navigator.mediaSession.setActionHandler("seekto",this.mediaSessionSeekTo),navigator.mediaSession.setActionHandler("previoustrack",this.mediaSessionSeekBackward),navigator.mediaSession.setActionHandler("nexttrack",this.mediaSessionSeekForward)}else console.warn("Media session not available")},coverImageLoaded:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.playbackSession.coverPath){r.next=2;break}return r.abrupt("return");case 2:(new L).getColorAsync(e.target).then((function(e){t.coverRgb=e.rgba,t.coverBgIsLight=e.isLight,document.body.style.backgroundColor=e.hex})).catch((function(e){console.log(e)}));case 4:case"end":return r.stop()}}),r)})))()},playPause:function(){this.isPlaying?this.pause():this.play()},play:function(){this.localAudioPlayer&&this.hasLoaded&&this.localAudioPlayer.play()},pause:function(){this.localAudioPlayer&&this.hasLoaded&&this.localAudioPlayer.pause()},jumpForward:function(){if(this.localAudioPlayer&&this.hasLoaded){var e=this.localAudioPlayer.getCurrentTime(),t=this.localAudioPlayer.getDuration(),r=this.$store.getters["user/getUserSetting"]("jumpForwardAmount")||10;this.seek(Math.min(e+r,t))}},jumpBackward:function(){if(this.localAudioPlayer&&this.hasLoaded){var e=this.localAudioPlayer.getCurrentTime(),t=this.$store.getters["user/getUserSetting"]("jumpBackwardAmount")||10;this.seek(Math.max(e-t,0))}},setVolume:function(e){this.localAudioPlayer&&this.hasLoaded&&this.localAudioPlayer.setVolume(e)},setPlaybackRate:function(e){this.localAudioPlayer&&this.hasLoaded&&this.localAudioPlayer.setPlaybackRate(e)},seek:function(time){this.localAudioPlayer&&this.hasLoaded&&(this.localAudioPlayer.seek(time,this.isPlaying),this.setCurrentTime(time))},setCurrentTime:function(time){this.$refs.audioPlayer&&(this.$refs.audioPlayer.setCurrentTime(time),this.currentTime=time)},setDuration:function(){this.localAudioPlayer&&(this.totalDuration=this.localAudioPlayer.getDuration(),this.$refs.audioPlayer&&this.$refs.audioPlayer.setDuration(this.totalDuration))},sendProgressSync:function(e){console.log("Sending progress sync for time",e);var progress={currentTime:e};this.$axios.$patch("/public/share/".concat(this.mediaItemShare.slug,"/progress"),progress,{progress:!1}).catch((function(e){console.error("Failed to send progress sync",e)}))},startPlayInterval:function(){var e=this,t=Date.now();clearInterval(this.playInterval),this.playInterval=setInterval((function(){if(e.localAudioPlayer){var r=e.localAudioPlayer.getCurrentTime();e.setCurrentTime(r);var n=(Date.now()-t)/1e3;t=Date.now(),e.listeningTimeSinceSync+=n,e.listeningTimeSinceSync>=30&&(e.listeningTimeSinceSync=0,e.sendProgressSync(r))}}),1e3)},stopPlayInterval:function(){clearInterval(this.playInterval),this.playInterval=null},playerStateChange:function(e){this.playerState=e,"LOADED"!==e&&"PLAYING"!==e||this.setDuration(),"LOADED"===e&&(this.hasLoaded=!0),"PLAYING"===e?this.startPlayInterval():this.stopPlayInterval(),this.updateMediaSessionPlaybackState()},playerTimeUpdate:function(time){this.setCurrentTime(time)},getHotkeyName:function(e){var t=e.keyCode||e.which;if(!this.$keynames[t])return null;var r=this.$keynames[t],n=r;return e.shiftKey&&(n="Shift-"+r),n},keyDown:function(e){if(this.localAudioPlayer&&this.hasLoaded){var t=this.getHotkeyName(e);t&&Object.values(this.$hotkeys.AudioPlayer).includes(t)&&(this.$eventBus.$emit("player-hotkey",t),e.preventDefault())}},resize:function(){var e=this;setTimeout((function(){e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.$store.commit("globals/updateWindowSize",{width:window.innerWidth,height:window.innerHeight})}),100)},playerError:function(e){console.error("Player error",e),this.$toast.error("Failed to play audio on device")},playerFinished:function(){console.log("Player finished")},downloadShareItem:function(){this.$downloadFile(this.downloadUrl)}},mounted:function(){this.$store.dispatch("user/loadUserSettings"),this.resize(),window.addEventListener("resize",this.resize),window.addEventListener("keydown",this.keyDown);var e=this.playbackSession.currentTime||0;this.localAudioPlayer.set(null,this.audioTracks,!1,e,!1),this.localAudioPlayer.on("stateChange",this.playerStateChange.bind(this)),this.localAudioPlayer.on("timeupdate",this.playerTimeUpdate.bind(this)),this.localAudioPlayer.on("error",this.playerError.bind(this)),this.localAudioPlayer.on("finished",this.playerFinished.bind(this)),this.setMediaSession()},beforeDestroy:function(){window.removeEventListener("resize",this.resize),window.removeEventListener("keydown",this.keyDown),this.localAudioPlayer.off("stateChange",this.playerStateChange.bind(this)),this.localAudioPlayer.off("timeupdate",this.playerTimeUpdate.bind(this)),this.localAudioPlayer.off("error",this.playerError.bind(this)),this.localAudioPlayer.off("finished",this.playerFinished.bind(this)),this.localAudioPlayer.destroy()}},D=r(4),component=Object(D.a)(H,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"w-full max-w-full h-dvh max-h-dvh overflow-hidden",style:{backgroundColor:e.coverRgb}},[t("div",{staticClass:"w-screen h-screen absolute inset-0 pointer-events-none",staticStyle:{background:"linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(38, 38, 38, 1) 80%)"}}),e._v(" "),t("div",{staticClass:"absolute inset-0 w-screen h-dvh flex items-center justify-center z-10"},[t("div",{staticClass:"w-full p-2 sm:p-4 md:p-8"},[e.isMobileLandscape?e._e():t("div",{staticClass:"mx-auto overflow-hidden rounded-xl my-2",style:{width:e.coverWidth+"px",height:e.coverHeight+"px"}},[t("img",{ref:"coverImg",staticClass:"object-contain w-full h-full",attrs:{src:e.coverUrl},on:{load:e.coverImageLoaded}})]),e._v(" "),t("p",{staticClass:"text-2xl lg:text-3xl font-semibold text-center mb-1 line-clamp-2"},[e._v(e._s(e.mediaItemShare.playbackSession.displayTitle||"No title"))]),e._v(" "),e.mediaItemShare.playbackSession.displayAuthor?t("p",{staticClass:"text-lg lg:text-xl text-slate-400 font-semibold text-center mb-1 truncate"},[e._v(e._s(e.mediaItemShare.playbackSession.displayAuthor))]):e._e(),e._v(" "),t("div",{staticClass:"w-full pt-16"},[t("player-ui",{ref:"audioPlayer",attrs:{chapters:e.chapters,"current-chapter":e.currentChapter,paused:e.isPaused,loading:!e.hasLoaded,"is-podcast":!1,"hide-bookmarks":"","hide-sleep-timer":""},on:{playPause:e.playPause,jumpForward:e.jumpForward,jumpBackward:e.jumpBackward,setVolume:e.setVolume,setPlaybackRate:e.setPlaybackRate,seek:e.seek}})],1),e._v(" "),e.mediaItemShare.isDownloadable?t("ui-tooltip",{staticClass:"absolute top-0 left-0 m-4",attrs:{direction:"bottom",text:e.$strings.LabelDownload}},[t("button",{staticClass:"text-gray-300 hover:text-white",attrs:{"aria-label":"Download"},on:{click:e.downloadShareItem}},[t("span",{staticClass:"material-symbols text-2xl sm:text-3xl"},[e._v("download")])])]):e._e()],1)])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{PlayerUi:r(412).default,UiTooltip:r(76).default})}}]);