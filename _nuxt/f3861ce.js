(window.webpackJsonp=window.webpackJsonp||[]).push([[13,57,116,117,118],{1033:function(e,t,r){"use strict";r.r(t);r(41),r(27),r(8),r(59),r(52);var n={data:function(){return{showYearInReview:!1,availableYears:[],yearInReviewYear:0,yearInReviewVariant:0,yearInReviewServerVariant:0,processingYearInReview:!1,processingYearInReviewShort:!1,processingYearInReviewServer:!1,showShareButton:!1}},computed:{isAdminOrUp:function(){return this.$store.getters["user/getIsAdminOrUp"]},user:function(){return this.$store.state.user.user}},methods:{shareYearInReviewServer:function(){this.$refs.yearInReviewServer.share()},shareYearInReview:function(){this.$refs.yearInReview.share()},shareYearInReviewShort:function(){this.$refs.yearInReviewShort.share()},yearInReviewYearChanged:function(){var e=this;this.$nextTick((function(){e.refreshYearInReview(),e.refreshYearInReviewServer()}))},refreshYearInReviewServer:function(){null!=this.$refs.yearInReviewServer&&this.$refs.yearInReviewServer.refresh()},refreshYearInReview:function(){null!=this.$refs.yearInReview&&null!=this.$refs.yearInReviewShort&&(this.$refs.yearInReview.refresh(),this.$refs.yearInReviewShort.refresh())},clickShowYearInReview:function(){this.showYearInReview=!this.showYearInReview},getAvailableYears:function(){if(this.user){var e=this.user.createdAt;if(e){for(var t=new Date(e).getFullYear(),r=[],n=(new Date).getFullYear();n>=t;n--)r.push({value:n,text:n.toString()});return r}}return[{value:this.yearInReviewYear,text:this.yearInReviewYear.toString()}]}},beforeMount:function(){this.yearInReviewYear=(new Date).getFullYear(),this.availableYears=this.getAvailableYears();var e=this.availableYears.map((function(e){return e.value}));(new Date).getMonth()<11&&e.includes(this.yearInReviewYear-1)&&this.yearInReviewYear--},mounted:function(){void 0!==navigator.share&&navigator.share?this.showShareButton=!0:console.warn("Navigator.share not supported")}},o=r(4),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg-bg rounded-md shadow-lg border border-white/5 p-1 sm:p-4 mb-4"},[e._m(0),e._v(" "),t("div",{staticClass:"flex items-center"},[t("h1",{staticClass:"hidden md:block text-xl font-semibold"},[e._v(e._s(e.$getString("HeaderYearReview",[e.yearInReviewYear])))]),e._v(" "),t("div",{staticClass:"hidden md:block grow"}),e._v(" "),t("ui-btn",{staticClass:"w-full md:w-auto",on:{click:function(t){return t.stopPropagation(),e.clickShowYearInReview.apply(null,arguments)}}},[e._v(e._s(e.showYearInReview?e.$strings.LabelYearReviewHide:e.$strings.LabelYearReviewShow))])],1),e._v(" "),e.showYearInReview?t("div",[t("div",{staticClass:"w-full h-px bg-slate-200/10 my-4"}),e._v(" "),e.availableYears.length>1?t("div",{staticClass:"mb-2 py-2 max-w-[800px] mx-auto"},[t("ui-dropdown",{staticClass:"max-w-24",attrs:{small:"",items:e.availableYears,disabled:e.processingYearInReview},on:{input:e.yearInReviewYearChanged},model:{value:e.yearInReviewYear,callback:function(t){e.yearInReviewYear=t},expression:"yearInReviewYear"}})],1):e._e(),e._v(" "),t("div",{staticClass:"flex items-center justify-center mb-2 max-w-[800px] mx-auto",attrs:{role:"toolbar"}},[t("ui-btn",{staticClass:"inline-flex items-center font-semibold",attrs:{small:"",disabled:!e.yearInReviewVariant||e.processingYearInReview,"aria-label":e.$strings.ButtonPrevious},on:{click:function(t){e.yearInReviewVariant--}}},[t("span",{staticClass:"material-symbols text-lg sm:pr-1 py-px sm:py-0"},[e._v("chevron_left")]),e._v(" "),t("span",{staticClass:"hidden sm:inline-block pr-2"},[e._v(e._s(e.$strings.ButtonPrevious))])]),e._v(" "),e.showShareButton?t("ui-btn",{staticClass:"inline-flex items-center font-semibold ml-1 sm:ml-2",attrs:{small:"",disabled:e.processingYearInReview},on:{click:e.shareYearInReview}},[e._v(e._s(e.$strings.ButtonShare)+" ")]):e._e(),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("h2",{staticClass:"hidden sm:block text-lg font-semibold"},[e._v(e._s(e.$getString("LabelPersonalYearReview",[e.yearInReviewVariant+1])))]),e._v(" "),t("p",{staticClass:"block sm:hidden text-lg font-semibold"},[e._v(e._s(e.yearInReviewVariant+1))]),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{staticClass:"inline-flex items-center font-semibold mr-1 sm:mr-2",attrs:{small:"",disabled:e.processingYearInReview},on:{click:e.refreshYearInReview}},[t("span",{staticClass:"hidden sm:inline-block"},[e._v(e._s(e.$strings.ButtonRefresh))]),e._v(" "),t("span",{staticClass:"material-symbols sm:hidden! text-lg py-px"},[e._v("refresh")])]),e._v(" "),t("ui-btn",{staticClass:"inline-flex items-center font-semibold",attrs:{small:"",disabled:e.yearInReviewVariant>=2||e.processingYearInReview,"aria-label":e.$strings.ButtonNext},on:{click:function(t){e.yearInReviewVariant++}}},[t("span",{staticClass:"hidden sm:inline-block pl-2"},[e._v(e._s(e.$strings.ButtonNext))]),e._v(" "),t("span",{staticClass:"material-symbols text-lg sm:pl-1 py-px sm:py-0"},[e._v("chevron_right")])])],1),e._v(" "),t("stats-year-in-review",{ref:"yearInReview",attrs:{variant:e.yearInReviewVariant,year:e.yearInReviewYear,processing:e.processingYearInReview},on:{"update:processing":function(t){e.processingYearInReview=t}}}),e._v(" "),t("div",{staticClass:"w-full max-w-[800px] mx-auto my-4"},[e.showShareButton?t("ui-btn",{staticClass:"inline-flex items-center font-semibold mb-1",attrs:{small:"",disabled:e.processingYearInReviewShort},on:{click:e.shareYearInReviewShort}},[e._v(e._s(e.$strings.ButtonShare))]):e._e(),e._v(" "),t("stats-year-in-review-short",{ref:"yearInReviewShort",attrs:{year:e.yearInReviewYear,processing:e.processingYearInReviewShort},on:{"update:processing":function(t){e.processingYearInReviewShort=t}}})],1),e._v(" "),e.isAdminOrUp?t("div",{staticClass:"w-full max-w-[800px] mx-auto mb-2 mt-4 border-t pt-4 border-white/10",attrs:{role:"toolbar"}},[t("div",{staticClass:"flex items-center justify-center mb-2"},[t("ui-btn",{staticClass:"inline-flex items-center font-semibold",attrs:{small:"",disabled:!e.yearInReviewServerVariant||e.processingYearInReviewServer,"aria-label":e.$strings.ButtonPrevious},on:{click:function(t){e.yearInReviewServerVariant--}}},[t("span",{staticClass:"material-symbols text-lg sm:pr-1 py-px sm:py-0"},[e._v("chevron_left")]),e._v(" "),t("span",{staticClass:"hidden sm:inline-block pr-2"},[e._v(e._s(e.$strings.ButtonPrevious))])]),e._v(" "),e.showShareButton?t("ui-btn",{staticClass:"inline-flex items-center font-semibold ml-1 sm:ml-2",attrs:{small:"",disabled:e.processingYearInReviewServer},on:{click:e.shareYearInReviewServer}},[e._v(e._s(e.$strings.ButtonShare)+" ")]):e._e(),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("h2",{staticClass:"hidden sm:block text-lg font-semibold"},[e._v(e._s(e.$getString("LabelServerYearReview",[e.yearInReviewServerVariant+1])))]),e._v(" "),t("p",{staticClass:"block sm:hidden text-lg font-semibold"},[e._v(e._s(e.yearInReviewServerVariant+1))]),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{staticClass:"inline-flex items-center font-semibold mr-1 sm:mr-2",attrs:{small:"",disabled:e.processingYearInReviewServer},on:{click:e.refreshYearInReviewServer}},[t("span",{staticClass:"hidden sm:inline-block"},[e._v(e._s(e.$strings.ButtonRefresh))]),e._v(" "),t("span",{staticClass:"material-symbols sm:hidden! text-lg py-px"},[e._v("refresh")])]),e._v(" "),t("ui-btn",{staticClass:"inline-flex items-center font-semibold",attrs:{small:"",disabled:e.yearInReviewServerVariant>=2||e.processingYearInReviewServer,"aria-label":e.$strings.ButtonNext},on:{click:function(t){e.yearInReviewServerVariant++}}},[t("span",{staticClass:"hidden sm:inline-block pl-2"},[e._v(e._s(e.$strings.ButtonNext))]),e._v(" "),t("span",{staticClass:"material-symbols text-lg sm:pl-1 py-px sm:py-0"},[e._v("chevron_right")])])],1)]):e._e(),e._v(" "),e.isAdminOrUp?t("stats-year-in-review-server",{ref:"yearInReviewServer",attrs:{year:e.yearInReviewYear,variant:e.yearInReviewServerVariant,processing:e.processingYearInReviewServer},on:{"update:processing":function(t){e.processingYearInReviewServer=t}}}):e._e()],1):e._e()])}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"h-0 w-0 overflow-hidden opacity-0"},[t("span",{staticClass:"material-symbols"},[e._v("close")]),e._v(" "),t("span",{staticClass:"abs-icons icon-audiobookshelf"})])}],!1,null,null,null);t.default=component.exports;installComponents(component,{UiBtn:r(42).default,UiDropdown:r(236).default,StatsYearInReview:r(845).default,StatsYearInReviewShort:r(846).default,StatsYearInReviewServer:r(847).default})},642:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(183);var o=r(237),l=r(149);function c(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||Object(o.a)(e)||Object(l.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},683:function(e,t,r){"use strict";var n=r(69),o=r(152),l=r(86);e.exports=function(e){for(var t=n(this),r=l(t),c=arguments.length,d=o(c>1?arguments[1]:void 0,r),h=c>2?arguments[2]:void 0,v=void 0===h?r:o(h,r);v>d;)t[d++]=e;return t}},687:function(e,t,r){"use strict";var n=r(9),o=r(683),l=r(124);n({target:"Array",proto:!0},{fill:o}),l("fill")},845:function(e,t,r){"use strict";r.r(t);var n=r(642),o=r(7),l=(r(29),r(17),r(687),r(41),r(57),r(15),r(14),r(8),r(351),r(352),r(52),r(62),r(58),{props:{variant:{type:Number,default:0},year:Number,processing:Boolean},data:function(){return{canvas:null,dataUrl:null,yearStats:null}},watch:{variant:function(){this.init()}},methods:{initCanvas:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var canvas,r,o,l,c,d,h,v,f,m,w,x,y,S,R,I,C,$,k,_,i,Y,L,B;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.yearStats){t.next=2;break}return t.abrupt("return");case 2:if((canvas=document.createElement("canvas")).width=800,canvas.height=800,r=canvas.getContext("2d"),o=function(e,t,n,o){var l=r.createLinearGradient(e,t,e+n,t+o);l.addColorStop(0,"#44444455"),l.addColorStop(1,"#ffffff11"),r.fillStyle=l,r.strokeStyle="#C0C0C088",r.beginPath(),r.roundRect(e,t,n,o,[20]),r.fill(),r.stroke()},l=function(text,e,t,n,o,l,c){var d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(r.fillStyle=n,r.font="".concat(t," ").concat(e," Source Sans Pro"),r.letterSpacing=o,d)for(var h=r.measureText(text).width;h>d;)console.warn('Text "'.concat(text,'" is greater than max width ').concat(d," (width:").concat(h,")")),text=text.endsWith("...")?text.slice(0,-4):text.slice(0,-3),text+="...",h=r.measureText(text).width,console.log('Checking text "'.concat(text,'" (width:').concat(h,")"));r.fillText(text,l,c)},c=function(e,t,n,o,l){r.fillStyle=t,r.font="".concat(n," Material Symbols Rounded"),r.fillText(e,o,l)},r.fillStyle="#232323",r.fillRect(0,0,canvas.width,canvas.height),(d=e.yearStats.finishedBooksWithCovers).push.apply(d,Object(n.a)(e.yearStats.booksWithCovers)),h={},!d.length){t.next=30;break}v=0,r.globalAlpha=.25,r.save(),r.translate(canvas.width/2,canvas.height/2),r.rotate(-Math.PI/180*25),r.translate(-canvas.width/2,-canvas.height/2),r.translate(-130,-120),f=regeneratorRuntime.mark((function t(n){var o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=regeneratorRuntime.mark((function t(o){var l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=v%d.length,c=d[l],v++,t.next=5,new Promise((function(t){var img=new Image;img.crossOrigin="anonymous",img.addEventListener("load",(function(){var l=img.width;img.width>img.height&&(l=img.height);var d=-(l-img.width)/2,v=-(l-img.height)/2;r.drawImage(img,d,v,l,l,215*n,215*o,215,215),t(),e.yearStats.finishedBooksWithCovers.includes(c)&&!h[c]&&(h[c]={img:img,sx:d,sy:v,sw:l})})),img.addEventListener("error",(function(){t()})),img.src=e.$store.getters["globals/getLibraryItemCoverSrcById"](c)}));case 5:case"end":return t.stop()}}),t)})),l=0;case 2:if(!(l<5)){t.next=7;break}return t.delegateYield(o(l),"t0",4);case 4:l++,t.next=2;break;case 7:case"end":return t.stop()}}),t)})),m=0;case 24:if(!(m<5)){t.next=29;break}return t.delegateYield(f(m),"t0",26);case 26:m++,t.next=24;break;case 29:r.restore();case 30:if(w=210,r.globalAlpha=1,r.textBaseline="middle",(x=r.createLinearGradient(0,0,canvas.width,canvas.height)).addColorStop(0,"#000000aa"),x.addColorStop(1,"#cd9d49aa"),r.fillStyle=x,r.fillRect(0,0,canvas.width,canvas.height),y="#ffdb70",r.fillStyle=y,r.font="42px absicons",r.fillText("",15,36),l("audiobookshelf","28px","normal",y,"0px",65,28),l("".concat(e.year," ").concat(e.$strings.StatsYearInReview),"18px","bold","white","1px",65,51),o(50,100,340,160),l(e.yearStats.numBooksFinished,"64px","bold","white","0px",160,165),l(e.$strings.StatsBooksFinished,"28px","normal",y,"0px",160,210,w),(S=new Path2D).addPath(new Path2D("M19 1H5c-1.1 0-1.99.9-1.99 2L3 15.93c0 .69.35 1.3.88 1.66L12 23l8.11-5.41c.53-.36.88-.97.88-1.66L21 3c0-1.1-.9-2-2-2zm-9 15l-5-5 1.41-1.41L10 13.17l7.59-7.59L19 7l-9 9z"),{a:2,d:2,e:100,f:160}),r.fillStyle="#ffffff",r.fill(S),o(410,100,340,160),l(e.$elapsedPrettyExtended(e.yearStats.totalListeningTime,!0,!1),"40px","bold","white","0px",500,165),l(e.$strings.StatsSpentListening,"28px","normal",y,"0px",500,205,w),c("watch_later","white","52px",440,180),o(50,280,340,160),l(e.yearStats.totalListeningSessions,"64px","bold","white","0px",160,345),l(e.$strings.StatsSessions,"28px","normal",y,"1px",160,390,w),c("headphones","white","52px",95,360),o(410,280,340,160),l(e.yearStats.numBooksListened,"64px","bold","white","0px",500,345),l(e.$strings.StatsBooksListenedTo,"28px","normal",y,"0px",500,390,w),c("local_library","white","52px",440,360),e.variant){if(1===e.variant){if((h=Object.values(h)).length>0)for(r.textAlign="center",l(e.$strings.StatsBooksFinishedThisYear,"28px","normal",y,"0px",canvas.width/2,530),i=0;i<Math.min(5,h.length);i++)Y=h[i],r.drawImage(Y.img,Y.sx,Y.sy,Y.sw,Y.sw,40+145*i,570,140,140)}else if(2===e.variant){if(e.yearStats.topAuthors.length)for(l(e.$strings.StatsTopAuthors,"24px","normal",y,"1px",70,524),L=0;L<e.yearStats.topAuthors.length;L++)l(e.yearStats.topAuthors[L].name,"36px","bolder","white","0px",70,584+60*L,330);if(e.yearStats.topGenres.length)for(l(e.$strings.StatsTopGenres,"24px","normal",y,"1px",430,524),B=0;B<e.yearStats.topGenres.length;B++)l(e.yearStats.topGenres[B].genre,"36px","bolder","white","0px",430,584+60*B,330)}}else(I=e.yearStats.mostListenedNarrator)&&(l(e.$strings.StatsTopNarrator,"24px","normal",y,"1px",70,520,330),l(I.name,"36px","bolder","white","0px",70,564,330),l(e.$elapsedPrettyExtended(I.time,!0,!1),"24px","lighter","white","1px",70,599)),(C=e.yearStats.topGenres[0])&&(l(e.$strings.StatsTopGenre,"24px","normal",y,"1px",430,520,330),l(C.genre,"36px","bolder","white","0px",430,564,330),l(e.$elapsedPrettyExtended(C.time,!0,!1),"24px","lighter","white","1px",430,599)),($=e.yearStats.topAuthors[0])&&(l(e.$strings.StatsTopAuthor,"24px","normal",y,"1px",70,670,330),l($.name,"36px","bolder","white","0px",70,714,330),l(e.$elapsedPrettyExtended($.time,!0,!1),"24px","lighter","white","1px",70,749)),null!==(R=e.yearStats.mostListenedMonth)&&void 0!==R&&R.time&&(k=new Date(e.year,e.yearStats.mostListenedMonth.month,1),_=e.$formatJsDate(k,"LLLL"),l(e.$strings.StatsTopMonth,"24px","normal",y,"1px",430,670,330),l(_,"36px","bolder","white","0px",430,714,330),l(e.$elapsedPrettyExtended(e.yearStats.mostListenedMonth.time,!0,!1),"24px","lighter","white","1px",430,749));e.canvas=canvas,e.dataUrl=canvas.toDataURL("png");case 66:case"end":return t.stop()}}),t)})))()},refresh:function(){this.init()},share:function(){var e=this;this.canvas.toBlob((function(t){var r={files:[new File([t],"yearinreview.png",{type:t.type})]};navigator.canShare(r)?navigator.share(r).then((function(){console.log("Share success")})).catch((function(t){console.error("Failed to share",t),"AbortError"!==t.name&&e.$toast.error(e.$strings.ToastFailedToShare+": "+t.message)})):e.$toast.error(e.$strings.ToastErrorCannotShare)}))},init:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$emit("update:processing",!0),t.next=3,e.$axios.$get("/api/me/stats/year/".concat(e.year)).catch((function(t){return console.error("Failed to load stats for year",t),e.$toast.error(e.$strings.ToastFailedToLoadData),null}));case 3:return e.yearStats=t.sent,t.next=6,e.initCanvas();case 6:e.$emit("update:processing",!1);case 7:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.init()}}),c=l,d=r(4),component=Object(d.a)(c,(function(){var e=this,t=e._self._c;return t("div",[e.processing?t("div",{staticClass:"max-w-[800px] h-80 md:h-[800px] mx-auto flex items-center justify-center",attrs:{role:"img","aria-label":e.$strings.MessageLoading}},[t("widgets-loading-spinner")],1):e.dataUrl?t("img",{staticClass:"mx-auto",attrs:{src:e.dataUrl,"aria-label":e.$getString("LabelPersonalYearReview",[e.variant+1])}}):e._e()])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{WidgetsLoadingSpinner:r(151).default})},846:function(e,t,r){"use strict";r.r(t);var n=r(642),o=r(7),l=(r(29),r(17),r(687),r(57),r(15),r(14),r(8),r(352),r(62),r(58),{props:{processing:Boolean,year:Number},data:function(){return{canvas:null,dataUrl:null,yearStats:null}},methods:{initCanvas:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var canvas,r,o,l,c,d,h,v,f,m,w,x;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.yearStats){t.next=2;break}return t.abrupt("return");case 2:if((canvas=document.createElement("canvas")).width=600,canvas.height=200,r=canvas.getContext("2d"),o=function(e,t,n,o){var l=r.createLinearGradient(e,t,e+n,t+o);l.addColorStop(0,"#44444455"),l.addColorStop(1,"#ffffff11"),r.fillStyle=l,r.strokeStyle="#C0C0C088",r.beginPath(),r.roundRect(e,t,n,o,[20]),r.fill(),r.stroke()},l=function(text,e,t,n,o,l,c){var d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(r.fillStyle=n,r.font="".concat(t," ").concat(e," Source Sans Pro"),r.letterSpacing=o,d)for(var h=r.measureText(text).width;h>d;)console.warn('Text "'.concat(text,'" is greater than max width ').concat(d," (width:").concat(h,")")),text=text.endsWith("...")?text.slice(0,-4):text.slice(0,-3),text+="...",h=r.measureText(text).width,console.log('Checking text "'.concat(text,'" (width:').concat(h,")"));r.fillText(text,l,c)},c=function(e,t,n,o,l){r.fillStyle=t,r.font="".concat(n," Material Symbols Rounded"),r.fillText(e,o,l)},r.fillStyle="#232323",r.fillRect(0,0,canvas.width,canvas.height),(d=e.yearStats.finishedBooksWithCovers).push.apply(d,Object(n.a)(e.yearStats.booksWithCovers)),!d.length){t.next=29;break}h=0,r.globalAlpha=.25,r.save(),r.translate(canvas.width/2,canvas.height/2),r.rotate(-Math.PI/180*25),r.translate(-canvas.width/2,-canvas.height/2),r.translate(-10,-90),v=regeneratorRuntime.mark((function t(n){var o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=regeneratorRuntime.mark((function t(o){var l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=h%d.length,c=d[l],h++,t.next=5,new Promise((function(t){var img=new Image;img.crossOrigin="anonymous",img.addEventListener("load",(function(){var e=img.width;img.width>img.height&&(e=img.height);var l=-(e-img.width)/2,c=-(e-img.height)/2;r.drawImage(img,l,c,e,e,155*n,155*o,155,155),t()})),img.addEventListener("error",(function(){t()})),img.src=e.$store.getters["globals/getLibraryItemCoverSrcById"](c)}));case 5:case"end":return t.stop()}}),t)})),l=0;case 2:if(!(l<3)){t.next=7;break}return t.delegateYield(o(l),"t0",4);case 4:l++,t.next=2;break;case 7:case"end":return t.stop()}}),t)})),f=0;case 23:if(!(f<4)){t.next=28;break}return t.delegateYield(v(f),"t0",25);case 25:f++,t.next=23;break;case 28:r.restore();case 29:r.globalAlpha=1,r.textBaseline="middle",(m=r.createLinearGradient(0,0,canvas.width,canvas.height)).addColorStop(0,"#000000aa"),m.addColorStop(1,"#cd9d49aa"),r.fillStyle=m,r.fillRect(0,0,canvas.width,canvas.height),w="#ffdb70",r.fillStyle=w,r.font="42px absicons",r.fillText("",15,36),l("audiobookshelf","28px","normal",w,"0px",65,28),l("".concat(e.year," ").concat(e.$strings.StatsYearInReview),"18px","bold","white","1px",65,51),o(15,75,280,110),l(e.yearStats.numBooksFinished,"48px","bold","white","0px",105,120),l(e.$strings.StatsBooksFinished,"20px","normal",w,"0px",105,155,180),(x=new Path2D).addPath(new Path2D("M19 1H5c-1.1 0-1.99.9-1.99 2L3 15.93c0 .69.35 1.3.88 1.66L12 23l8.11-5.41c.53-.36.88-.97.88-1.66L21 3c0-1.1-.9-2-2-2zm-9 15l-5-5 1.41-1.41L10 13.17l7.59-7.59L19 7l-9 9z"),{a:1.5,d:1.5,e:55,f:115}),r.fillStyle="#ffffff",r.fill(x),o(305,75,280,110),l(e.yearStats.numBooksListened,"48px","bold","white","0px",400,120),l(e.$strings.StatsBooksListenedTo,"20px","normal",w,"0px",400,155,180),c("local_library","white","42px",345,130),e.canvas=canvas,e.dataUrl=canvas.toDataURL("png");case 56:case"end":return t.stop()}}),t)})))()},share:function(){var e=this;this.canvas.toBlob((function(t){var r={files:[new File([t],"yearinreviewshort.png",{type:t.type})]};navigator.canShare(r)?navigator.share(r).then((function(){console.log("Share success")})).catch((function(t){console.error("Failed to share",t),"AbortError"!==t.name&&e.$toast.error(e.$strings.ToastFailedToShare+": "+t.message)})):e.$toast.error(e.$strings.ToastErrorCannotShare)}))},refresh:function(){this.init()},init:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$emit("update:processing",!0),t.next=3,e.$axios.$get("/api/me/stats/year/".concat(e.year)).catch((function(t){return console.error("Failed to load stats for year",t),e.$toast.error(e.$strings.ToastFailedToLoadData),null}));case 3:return e.yearStats=t.sent,t.next=6,e.initCanvas();case 6:e.$emit("update:processing",!1);case 7:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.init()}}),c=l,d=r(4),component=Object(d.a)(c,(function(){var e=this,t=e._self._c;return t("div",[e.processing?t("div",{staticClass:"max-w-[600px] h-32 sm:h-[200px] flex items-center justify-center"},[t("widgets-loading-spinner")],1):e.dataUrl?t("img",{attrs:{src:e.dataUrl}}):e._e()])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{WidgetsLoadingSpinner:r(151).default})},847:function(e,t,r){"use strict";r.r(t);var n=r(7),o=(r(29),r(17),r(687),r(57),r(15),r(14),r(8),r(351),r(352),r(62),r(58),{props:{variant:{type:Number,default:0},processing:Boolean,year:Number},data:function(){return{canvas:null,dataUrl:null,yearStats:null}},watch:{variant:function(){this.init()}},methods:{initCanvas:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var canvas,r,n,o,l,c,d,h,v,f,i,m,w,x,y,S;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.yearStats){t.next=2;break}return t.abrupt("return");case 2:if((canvas=document.createElement("canvas")).width=800,canvas.height=800,r=canvas.getContext("2d"),n=function(e,t,n,o){var l=r.createLinearGradient(e,t,e+n,t+o);l.addColorStop(0,"#44444455"),l.addColorStop(1,"#ffffff11"),r.fillStyle=l,r.strokeStyle="#C0C0C088",r.beginPath(),r.roundRect(e,t,n,o,[20]),r.fill(),r.stroke()},o=function(text,e,t,n,o,l,c){var d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(r.fillStyle=n,r.font="".concat(t," ").concat(e," Source Sans Pro"),r.letterSpacing=o,d)for(var h=r.measureText(text).width;h>d;)console.warn('Text "'.concat(text,'" is greater than max width ').concat(d," (width:").concat(h,")")),text=text.endsWith("...")?text.slice(0,-4):text.slice(0,-3),text+="...",h=r.measureText(text).width,console.log('Checking text "'.concat(text,'" (width:').concat(h,")"));r.fillText(text,l,c)},r.fillStyle="#232323",r.fillRect(0,0,canvas.width,canvas.height),l={},!e.yearStats.booksAddedWithCovers.length){t.next=27;break}c=0,r.globalAlpha=.25,r.save(),r.translate(canvas.width/2,canvas.height/2),r.rotate(-Math.PI/180*25),r.translate(-canvas.width/2,-canvas.height/2),r.translate(-130,-120),d=regeneratorRuntime.mark((function t(n){var o,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=regeneratorRuntime.mark((function t(o){var d,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d=c%e.yearStats.booksAddedWithCovers.length,h=e.yearStats.booksAddedWithCovers[d],c++,t.next=5,new Promise((function(t){var img=new Image;img.crossOrigin="anonymous",img.addEventListener("load",(function(){var e=img.width;img.width>img.height&&(e=img.height);var c=-(e-img.width)/2,d=-(e-img.height)/2;r.drawImage(img,c,d,e,e,215*n,215*o,215,215),l[h]||(l[h]={img:img,sx:c,sy:d,sw:e}),t()})),img.addEventListener("error",(function(){t()})),img.src=e.$store.getters["globals/getLibraryItemCoverSrcById"](h)}));case 5:case"end":return t.stop()}}),t)})),d=0;case 2:if(!(d<5)){t.next=7;break}return t.delegateYield(o(d),"t0",4);case 4:d++,t.next=2;break;case 7:case"end":return t.stop()}}),t)})),h=0;case 21:if(!(h<5)){t.next=26;break}return t.delegateYield(d(h),"t0",23);case 23:h++,t.next=21;break;case 26:r.restore();case 27:if(r.globalAlpha=1,r.textBaseline="middle",(v=r.createLinearGradient(0,0,canvas.width,canvas.height)).addColorStop(0,"#000000aa"),v.addColorStop(1,"#cd9d49aa"),r.fillStyle=v,r.fillRect(0,0,canvas.width,canvas.height),f="#ffdb70",r.fillStyle=f,r.font="42px absicons",r.fillText("",15,36),o("audiobookshelf","28px","normal",f,"0px",65,28),o("".concat(e.year," ").concat(e.$strings.StatsYearInReview),"18px","bold","white","1px",65,51),n(40,100,230,100),r.textAlign="center",o(e.yearStats.numBooksAdded,"48px","bold","white","0px",155,140),o(e.$strings.StatsBooksAdded,"18px","normal",f,"0px",155,170,200),n(285,100,230,100),o(e.yearStats.numAuthorsAdded,"48px","bold","white","0px",400,140),o(e.$strings.StatsAuthorsAdded,"18px","normal",f,"0px",400,170,200),n(530,100,230,100),o(e.yearStats.numListeningSessions,"48px","bold","white","0px",645,140),o(e.$strings.StatsSessions,"18px","normal",f,"1px",645,170,200),e.yearStats.totalBooksAddedSize&&(o(e.$strings.StatsCollectionGrewTo,"24px","normal",f,"0px",canvas.width/2,260),o(e.$bytesPretty(e.yearStats.totalBooksSize),"36px","bolder","white","0px",canvas.width/2,300),o("+"+e.$bytesPretty(e.yearStats.totalBooksAddedSize),"20px","lighter","white","0px",canvas.width/2,330)),e.yearStats.totalBooksAddedDuration&&(o(e.$strings.StatsTotalDuration,"24px","normal",f,"0px",canvas.width/2,400),o(e.$elapsedPrettyExtended(e.yearStats.totalBooksDuration,!0,!1),"36px","bolder","white","0px",canvas.width/2,440),o("+"+e.$elapsedPrettyExtended(e.yearStats.totalBooksAddedDuration,!0,!1),"20px","lighter","white","0px",canvas.width/2,470)),e.variant){if(1===e.variant){if(r.textAlign="left",e.yearStats.topAuthors.length)for(o(e.$strings.StatsTopAuthors,"24px","normal",f,"1px",70,549,330),w=0;w<e.yearStats.topAuthors.length;w++)o(e.yearStats.topAuthors[w].name,"36px","bolder","white","0px",70,609+60*w,330);if(e.yearStats.topNarrators.length)for(o(e.$strings.StatsTopNarrators,"24px","normal",f,"1px",430,549),x=0;x<e.yearStats.topNarrators.length;x++)o(e.yearStats.topNarrators[x].name,"36px","bolder","white","0px",430,609+60*x,330)}else if(2===e.variant){if(r.textAlign="left",e.yearStats.topAuthors.length)for(o(e.$strings.StatsTopAuthors,"24px","normal",f,"1px",70,549,330),y=0;y<e.yearStats.topAuthors.length;y++)o(e.yearStats.topAuthors[y].name,"36px","bolder","white","0px",70,609+60*y,330);if(e.yearStats.topGenres.length)for(o(e.$strings.StatsTopGenres,"24px","normal",f,"1px",430,549),S=0;S<e.yearStats.topGenres.length;S++)o(e.yearStats.topGenres[S].genre,"36px","bolder","white","0px",430,609+60*S,330)}}else if((l=Object.values(l)).length>0)for(o(e.$strings.StatsBooksAdditional,"24px","normal",f,"0px",canvas.width/2,540),i=0;i<Math.min(5,l.length);i++)m=l[i],r.drawImage(m.img,m.sx,m.sy,m.sw,m.sw,40+145*i,580,140,140);e.canvas=canvas,e.dataUrl=canvas.toDataURL("png");case 56:case"end":return t.stop()}}),t)})))()},share:function(){var e=this;this.canvas.toBlob((function(t){var r={files:[new File([t],"yearinreviewserver.png",{type:t.type})]};navigator.canShare(r)?navigator.share(r).then((function(){console.log("Share success")})).catch((function(t){console.error("Failed to share",t),"AbortError"!==t.name&&e.$toast.error(e.$strings.ToastFailedToShare+": "+t.message)})):e.$toast.error(e.$strings.ToastErrorCannotShare)}))},refresh:function(){this.init()},init:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$emit("update:processing",!0),t.next=3,e.$axios.$get("/api/stats/year/".concat(e.year)).catch((function(t){return console.error("Failed to load stats for year",t),e.$toast.error(e.$strings.ToastFailedToLoadData),null}));case 3:return e.yearStats=t.sent,t.next=6,e.initCanvas();case 6:e.$emit("update:processing",!1);case 7:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.init()}}),l=o,c=r(4),component=Object(c.a)(l,(function(){var e=this,t=e._self._c;return t("div",[e.processing?t("div",{staticClass:"max-w-[800px] h-80 md:h-[800px] mx-auto flex items-center justify-center",attrs:{role:"img","aria-label":e.$strings.MessageLoading}},[t("widgets-loading-spinner")],1):e.dataUrl?t("img",{staticClass:"mx-auto",attrs:{src:e.dataUrl,"aria-label":e.$getString("LabelServerYearReview",[e.variant+1])}}):e._e()])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{WidgetsLoadingSpinner:r(151).default})}}]);