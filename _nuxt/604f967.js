(window.webpackJsonp=window.webpackJsonp||[]).push([[161,57,59,82],{1041:function(e,t,r){"use strict";r.r(t);r(15),r(26),r(41),r(8),r(52);var n={data:function(){return{loading:!1,password:null,newPassword:null,confirmPassword:null,changingPassword:!1,selectedLanguage:"",newEReaderDevice:{name:"",email:""},ereaderDevices:[],deletingDeviceName:null,selectedEReaderDevice:null,showEReaderDeviceModal:!1}},computed:{streamLibraryItem:function(){return this.$store.state.streamLibraryItem},user:function(){return this.$store.state.user.user||null},username:function(){return this.user.username},usertype:function(){return this.user.type},isRoot:function(){return"root"===this.usertype},isGuest:function(){return"guest"===this.usertype},isPasswordAuthEnabled:function(){return(this.$store.getters.getServerSetting("authActiveAuthMethods")||[]).includes("local")},showChangePasswordForm:function(){return!this.isGuest&&this.isPasswordAuthEnabled},showEreaderTable:function(){var e;return"root"!==this.usertype&&"admin"!==this.usertype&&(null===(e=this.user.permissions)||void 0===e?void 0:e.createEreader)},revisedEreaderDevices:function(){return this.ereaderDevices.filter((function(e){var t;return 1===(null===(t=e.users)||void 0===t?void 0:t.length)}))}},methods:{updateLocalLanguage:function(e){this.$setLanguageCode(e)},logout:function(){var e=this;this.$root.socket&&(console.log("Disconnecting from socket",this.$root.socket.id),this.$root.socket.removeAllListeners(),this.$root.socket.disconnect()),localStorage.getItem("token")&&localStorage.removeItem("token"),this.$store.commit("libraries/setUserPlaylists",[]),this.$store.commit("libraries/setCollections",[]),this.$axios.$post("/logout").then((function(t){var r=t.redirect_url;r?window.location.href=r:e.$router.push("/login")})).catch((function(e){console.error(e)}))},resetForm:function(){this.password=null,this.newPassword=null,this.confirmPassword=null},submitChangePassword:function(){var e=this;return this.newPassword!==this.confirmPassword?this.$toast.error(this.$strings.ToastUserPasswordMismatch):this.password===this.newPassword?this.$toast.error(this.$strings.ToastUserPasswordMustChange):(this.changingPassword=!0,void this.$axios.$patch("/api/me/password",{password:this.password,newPassword:this.newPassword}).then((function(){e.$toast.success(e.$strings.ToastUserPasswordChangeSuccess),e.resetForm()})).catch((function(t){var r;console.error("Failed to change password",t);var n=e.$strings.ToastUnknownError;null!==(r=t.response)&&void 0!==r&&r.data&&"string"==typeof t.response.data&&(n=t.response.data),e.$toast.error(n)})).finally((function(){e.changingPassword=!1})))},addNewDeviceClick:function(){this.selectedEReaderDevice=null,this.showEReaderDeviceModal=!0},editDeviceClick:function(e){this.selectedEReaderDevice=e,this.showEReaderDeviceModal=!0},deleteDeviceClick:function(e){var t=this,r={message:this.$getString("MessageConfirmDeleteDevice",[e.name]),callback:function(r){r&&t.deleteDevice(e)},type:"yesNo"};this.$store.commit("globals/setConfirmPrompt",r)},deleteDevice:function(e){var t=this,r={ereaderDevices:this.revisedEreaderDevices.filter((function(t){return t.name!==e.name}))};this.deletingDeviceName=e.name,this.$axios.$post("/api/me/ereader-devices",r).then((function(data){t.ereaderDevicesUpdated(data.ereaderDevices)})).catch((function(e){console.error("Failed to delete device",e),t.$toast.error(t.$strings.ToastRemoveFailed)})).finally((function(){t.deletingDeviceName=null}))},ereaderDevicesUpdated:function(e){this.ereaderDevices=e}},mounted:function(){this.selectedLanguage=this.$languageCodes.current,this.ereaderDevices=this.$store.state.libraries.ereaderDevices||[]}},o=r(4),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"page p-6 overflow-y-auto relative",class:e.streamLibraryItem?"streaming":"",attrs:{id:"page-wrapper"}},[t("div",{staticClass:"w-full max-w-xl mx-auto"},[t("h1",{staticClass:"text-2xl"},[e._v(e._s(e.$strings.HeaderAccount))]),e._v(" "),t("div",{staticClass:"my-4"},[t("div",{staticClass:"flex -mx-2"},[t("div",{staticClass:"w-2/3 px-2"},[t("ui-text-input-with-label",{attrs:{disabled:"",value:e.username,label:e.$strings.LabelUsername}})],1),e._v(" "),t("div",{staticClass:"w-1/3 px-2"},[t("ui-text-input-with-label",{attrs:{disabled:"",value:e.usertype,label:e.$strings.LabelAccountType}})],1)]),e._v(" "),t("div",{staticClass:"py-4"},[t("p",{staticClass:"px-1 text-sm font-semibold"},[e._v(e._s(e.$strings.LabelLanguage))]),e._v(" "),t("ui-dropdown",{staticClass:"max-w-48",attrs:{items:e.$languageCodeOptions,small:""},on:{input:e.updateLocalLanguage},model:{value:e.selectedLanguage,callback:function(t){e.selectedLanguage=t},expression:"selectedLanguage"}})],1),e._v(" "),t("div",{staticClass:"w-full h-px bg-white/10 my-4"}),e._v(" "),e.showChangePasswordForm?t("p",{staticClass:"mb-4 text-lg"},[e._v(e._s(e.$strings.HeaderChangePassword))]):e._e(),e._v(" "),e.showChangePasswordForm?t("form",{on:{submit:function(t){return t.preventDefault(),e.submitChangePassword.apply(null,arguments)}}},[t("ui-text-input-with-label",{staticClass:"my-2",attrs:{disabled:e.changingPassword,type:"password",label:e.$strings.LabelPassword},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),t("ui-text-input-with-label",{staticClass:"my-2",attrs:{disabled:e.changingPassword,type:"password",label:e.$strings.LabelNewPassword},model:{value:e.newPassword,callback:function(t){e.newPassword=t},expression:"newPassword"}}),e._v(" "),t("ui-text-input-with-label",{staticClass:"my-2",attrs:{disabled:e.changingPassword,type:"password",label:e.$strings.LabelConfirmPassword},model:{value:e.confirmPassword,callback:function(t){e.confirmPassword=t},expression:"confirmPassword"}}),e._v(" "),t("div",{staticClass:"flex items-center py-2"},[e.isRoot?t("p",{staticClass:"text-error py-2 text-xs"},[e._v("* "+e._s(e.$strings.NoteChangeRootPassword))]):e._e(),e._v(" "),t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{directives:[{name:"show",rawName:"v-show",value:e.password&&e.newPassword&&e.confirmPassword||e.isRoot,expression:"(password && newPassword && confirmPassword) || isRoot"}],attrs:{type:"submit",loading:e.changingPassword,color:"bg-success"}},[e._v(e._s(e.$strings.ButtonSubmit))])],1)],1):e._e()]),e._v(" "),e.showEreaderTable?t("div",[t("div",{staticClass:"w-full h-px bg-white/10 my-4"}),e._v(" "),t("app-settings-content",{attrs:{"header-text":e.$strings.HeaderEreaderDevices},scopedSlots:e._u([{key:"header-items",fn:function(){return[t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-primary",small:""},on:{click:e.addNewDeviceClick}},[e._v(e._s(e.$strings.ButtonAddDevice))])]},proxy:!0}],null,!1,2840446414)},[e._v(" "),e.ereaderDevices.length?t("table",{staticClass:"tracksTable mt-4"},[t("tr",[t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelName))]),e._v(" "),t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelEmail))]),e._v(" "),t("th",{staticClass:"w-40"})]),e._v(" "),e._l(e.ereaderDevices,(function(r){var n,o;return t("tr",{key:r.name},[t("td",[t("p",{staticClass:"text-sm md:text-base text-gray-100"},[e._v(e._s(r.name))])]),e._v(" "),t("td",{staticClass:"text-left"},[t("p",{staticClass:"text-sm md:text-base text-gray-100"},[e._v(e._s(r.email))])]),e._v(" "),t("td",{staticClass:"w-40"},[t("div",{staticClass:"flex justify-end items-center h-10"},[t("ui-icon-btn",{staticClass:"mx-1",attrs:{icon:"edit",borderless:"",size:8,"icon-font-size":"1.1rem",disabled:e.deletingDeviceName===r.name||1!==(null===(n=r.users)||void 0===n?void 0:n.length)},on:{click:function(t){return e.editDeviceClick(r)}}}),e._v(" "),t("ui-icon-btn",{attrs:{icon:"delete",borderless:"",size:8,"icon-font-size":"1.1rem",disabled:e.deletingDeviceName===r.name||1!==(null===(o=r.users)||void 0===o?void 0:o.length)},on:{click:function(t){return e.deleteDeviceClick(r)}}})],1)])])}))],2):e.loading?e._e():t("div",{staticClass:"text-center py-4"},[t("p",{staticClass:"text-lg text-gray-100"},[e._v(e._s(e.$strings.MessageNoDevices))])])])],1):e._e(),e._v(" "),t("div",{staticClass:"py-4 mt-8 flex"},[t("ui-btn",{attrs:{color:"bg-primary flex items-center text-lg"},on:{click:e.logout}},[t("span",{staticClass:"material-symbols mr-4 icon-text"},[e._v("logout")]),e._v(e._s(e.$strings.ButtonLogout))])],1),e._v(" "),t("modals-emails-user-e-reader-device-modal",{attrs:{"existing-devices":e.revisedEreaderDevices,"ereader-device":e.selectedEReaderDevice},on:{update:e.ereaderDevicesUpdated},model:{value:e.showEReaderDeviceModal,callback:function(t){e.showEReaderDeviceModal=t},expression:"showEReaderDeviceModal"}})],1)])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:r(121).default,UiDropdown:r(236).default,UiBtn:r(42).default,UiIconBtn:r(148).default,AppSettingsContent:r(652).default,ModalsEmailsUserEReaderDeviceModal:r(832).default})},642:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(183);var o=r(237),l=r(149);function c(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||Object(o.a)(e)||Object(l.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},646:function(e,t,r){var content=r(648);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("6d988fa2",content,!0,{sourceMap:!1})},647:function(e,t,r){"use strict";r(646)},648:function(e,t,r){var n=r(18)((function(i){return i[1]}));n.push([e.i,"\n#settings-description a {\n  color: rgb(96 165 250);\n}\n#settings-description a:hover {\n  color: rgb(147 197 253);\n  text-decoration-line: underline;\n}\n#settings-description code {\n  font-size: 0.875rem;\n  border-radius: 6px;\n  background-color: rgb(82, 82, 82);\n  color: white;\n  padding: 2px 4px;\n}\n",""]),n.locals={},e.exports=n},652:function(e,t,r){"use strict";r.r(t);r(22),r(43);var n={props:{headerText:String,description:String,note:String},methods:{}},o=(r(647),r(4)),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg-bg rounded-md shadow-lg border border-white/5 p-2 sm:p-4 mb-8"},[t("div",{staticClass:"flex items-center mb-2"},[e._t("header-prefix"),e._v(" "),t("h1",{staticClass:"text-xl"},[e._v(e._s(e.headerText))]),e._v(" "),e._t("header-items")],2),e._v(" "),e.description?t("p",{staticClass:"mb-6 text-gray-200",attrs:{id:"settings-description"},domProps:{innerHTML:e._s(e.description)}}):e._e(),e._v(" "),e._t("default")],2)}),[],!1,null,null,null);t.default=component.exports},832:function(e,t,r){"use strict";r.r(t);r(15);var n=r(16),o=r(642);r(22),r(17),r(26),r(41),r(44),r(45),r(38),r(8),r(52),r(147),r(28);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={props:{value:Boolean,existingDevices:{type:Array,default:function(){return[]}},ereaderDevice:{type:Object,default:function(){return null}}},data:function(){return{processing:!1,newDevice:{name:"",email:"",availabilityOption:"adminAndUp",users:[]}}},watch:{show:{handler:function(e){e&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},user:function(){return this.$store.state.user.user},title:function(){return this.ereaderDevice?"Update Device":"Create Device"}},methods:{submitForm:function(){var e,t,r=this;if(this.$refs.ereaderNameInput.blur(),this.$refs.ereaderEmailInput.blur(),null!==(e=this.newDevice.name)&&void 0!==e&&e.trim()&&null!==(t=this.newDevice.email)&&void 0!==t&&t.trim())if(this.newDevice.name=this.newDevice.name.trim(),this.newDevice.email=this.newDevice.email.trim(),this.ereaderDevice){if(this.ereaderDevice.name!==this.newDevice.name&&this.existingDevices.some((function(e){return e.name===r.newDevice.name})))return void this.$toast.error(this.$strings.ToastDeviceNameAlreadyExists);this.submitUpdate()}else{if(this.existingDevices.some((function(e){return e.name===r.newDevice.name})))return void this.$toast.error(this.$strings.ToastDeviceNameAlreadyExists);this.submitCreate()}else this.$toast.error(this.$strings.ToastNameEmailRequired)},submitUpdate:function(){var e=this;this.processing=!0;var t=this.existingDevices.filter((function(t){return t.name!==e.ereaderDevice.name})),r={ereaderDevices:[].concat(Object(o.a)(t),[c({},this.newDevice)])};this.$axios.$post("/api/me/ereader-devices",r).then((function(data){e.$emit("update",data.ereaderDevices),e.show=!1})).catch((function(t){var r;console.error("Failed to update device",t),null!==(r=t.response)&&void 0!==r&&null!==(r=r.data)&&void 0!==r&&r.toLowerCase().includes("duplicate")?e.$toast.error(e.$strings.ToastDeviceNameAlreadyExists):e.$toast.error(e.$strings.ToastDeviceAddFailed)})).finally((function(){e.processing=!1}))},submitCreate:function(){var e=this;this.processing=!0;var t={ereaderDevices:[].concat(Object(o.a)(this.existingDevices),[c({},this.newDevice)])};this.$axios.$post("/api/me/ereader-devices",t).then((function(data){e.$emit("update",data.ereaderDevices||[]),e.show=!1})).catch((function(t){var r;console.error("Failed to add device",t),null!==(r=t.response)&&void 0!==r&&null!==(r=r.data)&&void 0!==r&&r.toLowerCase().includes("duplicate")?e.$toast.error(e.$strings.ToastDeviceNameAlreadyExists):e.$toast.error(e.$strings.ToastDeviceAddFailed)})).finally((function(){e.processing=!1}))},init:function(){this.ereaderDevice?(this.newDevice.name=this.ereaderDevice.name,this.newDevice.email=this.ereaderDevice.email,this.newDevice.availabilityOption=this.ereaderDevice.availabilityOption||"specificUsers",this.newDevice.users=this.ereaderDevice.users||[this.user.id]):(this.newDevice.name="",this.newDevice.email="",this.newDevice.availabilityOption="specificUsers",this.newDevice.users=[this.user.id])}},mounted:function(){}},v=r(4),component=Object(v.a)(d,(function(){var e=this,t=e._self._c;return t("modals-modal",{ref:"modal",attrs:{name:"ereader-device-edit",width:800,height:"unset",processing:e.processing},scopedSlots:e._u([{key:"outer",fn:function(){return[t("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[t("p",{staticClass:"text-3xl text-white truncate"},[e._v(e._s(e.title))])])]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"w-full text-sm rounded-lg bg-bg shadow-lg border border-black-300"},[t("div",{staticClass:"w-full px-3 py-5 md:p-12"},[t("div",{staticClass:"flex items-center -mx-1 mb-4"},[t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"ereaderNameInput",attrs:{disabled:e.processing,label:e.$strings.LabelName},model:{value:e.newDevice.name,callback:function(t){e.$set(e.newDevice,"name",t)},expression:"newDevice.name"}})],1),e._v(" "),t("div",{staticClass:"w-full md:w-1/2 px-1"},[t("ui-text-input-with-label",{ref:"ereaderEmailInput",attrs:{disabled:e.processing,label:e.$strings.LabelEmail},model:{value:e.newDevice.email,callback:function(t){e.$set(e.newDevice,"email",t)},expression:"newDevice.email"}})],1)]),e._v(" "),t("div",{staticClass:"flex items-center pt-4"},[t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[e._v(e._s(e.$strings.ButtonSubmit))])],1)])])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:r(121).default,UiBtn:r(42).default,ModalsModal:r(39).default})}}]);