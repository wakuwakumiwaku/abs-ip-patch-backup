(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{836:function(e,t,r){"use strict";r.r(t);r(15),r(147);var n=r(16);r(22),r(17),r(26),r(27),r(44),r(45),r(38),r(8),r(28);function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var l={props:{value:Boolean,apiKey:{type:Object,default:function(){return null}},users:{type:Array,default:function(){return[]}}},data:function(){return{processing:!1,newApiKey:{},isNew:!0}},watch:{show:{handler:function(e){e&&this.init()}}},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},title:function(){return this.isNew?this.$strings.HeaderNewApiKey:this.$strings.HeaderUpdateApiKey},userItems:function(){var e=this;return this.users.filter((function(u){return"root"!==u.type||e.$store.getters["user/getIsRoot"]})).map((function(u){return{text:u.username,value:u.id,subtext:u.type}}))},isExpired:function(){return!(!this.apiKey||!this.apiKey.expiresAt)&&new Date(this.apiKey.expiresAt).getTime()<Date.now()}},methods:{submitForm:function(){this.newApiKey.name?this.newApiKey.userId?this.isNew?this.submitCreateApiKey():this.submitUpdateApiKey():this.$toast.error(this.$strings.ToastNewApiKeyUserError):this.$toast.error(this.$strings.ToastNameRequired)},submitUpdateApiKey:function(){var e=this;if(this.newApiKey.isActive===this.apiKey.isActive&&this.newApiKey.userId===this.apiKey.userId)return this.$toast.info(this.$strings.ToastNoUpdatesNecessary),void(this.show=!1);var t={isActive:this.newApiKey.isActive,userId:this.newApiKey.userId};this.processing=!0,this.$axios.$patch("/api/api-keys/".concat(this.apiKey.id),t).then((function(data){e.processing=!1,data.error?e.$toast.error("".concat(e.$strings.ToastFailedToUpdate,": ").concat(data.error)):(e.show=!1,e.$emit("updated",data.apiKey))})).catch((function(t){e.processing=!1,console.error("Failed to update apiKey",t);var r=t.response&&t.response.data||"";e.$toast.error(r||e.$strings.ToastFailedToUpdate)}))},submitCreateApiKey:function(){var e=this,t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},this.newApiKey);this.newApiKey.expiresIn?t.expiresIn=parseInt(this.newApiKey.expiresIn):delete t.expiresIn,this.processing=!0,this.$axios.$post("/api/api-keys",t).then((function(data){e.processing=!1,data.error?e.$toast.error(e.$strings.ToastFailedToCreate+": "+data.error):(e.show=!1,e.$emit("created",data.apiKey))})).catch((function(t){e.processing=!1,console.error("Failed to create apiKey",t);var r=t.response&&t.response.data||"";e.$toast.error(r||e.$strings.ToastFailedToCreate)}))},init:function(){this.isNew=!this.apiKey,this.apiKey?this.newApiKey={name:this.apiKey.name,isActive:this.apiKey.isActive,userId:this.apiKey.userId}:this.newApiKey={name:null,expiresIn:null,isActive:!0,userId:null}}},mounted:function(){}},c=l,d=r(4),component=Object(d.a)(c,(function(){var e=this,t=e._self._c;return t("modals-modal",{ref:"modal",attrs:{name:"api-key",width:800,height:"unset",processing:e.processing},scopedSlots:e._u([{key:"outer",fn:function(){return[t("div",{staticClass:"absolute top-0 left-0 p-5 w-2/3 overflow-hidden"},[t("p",{staticClass:"text-3xl text-white truncate"},[e._v(e._s(e.title))])])]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"px-4 w-full text-sm py-6 rounded-lg bg-bg shadow-lg border border-black-300 overflow-y-auto overflow-x-hidden",staticStyle:{"min-height":"400px","max-height":"80vh"}},[t("div",{staticClass:"w-full p-8"},[t("div",{staticClass:"flex py-2"},[t("div",{staticClass:"w-1/2 px-2"},[t("ui-text-input-with-label",{attrs:{readonly:!e.isNew,label:e.$strings.LabelName},model:{value:e.newApiKey.name,callback:function(t){e.$set(e.newApiKey,"name","string"==typeof t?t.trim():t)},expression:"newApiKey.name"}})],1),e._v(" "),e.isNew?t("div",{staticClass:"w-1/2 px-2"},[t("ui-text-input-with-label",{attrs:{label:e.$strings.LabelExpiresInSeconds,type:"number",min:0},model:{value:e.newApiKey.expiresIn,callback:function(t){e.$set(e.newApiKey,"expiresIn","string"==typeof t?t.trim():t)},expression:"newApiKey.expiresIn"}})],1):e._e()]),e._v(" "),t("div",{staticClass:"flex items-center pt-4 pb-2 gap-2"},[t("div",{staticClass:"flex items-center px-2"},[t("p",{staticClass:"px-3 font-semibold",attrs:{id:"user-enabled-toggle"}},[e._v(e._s(e.$strings.LabelEnable))]),e._v(" "),t("ui-toggle-switch",{attrs:{disabled:e.isExpired&&!e.apiKey.isActive,labeledBy:"user-enabled-toggle"},model:{value:e.newApiKey.isActive,callback:function(t){e.$set(e.newApiKey,"isActive",t)},expression:"newApiKey.isActive"}})],1),e._v(" "),e.isExpired?t("div",{staticClass:"px-2"},[t("p",{staticClass:"text-sm text-error"},[e._v(e._s(e.$strings.LabelExpired))])]):e._e()]),e._v(" "),t("div",{staticClass:"w-full border-t border-b border-black-200 py-4 px-3 mt-4"},[t("p",{staticClass:"text-lg mb-2 font-semibold"},[e._v(e._s(e.$strings.LabelApiKeyUser))]),e._v(" "),t("p",{staticClass:"text-sm mb-2 text-gray-400"},[e._v(e._s(e.$strings.LabelApiKeyUserDescription))]),e._v(" "),t("ui-select-input",{attrs:{disabled:e.isExpired&&!e.apiKey.isActive,items:e.userItems,placeholder:e.$strings.LabelSelectUser,label:e.$strings.LabelApiKeyUser,"label-hidden":""},model:{value:e.newApiKey.userId,callback:function(t){e.$set(e.newApiKey,"userId",t)},expression:"newApiKey.userId"}})],1),e._v(" "),t("div",{staticClass:"flex pt-4 px-2"},[t("div",{staticClass:"grow"}),e._v(" "),t("ui-btn",{attrs:{color:"bg-success",type:"submit"}},[e._v(e._s(e.$strings.ButtonSubmit))])],1)])])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:r(121).default,UiToggleSwitch:r(185).default,UiSelectInput:r(364).default,UiBtn:r(42).default,ModalsModal:r(39).default})}}]);