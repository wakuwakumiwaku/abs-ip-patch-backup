(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{1094:function(e,t,o){"use strict";o.r(t);var n=o(7),r=(o(29),o(17),{props:{libraryItem:{type:Object,default:function(){}}},data:function(){return{checkingNewEpisodes:!1,lastEpisodeCheckInput:null,maxEpisodesToDownload:3}},watch:{lastEpisodeCheck:{handler:function(e){e&&this.setLastEpisodeCheckInput()}}},computed:{userIsAdminOrUp:function(){return this.$store.getters["user/getIsAdminOrUp"]},autoDownloadEpisodes:function(){return!!this.media.autoDownloadEpisodes},lastEpisodeCheck:function(){return this.media.lastEpisodeCheck},media:function(){return this.libraryItem&&this.libraryItem.media||{}},libraryItemId:function(){return this.libraryItem?this.libraryItem.id:null},episodes:function(){return this.media.episodes||[]}},methods:{checkForNewEpisodes:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.lastCheckInput&&e.$refs.lastCheckInput.blur(),e.$refs.maxEpisodesInput&&e.$refs.maxEpisodesInput.blur(),!(e.maxEpisodesToDownload<0)){t.next=6;break}return e.maxEpisodesToDownload=3,e.$toast.error(e.$strings.ToastInvalidMaxEpisodesToDownload),t.abrupt("return");case 6:if(e.checkingNewEpisodes=!0,!(o=new Date(e.lastEpisodeCheckInput).valueOf())||o===e.lastEpisodeCheck){t.next=15;break}return t.next=11,e.$axios.$patch("/api/items/".concat(e.libraryItemId,"/media"),{lastEpisodeCheck:o}).catch((function(e){return console.error("Failed to update",e),!1}));case 11:n=t.sent,console.log("updateResult",n),t.next=19;break;case 15:if(o){t.next=19;break}return e.$toast.error(e.$strings.ToastDateTimeInvalidOrIncomplete),e.checkingNewEpisodes=!1,t.abrupt("return",!1);case 19:e.$axios.$get("/api/podcasts/".concat(e.libraryItemId,"/checknew?limit=").concat(e.maxEpisodesToDownload)).then((function(t){t.episodes&&t.episodes.length?(console.log("New episodes",t.episodes.length),e.$toast.success(e.$getString("ToastNewEpisodesFound",[t.episodes.length]))):e.$toast.info(e.$strings.ToastNoNewEpisodesFound),e.checkingNewEpisodes=!1})).catch((function(t){console.error("Failed",t);var o=t.response&&t.response.data?t.response.data:"Unknown Error";e.$toast.error(o),e.checkingNewEpisodes=!1}));case 20:case"end":return t.stop()}}),t)})))()},setLastEpisodeCheckInput:function(){this.lastEpisodeCheckInput=this.lastEpisodeCheck?this.$formatDate(this.lastEpisodeCheck,"yyyy-MM-dd'T'HH:mm"):null}},mounted:function(){this.setLastEpisodeCheckInput()}}),l=o(4),component=Object(l.a)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"w-full h-full overflow-y-auto overflow-x-hidden px-4 py-6"},[t("div",{staticClass:"w-full mb-4"},[e.userIsAdminOrUp?t("div",{staticClass:"flex items-end justify-end mb-4"},[t("ui-text-input-with-label",{ref:"lastCheckInput",staticClass:"max-w-xs mr-2",attrs:{disabled:e.checkingNewEpisodes,type:"datetime-local",label:e.$strings.LabelLookForNewEpisodesAfterDate},model:{value:e.lastEpisodeCheckInput,callback:function(t){e.lastEpisodeCheckInput=t},expression:"lastEpisodeCheckInput"}}),e._v(" "),t("ui-text-input-with-label",{ref:"maxEpisodesInput",staticClass:"w-16 mr-2",attrs:{disabled:e.checkingNewEpisodes,type:"number",label:e.$strings.LabelLimit,"input-class":"h-10"},model:{value:e.maxEpisodesToDownload,callback:function(t){e.maxEpisodesToDownload=t},expression:"maxEpisodesToDownload"}},[t("div",{staticClass:"flex -mb-0.5"},[t("p",{staticClass:"px-1 text-sm font-semibold",class:{"text-gray-400":e.checkingNewEpisodes}},[e._v(e._s(e.$strings.LabelLimit))]),e._v(" "),t("ui-tooltip",{attrs:{direction:"top",text:e.$strings.LabelMaxEpisodesToDownload}},[t("span",{staticClass:"material-symbols text-base"},[e._v("info")])])],1)]),e._v(" "),t("ui-btn",{attrs:{loading:e.checkingNewEpisodes},on:{click:e.checkForNewEpisodes}},[e._v(e._s(e.$strings.ButtonCheckAndDownloadNewEpisodes))])],1):e._e(),e._v(" "),e.episodes.length?t("div",{staticClass:"w-full p-4 bg-primary"},[t("p",[e._v(e._s(e.$strings.HeaderEpisodes))])]):e._e(),e._v(" "),e.episodes.length?t("table",{staticClass:"text-sm tracksTable"},[t("tr",[t("th",{staticClass:"text-center w-20 min-w-20"},[e._v(e._s(e.$strings.LabelEpisode))]),e._v(" "),t("th",{staticClass:"text-left"},[e._v(e._s(e.$strings.LabelEpisodeTitle))]),e._v(" "),t("th",{staticClass:"text-center w-28"},[e._v(e._s(e.$strings.LabelEpisodeDuration))]),e._v(" "),t("th",{staticClass:"text-center w-28"},[e._v(e._s(e.$strings.LabelEpisodeSize))])]),e._v(" "),e._l(e.episodes,(function(o){return t("tr",{key:o.id},[t("td",{staticClass:"text-center w-20 min-w-20"},[t("p",[e._v(e._s(o.episode))])]),e._v(" "),t("td",{attrs:{dir:"auto"}},[e._v("\n          "+e._s(o.title)+"\n        ")]),e._v(" "),t("td",{staticClass:"font-mono text-center"},[e._v("\n          "+e._s(e.$secondsToTimestamp(o.duration))+"\n        ")]),e._v(" "),t("td",{staticClass:"font-mono text-center"},[e._v("\n          "+e._s(e.$bytesPretty(o.size))+"\n        ")])])}))],2):t("div",{staticClass:"flex my-4 text-center justify-center text-xl"},[e._v(e._s(e.$strings.MessageNoEpisodes))])])])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UiTextInputWithLabel:o(121).default,UiTooltip:o(76).default,UiBtn:o(42).default})}}]);